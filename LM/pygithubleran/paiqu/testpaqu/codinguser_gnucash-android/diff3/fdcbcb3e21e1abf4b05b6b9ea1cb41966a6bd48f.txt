From 157c39df6b96488b7e88d986ec6fe96c4a42c5cc Mon Sep 17 00:00:00 2001
From: Oleksandr Tyshkovets <olexandr.tyshkovets@gmail.com>
Date: Tue, 5 May 2015 19:01:12 +0300
Subject: [PATCH 1/4] Change currency more obvious

---
 .../android/ui/chart/ChartReportActivity.java      | 46 +++++++++++++++++
 app/src/main/res/layout/activity_chart_report.xml  | 60 ++++++++++++++++------
 app/src/main/res/values-de/strings.xml             |  3 +-
 app/src/main/res/values-el/strings.xml             |  3 +-
 app/src/main/res/values-es-rMX/strings.xml         |  3 +-
 app/src/main/res/values-es/strings.xml             |  3 +-
 app/src/main/res/values-fr/strings.xml             |  3 +-
 app/src/main/res/values-hu/strings.xml             |  3 +-
 app/src/main/res/values-it/strings.xml             |  3 +-
 app/src/main/res/values-nb/strings.xml             |  3 +-
 app/src/main/res/values-nl/strings.xml             |  3 +-
 app/src/main/res/values-pt-rBR/strings.xml         |  3 +-
 app/src/main/res/values-ru/strings.xml             |  3 +-
 app/src/main/res/values-zh/strings.xml             |  3 +-
 app/src/main/res/values/strings.xml                |  2 +-
 .../main/res/xml/fragment_report_preferences.xml   |  2 +-
 16 files changed, 117 insertions(+), 29 deletions(-)

diff --git a/app/src/main/java/org/gnucash/android/ui/chart/ChartReportActivity.java b/app/src/main/java/org/gnucash/android/ui/chart/ChartReportActivity.java
index 2eb47065..bbfef97d 100644
--- a/app/src/main/java/org/gnucash/android/ui/chart/ChartReportActivity.java
+++ b/app/src/main/java/org/gnucash/android/ui/chart/ChartReportActivity.java
@@ -18,11 +18,22 @@
 
 import android.content.Intent;
 import android.os.Bundle;
+import android.preference.PreferenceManager;
 import android.view.View;
+import android.widget.AdapterView;
+import android.widget.ArrayAdapter;
+import android.widget.Spinner;
 
 import org.gnucash.android.R;
+import org.gnucash.android.db.AccountsDbAdapter;
+import org.gnucash.android.model.Money;
 import org.gnucash.android.ui.passcode.PassLockActivity;
 
+import java.util.ArrayList;
+import java.util.Arrays;
+import java.util.Currency;
+import java.util.List;
+
 /**
  * Allows to select chart by type
  *
@@ -37,6 +48,40 @@ protected void onCreate(Bundle savedInstanceState) {
         super.onCreate(savedInstanceState);
         getSupportActionBar().setTitle(R.string.title_reports);
 
+        final List<String> allCurrencyCodes = Arrays.asList(getResources().getStringArray(R.array.key_currency_codes));
+        final List<String> allCurrencyNames = Arrays.asList(getResources().getStringArray(R.array.currency_names));
+
+        Currency preferredCurrency = Currency.getInstance(PreferenceManager
+                .getDefaultSharedPreferences(getApplicationContext())
+                .getString(getString(R.string.key_report_currency), Money.DEFAULT_CURRENCY_CODE));
+        List<Currency> currencies = AccountsDbAdapter.getInstance().getCurrencies();
+        if (currencies.remove(preferredCurrency)) {
+            currencies.add(0, preferredCurrency);
+        }
+        List<String> currencyNames = new ArrayList<>();
+        for (Currency currency : currencies) {
+            currencyNames.add(allCurrencyNames.get(allCurrencyCodes.indexOf(currency.getCurrencyCode())));
+        }
+
+        Spinner spinner = (Spinner) findViewById(R.id.report_currency_spinner);
+        ArrayAdapter<String> dataAdapter = new ArrayAdapter<>(this, android.R.layout.simple_spinner_item, currencyNames);
+        dataAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
+        spinner.setAdapter(dataAdapter);
+        spinner.setOnItemSelectedListener(new AdapterView.OnItemSelectedListener() {
+            @Override
+            public void onItemSelected(AdapterView<?> adapterView, View view, int i, long l) {
+                String currencyName = (String) ((Spinner) findViewById(R.id.report_currency_spinner)).getSelectedItem();
+                PreferenceManager.getDefaultSharedPreferences(getApplicationContext())
+                        .edit()
+                        .putString(getString(R.string.key_report_currency), allCurrencyCodes.get(allCurrencyNames.indexOf(currencyName)))
+                        .commit();
+            }
+
+            @Override
+            public void onNothingSelected(AdapterView<?> adapterView) {
+            }
+        });
+
         findViewById(R.id.pie_chart_button).setOnClickListener(new View.OnClickListener() {
             @Override
             public void onClick(View view) {
@@ -57,4 +102,5 @@ public void onClick(View view) {
         });
 
     }
+
 }
diff --git a/app/src/main/res/layout/activity_chart_report.xml b/app/src/main/res/layout/activity_chart_report.xml
index 2ea395b9..208602ae 100644
--- a/app/src/main/res/layout/activity_chart_report.xml
+++ b/app/src/main/res/layout/activity_chart_report.xml
@@ -21,27 +21,57 @@
     android:id="@+id/drawer_layout"
     android:layout_width="match_parent"
     android:layout_height="match_parent">
+
     <LinearLayout
-        android:orientation="horizontal"
+        android:orientation="vertical"
         android:layout_width="match_parent"
         android:layout_height="match_parent"
-        android:gravity="center_horizontal|center_vertical">
+        android:gravity="center_vertical">
 
-        <ImageButton
-            android:id="@+id/bar_chart_button"
-            android:layout_width="wrap_content"
-            android:layout_height="wrap_content"
-            android:src="@drawable/chart_bar_button" />
-        <ImageButton
-            android:id="@+id/pie_chart_button"
-            android:layout_width="wrap_content"
+        <LinearLayout
+            android:orientation="horizontal"
+            android:layout_width="match_parent"
             android:layout_height="wrap_content"
-            android:src="@drawable/chart_pie_button" />
-        <ImageButton
-            android:id="@+id/line_chart_button"
-            android:layout_width="wrap_content"
+            android:gravity="center_horizontal">
+
+            <ImageButton
+                android:id="@+id/bar_chart_button"
+                android:layout_width="wrap_content"
+                android:layout_height="wrap_content"
+                android:src="@drawable/chart_bar_button" />
+            <ImageButton
+                android:id="@+id/pie_chart_button"
+                android:layout_width="wrap_content"
+                android:layout_height="wrap_content"
+                android:src="@drawable/chart_pie_button" />
+            <ImageButton
+                android:id="@+id/line_chart_button"
+                android:layout_width="wrap_content"
+                android:layout_height="wrap_content"
+                android:src="@drawable/chart_line_button" />
+
+        </LinearLayout>
+
+        <LinearLayout
+            android:orientation="vertical"
+            android:layout_width="match_parent"
             android:layout_height="wrap_content"
-            android:src="@drawable/chart_line_button" />
+            android:gravity="center_horizontal"
+            android:layout_marginTop="30dp">
+
+            <TextView
+                android:id="@+id/textView"
+                android:layout_width="wrap_content"
+                android:layout_height="wrap_content"
+                android:textAppearance ="?android:attr/textAppearanceMedium"
+                android:text="@string/label_report_currency" />
+
+            <Spinner
+                android:id="@+id/report_currency_spinner"
+                android:layout_width="wrap_content"
+                android:layout_height="wrap_content" />
+
+        </LinearLayout>
 
     </LinearLayout>
 
diff --git a/app/src/main/res/values-de/strings.xml b/app/src/main/res/values-de/strings.xml
index d6b01b16..7fe479e7 100644
--- a/app/src/main/res/values-de/strings.xml
+++ b/app/src/main/res/values-de/strings.xml
@@ -461,7 +461,6 @@
 	<string name="toast_install_file_manager">Install a file manager to select files</string>
 	<string name="title_select_backup_to_restore">Select backup to restore</string>
 	<string name="title_report_prefs">Report Preferences</string>
-	<string name="title_report_currency">title_report_currency</string>
 	<string name="nav_menu_favorites">Favorites</string>
 	<string name="nav_menu_open">Open</string>
 	<string name="nav_menu_reports">Reports</string>
@@ -489,4 +488,6 @@
 No user-identifiable information will be collected as part of this process!</string>
     <string name="label_export_format">Export Format</string>
 	<string name="toast_backup_folder_not_found">Backup folder cannot be found. Make sure the SD Card is mounted!</string>
+	<string name="header_report_settings">Reports</string>
+	<string name="label_report_currency">Select currency</string>
 </resources>
diff --git a/app/src/main/res/values-el/strings.xml b/app/src/main/res/values-el/strings.xml
index 92c8a96d..8b02fe6b 100644
--- a/app/src/main/res/values-el/strings.xml
+++ b/app/src/main/res/values-el/strings.xml
@@ -479,7 +479,6 @@
 	<string name="toast_install_file_manager">Install a file manager to select files</string>
 	<string name="title_select_backup_to_restore">Select backup to restore</string>
 	<string name="title_report_prefs">Report Preferences</string>
-	<string name="title_report_currency">title_report_currency</string>
 	<string name="nav_menu_favorites">Favorites</string>
 	<string name="nav_menu_open">Open...</string>
 	<string name="nav_menu_reports">Reports</string>
@@ -508,4 +507,6 @@ No user-identifiable information will be collected as part of this process!
     </string>
     <string name="label_export_format">Export Format</string>
 	<string name="toast_backup_folder_not_found">Backup folder cannot be found. Make sure the SD Card is mounted!</string>
+	<string name="header_report_settings">Reports</string>
+	<string name="label_report_currency">Select currency</string>
 </resources>
diff --git a/app/src/main/res/values-es-rMX/strings.xml b/app/src/main/res/values-es-rMX/strings.xml
index 0b914507..a7e9440d 100644
--- a/app/src/main/res/values-es-rMX/strings.xml
+++ b/app/src/main/res/values-es-rMX/strings.xml
@@ -464,7 +464,6 @@
     <string name="toast_install_file_manager">Install a file manager to select files</string>
     <string name="title_select_backup_to_restore">Select backup to restore</string>
     <string name="title_report_prefs">Report Preferences</string>
-    <string name="title_report_currency">title_report_currency</string>
     <string name="nav_menu_favorites">Favorites</string>
     <string name="nav_menu_open">Open...</string>
     <string name="nav_menu_reports">Reports</string>
@@ -493,4 +492,6 @@ No user-identifiable information will be collected as part of this process!
     </string>
     <string name="label_export_format">Export Format</string>
     <string name="toast_backup_folder_not_found">Backup folder cannot be found. Make sure the SD Card is mounted!</string>
+    <string name="header_report_settings">Reports</string>
+    <string name="label_report_currency">Select currency</string>
 </resources>
diff --git a/app/src/main/res/values-es/strings.xml b/app/src/main/res/values-es/strings.xml
index 4f442c0c..20d5f7a4 100644
--- a/app/src/main/res/values-es/strings.xml
+++ b/app/src/main/res/values-es/strings.xml
@@ -451,7 +451,6 @@
 	<string name="export_warning_xml">Exportar todas las cuentas y transacciones</string>
 	<string name="title_google_drive_sync_pref">Google Drive Sync</string>
 	<string name="title_report_prefs">Report Preferences</string>
-	<string name="title_report_currency">title_report_currency</string>
 	<string name="summary_google_drive_sync">Activar sincronizaci&#243;n con Google Drive</string>
 	<string name="toast_install_file_manager">Instale un gestor de archivos para seleccionar archivos</string>
 	<string name="title_select_backup_to_restore">Seleccione la copia de seguridad a restaurar</string>
@@ -490,4 +489,6 @@
 Este proceso solo recoge informaci&#243;n que no permite identificar al usuario</string>
     <string name="label_export_format">Formato de exportaci&#243;n</string>
 	<string name="toast_backup_folder_not_found">Backup folder cannot be found. Make sure the SD Card is mounted!</string>
+	<string name="header_report_settings">Reports</string>
+	<string name="label_report_currency">Select currency</string>
 </resources>
diff --git a/app/src/main/res/values-fr/strings.xml b/app/src/main/res/values-fr/strings.xml
index 786917fc..071bd75f 100644
--- a/app/src/main/res/values-fr/strings.xml
+++ b/app/src/main/res/values-fr/strings.xml
@@ -461,7 +461,6 @@
     <string name="toast_install_file_manager">Install a file manager to select files</string>
     <string name="title_select_backup_to_restore">Select backup to restore</string>
     <string name="title_report_prefs">Report Preferences</string>
-    <string name="title_report_currency">title_report_currency</string>
     <string name="nav_menu_favorites">Favorites</string>
     <string name="nav_menu_open">Open...</string>
     <string name="nav_menu_reports">Reports</string>
@@ -490,4 +489,6 @@ No user-identifiable information will be collected as part of this process!
     </string>
     <string name="label_export_format">Export Format</string>
     <string name="toast_backup_folder_not_found">Backup folder cannot be found. Make sure the SD Card is mounted!</string>
+    <string name="header_report_settings">Reports</string>
+    <string name="label_report_currency">Select currency</string>
 </resources>
diff --git a/app/src/main/res/values-hu/strings.xml b/app/src/main/res/values-hu/strings.xml
index 06ccfaea..d2c5e743 100644
--- a/app/src/main/res/values-hu/strings.xml
+++ b/app/src/main/res/values-hu/strings.xml
@@ -465,7 +465,6 @@
     <string name="toast_install_file_manager">Install a file manager to select files</string>
     <string name="title_select_backup_to_restore">Select backup to restore</string>
     <string name="title_report_prefs">Report Preferences</string>
-    <string name="title_report_currency">title_report_currency</string>
     <string name="nav_menu_favorites">Favorites</string>
     <string name="nav_menu_open">Open...</string>
     <string name="nav_menu_reports">Reports</string>
@@ -494,4 +493,6 @@ No user-identifiable information will be collected as part of this process!
     </string>
     <string name="label_export_format">Export Format</string>
     <string name="toast_backup_folder_not_found">Backup folder cannot be found. Make sure the SD Card is mounted!</string>
+    <string name="header_report_settings">Reports</string>
+    <string name="label_report_currency">Select currency</string>
 </resources>
\ No newline at end of file
diff --git a/app/src/main/res/values-it/strings.xml b/app/src/main/res/values-it/strings.xml
index 8c113eae..f35c87cb 100644
--- a/app/src/main/res/values-it/strings.xml
+++ b/app/src/main/res/values-it/strings.xml
@@ -465,7 +465,6 @@
     <string name="toast_install_file_manager">Install a file manager to select files</string>
     <string name="title_select_backup_to_restore">Select backup to restore</string>
     <string name="title_report_prefs">Report Preferences</string>
-    <string name="title_report_currency">title_report_currency</string>
     <string name="nav_menu_favorites">Favorites</string>
     <string name="nav_menu_open">Open...</string>
     <string name="nav_menu_reports">Reports</string>
@@ -494,4 +493,6 @@ No user-identifiable information will be collected as part of this process!
     </string>
     <string name="label_export_format">Export Format</string>
     <string name="toast_backup_folder_not_found">Backup folder cannot be found. Make sure the SD Card is mounted!</string>
+    <string name="header_report_settings">Reports</string>
+    <string name="label_report_currency">Select currency</string>
 </resources>
diff --git a/app/src/main/res/values-nb/strings.xml b/app/src/main/res/values-nb/strings.xml
index 79f02f9a..2d8a4a2c 100644
--- a/app/src/main/res/values-nb/strings.xml
+++ b/app/src/main/res/values-nb/strings.xml
@@ -462,7 +462,6 @@
 	<string name="toast_install_file_manager">Install a file manager to select files</string>
 	<string name="title_select_backup_to_restore">Select backup to restore</string>
 	<string name="title_report_prefs">Report Preferences</string>
-	<string name="title_report_currency">title_report_currency</string>
 	<string name="nav_menu_favorites">Favorites</string>
 	<string name="nav_menu_open">Open...</string>
 	<string name="nav_menu_reports">Reports</string>
@@ -491,4 +490,6 @@ No user-identifiable information will be collected as part of this process!
     </string>
     <string name="label_export_format">Export Format</string>
 	<string name="toast_backup_folder_not_found">Backup folder cannot be found. Make sure the SD Card is mounted!</string>
+	<string name="header_report_settings">Reports</string>
+	<string name="label_report_currency">Select currency</string>
 </resources>
diff --git a/app/src/main/res/values-nl/strings.xml b/app/src/main/res/values-nl/strings.xml
index 86e1103f..5b880806 100644
--- a/app/src/main/res/values-nl/strings.xml
+++ b/app/src/main/res/values-nl/strings.xml
@@ -466,7 +466,6 @@
     <string name="toast_install_file_manager">Install a file manager to select files</string>
     <string name="title_select_backup_to_restore">Select backup to restore</string>
     <string name="title_report_prefs">Report Preferences</string>
-    <string name="title_report_currency">title_report_currency</string>
     <string name="nav_menu_favorites">Favorites</string>
     <string name="nav_menu_open">Open...</string>
     <string name="nav_menu_reports">Reports</string>
@@ -495,4 +494,6 @@ No user-identifiable information will be collected as part of this process!
     </string>
     <string name="label_export_format">Export Format</string>
     <string name="toast_backup_folder_not_found">Backup folder cannot be found. Make sure the SD Card is mounted!</string>
+    <string name="header_report_settings">Reports</string>
+    <string name="label_report_currency">Select currency</string>
 </resources>
diff --git a/app/src/main/res/values-pt-rBR/strings.xml b/app/src/main/res/values-pt-rBR/strings.xml
index 5973a7f2..e7f44d7b 100644
--- a/app/src/main/res/values-pt-rBR/strings.xml
+++ b/app/src/main/res/values-pt-rBR/strings.xml
@@ -464,7 +464,6 @@
 	<string name="toast_install_file_manager">Install a file manager to select files</string>
 	<string name="title_select_backup_to_restore">Select backup to restore</string>
 	<string name="title_report_prefs">Report Preferences</string>
-	<string name="title_report_currency">title_report_currency</string>
 	<string name="nav_menu_favorites">Favorites</string>
 	<string name="nav_menu_open">Open...</string>
 	<string name="nav_menu_reports">Reports</string>
@@ -493,4 +492,6 @@ No user-identifiable information will be collected as part of this process!
     </string>
     <string name="label_export_format">Export Format</string>
 	<string name="toast_backup_folder_not_found">Backup folder cannot be found. Make sure the SD Card is mounted!</string>
+	<string name="header_report_settings">Reports</string>
+	<string name="label_report_currency">Select currency</string>
 </resources>
diff --git a/app/src/main/res/values-ru/strings.xml b/app/src/main/res/values-ru/strings.xml
index 4d388b99..58d1dc89 100644
--- a/app/src/main/res/values-ru/strings.xml
+++ b/app/src/main/res/values-ru/strings.xml
@@ -466,7 +466,6 @@
     <string name="toast_install_file_manager">Install a file manager to select files</string>
     <string name="title_select_backup_to_restore">Select backup to restore</string>
     <string name="title_report_prefs">Report Preferences</string>
-    <string name="title_report_currency">title_report_currency</string>
     <string name="nav_menu_favorites">Favorites</string>
     <string name="nav_menu_open">Open...</string>
     <string name="nav_menu_reports">Reports</string>
@@ -499,4 +498,6 @@ No user-identifiable information will be collected as part of this process!
     </string>
     <string name="label_export_format">Export Format</string>
     <string name="toast_backup_folder_not_found">Backup folder cannot be found. Make sure the SD Card is mounted!</string>
+    <string name="header_report_settings">Reports</string>
+    <string name="label_report_currency">Select currency</string>
 </resources>
diff --git a/app/src/main/res/values-zh/strings.xml b/app/src/main/res/values-zh/strings.xml
index d083eb10..d8a15d39 100644
--- a/app/src/main/res/values-zh/strings.xml
+++ b/app/src/main/res/values-zh/strings.xml
@@ -461,7 +461,6 @@
     <string name="toast_install_file_manager">Install a file manager to select files</string>
     <string name="title_select_backup_to_restore">Select backup to restore</string>
     <string name="title_report_prefs">Report Preferences</string>
-    <string name="title_report_currency">title_report_currency</string>
     <string name="nav_menu_favorites">Favorites</string>
     <string name="nav_menu_open">Open...</string>
     <string name="nav_menu_reports">Reports</string>
@@ -491,4 +490,6 @@ No user-identifiable information will be collected as part of this process!
     </string>
     <string name="label_export_format">Export Format</string>
     <string name="toast_backup_folder_not_found">Backup folder cannot be found. Make sure the SD Card is mounted!</string>
+    <string name="header_report_settings">Reports</string>
+    <string name="label_report_currency">Select currency</string>
 </resources>
diff --git a/app/src/main/res/values/strings.xml b/app/src/main/res/values/strings.xml
index 60682f15..202a2a60 100644
--- a/app/src/main/res/values/strings.xml
+++ b/app/src/main/res/values/strings.xml
@@ -435,7 +435,7 @@
     <string name="title_line_chart">Line Chart</string>
     <string name="title_bar_chart">Bar Chart</string>
     <string name="title_report_prefs">Report Preferences</string>
-    <string name="title_report_currency">Report currency</string>
+    <string name="label_report_currency">Select currency</string>
     <string name="header_report_settings">Reports</string>
     <string name="menu_order_by_size">Order by size</string>
     <string name="menu_toggle_legend">Toggle legend</string>
diff --git a/app/src/main/res/xml/fragment_report_preferences.xml b/app/src/main/res/xml/fragment_report_preferences.xml
index b6f5ba67..a87a4edf 100644
--- a/app/src/main/res/xml/fragment_report_preferences.xml
+++ b/app/src/main/res/xml/fragment_report_preferences.xml
@@ -18,7 +18,7 @@
 <PreferenceScreen xmlns:android="http://schemas.android.com/apk/res/android" >
     <PreferenceCategory android:title="@string/title_report_prefs">
         <ListPreference android:key="@string/key_report_currency"
-                        android:title="@string/title_report_currency" />
+                        android:title="@string/label_report_currency" />
     </PreferenceCategory>
 
 </PreferenceScreen>
\ No newline at end of file

From 9293f11cf9cfb75e947d9e8e603f7d7366cb91a4 Mon Sep 17 00:00:00 2001
From: Oleksandr Tyshkovets <olexandr.tyshkovets@gmail.com>
Date: Wed, 6 May 2015 17:05:54 +0300
Subject: [PATCH 2/4] Use account color in the pie chart

---
 .../org/gnucash/android/ui/chart/PieChartActivity.java | 12 +++++++++++-
 .../android/ui/settings/ReportPreferenceFragment.java  | 18 ++++++++++++------
 app/src/main/res/values-de/strings.xml                 |  2 ++
 app/src/main/res/values-el/strings.xml                 |  2 ++
 app/src/main/res/values-es-rMX/strings.xml             |  2 ++
 app/src/main/res/values-es/strings.xml                 |  2 ++
 app/src/main/res/values-fr/strings.xml                 |  2 ++
 app/src/main/res/values-hu/strings.xml                 |  2 ++
 app/src/main/res/values-it/strings.xml                 |  2 ++
 app/src/main/res/values-nb/strings.xml                 |  2 ++
 app/src/main/res/values-nl/strings.xml                 |  2 ++
 app/src/main/res/values-pt-rBR/strings.xml             |  2 ++
 app/src/main/res/values-ru/strings.xml                 |  2 ++
 app/src/main/res/values-zh/strings.xml                 |  2 ++
 app/src/main/res/values/donottranslate.xml             |  1 +
 app/src/main/res/values/strings.xml                    |  2 ++
 app/src/main/res/xml/fragment_report_preferences.xml   |  4 ++++
 17 files changed, 54 insertions(+), 7 deletions(-)

diff --git a/app/src/main/java/org/gnucash/android/ui/chart/PieChartActivity.java b/app/src/main/java/org/gnucash/android/ui/chart/PieChartActivity.java
index 88fcd945..3755125f 100644
--- a/app/src/main/java/org/gnucash/android/ui/chart/PieChartActivity.java
+++ b/app/src/main/java/org/gnucash/android/ui/chart/PieChartActivity.java
@@ -82,7 +82,7 @@
     };
 
     private static final String DATE_PATTERN = "MMMM\nYYYY";
-    private static final String TOTAL_VALUE_LABEL_PATTERN = "%s\n%.2f %s";
+    private static final String TOTAL_VALUE_LABEL_PATTERN = "%s\n%.2f%s";
     private static final int ANIMATION_DURATION = 1800;
 
     private PieChart mChart;
@@ -103,6 +103,8 @@
 
     private boolean mChartDataPresent = true;
 
+    private boolean mUseAccountColor = true;
+
     private double mSlicePercentThreshold = 6;
 
     private String mCurrencyCode;
@@ -114,6 +116,9 @@ protected void onCreate(Bundle savedInstanceState) {
         super.onCreate(savedInstanceState);
         getSupportActionBar().setTitle(R.string.title_pie_chart);
 
+        mUseAccountColor = PreferenceManager.getDefaultSharedPreferences(getApplicationContext())
+                .getBoolean(getString(R.string.key_use_account_color), false);
+
         mPreviousMonthButton = (ImageButton) findViewById(R.id.previous_month_chart_button);
         mNextMonthButton = (ImageButton) findViewById(R.id.next_month_chart_button);
         mChartDateTextView = (TextView) findViewById(R.id.chart_date);
@@ -226,6 +231,11 @@ private PieData getData(boolean forCurrentMonth) {
 
                 if (balance / sum * 100 > mSlicePercentThreshold) {
                     dataSet.addEntry(new Entry((float) balance, dataSet.getEntryCount()));
+                    if (mUseAccountColor) {
+                        dataSet.getColors().set(dataSet.getColors().size() - 1, (account.getColorHexCode() != null)
+                                ? Color.parseColor(account.getColorHexCode())
+                                : COLORS[(dataSet.getEntryCount() - 1) % COLORS.length]);
+                    }
                     dataSet.addColor(COLORS[(dataSet.getEntryCount() - 1) % COLORS.length]);
                     names.add(account.getName());
                 } else {
diff --git a/app/src/main/java/org/gnucash/android/ui/settings/ReportPreferenceFragment.java b/app/src/main/java/org/gnucash/android/ui/settings/ReportPreferenceFragment.java
index 90f38dc7..e4c82dc6 100644
--- a/app/src/main/java/org/gnucash/android/ui/settings/ReportPreferenceFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/settings/ReportPreferenceFragment.java
@@ -94,12 +94,18 @@ public void onResume() {
 
     @Override
     public boolean onPreferenceChange(Preference preference, Object newValue) {
-        preference.setSummary(newValue.toString());
-        PreferenceManager.getDefaultSharedPreferences(getActivity())
-                .edit()
-                .putString(getString(R.string.key_report_currency), newValue.toString())
-                .commit();
-
+        if (preference.getKey().equals(getString(R.string.key_report_currency))) {
+            preference.setSummary(newValue.toString());
+            PreferenceManager.getDefaultSharedPreferences(getActivity())
+                    .edit()
+                    .putString(getString(R.string.key_report_currency), newValue.toString())
+                    .commit();
+        } else if (preference.getKey().equals(getString(R.string.key_use_account_color))) {
+            PreferenceManager.getDefaultSharedPreferences(getActivity())
+                    .edit()
+                    .putString(getString(R.string.key_use_account_color), newValue.toString())
+                    .commit();
+        }
         return true;
     }
 
diff --git a/app/src/main/res/values-de/strings.xml b/app/src/main/res/values-de/strings.xml
index 7fe479e7..eefdccc0 100644
--- a/app/src/main/res/values-de/strings.xml
+++ b/app/src/main/res/values-de/strings.xml
@@ -490,4 +490,6 @@ No user-identifiable information will be collected as part of this process!</str
 	<string name="toast_backup_folder_not_found">Backup folder cannot be found. Make sure the SD Card is mounted!</string>
 	<string name="header_report_settings">Reports</string>
 	<string name="label_report_currency">Select currency</string>
+	<string name="title_use_account_color">Account color in reports</string>
+	<string name="summary_use_account_color">Use account color in the pie chart</string>
 </resources>
diff --git a/app/src/main/res/values-el/strings.xml b/app/src/main/res/values-el/strings.xml
index 8b02fe6b..daae6efb 100644
--- a/app/src/main/res/values-el/strings.xml
+++ b/app/src/main/res/values-el/strings.xml
@@ -509,4 +509,6 @@ No user-identifiable information will be collected as part of this process!
 	<string name="toast_backup_folder_not_found">Backup folder cannot be found. Make sure the SD Card is mounted!</string>
 	<string name="header_report_settings">Reports</string>
 	<string name="label_report_currency">Select currency</string>
+	<string name="title_use_account_color">Account color in reports</string>
+	<string name="summary_use_account_color">Use account color in the pie chart</string>
 </resources>
diff --git a/app/src/main/res/values-es-rMX/strings.xml b/app/src/main/res/values-es-rMX/strings.xml
index a7e9440d..a9b699db 100644
--- a/app/src/main/res/values-es-rMX/strings.xml
+++ b/app/src/main/res/values-es-rMX/strings.xml
@@ -494,4 +494,6 @@ No user-identifiable information will be collected as part of this process!
     <string name="toast_backup_folder_not_found">Backup folder cannot be found. Make sure the SD Card is mounted!</string>
     <string name="header_report_settings">Reports</string>
     <string name="label_report_currency">Select currency</string>
+    <string name="title_use_account_color">Account color in reports</string>
+    <string name="summary_use_account_color">Use account color in the pie chart</string>
 </resources>
diff --git a/app/src/main/res/values-es/strings.xml b/app/src/main/res/values-es/strings.xml
index 20d5f7a4..d495135c 100644
--- a/app/src/main/res/values-es/strings.xml
+++ b/app/src/main/res/values-es/strings.xml
@@ -491,4 +491,6 @@ Este proceso solo recoge informaci&#243;n que no permite identificar al usuario<
 	<string name="toast_backup_folder_not_found">Backup folder cannot be found. Make sure the SD Card is mounted!</string>
 	<string name="header_report_settings">Reports</string>
 	<string name="label_report_currency">Select currency</string>
+	<string name="title_use_account_color">Account color in reports</string>
+	<string name="summary_use_account_color">Use account color in the pie chart</string>
 </resources>
diff --git a/app/src/main/res/values-fr/strings.xml b/app/src/main/res/values-fr/strings.xml
index 071bd75f..94cefb41 100644
--- a/app/src/main/res/values-fr/strings.xml
+++ b/app/src/main/res/values-fr/strings.xml
@@ -491,4 +491,6 @@ No user-identifiable information will be collected as part of this process!
     <string name="toast_backup_folder_not_found">Backup folder cannot be found. Make sure the SD Card is mounted!</string>
     <string name="header_report_settings">Reports</string>
     <string name="label_report_currency">Select currency</string>
+    <string name="title_use_account_color">Account color in reports</string>
+    <string name="summary_use_account_color">Use account color in the pie chart</string>
 </resources>
diff --git a/app/src/main/res/values-hu/strings.xml b/app/src/main/res/values-hu/strings.xml
index d2c5e743..b0a31341 100644
--- a/app/src/main/res/values-hu/strings.xml
+++ b/app/src/main/res/values-hu/strings.xml
@@ -495,4 +495,6 @@ No user-identifiable information will be collected as part of this process!
     <string name="toast_backup_folder_not_found">Backup folder cannot be found. Make sure the SD Card is mounted!</string>
     <string name="header_report_settings">Reports</string>
     <string name="label_report_currency">Select currency</string>
+    <string name="title_use_account_color">Account color in reports</string>
+    <string name="summary_use_account_color">Use account color in the pie chart</string>
 </resources>
\ No newline at end of file
diff --git a/app/src/main/res/values-it/strings.xml b/app/src/main/res/values-it/strings.xml
index f35c87cb..d5215d02 100644
--- a/app/src/main/res/values-it/strings.xml
+++ b/app/src/main/res/values-it/strings.xml
@@ -495,4 +495,6 @@ No user-identifiable information will be collected as part of this process!
     <string name="toast_backup_folder_not_found">Backup folder cannot be found. Make sure the SD Card is mounted!</string>
     <string name="header_report_settings">Reports</string>
     <string name="label_report_currency">Select currency</string>
+    <string name="title_use_account_color">Account color in reports</string>
+    <string name="summary_use_account_color">Use account color in the pie chart</string>
 </resources>
diff --git a/app/src/main/res/values-nb/strings.xml b/app/src/main/res/values-nb/strings.xml
index 2d8a4a2c..392b5f30 100644
--- a/app/src/main/res/values-nb/strings.xml
+++ b/app/src/main/res/values-nb/strings.xml
@@ -492,4 +492,6 @@ No user-identifiable information will be collected as part of this process!
 	<string name="toast_backup_folder_not_found">Backup folder cannot be found. Make sure the SD Card is mounted!</string>
 	<string name="header_report_settings">Reports</string>
 	<string name="label_report_currency">Select currency</string>
+	<string name="title_use_account_color">Account color in reports</string>
+	<string name="summary_use_account_color">Use account color in the pie chart</string>
 </resources>
diff --git a/app/src/main/res/values-nl/strings.xml b/app/src/main/res/values-nl/strings.xml
index 5b880806..f385acce 100644
--- a/app/src/main/res/values-nl/strings.xml
+++ b/app/src/main/res/values-nl/strings.xml
@@ -496,4 +496,6 @@ No user-identifiable information will be collected as part of this process!
     <string name="toast_backup_folder_not_found">Backup folder cannot be found. Make sure the SD Card is mounted!</string>
     <string name="header_report_settings">Reports</string>
     <string name="label_report_currency">Select currency</string>
+    <string name="title_use_account_color">Account color in reports</string>
+    <string name="summary_use_account_color">Use account color in the pie chart</string>
 </resources>
diff --git a/app/src/main/res/values-pt-rBR/strings.xml b/app/src/main/res/values-pt-rBR/strings.xml
index e7f44d7b..b30baf9b 100644
--- a/app/src/main/res/values-pt-rBR/strings.xml
+++ b/app/src/main/res/values-pt-rBR/strings.xml
@@ -494,4 +494,6 @@ No user-identifiable information will be collected as part of this process!
 	<string name="toast_backup_folder_not_found">Backup folder cannot be found. Make sure the SD Card is mounted!</string>
 	<string name="header_report_settings">Reports</string>
 	<string name="label_report_currency">Select currency</string>
+	<string name="title_use_account_color">Account color in reports</string>
+	<string name="summary_use_account_color">Use account color in the pie chart</string>
 </resources>
diff --git a/app/src/main/res/values-ru/strings.xml b/app/src/main/res/values-ru/strings.xml
index 58d1dc89..31500dc4 100644
--- a/app/src/main/res/values-ru/strings.xml
+++ b/app/src/main/res/values-ru/strings.xml
@@ -500,4 +500,6 @@ No user-identifiable information will be collected as part of this process!
     <string name="toast_backup_folder_not_found">Backup folder cannot be found. Make sure the SD Card is mounted!</string>
     <string name="header_report_settings">Reports</string>
     <string name="label_report_currency">Select currency</string>
+    <string name="title_use_account_color">Account color in reports</string>
+    <string name="summary_use_account_color">Use account color in the pie chart</string>
 </resources>
diff --git a/app/src/main/res/values-zh/strings.xml b/app/src/main/res/values-zh/strings.xml
index d8a15d39..4d90f344 100644
--- a/app/src/main/res/values-zh/strings.xml
+++ b/app/src/main/res/values-zh/strings.xml
@@ -492,4 +492,6 @@ No user-identifiable information will be collected as part of this process!
     <string name="toast_backup_folder_not_found">Backup folder cannot be found. Make sure the SD Card is mounted!</string>
     <string name="header_report_settings">Reports</string>
     <string name="label_report_currency">Select currency</string>
+    <string name="title_use_account_color">Account color in reports</string>
+    <string name="summary_use_account_color">Use account color in the pie chart</string>
 </resources>
diff --git a/app/src/main/res/values/donottranslate.xml b/app/src/main/res/values/donottranslate.xml
index 9f041ff9..88a52157 100644
--- a/app/src/main/res/values/donottranslate.xml
+++ b/app/src/main/res/values/donottranslate.xml
@@ -28,6 +28,7 @@
     <string name="key_google_drive_app_folder_id">google_drive_app_folder</string>
     <string name="key_report_currency">report_currency</string>
     <string name="key_enable_crashlytics">enable_crashlytics</string>
+    <string name="key_use_account_color">use_account_color</string>
 
     <string-array name="key_transaction_type_values">
         <item>CREDIT</item>
diff --git a/app/src/main/res/values/strings.xml b/app/src/main/res/values/strings.xml
index 202a2a60..9b3384e7 100644
--- a/app/src/main/res/values/strings.xml
+++ b/app/src/main/res/values/strings.xml
@@ -436,6 +436,8 @@
     <string name="title_bar_chart">Bar Chart</string>
     <string name="title_report_prefs">Report Preferences</string>
     <string name="label_report_currency">Select currency</string>
+    <string name="title_use_account_color">Account color in reports</string>
+    <string name="summary_use_account_color">Use account color in the pie chart</string>
     <string name="header_report_settings">Reports</string>
     <string name="menu_order_by_size">Order by size</string>
     <string name="menu_toggle_legend">Toggle legend</string>
diff --git a/app/src/main/res/xml/fragment_report_preferences.xml b/app/src/main/res/xml/fragment_report_preferences.xml
index a87a4edf..548d84ed 100644
--- a/app/src/main/res/xml/fragment_report_preferences.xml
+++ b/app/src/main/res/xml/fragment_report_preferences.xml
@@ -19,6 +19,10 @@
     <PreferenceCategory android:title="@string/title_report_prefs">
         <ListPreference android:key="@string/key_report_currency"
                         android:title="@string/label_report_currency" />
+
+        <CheckBoxPreference android:key="@string/key_use_account_color"
+                            android:title="@string/title_use_account_color"
+                            android:summary="@string/summary_use_account_color" />
     </PreferenceCategory>
 
 </PreferenceScreen>
\ No newline at end of file

From f405c433f32fb6d78b075a29511e0765fc6a38ba Mon Sep 17 00:00:00 2001
From: Oleksandr Tyshkovets <olexandr.tyshkovets@gmail.com>
Date: Wed, 6 May 2015 17:47:51 +0300
Subject: [PATCH 3/4] Removed report currency option from settings

---
 .../ui/settings/ReportPreferenceFragment.java      | 56 ++--------------------
 .../android/ui/settings/SettingsActivity.java      | 23 ---------
 .../main/res/xml/fragment_report_preferences.xml   |  3 --
 3 files changed, 3 insertions(+), 79 deletions(-)

diff --git a/app/src/main/java/org/gnucash/android/ui/settings/ReportPreferenceFragment.java b/app/src/main/java/org/gnucash/android/ui/settings/ReportPreferenceFragment.java
index e4c82dc6..abfeaa05 100644
--- a/app/src/main/java/org/gnucash/android/ui/settings/ReportPreferenceFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/settings/ReportPreferenceFragment.java
@@ -17,9 +17,7 @@
 package org.gnucash.android.ui.settings;
 
 import android.annotation.TargetApi;
-import android.content.SharedPreferences;
 import android.os.Bundle;
-import android.preference.ListPreference;
 import android.preference.Preference;
 import android.preference.Preference.OnPreferenceChangeListener;
 import android.preference.PreferenceFragment;
@@ -29,13 +27,6 @@
 import com.actionbarsherlock.app.SherlockPreferenceActivity;
 
 import org.gnucash.android.R;
-import org.gnucash.android.db.AccountsDbAdapter;
-import org.gnucash.android.model.Money;
-
-import java.util.ArrayList;
-import java.util.Arrays;
-import java.util.Currency;
-import java.util.List;
 
 /**
  * Report settings fragment inside the Settings activity
@@ -54,56 +45,15 @@ public void onCreate(Bundle savedInstanceState) {
         actionBar.setDisplayHomeAsUpEnabled(true);
         actionBar.setTitle(R.string.title_report_prefs);
 
-        List<Currency> currencyList = AccountsDbAdapter.getInstance().getCurrencies();
-        int size = currencyList.size();
-        String[] currencyCodes = new String[size];
-        for (Currency currency : currencyList) {
-            currencyCodes[--size] = currency.getCurrencyCode();
-        }
-
-        ListPreference pref = (ListPreference) findPreference(getString(R.string.key_report_currency));
-        pref.setEntryValues(currencyCodes);
-        pref.setOnPreferenceChangeListener(this);
-
-
-        List<String> currencyNames = new ArrayList<>();
-        String[] allCurrencyNames = getResources().getStringArray(R.array.currency_names);
-        List<String> allCurrencyCodes = Arrays.asList(getResources().getStringArray(R.array.key_currency_codes));
-        for (String code : currencyCodes) {
-            currencyNames.add(allCurrencyNames[allCurrencyCodes.indexOf(code)]);
-        }
-
-        pref.setEntries(currencyNames.toArray(new String[currencyNames.size()]));
-    }
-
-    @Override
-    public void onResume() {
-        super.onResume();
-
-        SharedPreferences sharedPreferences = PreferenceManager.getDefaultSharedPreferences(getActivity());
-        String keyChartCurrency = getString(R.string.key_report_currency);
-        Preference pref = findPreference(keyChartCurrency);
-        String chartCurrency = sharedPreferences.getString(keyChartCurrency, null);
-        if (chartCurrency != null && !chartCurrency.trim().isEmpty()) {
-            pref.setSummary(chartCurrency);
-        } else {
-            pref.setSummary(sharedPreferences.getString(getString(R.string.key_default_currency), Money.DEFAULT_CURRENCY_CODE));
-        }
-
+        findPreference(getString(R.string.key_use_account_color)).setOnPreferenceChangeListener(this);
     }
 
     @Override
     public boolean onPreferenceChange(Preference preference, Object newValue) {
-        if (preference.getKey().equals(getString(R.string.key_report_currency))) {
-            preference.setSummary(newValue.toString());
-            PreferenceManager.getDefaultSharedPreferences(getActivity())
-                    .edit()
-                    .putString(getString(R.string.key_report_currency), newValue.toString())
-                    .commit();
-        } else if (preference.getKey().equals(getString(R.string.key_use_account_color))) {
+        if (preference.getKey().equals(getString(R.string.key_use_account_color))) {
             PreferenceManager.getDefaultSharedPreferences(getActivity())
                     .edit()
-                    .putString(getString(R.string.key_use_account_color), newValue.toString())
+                    .putBoolean(getString(R.string.key_use_account_color), Boolean.valueOf(newValue.toString()))
                     .commit();
         }
         return true;
diff --git a/app/src/main/java/org/gnucash/android/ui/settings/SettingsActivity.java b/app/src/main/java/org/gnucash/android/ui/settings/SettingsActivity.java
index 94744683..82fdd46d 100644
--- a/app/src/main/java/org/gnucash/android/ui/settings/SettingsActivity.java
+++ b/app/src/main/java/org/gnucash/android/ui/settings/SettingsActivity.java
@@ -27,12 +27,9 @@
 import android.content.Intent;
 import android.content.IntentSender;
 import android.content.SharedPreferences;
-import android.content.SharedPreferences.Editor;
-import android.content.pm.PackageManager.NameNotFoundException;
 import android.os.Build;
 import android.os.Bundle;
 import android.preference.CheckBoxPreference;
-import android.preference.ListPreference;
 import android.preference.Preference;
 import android.preference.Preference.OnPreferenceChangeListener;
 import android.preference.PreferenceManager;
@@ -206,20 +203,6 @@ protected void onCreate(Bundle savedInstanceState) {
             pref.setOnPreferenceChangeListener(this);
             pref.setTitle(((CheckBoxPreference) pref).isChecked() ?
                     getString(R.string.title_passcode_enabled) : getString(R.string.title_passcode_disabled));
-
-            pref = findPreference(getString(R.string.key_report_currency));
-            pref.setOnPreferenceChangeListener(this);
-            pref.setSummary(PreferenceManager.getDefaultSharedPreferences(getApplicationContext()).getString(
-                    getString(R.string.key_report_currency), Money.DEFAULT_CURRENCY_CODE));
-
-            List<Currency> currencyList = AccountsDbAdapter.getInstance().getCurrencies();
-            int size = currencyList.size();
-            String[] currencyCodes = new String[size];
-            for (Currency currency : currencyList) {
-                currencyCodes[--size] = currency.getCurrencyCode();
-            }
-            ((ListPreference) pref).setEntryValues(currencyCodes);
-            ((ListPreference) pref).setEntries(currencyCodes);
         }
 	}
 
@@ -276,12 +259,6 @@ public boolean onPreferenceChange(Preference preference, Object newValue) {
                     .commit();
         } else if (preference.getKey().equals(getString(R.string.key_use_double_entry))){
             setImbalanceAccountsHidden((Boolean) newValue);
-        } else if (preference.getKey().equals(getString(R.string.key_report_currency))) {
-            preference.setSummary(newValue.toString());
-            PreferenceManager.getDefaultSharedPreferences(getApplicationContext())
-                    .edit()
-                    .putString(getString(R.string.key_report_currency), newValue.toString())
-                    .commit();
         }
 
 		return true;
diff --git a/app/src/main/res/xml/fragment_report_preferences.xml b/app/src/main/res/xml/fragment_report_preferences.xml
index 548d84ed..1e000034 100644
--- a/app/src/main/res/xml/fragment_report_preferences.xml
+++ b/app/src/main/res/xml/fragment_report_preferences.xml
@@ -17,9 +17,6 @@
 
 <PreferenceScreen xmlns:android="http://schemas.android.com/apk/res/android" >
     <PreferenceCategory android:title="@string/title_report_prefs">
-        <ListPreference android:key="@string/key_report_currency"
-                        android:title="@string/label_report_currency" />
-
         <CheckBoxPreference android:key="@string/key_use_account_color"
                             android:title="@string/title_use_account_color"
                             android:summary="@string/summary_use_account_color" />

From e03b60bd8daa40646efac4f17eae7d710bfbf9f3 Mon Sep 17 00:00:00 2001
From: Oleksandr Tyshkovets <olexandr.tyshkovets@gmail.com>
Date: Fri, 8 May 2015 21:51:07 +0300
Subject: [PATCH 4/4] Updated charting lib

---
 app/build.gradle                                   |  2 +-
 .../gnucash/android/ui/chart/BarChartActivity.java | 31 +++++++------
 .../android/ui/chart/LargeValueFormatter.java      | 51 ----------------------
 .../android/ui/chart/LineChartActivity.java        | 29 ++++++------
 .../gnucash/android/ui/chart/PieChartActivity.java | 18 ++++----
 5 files changed, 43 insertions(+), 88 deletions(-)
 delete mode 100644 app/src/main/java/org/gnucash/android/ui/chart/LargeValueFormatter.java

diff --git a/app/build.gradle b/app/build.gradle
index 2e73ba66..d23a329c 100644
--- a/app/build.gradle
+++ b/app/build.gradle
@@ -114,7 +114,7 @@ dependencies {
             'com.viewpagerindicator:library:2.4.1@aar',
             'com.doomonafireball.betterpickers:library:1.5.2',
             'com.commonsware.cwac:merge:1.1.+',
-            'com.github.PhilJay:MPAndroidChart:v2.0.8',
+            'com.github.PhilJay:MPAndroidChart:v2.1.0',
             'joda-time:joda-time:2.7',
             'com.google.android.gms:play-services-drive:7.0.0',
             'com.crashlytics.android:crashlytics:1.+'
diff --git a/app/src/main/java/org/gnucash/android/ui/chart/BarChartActivity.java b/app/src/main/java/org/gnucash/android/ui/chart/BarChartActivity.java
index 132604a6..3a7cefa0 100644
--- a/app/src/main/java/org/gnucash/android/ui/chart/BarChartActivity.java
+++ b/app/src/main/java/org/gnucash/android/ui/chart/BarChartActivity.java
@@ -34,6 +34,7 @@
 import com.github.mikephil.charting.data.Entry;
 import com.github.mikephil.charting.listener.OnChartValueSelectedListener;
 import com.github.mikephil.charting.utils.Highlight;
+import com.github.mikephil.charting.utils.LargeValueFormatter;
 
 import org.gnucash.android.R;
 import org.gnucash.android.db.AccountsDbAdapter;
@@ -75,8 +76,8 @@
 
     private BarChart mChart;
     private AccountsDbAdapter mAccountsDbAdapter = AccountsDbAdapter.getInstance();
-    private Map<AccountType, Long> mEarliestTimestampsMap = new HashMap<AccountType, Long>();
-    private Map<AccountType, Long> mLatestTimestampsMap = new HashMap<AccountType, Long>();
+    private Map<AccountType, Long> mEarliestTimestampsMap = new HashMap<>();
+    private Map<AccountType, Long> mLatestTimestampsMap = new HashMap<>();
     private long mEarliestTransactionTimestamp;
     private long mLatestTransactionTimestamp;
     private boolean mTotalPercentageMode = true;
@@ -97,13 +98,15 @@ protected void onCreate(Bundle savedInstanceState) {
         ((LinearLayout) findViewById(R.id.chart)).addView(mChart);
         mChart.setOnChartValueSelectedListener(this);
         mChart.setDescription("");
+        mChart.getXAxis().setDrawGridLines(false);
+        mChart.getAxisRight().setEnabled(false);
+        mChart.getAxisLeft().enableGridDashedLine(4.0f, 4.0f, 0);
         mChart.setDrawValuesForWholeStack(false);
-        mChart.setDrawBarShadow(false);
         mChart.getAxisLeft().setValueFormatter(new LargeValueFormatter(mCurrency.getSymbol(Locale.getDefault())));
         mChart.getAxisRight().setEnabled(false);
 
         // below we can add/remove displayed account's types
-        mChart.setData(getData(new ArrayList<AccountType>(Arrays.asList(AccountType.INCOME, AccountType.EXPENSE))));
+        mChart.setData(getData(new ArrayList<>(Arrays.asList(AccountType.INCOME, AccountType.EXPENSE))));
 
         Legend legend = mChart.getLegend();
         legend.setForm(Legend.LegendForm.CIRCLE);
@@ -126,7 +129,7 @@ protected void onCreate(Bundle savedInstanceState) {
      * @param accountTypeList account's types which will be displayed
      * @return a {@code BarData} instance that represents a user data
      */
-    private BarData getData(ArrayList<AccountType> accountTypeList) {
+    private BarData getData(List<AccountType> accountTypeList) {
         calculateEarliestAndLatestTimestamps(accountTypeList);
 
         LocalDateTime startDate = new LocalDateTime(mEarliestTransactionTimestamp).withDayOfMonth(1).withMillisOfDay(0);
@@ -135,9 +138,9 @@ private BarData getData(ArrayList<AccountType> accountTypeList) {
         Log.d(TAG, "X-axis end date: " + endDate.toString("dd MM yyyy"));
         int months = Months.monthsBetween(startDate, endDate).getMonths();
 
-        ArrayList<BarDataSet> dataSets = new ArrayList<BarDataSet>();
-        ArrayList<BarEntry> values = new ArrayList<BarEntry>();
-        ArrayList<String> xValues = new ArrayList<String>();
+        List<BarDataSet> dataSets = new ArrayList<>();
+        List<BarEntry> values = new ArrayList<>();
+        List<String> xValues = new ArrayList<>();
         for (int i = 0; i <= months; i++) {
             xValues.add(startDate.toString(X_AXIS_PATTERN));
 
@@ -189,7 +192,7 @@ private void calculateEarliestAndLatestTimestamps(List<AccountType> accountTypeL
             return;
         }
 
-        List<Long> timestamps = new ArrayList<Long>(mEarliestTimestampsMap.values());
+        List<Long> timestamps = new ArrayList<>(mEarliestTimestampsMap.values());
         timestamps.addAll(mLatestTimestampsMap.values());
         Collections.sort(timestamps);
         mEarliestTransactionTimestamp = timestamps.get(0);
@@ -203,9 +206,9 @@ private void calculateEarliestAndLatestTimestamps(List<AccountType> accountTypeL
      * @return a map with an account type as key and correspond accounts UIDs as value
      */
     private Map<AccountType, List<String>> getAccountTypeToAccountUidMap(List<AccountType> accountTypeList) {
-        Map<AccountType, List<String>> accountMap = new HashMap<AccountType, List<String>>();
+        Map<AccountType, List<String>> accountMap = new HashMap<>();
         for (AccountType accountType : accountTypeList) {
-            List<String> accountUIDList = new ArrayList<String>();
+            List<String> accountUIDList = new ArrayList<>();
             for (Account account : mAccountsDbAdapter.getSimpleAccountList()) {
                 if (account.getAccountType() == accountType
                         && !account.isPlaceholderAccount()
@@ -223,8 +226,8 @@ private void calculateEarliestAndLatestTimestamps(List<AccountType> accountTypeL
      * @return a {@code BarData} instance for situation when no user data available
      */
     private BarData getEmptyData() {
-        ArrayList<String> xValues = new ArrayList<String>();
-        ArrayList<BarEntry> yValues = new ArrayList<BarEntry>();
+        List<String> xValues = new ArrayList<>();
+        List<BarEntry> yValues = new ArrayList<>();
         for (int i = 0; i < NO_DATA_BAR_COUNTS; i++) {
             xValues.add("");
             yValues.add(new BarEntry(i % 2 == 0 ? 5f : 4.5f, i));
@@ -233,7 +236,7 @@ private BarData getEmptyData() {
         set.setDrawValues(false);
         set.setColor(NO_DATA_COLOR);
 
-        return new BarData(xValues, new ArrayList<BarDataSet>(Arrays.asList(set)));
+        return new BarData(xValues, Collections.singletonList(set));
     }
 
     @Override
diff --git a/app/src/main/java/org/gnucash/android/ui/chart/LargeValueFormatter.java b/app/src/main/java/org/gnucash/android/ui/chart/LargeValueFormatter.java
deleted file mode 100644
index 9307c5e4..00000000
--- a/app/src/main/java/org/gnucash/android/ui/chart/LargeValueFormatter.java
+++ /dev/null
@@ -1,51 +0,0 @@
-package org.gnucash.android.ui.chart;
-
-import com.github.mikephil.charting.utils.ValueFormatter;
-
-import java.text.DecimalFormat;
-
-/**
- * Value-formatter that formats large numbers in a pretty way.
- * This is a slightly enhanced version of {@link com.github.mikephil.charting.utils.LargeValueFormatter}.
- *
- * @author Oleksandr Tyshkovets <olexandr.tyshkovets@gmail.com>
- */
-public class LargeValueFormatter implements ValueFormatter {
-
-    private static final String[] SUFFIX = new String[] {
-            "", "k", "m", "b", "t"
-    };
-    private static final int MAX_LENGTH = 4;
-
-    private DecimalFormat mFormat;
-    private String mText;
-
-    public LargeValueFormatter() {
-        mFormat = new DecimalFormat("###E0");
-    }
-
-    /**
-     * Creates a formatter that appends a specified text to the result string
-     * @param text a text that will be appended
-     */
-    public LargeValueFormatter(String text) {
-        this();
-        mText = text;
-    }
-
-    @Override
-    public String getFormattedValue(float value) {
-        return makePretty(value) + " " + mText;
-    }
-
-    private String makePretty(double number) {
-        String r = mFormat.format(number);
-        r = r.replaceAll("E[0-9]", SUFFIX[Character.getNumericValue(r.charAt(r.length() - 1)) / 3]);
-        while (r.length() > MAX_LENGTH || r.matches("[0-9]+\\.[a-z]")) {
-            r = r.substring(0, r.length() - 2) + r.substring(r.length() - 1);
-        }
-
-        return r;
-    }
-
-}
diff --git a/app/src/main/java/org/gnucash/android/ui/chart/LineChartActivity.java b/app/src/main/java/org/gnucash/android/ui/chart/LineChartActivity.java
index ca1f2107..de11b676 100644
--- a/app/src/main/java/org/gnucash/android/ui/chart/LineChartActivity.java
+++ b/app/src/main/java/org/gnucash/android/ui/chart/LineChartActivity.java
@@ -33,6 +33,7 @@
 import com.github.mikephil.charting.data.LineDataSet;
 import com.github.mikephil.charting.listener.OnChartValueSelectedListener;
 import com.github.mikephil.charting.utils.Highlight;
+import com.github.mikephil.charting.utils.LargeValueFormatter;
 
 import org.gnucash.android.R;
 import org.gnucash.android.db.AccountsDbAdapter;
@@ -79,8 +80,8 @@
 
     private LineChart mChart;
     private AccountsDbAdapter mAccountsDbAdapter = AccountsDbAdapter.getInstance();
-    private Map<AccountType, Long> mEarliestTimestampsMap = new HashMap<AccountType, Long>();
-    private Map<AccountType, Long> mLatestTimestampsMap = new HashMap<AccountType, Long>();
+    private Map<AccountType, Long> mEarliestTimestampsMap = new HashMap<>();
+    private Map<AccountType, Long> mLatestTimestampsMap = new HashMap<>();
     private long mEarliestTransactionTimestamp;
     private long mLatestTransactionTimestamp;
     private boolean mChartDataPresent = true;
@@ -100,11 +101,13 @@ protected void onCreate(Bundle savedInstanceState) {
         ((LinearLayout) findViewById(R.id.chart)).addView(mChart);
         mChart.setOnChartValueSelectedListener(this);
         mChart.setDescription("");
-        mChart.getAxisLeft().setValueFormatter(new LargeValueFormatter(mCurrency.getSymbol(Locale.getDefault())));
+        mChart.getXAxis().setDrawGridLines(false);
         mChart.getAxisRight().setEnabled(false);
+        mChart.getAxisLeft().enableGridDashedLine(4.0f, 4.0f, 0);
+        mChart.getAxisLeft().setValueFormatter(new LargeValueFormatter(mCurrency.getSymbol(Locale.getDefault())));
 
         // below we can add/remove displayed account's types
-        mChart.setData(getData(new ArrayList<AccountType>(Arrays.asList(AccountType.INCOME, AccountType.EXPENSE))));
+        mChart.setData(getData(new ArrayList<>(Arrays.asList(AccountType.INCOME, AccountType.EXPENSE))));
 
         Legend legend = mChart.getLegend();
         legend.setPosition(Legend.LegendPosition.RIGHT_OF_CHART_INSIDE);
@@ -132,14 +135,14 @@ private LineData getData(List<AccountType> accountTypeList) {
 
         LocalDate startDate = new LocalDate(mEarliestTransactionTimestamp).withDayOfMonth(1);
         LocalDate endDate = new LocalDate(mLatestTransactionTimestamp).withDayOfMonth(1);
-        ArrayList<String> xValues = new ArrayList<String>();
+        List<String> xValues = new ArrayList<>();
         while (!startDate.isAfter(endDate)) {
             xValues.add(startDate.toString(X_AXIS_PATTERN));
             Log.d(TAG, "X axis " + startDate.toString("MM yy"));
             startDate = startDate.plusMonths(1);
         }
 
-        ArrayList<LineDataSet> dataSets = new ArrayList<LineDataSet>();
+        List<LineDataSet> dataSets = new ArrayList<>();
         for (AccountType accountType : accountTypeList) {
             LineDataSet set = new LineDataSet(getEntryList(accountType), accountType.toString());
             set.setDrawFilled(true);
@@ -163,8 +166,8 @@ private LineData getData(List<AccountType> accountTypeList) {
      * @return a {@code LineData} instance for situation when no user data available
      */
     private LineData getEmptyData() {
-        ArrayList<String> xValues = new ArrayList<String>();
-        ArrayList<Entry> yValues = new ArrayList<Entry>();
+        List<String> xValues = new ArrayList<>();
+        List<Entry> yValues = new ArrayList<>();
         for (int i = 0; i < NO_DATA_BAR_COUNTS; i++) {
             xValues.add("");
             yValues.add(new Entry(i % 2 == 0 ? 5f : 4.5f, i));
@@ -175,7 +178,7 @@ private LineData getEmptyData() {
         set.setColor(NO_DATA_COLOR);
         set.setFillColor(NO_DATA_COLOR);
 
-        return new LineData(xValues, new ArrayList<LineDataSet>(Arrays.asList(set)));
+        return new LineData(xValues, Collections.singletonList(set));
     }
 
     /**
@@ -183,8 +186,8 @@ private LineData getEmptyData() {
      * @param accountType account's type which user data will be processed
      * @return entries which represent a user data
      */
-    private ArrayList<Entry> getEntryList(AccountType accountType) {
-        List<String> accountUIDList = new ArrayList<String>();
+    private List<Entry> getEntryList(AccountType accountType) {
+        List<String> accountUIDList = new ArrayList<>();
         for (Account account : mAccountsDbAdapter.getSimpleAccountList()) {
             if (account.getAccountType() == accountType
                     && !account.isPlaceholderAccount()
@@ -201,7 +204,7 @@ private LineData getEmptyData() {
                 latest.withDayOfMonth(1).withMillisOfDay(0)).getMonths();
 
         int offset = getXAxisOffset(accountType);
-        ArrayList<Entry> values = new ArrayList<Entry>(months + 1);
+        List<Entry> values = new ArrayList<>(months + 1);
         for (int i = 0; i < months + 1; i++) {
             long start = earliest.dayOfMonth().withMinimumValue().millisOfDay().withMinimumValue().toDate().getTime();
             long end = earliest.dayOfMonth().withMaximumValue().millisOfDay().withMaximumValue().toDate().getTime();
@@ -236,7 +239,7 @@ private void calculateEarliestAndLatestTimestamps(List<AccountType> accountTypeL
             return;
         }
 
-        List<Long> timestamps = new ArrayList<Long>(mEarliestTimestampsMap.values());
+        List<Long> timestamps = new ArrayList<>(mEarliestTimestampsMap.values());
         timestamps.addAll(mLatestTimestampsMap.values());
         Collections.sort(timestamps);
         mEarliestTransactionTimestamp = timestamps.get(0);
diff --git a/app/src/main/java/org/gnucash/android/ui/chart/PieChartActivity.java b/app/src/main/java/org/gnucash/android/ui/chart/PieChartActivity.java
index 3755125f..20f54acd 100644
--- a/app/src/main/java/org/gnucash/android/ui/chart/PieChartActivity.java
+++ b/app/src/main/java/org/gnucash/android/ui/chart/PieChartActivity.java
@@ -82,7 +82,7 @@
     };
 
     private static final String DATE_PATTERN = "MMMM\nYYYY";
-    private static final String TOTAL_VALUE_LABEL_PATTERN = "%s\n%.2f%s";
+    private static final String TOTAL_VALUE_LABEL_PATTERN = "%s\n%.2f %s";
     private static final int ANIMATION_DURATION = 1800;
 
     private PieChart mChart;
@@ -132,6 +132,7 @@ protected void onCreate(Bundle savedInstanceState) {
         mChart = (PieChart) findViewById(R.id.pie_chart);
         mChart.setCenterTextSize(18);
         mChart.setDescription("");
+        mChart.getLegend().setEnabled(false);
         mChart.setOnChartValueSelectedListener(this);
 
         setUpSpinner();
@@ -198,7 +199,7 @@ private PieData getData(boolean forCurrentMonth) {
         List<Account> accountList = mAccountsDbAdapter.getSimpleAccountList(
                 AccountEntry.COLUMN_TYPE + " = ? AND " + AccountEntry.COLUMN_PLACEHOLDER + " = ?",
                 new String[]{ mAccountType.name(), "0" }, null);
-        List<String> uidList = new ArrayList<String>();
+        List<String> uidList = new ArrayList<>();
         for (Account account : accountList) {
             uidList.add(account.getUID());
         }
@@ -213,8 +214,8 @@ private PieData getData(boolean forCurrentMonth) {
 
         double otherSlice = 0;
         PieDataSet dataSet = new PieDataSet(null, "");
-        ArrayList<String> names = new ArrayList<String>();
-        List<String> skipUUID = new ArrayList<String>();
+        List<String> names = new ArrayList<>();
+        List<String> skipUUID = new ArrayList<>();
         for (Account account : getCurrencyCodeToAccountMap(accountList).get(mCurrencyCode)) {
             if (mAccountsDbAdapter.getSubAccountCount(account.getUID()) > 0) {
                 skipUUID.addAll(mAccountsDbAdapter.getDescendantAccountUIDs(account.getUID(), null, null));
@@ -311,9 +312,9 @@ private void setImageButtonEnabled(ImageButton button, boolean enabled) {
      * Sorts the pie's slices in ascending order
      */
     private void bubbleSort() {
-        ArrayList<String> labels = mChart.getData().getXVals();
-        ArrayList<Entry> values = mChart.getData().getDataSet().getYVals();
-        ArrayList<Integer> colors = mChart.getData().getDataSet().getColors();
+        List<String> labels = mChart.getData().getXVals();
+        List<Entry> values = mChart.getData().getDataSet().getYVals();
+        List<Integer> colors = mChart.getData().getDataSet().getColors();
         float tmp1;
         String tmp2;
         Integer tmp3;
@@ -346,7 +347,7 @@ private void bubbleSort() {
      */
     private void setUpSpinner() {
         Spinner spinner = (Spinner) findViewById(R.id.chart_data_spinner);
-        ArrayAdapter<AccountType> dataAdapter = new ArrayAdapter<AccountType>(this,
+        ArrayAdapter<AccountType> dataAdapter = new ArrayAdapter<>(this,
                 android.R.layout.simple_spinner_item,
                 Arrays.asList(AccountType.EXPENSE, AccountType.INCOME));
         dataAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
@@ -359,7 +360,6 @@ public void onItemSelected(AdapterView<?> adapterView, View view, int i, long l)
                 mLatestTransactionDate = new LocalDateTime(mTransactionsDbAdapter.getTimestampOfLatestTransaction(mAccountType, mCurrencyCode));
                 mChartDate = mLatestTransactionDate;
                 setData(false);
-                mChart.getLegend().setEnabled(false);
             }
 
             @Override
