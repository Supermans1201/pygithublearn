From 4ca4812bd3278b3f62e3311a04a62b14af13df92 Mon Sep 17 00:00:00 2001
From: Ngewi Fet <ngewif@gmail.com>
Date: Wed, 22 Apr 2015 17:27:59 +0200
Subject: [PATCH] Improved: Added dialog to select backup files to restore from

Improved: Handle error when no application can provide files for import
Improved: Open navigation drawer on first run to expose funcationality
Fixed: regression causing db to be deleted even when import fails
---
 .../java/org/gnucash/android/export/Exporter.java  | 25 ++++++-
 .../gnucash/android/importer/GncXmlHandler.java    |  5 +-
 .../org/gnucash/android/model/Transaction.java     |  9 +--
 .../android/ui/account/AccountsActivity.java       | 41 +++++------
 .../android/ui/settings/SettingsActivity.java      | 79 ++++++++++++++++------
 app/src/main/res/values-de/strings.xml             |  2 +
 app/src/main/res/values-el/strings.xml             |  2 +
 app/src/main/res/values-es-rMX/strings.xml         |  2 +
 app/src/main/res/values-es/strings.xml             |  2 +
 app/src/main/res/values-fr/strings.xml             |  2 +
 app/src/main/res/values-hu/strings.xml             |  2 +
 app/src/main/res/values-it/strings.xml             |  2 +
 app/src/main/res/values-nb/strings.xml             |  2 +
 app/src/main/res/values-nl/strings.xml             |  2 +
 app/src/main/res/values-pt-rBR/strings.xml         |  2 +
 app/src/main/res/values-ru/strings.xml             |  2 +
 app/src/main/res/values-zh/strings.xml             |  2 +
 app/src/main/res/values/strings.xml                |  2 +
 18 files changed, 135 insertions(+), 50 deletions(-)

diff --git a/app/src/main/java/org/gnucash/android/export/Exporter.java b/app/src/main/java/org/gnucash/android/export/Exporter.java
index 5b682354..ca9f6845 100644
--- a/app/src/main/java/org/gnucash/android/export/Exporter.java
+++ b/app/src/main/java/org/gnucash/android/export/Exporter.java
@@ -31,6 +31,7 @@
 import java.io.File;
 import java.io.FileFilter;
 import java.io.Writer;
+import java.text.ParseException;
 import java.text.SimpleDateFormat;
 import java.util.Date;
 import java.util.Locale;
@@ -63,6 +64,7 @@
      */
     protected ExportParams mParameters;
 
+    private static final SimpleDateFormat EXPORT_FILENAME_DATE_FORMAT = new SimpleDateFormat("yyyyMMdd_HHmmss", Locale.US);
     /**
      * Adapter for retrieving accounts to export
      * Subclasses should close this object when they are done with exporting
@@ -94,14 +96,30 @@ public Exporter(ExportParams params, SQLiteDatabase db) {
      * @return String containing the file name
      */
     public static String buildExportFilename(ExportFormat format) {
-        SimpleDateFormat formatter = new SimpleDateFormat("yyyyMMdd_HHmmss", Locale.US);
-        String filename = formatter.format(
+        String filename = EXPORT_FILENAME_DATE_FORMAT.format(
                 new Date(System.currentTimeMillis()))
                 + "_gnucash_export" + format.getExtension();
         return filename;
     }
 
     /**
+     * Parses the name of an export file and returns the date of export
+     * @param filename Export file name generated by {@link #buildExportFilename(ExportFormat)}
+     * @return Date in milliseconds
+     */
+    public static long getExportTime(String filename){
+        String[] tokens = filename.split("_");
+        long timeMillis = 0;
+        try {
+            Date date = EXPORT_FILENAME_DATE_FORMAT.parse(tokens[0] + "_" + tokens[1]);
+            timeMillis = date.getTime();
+        } catch (ParseException e) {
+            e.printStackTrace();
+        }
+        return timeMillis;
+    }
+
+    /**
      * Builds a file (creating folders where necessary) for saving the exported data
      * @param format Export format which determines the file extension
      * @return File for export
@@ -113,7 +131,8 @@ public static File createExportFile(ExportFormat format){
     }
 
     /**
-     * Builds a file for backups of the database (in XML) format
+     * Builds a file for backups of the database (in XML) format.
+     * Backups are usually zipped and have extension ".zip"
      * @return File for saving backups
      * @see #BACKUP_FOLDER_PATH
      */
diff --git a/app/src/main/java/org/gnucash/android/importer/GncXmlHandler.java b/app/src/main/java/org/gnucash/android/importer/GncXmlHandler.java
index 4d2769ae..00666a23 100644
--- a/app/src/main/java/org/gnucash/android/importer/GncXmlHandler.java
+++ b/app/src/main/java/org/gnucash/android/importer/GncXmlHandler.java
@@ -208,8 +208,6 @@ private void init(@Nullable SQLiteDatabase db) {
 
         mContent = new StringBuilder();
 
-        mAccountsDbAdapter.deleteAllRecords();
-
         mAccountList = new ArrayList<>();
         mAccountMap = new HashMap<>();
         mTransactionList = new ArrayList<>();
@@ -500,7 +498,7 @@ public void endElement(String uri, String localName, String qualifiedName) throw
                 break;
             case GncXmlHelper.TAG_TRANSACTION:
                 mTransaction.setTemplate(mInTemplates);
-                Split imbSplit = mTransaction.autoBalanceImportAccount();
+                Split imbSplit = mTransaction.getAutoBalanceSplit();
                 if (imbSplit != null) {
                     mAutoBalanceSplits.add(imbSplit);
                 }
@@ -644,6 +642,7 @@ public void endDocument() throws SAXException {
         long startTime = System.nanoTime();
         mAccountsDbAdapter.beginTransaction();
         try {
+            mAccountsDbAdapter.deleteAllRecords();
             long nAccounts = mAccountsDbAdapter.bulkAddAccounts(mAccountList);
             Log.d("Handler:", String.format("%d accounts inserted", nAccounts));
             long nTransactions = mTransactionsDbAdapter.bulkAddTransactions(mTransactionList);
diff --git a/app/src/main/java/org/gnucash/android/model/Transaction.java b/app/src/main/java/org/gnucash/android/model/Transaction.java
index 6a95cf28..d9fc948c 100644
--- a/app/src/main/java/org/gnucash/android/model/Transaction.java
+++ b/app/src/main/java/org/gnucash/android/model/Transaction.java
@@ -164,13 +164,14 @@ private void initDefaults(){
 	}
 
     /**
-     * Auto-balance the transaction by creating an imbalance split where necessary
+     * Creates a split which will balance the transaction
      * <p><b>Note:</b>If a transaction has splits with different currencies, not auto-balancing will be performed.</p>
      *
-     * The added split will not use any account in db, but will use currency code as account UID.
-     * The added split will be returned, to be filled with proper account UID later.
+     * <p>The added split will not use any account in db, but will use currency code as account UID.
+     * The added split will be returned, to be filled with proper account UID later.</p>
+     * @return Split whose amount is the imbalance of this transaction
      */
-    public Split autoBalanceImportAccount(){
+    public Split getAutoBalanceSplit(){
         //FIXME: when multiple currencies per transaction are supported
         Currency lastCurrency = null;
         for (Split split : mSplitList) {
diff --git a/app/src/main/java/org/gnucash/android/ui/account/AccountsActivity.java b/app/src/main/java/org/gnucash/android/ui/account/AccountsActivity.java
index 8d4ce795..d505f361 100644
--- a/app/src/main/java/org/gnucash/android/ui/account/AccountsActivity.java
+++ b/app/src/main/java/org/gnucash/android/ui/account/AccountsActivity.java
@@ -80,11 +80,6 @@
  */
 public class AccountsActivity extends PassLockActivity implements OnAccountClickedListener {
 
-	/**
-	 * Tag used for identifying the account list fragment when it is added to this activity
-	 */
-	public static final String FRAGMENT_ACCOUNTS_LIST 	= "accounts_list_fragment";
-
     /**
      * Request code for GnuCash account structure file to import
      */
@@ -143,7 +138,7 @@
     /**
      * Map containing fragments for the different tabs
      */
-    private SparseArray<Refreshable> mFragmentPageReferenceMap = new SparseArray<Refreshable>();
+    private SparseArray<Refreshable> mFragmentPageReferenceMap = new SparseArray<>();
 
     /**
      * ViewPager which manages the different tabs
@@ -467,18 +462,18 @@ private void showFirstRunDialog() {
         builder.setMessage(R.string.msg_confirm_create_default_accounts_first_run);
 
 		builder.setPositiveButton(R.string.btn_create_accounts, new DialogInterface.OnClickListener() {
-			
-			@Override
-			public void onClick(DialogInterface dialog, int which) {
+
+            @Override
+            public void onClick(DialogInterface dialog, int which) {
                 AlertDialog.Builder adb = new AlertDialog.Builder(AccountsActivity.this);
                 adb.setTitle(R.string.title_choose_currency);
-                ArrayAdapter<String> arrayAdapter = new ArrayAdapter<String>(
+                ArrayAdapter<String> arrayAdapter = new ArrayAdapter<>(
                         AccountsActivity.this,
                         android.R.layout.select_dialog_singlechoice,
                         getResources().getStringArray(R.array.currency_names));
 
                 final List<String> currencyCodes = Arrays.asList(
-                                        getResources().getStringArray(R.array.key_currency_codes));
+                        getResources().getStringArray(R.array.key_currency_codes));
                 String userCurrencyCode = Currency.getInstance(Locale.getDefault()).getCurrencyCode();
                 int currencyIndex = currencyCodes.indexOf(userCurrencyCode.toUpperCase());
 
@@ -496,17 +491,17 @@ public void onClick(DialogInterface dialog, int which) {
                     }
                 });
                 adb.create().show();
-			}
-		});
+            }
+        });
 		
 		builder.setNegativeButton(R.string.btn_cancel, new DialogInterface.OnClickListener() {
-			
-			@Override
-			public void onClick(DialogInterface dialog, int which) {
-				mDefaultAccountsDialog.dismiss();
-				removeFirstRunFlag();
-			}
-		});
+
+            @Override
+            public void onClick(DialogInterface dialog, int which) {
+                mDefaultAccountsDialog.dismiss();
+                removeFirstRunFlag();
+            }
+        });
 
         builder.setNeutralButton(R.string.btn_import_accounts, new DialogInterface.OnClickListener() {
             @Override
@@ -517,6 +512,12 @@ public void onClick(DialogInterface dialogInterface, int i) {
         });
 
 		mDefaultAccountsDialog = builder.create();
+        mDefaultAccountsDialog.setOnDismissListener(new DialogInterface.OnDismissListener() {
+            @Override
+            public void onDismiss(DialogInterface dialog) {
+                mDrawerLayout.openDrawer(mDrawerList);
+            }
+        });
 		mDefaultAccountsDialog.show();
 	}
 
diff --git a/app/src/main/java/org/gnucash/android/ui/settings/SettingsActivity.java b/app/src/main/java/org/gnucash/android/ui/settings/SettingsActivity.java
index ea87edff..188ae943 100644
--- a/app/src/main/java/org/gnucash/android/ui/settings/SettingsActivity.java
+++ b/app/src/main/java/org/gnucash/android/ui/settings/SettingsActivity.java
@@ -19,8 +19,10 @@
 
 import android.annotation.TargetApi;
 import android.app.Activity;
-import android.app.ProgressDialog;
+import android.app.AlertDialog;
+import android.content.ActivityNotFoundException;
 import android.content.Context;
+import android.content.DialogInterface;
 import android.content.Intent;
 import android.content.IntentSender;
 import android.content.SharedPreferences;
@@ -33,6 +35,7 @@
 import android.preference.Preference.OnPreferenceChangeListener;
 import android.preference.PreferenceManager;
 import android.util.Log;
+import android.widget.ArrayAdapter;
 import android.widget.Toast;
 
 import com.actionbarsherlock.app.ActionBar;
@@ -65,8 +68,13 @@
 import java.io.FileInputStream;
 import java.io.FileNotFoundException;
 import java.io.InputStream;
+import java.text.DateFormat;
+import java.text.SimpleDateFormat;
 import java.util.ArrayList;
+import java.util.Arrays;
+import java.util.Collections;
 import java.util.Currency;
+import java.util.Date;
 import java.util.List;
 import java.util.Timer;
 import java.util.TimerTask;
@@ -293,11 +301,15 @@ private void setDefaultCurrencyListener() {
     public boolean onPreferenceClick(Preference preference) {
         String key = preference.getKey();
 
-        if (key.equals(getString(R.string.key_import_accounts)) || key.equals(getString(R.string.key_restore_backup))){
+        if (key.equals(getString(R.string.key_import_accounts))){
             importAccounts();
             return true;
         }
 
+        if (key.equals(getString(R.string.key_restore_backup))){
+            restoreBackup();
+        }
+
         if (key.equals(getString(R.string.key_build_version))){
             AccountsActivity.showWhatsNewDialog(this);
             return true;
@@ -493,30 +505,57 @@ public void importAccounts() {
         pickIntent.setType("application/*");
         Intent chooser = Intent.createChooser(pickIntent, getString(R.string.title_select_gnucash_xml_file));
 
-        startActivityForResult(chooser, AccountsActivity.REQUEST_PICK_ACCOUNTS_FILE);
-
+        try {
+            startActivityForResult(chooser, AccountsActivity.REQUEST_PICK_ACCOUNTS_FILE);
+        } catch (ActivityNotFoundException ex){
+            Toast.makeText(this, R.string.toast_install_file_manager, Toast.LENGTH_LONG).show();
+        }
     }
 
     /**
-     * Imports the most recent backup file (by timestamp)
-     * TODO: Remove this method
+     * Opens a dialog for a user to select a backup to restore and then restores the backup
      */
-    public void importMostRecentBackup() {
-        Log.i("Settings", "Importing GnuCash XML");
-        File backupFile = Exporter.getMostRecentBackupFile();
-
-        if (backupFile == null) {
-            Toast.makeText(this, R.string.toast_no_recent_backup, Toast.LENGTH_SHORT).show();
-            return;
+    public void restoreBackup() {
+        Log.i("Settings", "Opening GnuCash XML backups for restore");
+        File[] backupFiles = new File(Exporter.BACKUP_FOLDER_PATH).listFiles();
+        Arrays.sort(backupFiles);
+        List<File> backupFilesList = Arrays.asList(backupFiles);
+        Collections.reverse(backupFilesList);
+        final File[] sortedBackupFiles = (File[]) backupFilesList.toArray();
+
+        final ArrayAdapter<String> arrayAdapter = new ArrayAdapter<>(this, android.R.layout.select_dialog_singlechoice);
+        final DateFormat dateFormatter = SimpleDateFormat.getDateTimeInstance();
+        for (File backupFile : sortedBackupFiles) {
+            long time = Exporter.getExportTime(backupFile.getName());
+            arrayAdapter.add(dateFormatter.format(new Date(time)));
         }
 
-        try {
-            FileInputStream inputStream = new FileInputStream(backupFile);
-            new ImportAsyncTask(this).execute(inputStream);
-        } catch (FileNotFoundException e) {
-            e.printStackTrace();
-            throw new RuntimeException(e);
-        }
+        AlertDialog.Builder restoreDialogBuilder =  new AlertDialog.Builder(this);
+        restoreDialogBuilder.setTitle(R.string.title_select_backup_to_restore);
+        restoreDialogBuilder.setNegativeButton(R.string.alert_dialog_cancel,
+                new DialogInterface.OnClickListener() {
+                    @Override
+                    public void onClick(DialogInterface dialog, int which) {
+                        dialog.dismiss();
+                    }
+                });
+        restoreDialogBuilder.setAdapter(arrayAdapter, new DialogInterface.OnClickListener() {
+            @Override
+            public void onClick(DialogInterface dialog, int which) {
+                File backupFile = sortedBackupFiles[which];
+
+                try {
+                    FileInputStream inputStream = new FileInputStream(backupFile);
+                    new ImportAsyncTask(SettingsActivity.this).execute(inputStream);
+                } catch (FileNotFoundException e) {
+                    e.printStackTrace();
+                    Log.e(LOG_TAG, "Error restoring backup: " + backupFile.getName());
+                    Toast.makeText(SettingsActivity.this, R.string.toast_error_importing_accounts, Toast.LENGTH_LONG).show();
+                }
+            }
+        });
+
+        restoreDialogBuilder.create().show();
     }
 
     @Override
diff --git a/app/src/main/res/values-de/strings.xml b/app/src/main/res/values-de/strings.xml
index f7f89dc1..7d9b2924 100644
--- a/app/src/main/res/values-de/strings.xml
+++ b/app/src/main/res/values-de/strings.xml
@@ -458,6 +458,8 @@
 	<string name="export_warning_xml">Exports all accounts and transactions</string>
 	<string name="title_google_drive_sync_pref">Google Drive Sync</string>
 	<string name="summary_google_drive_sync">Enable to sync to Google Drive</string>
+	<string name="toast_install_file_manager">Install a file manager to select files</string>
+	<string name="title_select_backup_to_restore">Select backup to restore</string>
 	<plurals name="label_every_x_days">
         <item quantity="one">Daily</item>
         <item quantity="other">Every %d days</item>
diff --git a/app/src/main/res/values-el/strings.xml b/app/src/main/res/values-el/strings.xml
index 9da265ec..aa1f1fac 100644
--- a/app/src/main/res/values-el/strings.xml
+++ b/app/src/main/res/values-el/strings.xml
@@ -476,6 +476,8 @@
 	<string name="export_warning_xml">Exports all accounts and transactions</string>
 	<string name="title_google_drive_sync_pref">Google Drive Sync</string>
 	<string name="summary_google_drive_sync">Enable to sync to Google Drive</string>
+	<string name="toast_install_file_manager">Install a file manager to select files</string>
+	<string name="title_select_backup_to_restore">Select backup to restore</string>
 	<plurals name="label_every_x_days">
         <item quantity="one">Daily</item>
         <item quantity="other">Every %d days</item>
diff --git a/app/src/main/res/values-es-rMX/strings.xml b/app/src/main/res/values-es-rMX/strings.xml
index f5754eea..ff198fbe 100644
--- a/app/src/main/res/values-es-rMX/strings.xml
+++ b/app/src/main/res/values-es-rMX/strings.xml
@@ -461,6 +461,8 @@
     <string name="export_warning_xml">Exports all accounts and transactions</string>
     <string name="title_google_drive_sync_pref">Google Drive Sync</string>
     <string name="summary_google_drive_sync">Enable to sync to Google Drive</string>
+    <string name="toast_install_file_manager">Install a file manager to select files</string>
+    <string name="title_select_backup_to_restore">Select backup to restore</string>
     <plurals name="label_every_x_days">
         <item quantity="one">Daily</item>
         <item quantity="other">Every %d days</item>
diff --git a/app/src/main/res/values-es/strings.xml b/app/src/main/res/values-es/strings.xml
index dfebf879..9b35ddec 100644
--- a/app/src/main/res/values-es/strings.xml
+++ b/app/src/main/res/values-es/strings.xml
@@ -459,6 +459,8 @@
 	<string name="export_warning_xml">Exports all accounts and transactions</string>
 	<string name="title_google_drive_sync_pref">Google Drive Sync</string>
 	<string name="summary_google_drive_sync">Enable to sync to Google Drive</string>
+	<string name="toast_install_file_manager">Install a file manager to select files</string>
+	<string name="title_select_backup_to_restore">Select backup to restore</string>
 	<plurals name="label_every_x_days">
         <item quantity="one">Daily</item>
         <item quantity="other">Every %d days</item>
diff --git a/app/src/main/res/values-fr/strings.xml b/app/src/main/res/values-fr/strings.xml
index f0f3da22..ebe64bd2 100644
--- a/app/src/main/res/values-fr/strings.xml
+++ b/app/src/main/res/values-fr/strings.xml
@@ -458,6 +458,8 @@
     <string name="export_warning_xml">Exports all accounts and transactions</string>
     <string name="title_google_drive_sync_pref">Google Drive Sync</string>
     <string name="summary_google_drive_sync">Enable to sync to Google Drive</string>
+    <string name="toast_install_file_manager">Install a file manager to select files</string>
+    <string name="title_select_backup_to_restore">Select backup to restore</string>
     <plurals name="label_every_x_days">
         <item quantity="one">Daily</item>
         <item quantity="other">Every %d days</item>
diff --git a/app/src/main/res/values-hu/strings.xml b/app/src/main/res/values-hu/strings.xml
index 4793eb68..36d45267 100644
--- a/app/src/main/res/values-hu/strings.xml
+++ b/app/src/main/res/values-hu/strings.xml
@@ -462,6 +462,8 @@
     <string name="export_warning_xml">Exports all accounts and transactions</string>
     <string name="title_google_drive_sync_pref">Google Drive Sync</string>
     <string name="summary_google_drive_sync">Enable to sync to Google Drive</string>
+    <string name="toast_install_file_manager">Install a file manager to select files</string>
+    <string name="title_select_backup_to_restore">Select backup to restore</string>
     <plurals name="label_every_x_days">
         <item quantity="one">Daily</item>
         <item quantity="other">Every %d days</item>
diff --git a/app/src/main/res/values-it/strings.xml b/app/src/main/res/values-it/strings.xml
index 041cb775..ea58a2b0 100644
--- a/app/src/main/res/values-it/strings.xml
+++ b/app/src/main/res/values-it/strings.xml
@@ -462,6 +462,8 @@
     <string name="export_warning_xml">Exports all accounts and transactions</string>
     <string name="title_google_drive_sync_pref">Google Drive Sync</string>
     <string name="summary_google_drive_sync">Enable to sync to Google Drive</string>
+    <string name="toast_install_file_manager">Install a file manager to select files</string>
+    <string name="title_select_backup_to_restore">Select backup to restore</string>
     <plurals name="label_every_x_days">
         <item quantity="one">Daily</item>
         <item quantity="other">Every %d days</item>
diff --git a/app/src/main/res/values-nb/strings.xml b/app/src/main/res/values-nb/strings.xml
index 64304c66..e5f8bd8d 100644
--- a/app/src/main/res/values-nb/strings.xml
+++ b/app/src/main/res/values-nb/strings.xml
@@ -459,6 +459,8 @@
 	<string name="export_warning_xml">Exports all accounts and transactions</string>
 	<string name="title_google_drive_sync_pref">Google Drive Sync</string>
 	<string name="summary_google_drive_sync">Enable to sync to Google Drive</string>
+	<string name="toast_install_file_manager">Install a file manager to select files</string>
+	<string name="title_select_backup_to_restore">Select backup to restore</string>
 	<plurals name="label_every_x_days">
         <item quantity="one">Daily</item>
         <item quantity="other">Every %d days</item>
diff --git a/app/src/main/res/values-nl/strings.xml b/app/src/main/res/values-nl/strings.xml
index 8d2a23d5..21859b90 100644
--- a/app/src/main/res/values-nl/strings.xml
+++ b/app/src/main/res/values-nl/strings.xml
@@ -469,6 +469,8 @@
     <string name="export_warning_xml">Exports all accounts and transactions</string>
     <string name="title_google_drive_sync_pref">Google Drive Sync</string>
     <string name="summary_google_drive_sync">Enable to sync to Google Drive</string>
+    <string name="toast_install_file_manager">Install a file manager to select files</string>
+    <string name="title_select_backup_to_restore">Select backup to restore</string>
     <plurals name="label_every_x_days">
         <item quantity="one">Daily</item>
         <item quantity="other">Every %d days</item>
diff --git a/app/src/main/res/values-pt-rBR/strings.xml b/app/src/main/res/values-pt-rBR/strings.xml
index d6301992..606ee978 100644
--- a/app/src/main/res/values-pt-rBR/strings.xml
+++ b/app/src/main/res/values-pt-rBR/strings.xml
@@ -461,6 +461,8 @@
 	<string name="export_warning_xml">Exports all accounts and transactions</string>
 	<string name="title_google_drive_sync_pref">Google Drive Sync</string>
 	<string name="summary_google_drive_sync">Enable to sync to Google Drive</string>
+	<string name="toast_install_file_manager">Install a file manager to select files</string>
+	<string name="title_select_backup_to_restore">Select backup to restore</string>
 	<plurals name="label_every_x_days">
         <item quantity="one">Daily</item>
         <item quantity="other">Every %d days</item>
diff --git a/app/src/main/res/values-ru/strings.xml b/app/src/main/res/values-ru/strings.xml
index e00df711..6800f983 100644
--- a/app/src/main/res/values-ru/strings.xml
+++ b/app/src/main/res/values-ru/strings.xml
@@ -463,6 +463,8 @@
     <string name="export_warning_xml">Exports all accounts and transactions</string>
     <string name="title_google_drive_sync_pref">Google Drive Sync</string>
     <string name="summary_google_drive_sync">Enable to sync to Google Drive</string>
+    <string name="toast_install_file_manager">Install a file manager to select files</string>
+    <string name="title_select_backup_to_restore">Select backup to restore</string>
     <plurals name="label_every_x_days">
         <item quantity="one">Daily</item>
         <item quantity="few">Every %d days</item>
diff --git a/app/src/main/res/values-zh/strings.xml b/app/src/main/res/values-zh/strings.xml
index ba7e6874..4b44810f 100644
--- a/app/src/main/res/values-zh/strings.xml
+++ b/app/src/main/res/values-zh/strings.xml
@@ -458,6 +458,8 @@
     <string name="export_warning_xml">Exports all accounts and transactions</string>
     <string name="title_google_drive_sync_pref">Google Drive Sync</string>
     <string name="summary_google_drive_sync">Enable to sync to Google Drive</string>
+    <string name="toast_install_file_manager">Install a file manager to select files</string>
+    <string name="title_select_backup_to_restore">Select backup to restore</string>
     <plurals name="label_every_x_days">
         <item quantity="one">Daily</item>
         <item quantity="other">Every %d days</item>
diff --git a/app/src/main/res/values/strings.xml b/app/src/main/res/values/strings.xml
index 48ddbc07..fd868f39 100644
--- a/app/src/main/res/values/strings.xml
+++ b/app/src/main/res/values/strings.xml
@@ -467,6 +467,8 @@
     <string name="export_warning_xml">Exports all accounts and transactions</string>
     <string name="title_google_drive_sync_pref">Google Drive Sync</string>
     <string name="summary_google_drive_sync">Enable to sync to Google Drive</string>
+    <string name="toast_install_file_manager">Install a file manager to select files</string>
+    <string name="title_select_backup_to_restore">Select backup to restore</string>
     <plurals name="label_every_x_days">
         <item quantity="one">Daily</item>
         <item quantity="other">Every %d days</item>
