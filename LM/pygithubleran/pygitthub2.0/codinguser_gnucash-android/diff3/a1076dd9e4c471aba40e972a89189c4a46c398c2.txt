From 62242ff79cb9d21ac08b8a2546e282fe674d1d61 Mon Sep 17 00:00:00 2001
From: Ngewi Fet <ngewif@gmail.com>
Date: Wed, 17 Aug 2016 17:47:05 +0200
Subject: [PATCH 1/3] Fix currency preference from startup wizard is ignored -
 fixes #542 Update default currencies file - Adds BYN currency - closes #516

Fix after default created book db file not deleted after creating new book from FirstRunWizard
---
 .../android/test/ui/AccountsActivityTest.java      |   1 +
 .../android/db/adapter/DatabaseAdapter.java        |  14 +
 .../gnucash/android/importer/ImportAsyncTask.java  |   6 +-
 .../android/ui/settings/BookManagerFragment.java   |   3 +-
 .../android/ui/wizard/FirstRunWizardActivity.java  |   2 +-
 app/src/main/res/raw/iso_4217_currencies.xml       | 463 +++++++++++----------
 .../android/test/unit/db/BooksDbAdapterTest.java   |  41 ++
 7 files changed, 299 insertions(+), 231 deletions(-)

diff --git a/app/src/androidTest/java/org/gnucash/android/test/ui/AccountsActivityTest.java b/app/src/androidTest/java/org/gnucash/android/test/ui/AccountsActivityTest.java
index 69f6e4a0..39b40f2e 100644
--- a/app/src/androidTest/java/org/gnucash/android/test/ui/AccountsActivityTest.java
+++ b/app/src/androidTest/java/org/gnucash/android/test/ui/AccountsActivityTest.java
@@ -413,6 +413,7 @@ public void testDeleteAccountMovingSubaccounts() {
                 withId(R.id.options_menu))).perform(click());
         onView(withText(R.string.menu_delete)).perform(click());
 
+        //// FIXME: 17.08.2016 This enabled check fails during some test runs - not reliable, investigate why
         onView(allOf(withParent(withId(R.id.accounts_options)),
                 withId(R.id.radio_move))).check(matches(isEnabled())).perform(click());
 
diff --git a/app/src/main/java/org/gnucash/android/db/adapter/DatabaseAdapter.java b/app/src/main/java/org/gnucash/android/db/adapter/DatabaseAdapter.java
index 5ebfd32b..f12c2e4d 100644
--- a/app/src/main/java/org/gnucash/android/db/adapter/DatabaseAdapter.java
+++ b/app/src/main/java/org/gnucash/android/db/adapter/DatabaseAdapter.java
@@ -24,6 +24,7 @@
 import android.text.TextUtils;
 import android.util.Log;
 
+import org.gnucash.android.app.GnuCashApplication;
 import org.gnucash.android.db.DatabaseSchema;
 import org.gnucash.android.db.DatabaseSchema.AccountEntry;
 import org.gnucash.android.db.DatabaseSchema.CommonColumns;
@@ -712,6 +713,19 @@ public boolean deleteRecord(@NonNull String uid){
     }
 
     /**
+     * Deletes a book - removes the book record from the database and deletes the database file from the disk
+     * @param bookUID GUID of the book
+     * @return <code>true</code> if deletion was successful, <code>false</code> otherwise
+     * @see #deleteRecord(String)
+     */
+    public boolean deleteBook(@NonNull String bookUID){
+        boolean result = GnuCashApplication.getAppContext().deleteDatabase(bookUID);
+        if (result) //delete the db entry only if the file deletion was successful
+            result &= deleteRecord(bookUID);
+        return result;
+    }
+
+    /**
      * Returns an attribute from a specific column in the database for a specific record.
      * <p>The attribute is returned as a string which can then be converted to another type if
      * the caller was expecting something other type </p>
diff --git a/app/src/main/java/org/gnucash/android/importer/ImportAsyncTask.java b/app/src/main/java/org/gnucash/android/importer/ImportAsyncTask.java
index 0e3891ae..b8fdd602 100644
--- a/app/src/main/java/org/gnucash/android/importer/ImportAsyncTask.java
+++ b/app/src/main/java/org/gnucash/android/importer/ImportAsyncTask.java
@@ -124,9 +124,6 @@ public void run() {
 
     @Override
     protected void onPostExecute(Boolean importSuccess) {
-        if (mDelegate != null)
-            mDelegate.onTaskComplete();
-
         try {
             if (mProgressDialog != null && mProgressDialog.isShowing())
                 mProgressDialog.dismiss();
@@ -142,5 +139,8 @@ protected void onPostExecute(Boolean importSuccess) {
 
         if (mImportedBookUID != null)
             GnuCashApplication.loadBook(mImportedBookUID);
+
+        if (mDelegate != null)
+            mDelegate.onTaskComplete();
     }
 }
diff --git a/app/src/main/java/org/gnucash/android/ui/settings/BookManagerFragment.java b/app/src/main/java/org/gnucash/android/ui/settings/BookManagerFragment.java
index 510d259c..0b9d4c4b 100644
--- a/app/src/main/java/org/gnucash/android/ui/settings/BookManagerFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/settings/BookManagerFragment.java
@@ -199,8 +199,7 @@ public void onClick(View v) {
                         dialogBuilder.setPositiveButton(getString(R.string.btn_delete_book), new DialogInterface.OnClickListener() {
                             @Override
                             public void onClick(DialogInterface dialog, int which) {
-                                BooksDbAdapter.getInstance().deleteRecord(bookUID);
-                                mContext.deleteDatabase(bookUID);
+                                BooksDbAdapter.getInstance().deleteBook(bookUID);
                                 refresh();
                             }
                         });
diff --git a/app/src/main/java/org/gnucash/android/ui/wizard/FirstRunWizardActivity.java b/app/src/main/java/org/gnucash/android/ui/wizard/FirstRunWizardActivity.java
index 04b67eca..7254ef5f 100644
--- a/app/src/main/java/org/gnucash/android/ui/wizard/FirstRunWizardActivity.java
+++ b/app/src/main/java/org/gnucash/android/ui/wizard/FirstRunWizardActivity.java
@@ -208,7 +208,7 @@ private void createAccountsAndFinish() {
             //save the UID of the active book, and then delete it after successful import
             String bookUID = BooksDbAdapter.getInstance().getActiveBookUID();
             AccountsActivity.createDefaultAccounts(mCurrencyCode, FirstRunWizardActivity.this);
-            BooksDbAdapter.getInstance().deleteRecord(bookUID); //a default book is usually created
+            BooksDbAdapter.getInstance().deleteBook(bookUID); //a default book is usually created
             finish();
         } else if (mAccountOptions.equals(getString(R.string.wizard_option_import_my_accounts))){
             AccountsActivity.startXmlFileChooser(this);
diff --git a/app/src/main/res/raw/iso_4217_currencies.xml b/app/src/main/res/raw/iso_4217_currencies.xml
index e7492ea1..e4e852f9 100644
--- a/app/src/main/res/raw/iso_4217_currencies.xml
+++ b/app/src/main/res/raw/iso_4217_currencies.xml
@@ -1,4 +1,3 @@
-<?xml version="1.0" encoding="utf-8" ?>
 <!-- currency descriptions for ISO4217 currencies.
 
   This file is not currently used at runtime.  It's used to generate
@@ -54,7 +53,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "ADP" - "Andorran Peseta"
       2002-01-01 "ESP" 1 ;; = 1/1 Spanish Peseta replaced by EUR
     -->
@@ -68,7 +67,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "AED" - "UAE Dirham"
       There is also an arabic symbol for "Dhs"
     -->
@@ -82,7 +81,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="Dhs"
-        />
+    />
     <!-- "AFA" - "Afghani"
       through 2003-01-02 "AFN" 1000
     -->
@@ -96,7 +95,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "AFN" - "Afghani"
     -->
     <currency
@@ -109,7 +108,7 @@
         parts-per-unit="1"
         smallest-fraction="1"
         local-symbol=""
-        />
+    />
     <!-- "ALL" - "Lek"
     -->
     <currency
@@ -122,7 +121,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "AMD" - "Armenian Dram"
     -->
     <currency
@@ -135,7 +134,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="."
-        />
+    />
     <!-- "ANG" - "Netherlands Antillian Guilder"
       through 2010-10 ???
     -->
@@ -149,7 +148,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="NA"
-        />
+    />
     <!-- "AOA" - "Kwanza"
     -->
     <currency
@@ -162,7 +161,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="Kz"
-        />
+    />
     <!-- "AON" - "Angola New Kwanza"
       1995-07-01 "AOR" 1000
     -->
@@ -176,7 +175,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "AOR" - "Angola Kwanza Reajustado"
       2000-02-01 "AOA" 1000000
     -->
@@ -190,7 +189,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "ARA" - "Argentine Austral"
       1992-01-01 "ARS" 10000
     -->
@@ -204,7 +203,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "ARS" - "Argentine Peso"
     -->
     <currency
@@ -217,7 +216,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "ATS" - "Austrian Schilling"
       2002-01-01 "EUR" 13.7603
     -->
@@ -231,7 +230,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="S"
-        />
+    />
     <!-- "AUD" - "Australian Dollar"
     -->
     <currency
@@ -244,7 +243,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="$"
-        />
+    />
     <!-- "AWG" - "Aruban Guilder"
       ""
     -->
@@ -258,7 +257,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="Afl."
-        />
+    />
     <!-- "AZM" - "Azerbaijanian Manat"
       2006-01-01 "AZN" 5000
     -->
@@ -272,7 +271,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "AZN" - "Azerbaijanian Manat"
       "m" should be  a 90 rotated  sign, but currently not encoded in Unicode
     -->
@@ -286,7 +285,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="m"
-        />
+    />
     <!-- "BAD" - "Bosnia and Herzegovina Dinar"
       1998-06-22 "BAM" 100 ;; there was a revaluation 1994-08: 10000:1
     -->
@@ -300,7 +299,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "BAM" - "Convertible Marks"
     -->
     <currency
@@ -313,7 +312,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="KM"
-        />
+    />
     <!-- "BBD" - "Barbados Dollar"
     -->
     <currency
@@ -326,7 +325,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="Bds$"
-        />
+    />
     <!-- "BDT" - "Taka"
     -->
     <currency
@@ -339,7 +338,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "BEF" - "Belgian Franc"
       2002-01-01 "EUR" 40.3399
     -->
@@ -353,7 +352,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="fr."
-        />
+    />
     <!-- "BGL" - "Bulgarian Lev A/99"
       1999-07-05 "BGN" 1000
     -->
@@ -367,7 +366,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "BGN" - "Bulgarian Lev"
       scheduled replacement: 2012-01-01 "EUR" 1.95583 (=DEM)
     -->
@@ -381,7 +380,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "BHD" - "Bahraini Dinar"
       ar:..
     -->
@@ -395,7 +394,7 @@
         parts-per-unit="1000"
         smallest-fraction="1000"
         local-symbol="BD"
-        />
+    />
     <!-- "BIF" - "Burundi Franc"
     -->
     <currency
@@ -408,7 +407,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="FBu"
-        />
+    />
     <!-- "BMD" - "Bermudian Dollar"
     -->
     <currency
@@ -421,7 +420,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="BD$"
-        />
+    />
     <!-- "BND" - "Brunei Dollar"
     -->
     <currency
@@ -434,7 +433,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="B$"
-        />
+    />
     <!-- "BOB" - "Boliviano"
     -->
     <currency
@@ -447,7 +446,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="Bs."
-        />
+    />
     <!-- "BOV" - "Mvdol"
       Mantenimiento de Valor respecto al Dlar
     -->
@@ -461,7 +460,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "BRE" - "Brazilian Cruzeiro"
       1993-08-01 "BRR" 1000
     -->
@@ -475,7 +474,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "BRL" - "Brazilian Real"
     -->
     <currency
@@ -488,7 +487,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="R$"
-        />
+    />
     <!-- "BRR" - "Brazilian Cruzeiro Real"
       1994-07-01 "BRL" 2750
     -->
@@ -502,7 +501,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "BSD" - "Bahamian Dollar"
     -->
     <currency
@@ -515,7 +514,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="B$"
-        />
+    />
     <!-- "BTN" - "Ngultrum"
     -->
     <currency
@@ -528,7 +527,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="Nu."
-        />
+    />
     <!-- "BWP" - "Pula"
     -->
     <currency
@@ -541,7 +540,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="P"
-        />
+    />
     <!-- "BYB" - "Belarussian Rouble"
       2000-01-01 "BYR" 1000
     -->
@@ -555,8 +554,9 @@
         parts-per-unit="100"
         smallest-fraction="1"
         local-symbol=""
-        />
+    />
     <!-- "BYR" - "Belarussian Ruble"
+      2017-01-01 "BYN" 10000
     -->
     <currency
         isocode="BYR"
@@ -568,7 +568,20 @@
         parts-per-unit="1"
         smallest-fraction="100"
         local-symbol="Br"
-        />
+    />
+    <!-- "BYN" - "Belarussian Ruble"
+    -->
+    <currency
+        isocode="BYN"
+        fullname="Belarussian Ruble"
+        unitname="ruble"
+        partname="kapeyka"
+        namespace="ISO4217"
+        exchange-code="933"
+        parts-per-unit="100"
+        smallest-fraction="100"
+        local-symbol="Br"
+    />
     <!-- "BZD" - "Belize Dollar"
     -->
     <currency
@@ -581,7 +594,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="BZ$"
-        />
+    />
     <!-- "CAD" - "Canadian Dollar"
     -->
     <currency
@@ -594,7 +607,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="C$"
-        />
+    />
     <!-- "CDF" - "Franc Congolais"
     -->
     <currency
@@ -607,7 +620,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="FC"
-        />
+    />
     <!-- "CHE" - "WIR Euro"
       complementary currency by WIR Wirtschaftsring-Genossenschaft
     -->
@@ -621,7 +634,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "CHF" - "Swiss Franc"
     -->
     <currency
@@ -634,7 +647,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="SFr."
-        />
+    />
     <!-- "CHW" - "WIR Franc"
       complementary currency by WIR Wirtschaftsring-Genossenschaft
     -->
@@ -648,7 +661,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "CLF" - "Unidades de fomento"
       international secured loans; decimals not defined but required for conversion as of 2011-03-18 1 CLF = 21,560.19 CLP
     -->
@@ -662,7 +675,7 @@
         parts-per-unit="10000"
         smallest-fraction="10000"
         local-symbol=""
-        />
+    />
     <!-- "CLP" - "Chilean Peso"
       "$" should have 2 strokes
     -->
@@ -676,7 +689,7 @@
         parts-per-unit="100"
         smallest-fraction="1"
         local-symbol="$"
-        />
+    />
     <!-- "CNY" - "Yuan Renminbi"
       locale-symbol has been changed from  to CN following a discussion on bug 727466
     -->
@@ -690,7 +703,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="CN"
-        />
+    />
     <!-- "COP" - "Colombian Peso"
     -->
     <currency
@@ -703,7 +716,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="$"
-        />
+    />
     <!-- "COU" - "Unidad de Valor Real"
     -->
     <currency
@@ -716,7 +729,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "CRC" - "Costa Rican Colon"
     -->
     <currency
@@ -729,7 +742,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "CUP" - "Cuban Peso"
     -->
     <currency
@@ -742,7 +755,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="$MN"
-        />
+    />
     <!-- "CUC" - "Cuban Convertible Peso"
     -->
     <currency
@@ -755,7 +768,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="CUC$"
-        />
+    />
     <!-- "CVE" - "Cape Verde Escudo"
     -->
     <currency
@@ -768,7 +781,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="Esc"
-        />
+    />
     <!-- "CYP" - "Cyprus Pound"
       2008-01-01 "EUR" 0.585274
     -->
@@ -782,7 +795,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "CZK" - "Czech Koruna"
     -->
     <currency
@@ -795,7 +808,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="K"
-        />
+    />
     <!-- "DEM" - "Deutsche Mark"
       2002-01-01 "EUR" 1.95583
     -->
@@ -809,7 +822,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="DM"
-        />
+    />
     <!-- "DJF" - "Djibouti Franc"
     -->
     <currency
@@ -822,7 +835,7 @@
         parts-per-unit="100"
         smallest-fraction="1"
         local-symbol="Fdj"
-        />
+    />
     <!-- "DKK" - "Danish Krone"
     -->
     <currency
@@ -835,7 +848,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="kr"
-        />
+    />
     <!-- "DOP" - "Dominican Peso"
     -->
     <currency
@@ -848,9 +861,9 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="RD$"
-        />
+    />
     <!-- "DZD" - "Algerian Dinar"
-      ar.: 	
+      ar.:  
     -->
     <currency
         isocode="DZD"
@@ -862,7 +875,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="DA"
-        />
+    />
     <!-- "ECS" - "Ecuador Sucre"
       2000-09-15 "USD" 25000
     -->
@@ -876,7 +889,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="S/."
-        />
+    />
     <!-- "EEK" - "Kroon"
       2011-01-01 "EUR" 15.6466
     -->
@@ -890,7 +903,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="kr"
-        />
+    />
     <!-- "EGP" - "Egyptian Pound"
       ar.:. maleem=0.001 E for accounting?
     -->
@@ -904,7 +917,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="E"
-        />
+    />
     <!-- "ERN" - "Nakfa"
     -->
     <currency
@@ -917,7 +930,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="Nfa"
-        />
+    />
     <!-- "ESP" - "Spanish Peseta"
       2002-01-01 "EUR" 166.386
     -->
@@ -931,7 +944,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "ETB" - "Ethiopian Birr"
     -->
     <currency
@@ -944,7 +957,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="Br"
-        />
+    />
     <!-- "EUR" - "Euro"
     -->
     <currency
@@ -957,7 +970,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "FIM" - "Finnish Markka"
       2002-01-01 "EUR" 5.94573
     -->
@@ -971,7 +984,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="mk"
-        />
+    />
     <!-- "FJD" - "Fiji Dollar"
     -->
     <currency
@@ -984,7 +997,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="FJ$"
-        />
+    />
     <!-- "FKP" - "Falkland Islands Pound"
     -->
     <currency
@@ -997,7 +1010,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="FK"
-        />
+    />
     <!-- "FRF" - "French Franc"
       2002-01-01 "EUR" 6.55957
     -->
@@ -1011,7 +1024,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "GBP" - "Pound Sterling"
     -->
     <currency
@@ -1024,7 +1037,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "GEL" - "Lari"
     -->
     <currency
@@ -1037,7 +1050,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "GHC" - "Cedi"
       2007-07-01 "GHS" 10000
     -->
@@ -1051,7 +1064,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "GHS" - "Ghana Cedi"
     -->
     <currency
@@ -1064,7 +1077,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="GH"
-        />
+    />
     <!-- "GIP" - "Gibraltar Pound"
     -->
     <currency
@@ -1077,7 +1090,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "GMD" - "Dalasi"
     -->
     <currency
@@ -1090,7 +1103,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="D"
-        />
+    />
     <!-- "GNF" - "Guinea Franc"
     -->
     <currency
@@ -1103,7 +1116,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="FG"
-        />
+    />
     <!-- "GRD" - "Greek Drachma"
       2002-01-01 "EUR" 340.750
     -->
@@ -1117,7 +1130,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="."
-        />
+    />
     <!-- "GTQ" - "Quetzal"
     -->
     <currency
@@ -1130,7 +1143,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="Q"
-        />
+    />
     <!-- "GWP" - "Guinea-Bissau Peso"
       1997-01-01 "XOF" 65
     -->
@@ -1144,7 +1157,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "GYD" - "Guyana Dollar"
     -->
     <currency
@@ -1157,7 +1170,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="G$"
-        />
+    />
     <!-- "HKD" - "Hong Kong Dollar"
     -->
     <currency
@@ -1170,7 +1183,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="HK$"
-        />
+    />
     <!-- "HNL" - "Lempira"
     -->
     <currency
@@ -1183,7 +1196,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="L"
-        />
+    />
     <!-- "HRK" - "Croatian Kuna"
     -->
     <currency
@@ -1196,7 +1209,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="kn"
-        />
+    />
     <!-- "HTG" - "Gourde"
     -->
     <currency
@@ -1209,7 +1222,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="G"
-        />
+    />
     <!-- "HUF" - "Forint"
     -->
     <currency
@@ -1222,7 +1235,7 @@
         parts-per-unit="1"
         smallest-fraction="100"
         local-symbol="Ft"
-        />
+    />
     <!-- "IDR" - "Rupiah"
     -->
     <currency
@@ -1235,7 +1248,7 @@
         parts-per-unit="1"
         smallest-fraction="100"
         local-symbol="Rp"
-        />
+    />
     <!-- "IEP" - "Irish Pound"
       2002-01-01 "EUR" 0.787564
     -->
@@ -1249,7 +1262,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "ILS" - "New Israeli Sheqel"
     -->
     <currency
@@ -1262,7 +1275,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "INR" - "Indian Rupee"
     -->
     <currency
@@ -1275,7 +1288,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "IQD" - "Iraqi Dinar"
     -->
     <currency
@@ -1288,7 +1301,7 @@
         parts-per-unit="1000"
         smallest-fraction="1000"
         local-symbol="."
-        />
+    />
     <!-- "IRR" - "Iranian Rial"
     -->
     <currency
@@ -1301,7 +1314,7 @@
         parts-per-unit="1"
         smallest-fraction="1"
         local-symbol=""
-        />
+    />
     <!-- "ISK" - "Iceland Krona"
     -->
     <currency
@@ -1314,7 +1327,7 @@
         parts-per-unit="1"
         smallest-fraction="100"
         local-symbol="kr"
-        />
+    />
     <!-- "ITL" - "Italian Lira"
       2002-01-01 "EUR" 1936.27
     -->
@@ -1328,7 +1341,7 @@
         parts-per-unit="1"
         smallest-fraction="1"
         local-symbol=""
-        />
+    />
     <!-- "JMD" - "Jamaican Dollar"
     -->
     <currency
@@ -1341,7 +1354,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="J$"
-        />
+    />
     <!-- "JOD" - "Jordanian Dinar"
     -->
     <currency
@@ -1354,7 +1367,7 @@
         parts-per-unit="1000"
         smallest-fraction="1000"
         local-symbol="JD"
-        />
+    />
     <!-- "JPY" - "Yen"
     -->
     <currency
@@ -1367,7 +1380,7 @@
         parts-per-unit="100"
         smallest-fraction="1"
         local-symbol="JP"
-        />
+    />
     <!-- "KES" - "Kenyan Shilling"
     -->
     <currency
@@ -1380,7 +1393,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="Ksh"
-        />
+    />
     <!-- "KGS" - "Som"
     -->
     <currency
@@ -1393,7 +1406,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "KHR" - "Riel"
     -->
     <currency
@@ -1406,7 +1419,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "KMF" - "Comoro Franc"
     -->
     <currency
@@ -1419,7 +1432,7 @@
         parts-per-unit="100"
         smallest-fraction="1"
         local-symbol="FC"
-        />
+    />
     <!-- "KPW" - "North Korean Won"
     -->
     <currency
@@ -1432,7 +1445,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "KRW" - "Won"
     -->
     <currency
@@ -1445,7 +1458,7 @@
         parts-per-unit="1"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "KWD" - "Kuwaiti Dinar"
     -->
     <currency
@@ -1458,7 +1471,7 @@
         parts-per-unit="1000"
         smallest-fraction="1000"
         local-symbol="."
-        />
+    />
     <!-- "KYD" - "Cayman Islands Dollar"
     -->
     <currency
@@ -1471,7 +1484,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="CI$"
-        />
+    />
     <!-- "KZT" - "Tenge"
     -->
     <currency
@@ -1484,7 +1497,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "LAK" - "Kip"
     -->
     <currency
@@ -1497,7 +1510,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "LBP" - "Lebanese Pound"
     -->
     <currency
@@ -1510,7 +1523,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="."
-        />
+    />
     <!-- "LKR" - "Sri Lanka Rupee"
     -->
     <currency
@@ -1523,7 +1536,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "LRD" - "Liberian Dollar"
     -->
     <currency
@@ -1536,7 +1549,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="L$"
-        />
+    />
     <!-- "LSL" - "Loti"
     -->
     <currency
@@ -1549,7 +1562,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="M"
-        />
+    />
     <!-- "LTL" - "Lithuanian Litas"
     -->
     <currency
@@ -1562,7 +1575,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="Lt"
-        />
+    />
     <!-- "LUF" - "Luxembourg Franc"
       2002-01-01 "EUR" 40.3399
     -->
@@ -1576,7 +1589,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="Flux"
-        />
+    />
     <!-- "LVL" - "Latvian Lats"
       Valid from 2. may 2009. till 31. december 2013, now "EUR" 0.702804
     -->
@@ -1590,7 +1603,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="Ls"
-        />
+    />
     <!-- "LYD" - "Libyan Dinar"
     -->
     <currency
@@ -1603,7 +1616,7 @@
         parts-per-unit="1000"
         smallest-fraction="1000"
         local-symbol="."
-        />
+    />
     <!-- "MAD" - "Moroccan Dirham"
     -->
     <currency
@@ -1616,7 +1629,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="."
-        />
+    />
     <!-- "MDL" - "Moldovan Leu"
     -->
     <currency
@@ -1629,7 +1642,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "MGA" - "Malagasy Ariary"
     -->
     <currency
@@ -1642,7 +1655,7 @@
         parts-per-unit="5"
         smallest-fraction="5"
         local-symbol=""
-        />
+    />
     <!-- "MGF" - "Malagasy Franc"
       2003-07-31 "MGA" 5
     -->
@@ -1656,7 +1669,7 @@
         parts-per-unit="500"
         smallest-fraction="500"
         local-symbol=""
-        />
+    />
     <!-- "MKD" - "Denar"
     -->
     <currency
@@ -1669,7 +1682,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "MLF" - "Mali Franc"
       1984-07-01 "XOF" 2
     -->
@@ -1683,7 +1696,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "MMK" - "Kyat"
     -->
     <currency
@@ -1696,7 +1709,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="K"
-        />
+    />
     <!-- "MNT" - "Tugrik"
     -->
     <currency
@@ -1709,7 +1722,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "MOP" - "Pataca"
     -->
     <currency
@@ -1722,7 +1735,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="MOP$"
-        />
+    />
     <!-- "MRO" - "Ouguiya"
     -->
     <currency
@@ -1735,7 +1748,7 @@
         parts-per-unit="5"
         smallest-fraction="5"
         local-symbol="UM"
-        />
+    />
     <!-- "MTL" - "Maltese Lira"
       2008-01-01 "EUR" 0.4293
     -->
@@ -1749,7 +1762,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="Lm"
-        />
+    />
     <!-- "MUR" - "Mauritius Rupee"
     -->
     <currency
@@ -1762,7 +1775,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="R"
-        />
+    />
     <!-- "MVR" - "Rufiyaa"
     -->
     <currency
@@ -1775,7 +1788,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="."
-        />
+    />
     <!-- "MWK" - "Kwacha"
     -->
     <currency
@@ -1788,7 +1801,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="MK"
-        />
+    />
     <!-- "MXN" - "Mexican Peso"
       since Jan 1993 (1000 MXP = 1 MXN)
     -->
@@ -1802,7 +1815,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="Mex$"
-        />
+    />
     <!-- "MXV" - "Mexican Unidad de Inversion (UDI)"
       fund index based; used for credits, not subject to inflation
     -->
@@ -1816,7 +1829,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "MYR" - "Malaysian Ringgit"
     -->
     <currency
@@ -1829,7 +1842,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="RM"
-        />
+    />
     <!-- "MZM" - "Mozambique Metical"
       2006-07-01 "MZN" 1000
     -->
@@ -1843,7 +1856,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "MZN" - "Metical"
     -->
     <currency
@@ -1856,7 +1869,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="MTn"
-        />
+    />
     <!-- "NAD" - "Namibia Dollar"
     -->
     <currency
@@ -1869,7 +1882,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="N$"
-        />
+    />
     <!-- "NGN" - "Naira"
     -->
     <currency
@@ -1882,7 +1895,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "NIC" - "Nicaraguan Cordoba"
       1990-10-13 "NIO" 5000000
     -->
@@ -1896,7 +1909,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "NIO" - "Cordoba Oro"
     -->
     <currency
@@ -1909,7 +1922,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="C$"
-        />
+    />
     <!-- "NLG" - "Netherlands Guilder"
       2002-01-01 "EUR" 2.20371
     -->
@@ -1923,7 +1936,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "NOK" - "Norwegian Krone"
     -->
     <currency
@@ -1936,7 +1949,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="kr"
-        />
+    />
     <!-- "NPR" - "Nepalese Rupee"
     -->
     <currency
@@ -1949,7 +1962,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "NZD" - "New Zealand Dollar"
     -->
     <currency
@@ -1962,7 +1975,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="NZ$"
-        />
+    />
     <!-- "OMR" - "Rial Omani"
     -->
     <currency
@@ -1975,7 +1988,7 @@
         parts-per-unit="1000"
         smallest-fraction="1000"
         local-symbol=".."
-        />
+    />
     <!-- "PAB" - "Balboa"
     -->
     <currency
@@ -1988,7 +2001,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "PEN" - "Nuevo Sol"
     -->
     <currency
@@ -2001,7 +2014,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="S/."
-        />
+    />
     <!-- "PGK" - "Kina"
     -->
     <currency
@@ -2014,7 +2027,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="K"
-        />
+    />
     <!-- "PHP" - "Philippine Peso"
     -->
     <currency
@@ -2027,7 +2040,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "PKR" - "Pakistan Rupee"
     -->
     <currency
@@ -2040,7 +2053,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="Rs"
-        />
+    />
     <!-- "PLN" - "Zloty"
     -->
     <currency
@@ -2053,7 +2066,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="z"
-        />
+    />
     <!-- "PTE" - "Portuguese Escudo"
       2002-01-01 "EUR" 200.482
     -->
@@ -2067,7 +2080,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="$"
-        />
+    />
     <!-- "PYG" - "Guarani"
       scheduled revaluation 2011
     -->
@@ -2081,7 +2094,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "QAR" - "Qatari Rial"
     -->
     <currency
@@ -2094,7 +2107,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="."
-        />
+    />
     <!-- "ROL" - "Romanian Old Leu"
       2005-07-01 "RON" 10000
     -->
@@ -2108,7 +2121,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "RON" - "New Leu"
       scheduled 2012..14: EUR
     -->
@@ -2122,7 +2135,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "RSD" - "Serbian Dinar"
     -->
     <currency
@@ -2135,7 +2148,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "RUB" - "Russian Rouble"
       RUR: 1998-01-1 "RUB" 1000; see bug #393185
     -->
@@ -2149,7 +2162,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "RWF" - "Rwanda Franc"
     -->
     <currency
@@ -2162,7 +2175,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="RF"
-        />
+    />
     <!-- "SAR" - "Saudi Riyal"
     -->
     <currency
@@ -2175,7 +2188,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="."
-        />
+    />
     <!-- "SBD" - "Solomon Islands Dollar"
     -->
     <currency
@@ -2188,7 +2201,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="SI$"
-        />
+    />
     <!-- "SCR" - "Seychelles Rupee"
     -->
     <currency
@@ -2201,7 +2214,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="SR"
-        />
+    />
     <!-- "SDD" - "Sudanese Dinar"
       2007-07-01 "SDG" 100, reunite with South
     -->
@@ -2215,7 +2228,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "SDG" - "Sudanese Pound"
     -->
     <currency
@@ -2228,7 +2241,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "SDP" - "Sudanese Pound"
       1992-01-01 "SDD" 10, but only in the North
     -->
@@ -2242,7 +2255,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "SEK" - "Swedish Krona"
     -->
     <currency
@@ -2255,7 +2268,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="kr"
-        />
+    />
     <!-- "SGD" - "Singapore Dollar"
     -->
     <currency
@@ -2268,7 +2281,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="S$"
-        />
+    />
     <!-- "SHP" - "Saint Helena Pound"
     -->
     <currency
@@ -2281,7 +2294,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "SIT" - "Slovenian Tolar"
       2007-01-01 "EUR" 239.640
     -->
@@ -2295,7 +2308,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "SKK" - "Slovak Koruna"
       2009-01-01 "EUR" 30.126
     -->
@@ -2309,7 +2322,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "SLL" - "Leone"
     -->
     <currency
@@ -2322,7 +2335,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="Le"
-        />
+    />
     <!-- "SOS" - "Somali Shilling"
     -->
     <currency
@@ -2335,7 +2348,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="SoSh"
-        />
+    />
     <!-- "SRD" - "Surinam Dollar"
     -->
     <currency
@@ -2348,7 +2361,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="$"
-        />
+    />
     <!-- "SRG" - "Suriname Guilder"
       2004-01-01 "SRD" 1000
     -->
@@ -2362,7 +2375,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "STD" - "Dobra"
     -->
     <currency
@@ -2375,7 +2388,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="Db"
-        />
+    />
     <!-- "SVC" - "El Salvador Colon"
       2001-01-01 "USD" 8.75
     -->
@@ -2389,7 +2402,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "SYP" - "Syrian Pound"
     -->
     <currency
@@ -2402,7 +2415,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "SZL" - "Lilangeni"
     -->
     <currency
@@ -2415,7 +2428,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="L"
-        />
+    />
     <!-- "THB" - "Baht"
     -->
     <currency
@@ -2428,7 +2441,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "TJR" - "Tajik Rouble"
       2002-11-01 "TJS" 1000
     -->
@@ -2442,7 +2455,7 @@
         parts-per-unit="1"
         smallest-fraction="1"
         local-symbol=""
-        />
+    />
     <!-- "TJS" - "Somoni"
     -->
     <currency
@@ -2455,7 +2468,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "TMM" - "Manat"
       2009-01-01 "TMT" 5000
     -->
@@ -2469,7 +2482,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "TMT" - "Manat"
     -->
     <currency
@@ -2482,7 +2495,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="m"
-        />
+    />
     <!-- "TND" - "Tunisian Dinar"
     -->
     <currency
@@ -2495,7 +2508,7 @@
         parts-per-unit="1000"
         smallest-fraction="1000"
         local-symbol="."
-        />
+    />
     <!-- "TOP" - "Pa'anga"
     -->
     <currency
@@ -2508,7 +2521,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="T$"
-        />
+    />
     <!-- "TRY" - "Turkish Lira"
     -->
     <currency
@@ -2521,7 +2534,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "TTD" - "Trinidad and Tobago Dollar"
     -->
     <currency
@@ -2534,7 +2547,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="TT$"
-        />
+    />
     <!-- "TWD" - "New Taiwan Dollar"
     -->
     <currency
@@ -2547,7 +2560,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="NT$"
-        />
+    />
     <!-- "TZS" - "Tanzanian Shilling"
     -->
     <currency
@@ -2560,7 +2573,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="/"
-        />
+    />
     <!-- "UAH" - "Hryvnia"
     -->
     <currency
@@ -2573,7 +2586,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "UGX" - "Uganda Shilling"
     -->
     <currency
@@ -2586,7 +2599,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="USh"
-        />
+    />
     <!-- "USD" - "US Dollar"
     -->
     <currency
@@ -2599,7 +2612,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="$"
-        />
+    />
     <!-- "USN" - "US Dollar (Next day)"
       funds code
     -->
@@ -2613,7 +2626,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="$n"
-        />
+    />
     <!-- "USS" - "US Dollar (Same day)"
       funds code
     -->
@@ -2627,7 +2640,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="$s"
-        />
+    />
     <!-- "UYI" - "Uruguay Peso en Unidades Indexadas"
     -->
     <currency
@@ -2640,7 +2653,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="UI"
-        />
+    />
     <!-- "UYU" - "Peso Uruguayo"
     -->
     <currency
@@ -2653,7 +2666,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="$U"
-        />
+    />
     <!-- "UZS" - "Uzbekistan Sum"
     -->
     <currency
@@ -2666,7 +2679,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="som"
-        />
+    />
     <!-- "VEB" - "Venezuela Bolvar"
       2008-01-01 "VEF" 1000
     -->
@@ -2680,7 +2693,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "VEF" - "Bolivar Fuerte"
     -->
     <currency
@@ -2693,7 +2706,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="Bs."
-        />
+    />
     <!-- "VND" - "Dong"
     -->
     <currency
@@ -2706,7 +2719,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "VUV" - "Vatu"
     -->
     <currency
@@ -2719,7 +2732,7 @@
         parts-per-unit="1"
         smallest-fraction="1"
         local-symbol="Vt"
-        />
+    />
     <!-- "WST" - "Tala"
     -->
     <currency
@@ -2732,7 +2745,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="WS$"
-        />
+    />
     <!-- "YER" - "Yemeni Rial"
     -->
     <currency
@@ -2745,7 +2758,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="Rl"
-        />
+    />
     <!-- "YUM" - "Yugoslavian Dinar"
       2003 replaced by RSD 1
     -->
@@ -2759,7 +2772,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "ZAR" - "Rand"
     -->
     <currency
@@ -2772,7 +2785,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="R"
-        />
+    />
     <!-- "ZMK" - "Kwacha (old)"
       replaced by ZMW from 2013-01-01 onwards
     -->
@@ -2786,7 +2799,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="ZK"
-        />
+    />
     <!-- "ZMW" - "Zambian Kwacha"
       replaced ZMK from 2013-01-01 onwards
     -->
@@ -2800,7 +2813,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="ZK"
-        />
+    />
     <!-- "ZWD" - "Zimbabwe Dollar"
       2006-08-01 "ZWN" 1000, 2008-08-01 "ZWR" 10000000000, 2009-02-01 "ZWD" 1000000000000
     -->
@@ -2814,7 +2827,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "ZWL" - "Zimbabwe Dollar"
       2009-04 suspended for at least 1 year
     -->
@@ -2828,7 +2841,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="Z.$"
-        />
+    />
 
     <!-- multinational -->
     <!-- "XAF" - "CFA Franc BEAC"
@@ -2844,7 +2857,7 @@
         parts-per-unit="1"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- XB* should be replaced by EUR, if I am right -->
     <!-- "XCD" - "East Caribbean Dollar"
       Organisation of Eastern Caribbean States
@@ -2859,7 +2872,7 @@
         parts-per-unit="100"
         smallest-fraction="100"
         local-symbol="EC$"
-        />
+    />
     <!-- "XDR" - "SDR"
       International Monetary Funds Special Drawing Rights
     -->
@@ -2873,7 +2886,7 @@
         parts-per-unit="1"
         smallest-fraction="1"
         local-symbol=""
-        />
+    />
     <!-- "XFO" - "Gold-Franc"
       Bank for International Settlements
     -->
@@ -2887,7 +2900,7 @@
         parts-per-unit="1"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "XFU" - "UIC-Franc"
       Union Internationale des Chemins de fer
     -->
@@ -2901,7 +2914,7 @@
         parts-per-unit="1"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "XOF" - "CFA Franc BCEAO"
       Banque Centrale des tats de l'Afrique de l'Ouest
     -->
@@ -2915,7 +2928,7 @@
         parts-per-unit="1"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "XPF" - "CFP Franc"
       Communaut Financire du Pacifique
     -->
@@ -2929,7 +2942,7 @@
         parts-per-unit="1"
         smallest-fraction="100"
         local-symbol=""
-        />
+    />
     <!-- "XTS" - "Code for testing purposes"
       Code reserved for testing purposes
     -->
@@ -2943,7 +2956,7 @@
         parts-per-unit="1"
         smallest-fraction="1000000"
         local-symbol=""
-        />
+    />
     <!-- "XXX" - "No currency"
     -->
     <currency
@@ -2956,7 +2969,7 @@
         parts-per-unit="1"
         smallest-fraction="1000000"
         local-symbol=""
-        />
+    />
 
     <!-- precious metals -->
     <!-- "XAG" - "Silver"
@@ -2971,7 +2984,7 @@
         parts-per-unit="1"
         smallest-fraction="1000000"
         local-symbol=""
-        />
+    />
     <!-- "XAU" - "Gold"
     -->
     <currency
@@ -2984,7 +2997,7 @@
         parts-per-unit="1"
         smallest-fraction="1000000"
         local-symbol=""
-        />
+    />
     <!-- "XPD" - "Palladium"
     -->
     <currency
@@ -2997,7 +3010,7 @@
         parts-per-unit="1"
         smallest-fraction="1000000"
         local-symbol=""
-        />
+    />
     <!-- "XPT" - "Platinum"
     -->
     <currency
@@ -3010,5 +3023,5 @@
         parts-per-unit="1"
         smallest-fraction="1000000"
         local-symbol=""
-        />
-</currencylist>
\ No newline at end of file
+    />
+</currencylist>
diff --git a/app/src/test/java/org/gnucash/android/test/unit/db/BooksDbAdapterTest.java b/app/src/test/java/org/gnucash/android/test/unit/db/BooksDbAdapterTest.java
index fffdaecc..55e4855d 100644
--- a/app/src/test/java/org/gnucash/android/test/unit/db/BooksDbAdapterTest.java
+++ b/app/src/test/java/org/gnucash/android/test/unit/db/BooksDbAdapterTest.java
@@ -16,8 +16,12 @@
 package org.gnucash.android.test.unit.db;
 
 import org.gnucash.android.BuildConfig;
+import org.gnucash.android.R;
+import org.gnucash.android.app.GnuCashApplication;
+import org.gnucash.android.db.DatabaseHelper;
 import org.gnucash.android.db.adapter.BooksDbAdapter;
 import org.gnucash.android.db.adapter.DatabaseAdapter;
+import org.gnucash.android.importer.GncXmlImporter;
 import org.gnucash.android.model.BaseModel;
 import org.gnucash.android.model.Book;
 import org.gnucash.android.test.unit.testutil.GnucashTestRunner;
@@ -27,6 +31,12 @@
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.robolectric.annotation.Config;
+import org.xml.sax.SAXException;
+
+import java.io.File;
+import java.io.IOException;
+
+import javax.xml.parsers.ParserConfigurationException;
 
 import static org.assertj.core.api.Assertions.assertThat;
 
@@ -110,6 +120,23 @@ public void testGeneratedDisplayName(){
     }
 
     /**
+     * Test that deleting a book record also deletes the book database
+     */
+    @Test
+    public void deletingBook_shouldDeleteDbFile(){
+        String bookUID = createNewBookWithDefaultAccounts();
+        File dbPath = GnuCashApplication.getAppContext().getDatabasePath(bookUID);
+        assertThat(dbPath).exists();
+        BooksDbAdapter booksDbAdapter = BooksDbAdapter.getInstance();
+        assertThat(booksDbAdapter.getRecord(bookUID)).isNotNull();
+
+        long booksCount = booksDbAdapter.getRecordsCount();
+        booksDbAdapter.deleteBook(bookUID);
+        assertThat(dbPath).doesNotExist();
+        assertThat(booksDbAdapter.getRecordsCount()).isEqualTo(booksCount - 1);
+    }
+
+    /**
      * Test that book names never conflict and that the ordinal attached to the book name is
      * increased irrespective of the order in which books are added to and deleted from the db
      */
@@ -132,4 +159,18 @@ public void testGeneratedDisplayNames_shouldBeUnique(){
         assertThat(generatedName).isNotEqualTo(book3.getDisplayName());
         assertThat(generatedName).isEqualTo("Book 4");
     }
+
+    /**
+     * Creates a new database with default accounts
+     * @return The book UID for the new database
+     * @throws RuntimeException if the new books could not be created
+     */
+    private String createNewBookWithDefaultAccounts(){
+        try {
+            return GncXmlImporter.parse(GnuCashApplication.getAppContext().getResources().openRawResource(R.raw.default_accounts));
+        } catch (ParserConfigurationException | SAXException | IOException e) {
+            e.printStackTrace();
+            throw new RuntimeException("Could not create default accounts");
+        }
+    }
 }

From 9b531e55a5ad2f5e914ebbe45f7a563ebecb7a1e Mon Sep 17 00:00:00 2001
From: Ngewi Fet <ngewif@gmail.com>
Date: Wed, 17 Aug 2016 23:20:53 +0200
Subject: [PATCH 2/3] Display book statistics in Book list (BookManager)

Fix: crash when switching books due to refresh of non-attached fragment
Fix warning string when creating default accounts to say existing accounts will not be deleted
---
 .../android/ui/account/AccountsActivity.java        |  5 ++++-
 .../android/ui/account/AccountsListFragment.java    |  4 +---
 .../android/ui/settings/BookManagerFragment.java    | 21 ++++++++++++++++++++-
 app/src/main/res/values/strings.xml                 | 12 +++++++++++-
 4 files changed, 36 insertions(+), 6 deletions(-)

diff --git a/app/src/main/java/org/gnucash/android/ui/account/AccountsActivity.java b/app/src/main/java/org/gnucash/android/ui/account/AccountsActivity.java
index f32dfe62..0591ccc2 100644
--- a/app/src/main/java/org/gnucash/android/ui/account/AccountsActivity.java
+++ b/app/src/main/java/org/gnucash/android/ui/account/AccountsActivity.java
@@ -350,7 +350,10 @@ protected void onNewIntent(Intent intent) {
         setIntent(intent);
         setCurrentTab();
 
-        getCurrentAccountListFragment().refresh();
+        int index = mViewPager.getCurrentItem();
+        Fragment fragment = (Fragment) mFragmentPageReferenceMap.get(index);
+        if (fragment != null)
+            ((Refreshable)fragment).refresh();
 
         handleOpenFileIntent(intent);
     }
diff --git a/app/src/main/java/org/gnucash/android/ui/account/AccountsListFragment.java b/app/src/main/java/org/gnucash/android/ui/account/AccountsListFragment.java
index 6004729e..9a4b0a9d 100644
--- a/app/src/main/java/org/gnucash/android/ui/account/AccountsListFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/account/AccountsListFragment.java
@@ -303,9 +303,7 @@ public void refresh(String parentAccountUID) {
      */
     @Override
     public void refresh() {
-        if (!isDetached()) {
-            getLoaderManager().restartLoader(0, null, this);
-        }
+        getLoaderManager().restartLoader(0, null, this);
     }
 
     @Override
diff --git a/app/src/main/java/org/gnucash/android/ui/settings/BookManagerFragment.java b/app/src/main/java/org/gnucash/android/ui/settings/BookManagerFragment.java
index 0b9d4c4b..6d7e391a 100644
--- a/app/src/main/java/org/gnucash/android/ui/settings/BookManagerFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/settings/BookManagerFragment.java
@@ -19,6 +19,7 @@
 import android.content.Context;
 import android.content.DialogInterface;
 import android.database.Cursor;
+import android.database.sqlite.SQLiteDatabase;
 import android.os.Bundle;
 import android.support.annotation.Nullable;
 import android.support.v4.app.ListFragment;
@@ -43,8 +44,12 @@
 import org.gnucash.android.R;
 import org.gnucash.android.app.GnuCashApplication;
 import org.gnucash.android.db.DatabaseCursorLoader;
+import org.gnucash.android.db.DatabaseHelper;
 import org.gnucash.android.db.DatabaseSchema.BookEntry;
+import org.gnucash.android.db.adapter.AccountsDbAdapter;
 import org.gnucash.android.db.adapter.BooksDbAdapter;
+import org.gnucash.android.db.adapter.SplitsDbAdapter;
+import org.gnucash.android.db.adapter.TransactionsDbAdapter;
 import org.gnucash.android.ui.account.AccountsActivity;
 import org.gnucash.android.ui.common.Refreshable;
 import org.gnucash.android.util.PreferencesHelper;
@@ -159,8 +164,22 @@ public void bindView(View view, final Context context, Cursor cursor) {
 
             TextView labelLastSync = (TextView) view.findViewById(R.id.label_last_sync);
             labelLastSync.setText(R.string.label_last_export_time);
-            ImageView optionsMenu = (ImageView) view.findViewById(R.id.options_menu);
 
+            //retrieve some book statistics
+            DatabaseHelper dbHelper = new DatabaseHelper(GnuCashApplication.getAppContext(), bookUID);
+            SQLiteDatabase db = dbHelper.getReadableDatabase();
+            TransactionsDbAdapter trnAdapter = new TransactionsDbAdapter(db, new SplitsDbAdapter(db));
+            int transactionCount = (int) trnAdapter.getRecordsCount();
+            String transactionStats = getResources().getQuantityString(R.plurals.book_transaction_stats, transactionCount, transactionCount);
+
+            AccountsDbAdapter accountsDbAdapter = new AccountsDbAdapter(db, trnAdapter);
+            int accountsCount = (int) accountsDbAdapter.getRecordsCount();
+            String accountStats = getResources().getQuantityString(R.plurals.book_account_stats, accountsCount, accountsCount);
+            String stats = accountStats + ", " + transactionStats;
+            TextView statsText = (TextView) view.findViewById(R.id.secondary_text);
+            statsText.setText(stats);
+
+            ImageView optionsMenu = (ImageView) view.findViewById(R.id.options_menu);
             optionsMenu.setOnClickListener(new View.OnClickListener() {
                 @Override
                 public void onClick(View v) {
diff --git a/app/src/main/res/values/strings.xml b/app/src/main/res/values/strings.xml
index 91f67153..2d3a874a 100644
--- a/app/src/main/res/values/strings.xml
+++ b/app/src/main/res/values/strings.xml
@@ -215,7 +215,7 @@
     <string name="title_all_accounts">All</string>
     <string name="summary_create_default_accounts">Creates default GnuCash commonly-used account structure</string>
     <string name="title_create_default_accounts">Create default accounts</string>
-    <string name="msg_confirm_create_default_accounts_setting">All existing accounts and transactions on the device will be deleted.\n\nAre you sure you want to proceed?</string>
+    <string name="msg_confirm_create_default_accounts_setting">A new book will be opened with the default accounts\n\nYour current accounts and transactions will not be modified!</string>
     <string name="menu_scheduled_transactions">Scheduled Transactions</string>
     <string name="msg_confirm_create_default_accounts_first_run">Welcome to GnuCash Android! \nYou can either create
         a hierarchy of commonly-used accounts, or import your own GnuCash account structure. \n\nBoth options are also
@@ -457,4 +457,14 @@
     <string name="toast_transaction_has_no_splits_and_cannot_open">The selected transaction has no splits and cannot be opened</string>
     <string name="label_split_count">%1$d splits</string>
     <string name="label_inside_account_with_name">in %1$s</string>
+
+    <plurals name="book_account_stats">
+        <item quantity="one">%d account</item>
+        <item quantity="other">%d accounts</item>
+    </plurals>
+
+    <plurals name="book_transaction_stats">
+        <item quantity="one">%d transaction</item>
+        <item quantity="other">%d transactions</item>
+    </plurals>
 </resources>

From bc9159cf9f800fcd4c1ff895c6a7ab732ec16091 Mon Sep 17 00:00:00 2001
From: Ngewi Fet <ngewif@gmail.com>
Date: Wed, 17 Aug 2016 23:23:20 +0200
Subject: [PATCH 3/3] Update version string for v2.1.0-beta4 release

---
 app/build.gradle | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/app/build.gradle b/app/build.gradle
index a4b052d4..a764cb1a 100644
--- a/app/build.gradle
+++ b/app/build.gradle
@@ -7,7 +7,7 @@ apply plugin: 'io.fabric'
 def versionMajor = 2
 def versionMinor = 1
 def versionPatch = 0
-def versionBuild = 3
+def versionBuild = 4
 
 def buildTime() {
     def df = new SimpleDateFormat("yyyyMMdd HH:mm 'UTC'")
