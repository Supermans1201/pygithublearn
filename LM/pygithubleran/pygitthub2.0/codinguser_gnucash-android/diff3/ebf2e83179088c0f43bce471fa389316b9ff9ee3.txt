From aa675135c3568de2a8963ba4f9abc29824978314 Mon Sep 17 00:00:00 2001
From: Oleksandr Tyshkovets <olexandr.tyshkovets@gmail.com>
Date: Thu, 29 Oct 2015 20:57:09 +0300
Subject: [PATCH 01/25] Return accounts balance as is

---
 app/src/main/java/org/gnucash/android/db/AccountsDbAdapter.java | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/app/src/main/java/org/gnucash/android/db/AccountsDbAdapter.java b/app/src/main/java/org/gnucash/android/db/AccountsDbAdapter.java
index 30fc1093..d20b73d2 100644
--- a/app/src/main/java/org/gnucash/android/db/AccountsDbAdapter.java
+++ b/app/src/main/java/org/gnucash/android/db/AccountsDbAdapter.java
@@ -786,12 +786,12 @@ private Money computeBalance(String accountUID, long startTimestamp, long endTim
     }
 
     /**
-     * Returns the absolute balance of account list within the specified time range while taking sub-accounts
-     * into consideration. The default currency takes as base currency.
+     * Returns the balance of account list within the specified time range. The default currency
+     * takes as base currency.
      * @param accountUIDList list of account UIDs
      * @param startTimestamp the start timestamp of the time range
      * @param endTimestamp the end timestamp of the time range
-     * @return the absolute balance of account list
+     * @return Money balance of account list
      */
     public Money getAccountsBalance(List<String> accountUIDList, long startTimestamp, long endTimestamp) {
         String currencyCode = GnuCashApplication.getDefaultCurrencyCode();
@@ -802,7 +802,7 @@ public Money getAccountsBalance(List<String> accountUIDList, long startTimestamp
                 ? splitsDbAdapter.computeSplitBalance(accountUIDList, currencyCode, true)
                 : splitsDbAdapter.computeSplitBalance(accountUIDList, currencyCode, true, startTimestamp, endTimestamp);
 
-        return balance.add(splitSum).absolute();
+        return balance.add(splitSum);
     }
 
     /**

From 552ac6198951a3be7f5a4b03f1a0d94ec03ee072 Mon Sep 17 00:00:00 2001
From: Oleksandr Tyshkovets <olexandr.tyshkovets@gmail.com>
Date: Sat, 31 Oct 2015 20:31:05 +0200
Subject: [PATCH 02/25] Pie chart ignores negatives

---
 app/src/main/java/org/gnucash/android/ui/report/PieChartFragment.java | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/app/src/main/java/org/gnucash/android/ui/report/PieChartFragment.java b/app/src/main/java/org/gnucash/android/ui/report/PieChartFragment.java
index 64334bed..af271789 100644
--- a/app/src/main/java/org/gnucash/android/ui/report/PieChartFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/report/PieChartFragment.java
@@ -193,8 +193,8 @@ private PieData getData() {
                     && account.getCurrency() == Currency.getInstance(mCurrencyCode)) {
 
                 double balance = mAccountsDbAdapter.getAccountsBalance(Collections.singletonList(account.getUID()),
-                        mReportStartTime, mReportEndTime).absolute().asDouble();
-                if (balance != 0) {
+                        mReportStartTime, mReportEndTime).asDouble();
+                if (balance > 0) {
                     dataSet.addEntry(new Entry((float) balance, dataSet.getEntryCount()));
                     colors.add(mUseAccountColor && account.getColorHexCode() != null
                             ? Color.parseColor(account.getColorHexCode())

From d09c07632e2951f92234dcb85a7e42aa72b616fb Mon Sep 17 00:00:00 2001
From: Oleksandr Tyshkovets <olexandr.tyshkovets@gmail.com>
Date: Sat, 31 Oct 2015 20:35:58 +0200
Subject: [PATCH 03/25] Fix for summary report

---
 .../java/org/gnucash/android/ui/report/ReportSummaryFragment.java    | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/app/src/main/java/org/gnucash/android/ui/report/ReportSummaryFragment.java b/app/src/main/java/org/gnucash/android/ui/report/ReportSummaryFragment.java
index f41a2ae5..7c503cd0 100644
--- a/app/src/main/java/org/gnucash/android/ui/report/ReportSummaryFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/report/ReportSummaryFragment.java
@@ -191,8 +191,9 @@ private PieData getData() {
 
                 long start = new LocalDate().minusMonths(2).dayOfMonth().withMinimumValue().toDate().getTime();
                 long end = new LocalDate().plusDays(1).toDate().getTime();
-                double balance = mAccountsDbAdapter.getAccountsBalance(Collections.singletonList(account.getUID()), start, end).absolute().asDouble();
-                if (balance != 0) {
+                double balance = mAccountsDbAdapter.getAccountsBalance(
+                        Collections.singletonList(account.getUID()), start, end).asDouble();
+                if (balance > 0) {
                     dataSet.addEntry(new Entry((float) balance, dataSet.getEntryCount()));
                     colors.add(account.getColorHexCode() != null
                             ? Color.parseColor(account.getColorHexCode())

From dba87166b68c70ec014e885bfe56867a860cada1 Mon Sep 17 00:00:00 2001
From: Oleksandr Tyshkovets <olexandr.tyshkovets@gmail.com>
Date: Sun, 1 Nov 2015 19:39:35 +0200
Subject: [PATCH 04/25] Fix for pie chart legend toggling

---
 .../java/org/gnucash/android/ui/report/PieChartFragment.java | 12 ++++++------
 1 file changed, 6 insertions(+), 6 deletions(-)

diff --git a/app/src/main/java/org/gnucash/android/ui/report/PieChartFragment.java b/app/src/main/java/org/gnucash/android/ui/report/PieChartFragment.java
index af271789..e0f65835 100644
--- a/app/src/main/java/org/gnucash/android/ui/report/PieChartFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/report/PieChartFragment.java
@@ -33,8 +33,6 @@
 import android.widget.TextView;
 
 import com.github.mikephil.charting.charts.PieChart;
-import com.github.mikephil.charting.components.Legend.LegendForm;
-import com.github.mikephil.charting.components.Legend.LegendPosition;
 import com.github.mikephil.charting.data.Entry;
 import com.github.mikephil.charting.data.PieData;
 import com.github.mikephil.charting.data.PieDataSet;
@@ -57,6 +55,9 @@
 import butterknife.Bind;
 import butterknife.ButterKnife;
 
+import static com.github.mikephil.charting.components.Legend.LegendForm;
+import static com.github.mikephil.charting.components.Legend.LegendPosition;
+
 /**
  * Activity used for drawing a pie chart
  *
@@ -132,8 +133,10 @@ public void onActivityCreated(@Nullable Bundle savedInstanceState) {
 
         mChart.setCenterTextSize(CENTER_TEXT_SIZE);
         mChart.setDescription("");
-        mChart.getLegend().setWordWrapEnabled(true);
         mChart.setOnChartValueSelectedListener(this);
+        mChart.getLegend().setForm(LegendForm.CIRCLE);
+        mChart.getLegend().setWordWrapEnabled(true);
+        mChart.getLegend().setPosition(LegendPosition.BELOW_CHART_CENTER);
 
         ReportsActivity reportsActivity = (ReportsActivity) getActivity();
         mReportStartTime = reportsActivity.getReportStartTime();
@@ -278,7 +281,6 @@ private void bubbleSort() {
     @Override
     public void onCreateOptionsMenu(Menu menu, MenuInflater inflater) {
         inflater.inflate(R.menu.chart_actions, menu);
-        menu.findItem(R.id.menu_toggle_legend).setChecked(false);
     }
 
     @Override
@@ -303,8 +305,6 @@ public boolean onOptionsItemSelected(MenuItem item) {
             }
             case R.id.menu_toggle_legend: {
                 mChart.getLegend().setEnabled(!mChart.getLegend().isEnabled());
-                mChart.getLegend().setForm(LegendForm.CIRCLE);
-                mChart.getLegend().setPosition(LegendPosition.RIGHT_OF_CHART_CENTER);
                 mChart.notifyDataSetChanged();
                 mChart.invalidate();
                 return true;

From d54ac0114551290ec1a935c242a915a1f333531d Mon Sep 17 00:00:00 2001
From: Oleksandr Tyshkovets <olexandr.tyshkovets@gmail.com>
Date: Mon, 2 Nov 2015 21:15:29 +0200
Subject: [PATCH 05/25] Use center text instead of legend when no data

---
 .../org/gnucash/android/ui/report/ReportSummaryFragment.java  | 11 +++++++++--
 1 file changed, 9 insertions(+), 2 deletions(-)

diff --git a/app/src/main/java/org/gnucash/android/ui/report/ReportSummaryFragment.java b/app/src/main/java/org/gnucash/android/ui/report/ReportSummaryFragment.java
index 7c503cd0..a4341705 100644
--- a/app/src/main/java/org/gnucash/android/ui/report/ReportSummaryFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/report/ReportSummaryFragment.java
@@ -34,7 +34,7 @@
 import android.widget.TextView;
 
 import com.github.mikephil.charting.charts.PieChart;
-import com.github.mikephil.charting.components.Legend;
+import com.github.mikephil.charting.components.Legend.LegendForm;
 import com.github.mikephil.charting.data.Entry;
 import com.github.mikephil.charting.data.PieData;
 import com.github.mikephil.charting.data.PieDataSet;
@@ -57,6 +57,8 @@
 import butterknife.Bind;
 import butterknife.ButterKnife;
 
+import static com.github.mikephil.charting.components.Legend.LegendPosition;
+
 /**
  * Shows a summary of reports
  * @author Ngewi Fet <ngewif@gmail.com>
@@ -139,7 +141,9 @@ public void onActivityCreated(@Nullable Bundle savedInstanceState) {
         mChart.setCenterTextSize(PieChartFragment.CENTER_TEXT_SIZE);
         mChart.setDescription("");
         mChart.getLegend().setEnabled(true);
-        mChart.getLegend().setPosition(Legend.LegendPosition.RIGHT_OF_CHART_CENTER);
+        mChart.getLegend().setWordWrapEnabled(true);
+        mChart.getLegend().setForm(LegendForm.CIRCLE);
+        mChart.getLegend().setPosition(LegendPosition.RIGHT_OF_CHART_CENTER);
         mChart.getLegend().setTextSize(LEGEND_TEXT_SIZE);
 
         ColorStateList csl = new ColorStateList(new int[][]{new int[0]}, new int[]{getResources().getColor(R.color.account_green)});
@@ -225,6 +229,9 @@ private void displayChart() {
             mChart.setTouchEnabled(true);
         } else {
             mChart.setData(getEmptyData());
+            mChart.setCenterText(getResources().getString(R.string.label_chart_no_data));
+            mChart.getLegend().setEnabled(false);
+            mChart.setTouchEnabled(false);
         }
 
         mChart.invalidate();

From 410c763ebb3664005f34d633aa36f4278f2b455a Mon Sep 17 00:00:00 2001
From: Oleksandr Tyshkovets <olexandr.tyshkovets@gmail.com>
Date: Mon, 2 Nov 2015 21:21:28 +0200
Subject: [PATCH 06/25] Bar chart displays negatives

---
 app/src/main/java/org/gnucash/android/ui/report/BarChartFragment.java | 1 +
 1 file changed, 1 insertion(+)

diff --git a/app/src/main/java/org/gnucash/android/ui/report/BarChartFragment.java b/app/src/main/java/org/gnucash/android/ui/report/BarChartFragment.java
index 2942a2b5..fba3eb32 100644
--- a/app/src/main/java/org/gnucash/android/ui/report/BarChartFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/report/BarChartFragment.java
@@ -148,6 +148,7 @@ public void onActivityCreated(@Nullable Bundle savedInstanceState) {
 //        mChart.setDrawValuesForWholeStack(false);
         mChart.getXAxis().setDrawGridLines(false);
         mChart.getAxisRight().setEnabled(false);
+        mChart.getAxisLeft().setStartAtZero(false);
         mChart.getAxisLeft().enableGridDashedLine(4.0f, 4.0f, 0);
         mChart.getAxisLeft().setValueFormatter(new LargeValueFormatter(mCurrency.getSymbol(Locale.getDefault())));
         Legend chartLegend = mChart.getLegend();

From c4ad14dcaf2321005a12497d56ea0fa053811f41 Mon Sep 17 00:00:00 2001
From: Oleksandr Tyshkovets <olexandr.tyshkovets@gmail.com>
Date: Tue, 3 Nov 2015 20:12:48 +0200
Subject: [PATCH 07/25] Updated MPAndroidChart to 2.1.6

---
 app/build.gradle                                                       | 2 +-
 app/src/main/java/org/gnucash/android/ui/report/BarChartFragment.java  | 2 +-
 app/src/main/java/org/gnucash/android/ui/report/LineChartFragment.java | 2 +-
 app/src/main/java/org/gnucash/android/ui/report/PieChartFragment.java  | 2 +-
 4 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/app/build.gradle b/app/build.gradle
index 2a9d08c5..34201f84 100644
--- a/app/build.gradle
+++ b/app/build.gradle
@@ -171,7 +171,7 @@ dependencies {
             'com.viewpagerindicator:library:2.4.1@aar',
             'com.code-troopers.betterpickers:library:2.0.3',
             'org.jraf:android-switch-backport:2.0.1@aar',
-            'com.github.PhilJay:MPAndroidChart:v2.1.3',
+            'com.github.PhilJay:MPAndroidChart:v2.1.6',
             'joda-time:joda-time:2.7',
             'org.ocpsoft.prettytime:prettytime:3.2.7.Final',
             'com.google.android.gms:play-services-drive:7.0.0',
diff --git a/app/src/main/java/org/gnucash/android/ui/report/BarChartFragment.java b/app/src/main/java/org/gnucash/android/ui/report/BarChartFragment.java
index fba3eb32..67567a12 100644
--- a/app/src/main/java/org/gnucash/android/ui/report/BarChartFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/report/BarChartFragment.java
@@ -41,7 +41,7 @@
 import com.github.mikephil.charting.data.Entry;
 import com.github.mikephil.charting.highlight.Highlight;
 import com.github.mikephil.charting.listener.OnChartValueSelectedListener;
-import com.github.mikephil.charting.utils.LargeValueFormatter;
+import com.github.mikephil.charting.formatter.LargeValueFormatter;
 
 import org.gnucash.android.R;
 import org.gnucash.android.app.GnuCashApplication;
diff --git a/app/src/main/java/org/gnucash/android/ui/report/LineChartFragment.java b/app/src/main/java/org/gnucash/android/ui/report/LineChartFragment.java
index 5c9e12aa..8d753bdf 100644
--- a/app/src/main/java/org/gnucash/android/ui/report/LineChartFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/report/LineChartFragment.java
@@ -39,7 +39,7 @@
 import com.github.mikephil.charting.data.LineDataSet;
 import com.github.mikephil.charting.highlight.Highlight;
 import com.github.mikephil.charting.listener.OnChartValueSelectedListener;
-import com.github.mikephil.charting.utils.LargeValueFormatter;
+import com.github.mikephil.charting.formatter.LargeValueFormatter;
 
 import org.gnucash.android.R;
 import org.gnucash.android.app.GnuCashApplication;
diff --git a/app/src/main/java/org/gnucash/android/ui/report/PieChartFragment.java b/app/src/main/java/org/gnucash/android/ui/report/PieChartFragment.java
index e0f65835..f4b4ea5e 100644
--- a/app/src/main/java/org/gnucash/android/ui/report/PieChartFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/report/PieChartFragment.java
@@ -366,7 +366,7 @@ public void onValueSelected(Entry e, int dataSetIndex, Highlight h) {
         if (e == null) return;
         String label = mChart.getData().getXVals().get(e.getXIndex());
         float value = e.getVal();
-        float percent = value / mChart.getYValueSum() * 100;
+        float percent = value / mChart.getData().getYValueSum() * 100;
         mSelectedValueTextView.setText(String.format(SELECTED_VALUE_PATTERN, label, value, percent));
     }
 

From 6e7193fe58e167979d19d4aed76d88285ff94dd8 Mon Sep 17 00:00:00 2001
From: Oleksandr Tyshkovets <olexandr.tyshkovets@gmail.com>
Date: Tue, 3 Nov 2015 20:34:26 +0200
Subject: [PATCH 08/25] Return accounts balance due to account type

---
 app/src/main/java/org/gnucash/android/db/AccountsDbAdapter.java | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/app/src/main/java/org/gnucash/android/db/AccountsDbAdapter.java b/app/src/main/java/org/gnucash/android/db/AccountsDbAdapter.java
index d20b73d2..62381b9a 100644
--- a/app/src/main/java/org/gnucash/android/db/AccountsDbAdapter.java
+++ b/app/src/main/java/org/gnucash/android/db/AccountsDbAdapter.java
@@ -796,11 +796,12 @@ private Money computeBalance(String accountUID, long startTimestamp, long endTim
     public Money getAccountsBalance(List<String> accountUIDList, long startTimestamp, long endTimestamp) {
         String currencyCode = GnuCashApplication.getDefaultCurrencyCode();
         Money balance = Money.createZeroInstance(currencyCode);
+        boolean hasDebitNormalBalance = getAccountType(accountUIDList.get(0)).hasDebitNormalBalance();
 
         SplitsDbAdapter splitsDbAdapter = SplitsDbAdapter.getInstance();
         Money splitSum = (startTimestamp == -1 && endTimestamp == -1)
-                ? splitsDbAdapter.computeSplitBalance(accountUIDList, currencyCode, true)
-                : splitsDbAdapter.computeSplitBalance(accountUIDList, currencyCode, true, startTimestamp, endTimestamp);
+                ? splitsDbAdapter.computeSplitBalance(accountUIDList, currencyCode, hasDebitNormalBalance)
+                : splitsDbAdapter.computeSplitBalance(accountUIDList, currencyCode, hasDebitNormalBalance, startTimestamp, endTimestamp);
 
         return balance.add(splitSum);
     }

From 9d4da8b224b31b51f697f762cb11b1ae076c5989 Mon Sep 17 00:00:00 2001
From: Oleksandr Tyshkovets <olexandr.tyshkovets@gmail.com>
Date: Wed, 4 Nov 2015 21:28:21 +0200
Subject: [PATCH 09/25] Fix percent computing with negative values

---
 .../java/org/gnucash/android/ui/report/BarChartFragment.java | 12 ++++++++++--
 1 file changed, 10 insertions(+), 2 deletions(-)

diff --git a/app/src/main/java/org/gnucash/android/ui/report/BarChartFragment.java b/app/src/main/java/org/gnucash/android/ui/report/BarChartFragment.java
index 67567a12..93cd0ba2 100644
--- a/app/src/main/java/org/gnucash/android/ui/report/BarChartFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/report/BarChartFragment.java
@@ -465,8 +465,16 @@ public void onValueSelected(Entry e, int dataSetIndex, Highlight h) {
         String stackLabels = entry.getData().toString();
         String label = mChart.getData().getXVals().get(entry.getXIndex()) + ", "
                 + stackLabels.substring(1, stackLabels.length() - 1).split(",")[index];
-        double value = entry.getVals()[index];
-        double sum = mTotalPercentageMode ? mChart.getData().getDataSetByIndex(dataSetIndex).getYValueSum() : entry.getVal();
+        double value = Math.abs(entry.getVals()[index]);
+        double sum = 0;
+        if (mTotalPercentageMode) {
+            for (BarEntry barEntry : mChart.getData().getDataSetByIndex(dataSetIndex).getYVals()) {
+                sum += barEntry.getNegativeSum() + barEntry.getPositiveSum();
+            }
+        } else {
+            sum = entry.getNegativeSum() + entry.getPositiveSum();
+        }
+        Log.w(TAG, "sum2 = " + sum);
         selectedValueTextView.setText(String.format(SELECTED_VALUE_PATTERN, label, value, value / sum * 100));
     }
 

From b07a8254e30544529964d1532684ec9f4b47caa6 Mon Sep 17 00:00:00 2001
From: Oleksandr Tyshkovets <olexandr.tyshkovets@gmail.com>
Date: Wed, 4 Nov 2015 21:37:16 +0200
Subject: [PATCH 10/25] Revert to 2.1.3 due to line chart filling bug

---
 app/build.gradle                                                       | 2 +-
 app/src/main/java/org/gnucash/android/ui/report/BarChartFragment.java  | 2 +-
 app/src/main/java/org/gnucash/android/ui/report/LineChartFragment.java | 2 +-
 3 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/app/build.gradle b/app/build.gradle
index 34201f84..2a9d08c5 100644
--- a/app/build.gradle
+++ b/app/build.gradle
@@ -171,7 +171,7 @@ dependencies {
             'com.viewpagerindicator:library:2.4.1@aar',
             'com.code-troopers.betterpickers:library:2.0.3',
             'org.jraf:android-switch-backport:2.0.1@aar',
-            'com.github.PhilJay:MPAndroidChart:v2.1.6',
+            'com.github.PhilJay:MPAndroidChart:v2.1.3',
             'joda-time:joda-time:2.7',
             'org.ocpsoft.prettytime:prettytime:3.2.7.Final',
             'com.google.android.gms:play-services-drive:7.0.0',
diff --git a/app/src/main/java/org/gnucash/android/ui/report/BarChartFragment.java b/app/src/main/java/org/gnucash/android/ui/report/BarChartFragment.java
index 93cd0ba2..f79fa3ae 100644
--- a/app/src/main/java/org/gnucash/android/ui/report/BarChartFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/report/BarChartFragment.java
@@ -41,7 +41,7 @@
 import com.github.mikephil.charting.data.Entry;
 import com.github.mikephil.charting.highlight.Highlight;
 import com.github.mikephil.charting.listener.OnChartValueSelectedListener;
-import com.github.mikephil.charting.formatter.LargeValueFormatter;
+import com.github.mikephil.charting.utils.LargeValueFormatter;
 
 import org.gnucash.android.R;
 import org.gnucash.android.app.GnuCashApplication;
diff --git a/app/src/main/java/org/gnucash/android/ui/report/LineChartFragment.java b/app/src/main/java/org/gnucash/android/ui/report/LineChartFragment.java
index 8d753bdf..5c9e12aa 100644
--- a/app/src/main/java/org/gnucash/android/ui/report/LineChartFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/report/LineChartFragment.java
@@ -39,7 +39,7 @@
 import com.github.mikephil.charting.data.LineDataSet;
 import com.github.mikephil.charting.highlight.Highlight;
 import com.github.mikephil.charting.listener.OnChartValueSelectedListener;
-import com.github.mikephil.charting.formatter.LargeValueFormatter;
+import com.github.mikephil.charting.utils.LargeValueFormatter;
 
 import org.gnucash.android.R;
 import org.gnucash.android.app.GnuCashApplication;

From c42677aa8f96c4281d873e4795feee197cf30d4c Mon Sep 17 00:00:00 2001
From: Yongxin Wang <fefe.wyx@gmail.com>
Date: Fri, 6 Nov 2015 17:20:35 +0800
Subject: [PATCH 11/25] set default currency as the most used currency

---
 .../gnucash/android/importer/GncXmlHandler.java    | 24 ++++++++++++++++++++++
 1 file changed, 24 insertions(+)

diff --git a/app/src/main/java/org/gnucash/android/importer/GncXmlHandler.java b/app/src/main/java/org/gnucash/android/importer/GncXmlHandler.java
index 40be52aa..514300b8 100644
--- a/app/src/main/java/org/gnucash/android/importer/GncXmlHandler.java
+++ b/app/src/main/java/org/gnucash/android/importer/GncXmlHandler.java
@@ -18,11 +18,14 @@
 package org.gnucash.android.importer;
 
 import android.database.sqlite.SQLiteDatabase;
+import android.preference.PreferenceManager;
 import android.support.annotation.Nullable;
 import android.util.Log;
 
 import com.crashlytics.android.Crashlytics;
 
+import org.gnucash.android.R;
+import org.gnucash.android.app.GnuCashApplication;
 import org.gnucash.android.db.AccountsDbAdapter;
 import org.gnucash.android.db.CommoditiesDbAdapter;
 import org.gnucash.android.db.PricesDbAdapter;
@@ -230,6 +233,8 @@
 
     private PricesDbAdapter mPricesDbAdapter;
 
+    private Map<String, Integer> mCurrencyCount;
+
     /**
      * Creates a handler for handling XML stream events when parsing the XML backup file
      */
@@ -275,6 +280,7 @@ private void init(@Nullable SQLiteDatabase db) {
         mAutoBalanceSplits = new ArrayList<>();
 
         mPriceList = new ArrayList<>();
+        mCurrencyCount = new HashMap<>();
     }
 
     @Override
@@ -375,6 +381,11 @@ public void endElement(String uri, String localName, String qualifiedName) throw
                 }
                 if (mTransaction != null) {
                     mTransaction.setCurrencyCode(currencyCode);
+                    if (mCurrencyCount.containsKey(currencyCode)) {
+                        mCurrencyCount.put(currencyCode, mCurrencyCount.get(currencyCode) + 1);
+                    } else {
+                        mCurrencyCount.put(currencyCode, 1);
+                    }
                 }
                 if (mPrice != null) {
                     if (mPriceCommodity) {
@@ -844,6 +855,19 @@ public void endDocument() throws SAXException {
         } finally {
             mAccountsDbAdapter.endTransaction();
         }
+
+        String mostAppearedCurrency = "";
+        int mostCurrencyAppearance = 0;
+        for (Map.Entry<String, Integer> entry : mCurrencyCount.entrySet()) {
+            if (entry.getValue() > mostCurrencyAppearance) {
+                mostCurrencyAppearance = entry.getValue();
+                mostAppearedCurrency = entry.getKey();
+            }
+        }
+        if (mostCurrencyAppearance > 0) {
+            PreferenceManager.getDefaultSharedPreferences(GnuCashApplication.getAppContext()).edit().putString(GnuCashApplication.getAppContext().getString(R.string.key_default_currency), mostAppearedCurrency).apply();
+            Money.DEFAULT_CURRENCY_CODE = mostAppearedCurrency;
+        }
     }
 
     /**

From 8f4e42157785a1f71ad2591c4062bf4a334e34e9 Mon Sep 17 00:00:00 2001
From: Ngewi Fet <ngewif@gmail.com>
Date: Sun, 8 Nov 2015 01:58:12 +0100
Subject: [PATCH 12/25] Add option to select export time in export form

Modify CalculatorEditText to use commodities
Export OFX transactions based on time

TODO: add tests
---
 .../org/gnucash/android/db/AccountsDbAdapter.java  |  12 +-
 .../org/gnucash/android/db/DatabaseSchema.java     |   2 +-
 .../org/gnucash/android/db/MigrationHelper.java    |  56 ++++++
 .../gnucash/android/export/ExportAsyncTask.java    |   8 +-
 .../org/gnucash/android/export/ExportParams.java   |  35 ++--
 .../gnucash/android/export/ofx/OfxExporter.java    |   5 +-
 .../gnucash/android/export/qif/QifExporter.java    |   4 +-
 .../java/org/gnucash/android/model/Account.java    |   6 +-
 .../android/ui/export/ExportFormFragment.java      | 194 ++++++++++++++++-----
 .../ui/transaction/SplitEditorFragment.java        |   2 +-
 .../android/ui/util/widget/CalculatorEditText.java |  22 +--
 app/src/main/res/layout/fragment_export_form.xml   |  60 +++++--
 app/src/main/res/values/strings.xml                |   2 +-
 13 files changed, 308 insertions(+), 100 deletions(-)

diff --git a/app/src/main/java/org/gnucash/android/db/AccountsDbAdapter.java b/app/src/main/java/org/gnucash/android/db/AccountsDbAdapter.java
index 9bb90f6e..63b189a3 100644
--- a/app/src/main/java/org/gnucash/android/db/AccountsDbAdapter.java
+++ b/app/src/main/java/org/gnucash/android/db/AccountsDbAdapter.java
@@ -39,6 +39,7 @@
 import org.gnucash.android.model.TransactionType;
 
 import java.math.BigDecimal;
+import java.sql.Timestamp;
 import java.util.ArrayList;
 import java.util.Currency;
 import java.util.HashMap;
@@ -503,12 +504,11 @@ public AccountType getAccountType(long accountId){
     }
 	/**
 	 * Returns a list of accounts which have transactions that have not been exported yet
+     * @param lastExportTimeStamp Timestamp after which to any transactions created/modified should be exported
 	 * @return List of {@link Account}s with unexported transactions
-     * @deprecated This uses the exported flag in the database which is no longer supported.
 	 */
-    @Deprecated
-    public List<Account> getExportableAccounts(){
-        LinkedList<Account> accountsList = new LinkedList<Account>();
+    public List<Account> getExportableAccounts(Timestamp lastExportTimeStamp){
+        LinkedList<Account> accountsList = new LinkedList<>();
         Cursor cursor = mDb.query(
                 TransactionEntry.TABLE_NAME + " , " + SplitEntry.TABLE_NAME +
                         " ON " + TransactionEntry.TABLE_NAME + "." + TransactionEntry.COLUMN_UID + " = " +
@@ -517,8 +517,8 @@ public AccountType getAccountType(long accountId){
                         AccountEntry.COLUMN_UID + " = " + SplitEntry.TABLE_NAME + "." +
                         SplitEntry.COLUMN_ACCOUNT_UID,
                 new String[]{AccountEntry.TABLE_NAME + ".*"},
-                TransactionEntry.TABLE_NAME + "." + TransactionEntry.COLUMN_EXPORTED + " == 0",
-                null,
+                TransactionEntry.TABLE_NAME + "." + TransactionEntry.COLUMN_MODIFIED_AT + " > ?",
+                new String[]{lastExportTimeStamp.toString()},
                 AccountEntry.TABLE_NAME + "." + AccountEntry.COLUMN_UID,
                 null,
                 null
diff --git a/app/src/main/java/org/gnucash/android/db/DatabaseSchema.java b/app/src/main/java/org/gnucash/android/db/DatabaseSchema.java
index c39568a3..463c9e06 100644
--- a/app/src/main/java/org/gnucash/android/db/DatabaseSchema.java
+++ b/app/src/main/java/org/gnucash/android/db/DatabaseSchema.java
@@ -28,7 +28,7 @@
      * Database version.
      * With any change to the database schema, this number must increase
      */
-    public static final int DATABASE_VERSION = 9;
+    public static final int DATABASE_VERSION = 10;
 
     /**
      * Database version where Splits were introduced
diff --git a/app/src/main/java/org/gnucash/android/db/MigrationHelper.java b/app/src/main/java/org/gnucash/android/db/MigrationHelper.java
index b8039c6b..9040e2d2 100644
--- a/app/src/main/java/org/gnucash/android/db/MigrationHelper.java
+++ b/app/src/main/java/org/gnucash/android/db/MigrationHelper.java
@@ -24,6 +24,7 @@
 import android.database.Cursor;
 import android.database.sqlite.SQLiteDatabase;
 import android.os.Environment;
+import android.preference.PreferenceManager;
 import android.text.TextUtils;
 import android.util.Log;
 
@@ -31,12 +32,15 @@
 
 import org.gnucash.android.R;
 import org.gnucash.android.app.GnuCashApplication;
+import org.gnucash.android.export.ExportFormat;
+import org.gnucash.android.export.ExportParams;
 import org.gnucash.android.export.Exporter;
 import org.gnucash.android.importer.CommoditiesXmlHandler;
 import org.gnucash.android.model.AccountType;
 import org.gnucash.android.model.BaseModel;
 import org.gnucash.android.model.Commodity;
 import org.gnucash.android.model.Money;
+import org.gnucash.android.model.ScheduledAction;
 import org.gnucash.android.model.Transaction;
 import org.xml.sax.InputSource;
 import org.xml.sax.SAXException;
@@ -1058,4 +1062,56 @@ static int upgradeDbToVersion9(SQLiteDatabase db){
         }
         return oldVersion;
     }
+
+    /**
+     * Upgrades the database to version 10
+     * <p>This method converts all saved scheduled export parameters to the new format using the
+     * timestamp of last export</p>
+     * @param db SQLite database
+     * @return New version number
+     */
+    static int upgradeDbToVersion10(SQLiteDatabase db){
+        Log.i(DatabaseHelper.LOG_TAG, "Upgrading database to version 9");
+        int oldVersion = 9;
+
+        db.beginTransaction();
+        try {
+            Cursor cursor = db.query(ScheduledActionEntry.TABLE_NAME,
+                    new String[]{ScheduledActionEntry.COLUMN_UID, ScheduledActionEntry.COLUMN_TAG},
+                    ScheduledActionEntry.COLUMN_TYPE + " = ?",
+                    new String[]{ScheduledAction.ActionType.BACKUP.name()},
+                    null, null, null);
+
+            ContentValues contentValues = new ContentValues();
+            while (cursor.moveToNext()){
+                String paramString = cursor.getString(cursor.getColumnIndexOrThrow(ScheduledActionEntry.COLUMN_TAG));
+                String[] tokens = paramString.split(";");
+                ExportParams params = new ExportParams(ExportFormat.valueOf(tokens[0]));
+                params.setExportTarget(ExportParams.ExportTarget.valueOf(tokens[1]));
+                params.setDeleteTransactionsAfterExport(Boolean.parseBoolean(tokens[3]));
+
+                boolean exportAll = Boolean.parseBoolean(tokens[2]);
+                if (exportAll){
+                    params.setExportStartTime(Timestamp.valueOf(Exporter.TIMESTAMP_ZERO));
+                } else {
+                    String lastExportTimeStamp = PreferenceManager.getDefaultSharedPreferences(GnuCashApplication.getAppContext())
+                            .getString(Exporter.PREF_LAST_EXPORT_TIME, Exporter.TIMESTAMP_ZERO);
+                    Timestamp timestamp = Timestamp.valueOf(lastExportTimeStamp);
+                    params.setExportStartTime(timestamp);
+                }
+
+                String uid = cursor.getString(cursor.getColumnIndexOrThrow(ScheduledActionEntry.COLUMN_UID));
+                contentValues.clear();
+                contentValues.put(ScheduledActionEntry.COLUMN_UID, uid);
+                contentValues.put(ScheduledActionEntry.COLUMN_TAG, params.toCsv());
+                db.insert(ScheduledActionEntry.TABLE_NAME, null, contentValues);
+            }
+
+            db.setTransactionSuccessful();
+            oldVersion = 10;
+        } finally {
+            db.endTransaction();
+        }
+        return oldVersion;
+    }
 }
diff --git a/app/src/main/java/org/gnucash/android/export/ExportAsyncTask.java b/app/src/main/java/org/gnucash/android/export/ExportAsyncTask.java
index 1f07600e..6709a9af 100644
--- a/app/src/main/java/org/gnucash/android/export/ExportAsyncTask.java
+++ b/app/src/main/java/org/gnucash/android/export/ExportAsyncTask.java
@@ -143,7 +143,7 @@ protected Boolean doInBackground(ExportParams... params) {
             }
 
         try {
-            File file = new File(mExportParams.getTargetFilepath());
+            File file = new File(mExportParams.getInternalExportPath());
             BufferedWriter writer = new BufferedWriter(new OutputStreamWriter(new FileOutputStream(file), "UTF-8"));
             try {
                 // FIXME: detect if there aren't transactions to export and inform the user
@@ -366,11 +366,11 @@ private void copyExportToDropbox() {
     private List<String> getExportedFiles() throws IOException {
         List<String> exportedFilePaths;
         if (mExportParams.getExportFormat() == ExportFormat.QIF) {
-            String path = mExportParams.getTargetFilepath();
+            String path = mExportParams.getInternalExportPath();
             exportedFilePaths = QifExporter.splitQIF(new File(path));
         } else {
             exportedFilePaths = new ArrayList<>();
-            exportedFilePaths.add(mExportParams.getTargetFilepath());
+            exportedFilePaths.add(mExportParams.getInternalExportPath());
         }
         return exportedFilePaths;
     }
@@ -382,7 +382,7 @@ private void copyExportToDropbox() {
      */
     private File moveExportToSDCard() {
         Log.i(TAG, "Moving exported file to external storage");
-        File src = new File(mExportParams.getTargetFilepath());
+        File src = new File(mExportParams.getInternalExportPath());
         File dst = Exporter.createExportFile(mExportParams.getExportFormat());
 
         try {
diff --git a/app/src/main/java/org/gnucash/android/export/ExportParams.java b/app/src/main/java/org/gnucash/android/export/ExportParams.java
index 6b23ede1..50619cc4 100644
--- a/app/src/main/java/org/gnucash/android/export/ExportParams.java
+++ b/app/src/main/java/org/gnucash/android/export/ExportParams.java
@@ -16,9 +16,16 @@
 
 package org.gnucash.android.export;
 
+import android.preference.PreferenceManager;
+import android.util.Log;
+
+import com.crashlytics.android.Crashlytics;
+
 import org.gnucash.android.app.GnuCashApplication;
 import org.gnucash.android.ui.export.ExportFormFragment;
 
+import java.sql.Timestamp;
+
 /**
  * Encapsulation of the parameters used for exporting transactions.
  * The parameters are determined by the user in the export dialog and are then transmitted to the asynchronous task which
@@ -42,10 +49,9 @@
     private ExportFormat mExportFormat      = ExportFormat.QIF;
 
     /**
-     * Flag to determine if all transactions (including previously exported ones) should be exported
-     * By default only new transactions since the last export will be exported.
+     * All transactions created after this date will be exported
      */
-    private boolean mExportAllTransactions  = false;
+    private Timestamp mExportStartTime = Timestamp.valueOf(Exporter.TIMESTAMP_ZERO);
 
     /**
      * Flag to determine if all transactions should be deleted after exporting is complete
@@ -90,19 +96,20 @@ public void setExportFormat(ExportFormat exportFormat) {
     }
 
     /**
-     * Returns flag whether all transactions should be exported, or only new ones since last export
-     * @return <code>true</code> if all transactions should be exported, <code>false</code> otherwise
+     * Return date from which to start exporting transactions
+     * <p>Transactions created or modified after this timestamp will be exported</p>
+     * @return Timestamp from which to export
      */
-    public boolean shouldExportAllTransactions() {
-        return mExportAllTransactions;
+    public Timestamp getExportStartTime(){
+        return mExportStartTime;
     }
 
     /**
-     * Sets flag for exporting all transactions or only new transactions since last export
-     * @param exportAll Boolean flag
+     * Set the timestamp after which all transactions created/modified will be exported
+     * @param exportStartTime Timestamp
      */
-    public void setExportAllTransactions(boolean exportAll) {
-        this.mExportAllTransactions = exportAll;
+    public void setExportStartTime(Timestamp exportStartTime){
+        this.mExportStartTime = exportStartTime;
     }
 
     /**
@@ -142,7 +149,7 @@ public void setExportTarget(ExportTarget mExportTarget) {
      * This file path is not accessible outside the context of the application
      * @return String path to exported transactions
      */
-    public String getTargetFilepath() {
+    public String getInternalExportPath() {
         return mTargetFilepath;
     }
 
@@ -160,7 +167,7 @@ public String toString() {
     public String toCsv(){
         String separator = ";";
         String csv = mExportFormat.name() + separator + mExportTarget.name() + separator
-                + Boolean.toString(mExportAllTransactions) + separator
+                + mExportStartTime.toString() + separator
                 + Boolean.toString(mDeleteTransactionsAfterExport);
 
         return csv;
@@ -175,7 +182,7 @@ public static ExportParams parseCsv(String csvParams){
         String[] tokens = csvParams.split(";");
         ExportParams params = new ExportParams(ExportFormat.valueOf(tokens[0]));
         params.setExportTarget(ExportTarget.valueOf(tokens[1]));
-        params.setExportAllTransactions(Boolean.parseBoolean(tokens[2]));
+        params.setExportStartTime(Timestamp.valueOf(tokens[2]));
         params.setDeleteTransactionsAfterExport(Boolean.parseBoolean(tokens[3]));
 
         return params;
diff --git a/app/src/main/java/org/gnucash/android/export/ofx/OfxExporter.java b/app/src/main/java/org/gnucash/android/export/ofx/OfxExporter.java
index ff9b144e..ab915e40 100644
--- a/app/src/main/java/org/gnucash/android/export/ofx/OfxExporter.java
+++ b/app/src/main/java/org/gnucash/android/export/ofx/OfxExporter.java
@@ -99,7 +99,7 @@ private void generateOfx(Document doc, Element parent){
 
 
 			//add account details (transactions) to the XML document			
-			account.toOfx(doc, statementTransactionResponse, mParameters.shouldExportAllTransactions());
+			account.toOfx(doc, statementTransactionResponse, mParameters.getExportStartTime());
 			
 			//mark as exported
 			accountsDbAdapter.markAsExported(account.getUID());
@@ -108,8 +108,7 @@ private void generateOfx(Document doc, Element parent){
 	}
 
     public String generateExport() throws ExporterException {
-        mAccountsList = mParameters.shouldExportAllTransactions() ?
-                mAccountsDbAdapter.getAllRecords() : mAccountsDbAdapter.getExportableAccounts();
+        mAccountsList = mAccountsDbAdapter.getExportableAccounts(mParameters.getExportStartTime());
 
         DocumentBuilderFactory docFactory = DocumentBuilderFactory
                 .newInstance();
diff --git a/app/src/main/java/org/gnucash/android/export/qif/QifExporter.java b/app/src/main/java/org/gnucash/android/export/qif/QifExporter.java
index ac5ca01c..95b7485c 100644
--- a/app/src/main/java/org/gnucash/android/export/qif/QifExporter.java
+++ b/app/src/main/java/org/gnucash/android/export/qif/QifExporter.java
@@ -88,9 +88,7 @@ public void generateExport(Writer writer) throws ExporterException {
                             // or if the transaction has only one split (the whole transaction would be lost if it is not selected)
                             "trans_split_count == 1 )" +
                             (
-                            mParameters.shouldExportAllTransactions() ?
-                                    //"" : " AND " + TransactionEntry.TABLE_NAME + "_" + TransactionEntry.COLUMN_EXPORTED + "== 0"
-                                    "" : " AND " + TransactionEntry.TABLE_NAME + "_" + DatabaseSchema.CommonColumns.COLUMN_MODIFIED_AT + " > \"" + lastExportTimeStamp + "\""
+                                    " AND " + TransactionEntry.TABLE_NAME + "_" + TransactionEntry.COLUMN_MODIFIED_AT + " > \"" + lastExportTimeStamp + "\""
                             ),
                     null,
                     // trans_time ASC : put transactions in time order
diff --git a/app/src/main/java/org/gnucash/android/model/Account.java b/app/src/main/java/org/gnucash/android/model/Account.java
index 84dc317e..6df05036 100644
--- a/app/src/main/java/org/gnucash/android/model/Account.java
+++ b/app/src/main/java/org/gnucash/android/model/Account.java
@@ -472,8 +472,9 @@ public static OfxAccountType convertToOfxAccountType(AccountType accountType){
 	 * Converts this account's transactions into XML and adds them to the DOM document
 	 * @param doc XML DOM document for the OFX data
 	 * @param parent Parent node to which to add this account's transactions in XML
+	 * @param exportStartTime Time from which to export transactions which are created/modified after
 	 */
-	public void toOfx(Document doc, Element parent, boolean exportAllTransactions){
+	public void toOfx(Document doc, Element parent, Timestamp exportStartTime){
 		Element currency = doc.createElement(OfxHelper.TAG_CURRENCY_DEF);
 		currency.appendChild(doc.createTextNode(mCommodity.getCurrencyCode()));
 		
@@ -529,9 +530,8 @@ public void toOfx(Document doc, Element parent, boolean exportAllTransactions){
 		bankTransactionsList.appendChild(dtstart);
 		bankTransactionsList.appendChild(dtend);
 
-		Timestamp lastExportedTimestamp = Timestamp.valueOf(PreferenceManager.getDefaultSharedPreferences(GnuCashApplication.getAppContext()).getString(Exporter.PREF_LAST_EXPORT_TIME, Exporter.TIMESTAMP_ZERO));
 		for (Transaction transaction : mTransactionsList) {
-			if (!exportAllTransactions && /*transaction.isExported()*/ transaction.getModifiedTimestamp().before(lastExportedTimestamp))
+			if (transaction.getModifiedTimestamp().before(exportStartTime))
 				continue;
             bankTransactionsList.appendChild(transaction.toOFX(doc, getUID()));
 		}		
diff --git a/app/src/main/java/org/gnucash/android/ui/export/ExportFormFragment.java b/app/src/main/java/org/gnucash/android/ui/export/ExportFormFragment.java
index 0303fde4..45d707c1 100644
--- a/app/src/main/java/org/gnucash/android/ui/export/ExportFormFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/export/ExportFormFragment.java
@@ -21,6 +21,7 @@
 import android.content.Intent;
 import android.content.SharedPreferences;
 import android.content.pm.PackageManager;
+import android.content.res.Resources;
 import android.os.Build;
 import android.os.Bundle;
 import android.preference.PreferenceManager;
@@ -28,6 +29,7 @@
 import android.support.v4.app.FragmentManager;
 import android.support.v7.app.ActionBar;
 import android.support.v7.app.AppCompatActivity;
+import android.support.v7.widget.SwitchCompat;
 import android.text.format.Time;
 import android.util.Log;
 import android.view.LayoutInflater;
@@ -39,13 +41,18 @@
 import android.widget.AdapterView;
 import android.widget.ArrayAdapter;
 import android.widget.CheckBox;
+import android.widget.CompoundButton;
+import android.widget.LinearLayout;
 import android.widget.RadioButton;
 import android.widget.Spinner;
 import android.widget.TextView;
 
+import com.codetroopers.betterpickers.calendardatepicker.CalendarDatePickerDialog;
+import com.codetroopers.betterpickers.radialtimepicker.RadialTimePickerDialog;
 import com.codetroopers.betterpickers.recurrencepicker.EventRecurrence;
 import com.codetroopers.betterpickers.recurrencepicker.EventRecurrenceFormatter;
 import com.codetroopers.betterpickers.recurrencepicker.RecurrencePickerDialog;
+import com.crashlytics.android.Crashlytics;
 import com.dropbox.sync.android.DbxAccountManager;
 
 import org.gnucash.android.R;
@@ -54,26 +61,37 @@
 import org.gnucash.android.export.ExportAsyncTask;
 import org.gnucash.android.export.ExportFormat;
 import org.gnucash.android.export.ExportParams;
+import org.gnucash.android.export.Exporter;
 import org.gnucash.android.model.BaseModel;
 import org.gnucash.android.model.ScheduledAction;
 import org.gnucash.android.ui.account.AccountsActivity;
 import org.gnucash.android.ui.common.UxArgument;
 import org.gnucash.android.ui.settings.SettingsActivity;
+import org.gnucash.android.ui.transaction.TransactionFormFragment;
 import org.gnucash.android.ui.util.RecurrenceParser;
 
+import java.sql.Timestamp;
+import java.text.DateFormat;
+import java.text.ParseException;
+import java.util.Calendar;
+import java.util.Date;
+import java.util.GregorianCalendar;
 import java.util.List;
 
 import butterknife.Bind;
 import butterknife.ButterKnife;
 
+
 /**
  * Dialog fragment for exporting accounts and transactions in various formats
  * <p>The dialog is used for collecting information on the export options and then passing them
  * to the {@link org.gnucash.android.export.Exporter} responsible for exporting</p>
  * @author Ngewi Fet <ngewif@gmail.com>
  */
-public class
-		ExportFormFragment extends Fragment implements RecurrencePickerDialog.OnRecurrenceSetListener {
+public class ExportFormFragment extends Fragment implements
+		RecurrencePickerDialog.OnRecurrenceSetListener,
+		CalendarDatePickerDialog.OnDateSetListener,
+		RadialTimePickerDialog.OnTimeSetListener {
 		
 	/**
 	 * Spinner for selecting destination for the exported file.
@@ -83,12 +101,6 @@
 	@Bind(R.id.spinner_export_destination) Spinner mDestinationSpinner;
 	
 	/**
-	 * Checkbox indicating that all transactions should be exported,
-	 * regardless of whether they have been exported previously or not
-	 */
-	@Bind(R.id.checkbox_export_all) CheckBox mExportAllCheckBox;
-	
-	/**
 	 * Checkbox for deleting all transactions after exporting them
 	 */
 	@Bind(R.id.checkbox_post_export_delete) CheckBox mDeleteAllCheckBox;
@@ -104,6 +116,24 @@
 	@Bind(R.id.input_recurrence) TextView mRecurrenceTextView;
 
 	/**
+	 * Text view displaying start date to export from
+	 */
+	@Bind(R.id.export_start_date) TextView mExportStartDate;
+
+	@Bind(R.id.export_start_time) TextView mExportStartTime;
+
+	/**
+	 * Switch toggling whether to export all transactions or not
+	 */
+	@Bind(R.id.switch_export_all) SwitchCompat mExportAllSwitch;
+
+	@Bind(R.id.export_date_layout) LinearLayout mExportDateLayout;
+
+	@Bind(R.id.radio_ofx_format) RadioButton mOfxRadioButton;
+	@Bind(R.id.radio_qif_format) RadioButton mQifRadioButton;
+	@Bind(R.id.radio_xml_format) RadioButton mXmlRadioButton;
+
+	/**
 	 * Event recurrence options
 	 */
 	EventRecurrence mEventRecurrence = new EventRecurrence();
@@ -113,6 +143,8 @@
 	 */
 	String mRecurrenceRule;
 
+	Calendar mExportStartCalendar = Calendar.getInstance();
+
 	/**
 	 * Tag for logging
 	 */
@@ -126,7 +158,7 @@
 	private ExportParams.ExportTarget mExportTarget = ExportParams.ExportTarget.SD_CARD;
 
 
-    public void onRadioButtonClicked(View view){
+	public void onRadioButtonClicked(View view){
         switch (view.getId()){
             case R.id.radio_ofx_format:
                 mExportFormat = ExportFormat.OFX;
@@ -136,6 +168,7 @@ public void onRadioButtonClicked(View view){
                 } else {
                     mExportWarningTextView.setVisibility(View.GONE);
                 }
+				mExportDateLayout.setVisibility(View.VISIBLE);
                 break;
 
             case R.id.radio_qif_format:
@@ -147,12 +180,13 @@ public void onRadioButtonClicked(View view){
                 } else {
                     mExportWarningTextView.setVisibility(View.GONE);
                 }
+				mExportDateLayout.setVisibility(View.VISIBLE);
 				break;
 
 			case R.id.radio_xml_format:
 				mExportFormat = ExportFormat.XML;
 				mExportWarningTextView.setText(R.string.export_warning_xml);
-
+				mExportDateLayout.setVisibility(View.GONE);
 				break;
         }
     }
@@ -161,15 +195,13 @@ public void onRadioButtonClicked(View view){
 	public View onCreateView(LayoutInflater inflater, ViewGroup container,
 			Bundle savedInstanceState) {
 		View view = inflater.inflate(R.layout.fragment_export_form, container, false);
+
 		ButterKnife.bind(this, view);
-		return view;
-	}
 
-	@Override
-	public void onCreate(Bundle savedInstanceState) {
-		super.onCreate(savedInstanceState);
-	}
+		bindViewListeners();
 
+		return view;
+	}
 	@Override
 	public void onCreateOptionsMenu(Menu menu, MenuInflater inflater) {
 		inflater.inflate(R.menu.default_save_actions, menu);
@@ -196,7 +228,7 @@ public boolean onOptionsItemSelected(MenuItem item) {
 	@Override
 	public void onActivityCreated(Bundle savedInstanceState) {		
 		super.onActivityCreated(savedInstanceState);
-        bindViews();
+
 		ActionBar supportActionBar = ((AppCompatActivity) getActivity()).getSupportActionBar();
 		assert supportActionBar != null;
 		supportActionBar.setTitle(R.string.title_export_dialog);
@@ -233,7 +265,13 @@ private void getSDWritePermission(){
 	 */
 	private void startExport(){
 		ExportParams exportParameters = new ExportParams(mExportFormat);
-		exportParameters.setExportAllTransactions(mExportAllCheckBox.isChecked());
+
+		if (mExportAllSwitch.isChecked()){
+			exportParameters.setExportStartTime(Timestamp.valueOf(Exporter.TIMESTAMP_ZERO));
+		} else {
+			exportParameters.setExportStartTime(new Timestamp(mExportStartCalendar.getTimeInMillis()));
+		}
+
 		exportParameters.setExportTarget(mExportTarget);
 		exportParameters.setDeleteTransactionsAfterExport(mDeleteAllCheckBox.isChecked());
 
@@ -253,7 +291,8 @@ private void startExport(){
 		//getActivity().finish();
 	}
 
-	private void bindViews(){
+	private void bindViewListeners(){
+		// export destination bindings
 		ArrayAdapter<CharSequence> adapter = ArrayAdapter.createFromResource(getActivity(),
 		        R.array.export_destinations, android.R.layout.simple_spinner_item);
 		adapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);		
@@ -300,9 +339,77 @@ public void onNothingSelected(AdapterView<?> parent) {
 
 			}
 		});
+
+
+		//**************** export start time bindings ******************
+		String lastExportTimeStamp = PreferenceManager.getDefaultSharedPreferences(getActivity())
+				.getString(Exporter.PREF_LAST_EXPORT_TIME, Exporter.TIMESTAMP_ZERO);
+		Timestamp timestamp = Timestamp.valueOf(lastExportTimeStamp);
+		mExportStartCalendar.setTimeInMillis(timestamp.getTime());
+
+		Date date = new Date(timestamp.getTime());
+		mExportStartDate.setText(TransactionFormFragment.DATE_FORMATTER.format(date));
+		mExportStartTime.setText(TransactionFormFragment.TIME_FORMATTER.format(date));
+
+		mExportStartDate.setOnClickListener(new View.OnClickListener() {
+
+			@Override
+			public void onClick(View v) {
+				long dateMillis = 0;
+				try {
+					Date date = TransactionFormFragment.DATE_FORMATTER.parse(mExportStartDate.getText().toString());
+					dateMillis = date.getTime();
+				} catch (ParseException e) {
+					Log.e(getTag(), "Error converting input time to Date object");
+				}
+				Calendar calendar = Calendar.getInstance();
+				calendar.setTimeInMillis(dateMillis);
+
+				int year = calendar.get(Calendar.YEAR);
+				int monthOfYear = calendar.get(Calendar.MONTH);
+				int dayOfMonth = calendar.get(Calendar.DAY_OF_MONTH);
+				CalendarDatePickerDialog datePickerDialog = CalendarDatePickerDialog.newInstance(
+						ExportFormFragment.this,
+						year, monthOfYear, dayOfMonth);
+				datePickerDialog.show(getFragmentManager(), "date_picker_fragment");
+			}
+		});
+
+		mExportStartTime.setOnClickListener(new View.OnClickListener() {
+
+			@Override
+			public void onClick(View v) {
+				long timeMillis = 0;
+				try {
+					Date date = TransactionFormFragment.TIME_FORMATTER.parse(mExportStartTime.getText().toString());
+					timeMillis = date.getTime();
+				} catch (ParseException e) {
+					Log.e(getTag(), "Error converting input time to Date object");
+				}
+
+				Calendar calendar = Calendar.getInstance();
+				calendar.setTimeInMillis(timeMillis);
+
+				RadialTimePickerDialog timePickerDialog = RadialTimePickerDialog.newInstance(
+						ExportFormFragment.this, calendar.get(Calendar.HOUR_OF_DAY),
+						calendar.get(Calendar.MINUTE), true);
+				timePickerDialog.show(getFragmentManager(), "time_picker_dialog_fragment");
+			}
+		});
+
 		SharedPreferences sharedPrefs = PreferenceManager.getDefaultSharedPreferences(getActivity());
-		mExportAllCheckBox.setChecked(sharedPrefs.getBoolean(getString(R.string.key_export_all_transactions), false));
-		
+		mExportAllSwitch.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener() {
+			@Override
+			public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {
+				mExportStartDate.setEnabled(!isChecked);
+				mExportStartTime.setEnabled(!isChecked);
+				int color = isChecked ? android.R.color.darker_gray : android.R.color.black;
+				mExportStartDate.setTextColor(getResources().getColor(color));
+				mExportStartTime.setTextColor(getResources().getColor(color));
+			}
+		});
+
+		mExportAllSwitch.setChecked(sharedPrefs.getBoolean(getString(R.string.key_export_all_transactions), false));
 		mDeleteAllCheckBox.setChecked(sharedPrefs.getBoolean(getString(R.string.key_delete_transactions_after_export), false));
 
 		mRecurrenceTextView.setOnClickListener(new View.OnClickListener() {
@@ -334,7 +441,7 @@ public void onClick(View view) {
         String defaultExportFormat = sharedPrefs.getString(getString(R.string.key_default_export_format), ExportFormat.QIF.name());
         mExportFormat = ExportFormat.valueOf(defaultExportFormat);
 
-        View.OnClickListener clickListener = new View.OnClickListener() {
+        View.OnClickListener radioClickListener = new View.OnClickListener() {
             @Override
             public void onClick(View view) {
                 onRadioButtonClicked(view);
@@ -344,28 +451,21 @@ public void onClick(View view) {
 		View v = getView();
 		assert v != null;
 
-        RadioButton ofxRadioButton = (RadioButton) v.findViewById(R.id.radio_ofx_format);
-        ofxRadioButton.setOnClickListener(clickListener);
-        if (defaultExportFormat.equalsIgnoreCase(ExportFormat.OFX.name())) {
-            ofxRadioButton.performClick();
-        }
-
-        RadioButton qifRadioButton = (RadioButton) v.findViewById(R.id.radio_qif_format);
-        qifRadioButton.setOnClickListener(clickListener);
-        if (defaultExportFormat.equalsIgnoreCase(ExportFormat.QIF.name())){
-            qifRadioButton.performClick();
-        }
+		mOfxRadioButton.setOnClickListener(radioClickListener);
+		mQifRadioButton.setOnClickListener(radioClickListener);
+		mXmlRadioButton.setOnClickListener(radioClickListener);
 
-		RadioButton xmlRadioButton = (RadioButton) v.findViewById(R.id.radio_xml_format);
-		xmlRadioButton.setOnClickListener(clickListener);
-		if (defaultExportFormat.equalsIgnoreCase(ExportFormat.XML.name())){
-			xmlRadioButton.performClick();
+		ExportFormat defaultFormat = ExportFormat.valueOf(defaultExportFormat.toUpperCase());
+		switch (defaultFormat){
+			case QIF: mQifRadioButton.performClick(); break;
+			case OFX: mOfxRadioButton.performClick(); break;
+			case XML: mXmlRadioButton.performClick(); break;
 		}
 
 		if (GnuCashApplication.isDoubleEntryEnabled()){
-			ofxRadioButton.setVisibility(View.GONE);
+			mOfxRadioButton.setVisibility(View.GONE);
 		} else {
-			xmlRadioButton.setVisibility(View.GONE);
+			mXmlRadioButton.setVisibility(View.GONE);
 		}
 
 	}
@@ -393,5 +493,21 @@ public void onActivityResult(int requestCode, int resultCode, Intent data) {
 		}
 	}
 
+	@Override
+	public void onDateSet(CalendarDatePickerDialog dialog, int year, int monthOfYear, int dayOfMonth) {
+		Calendar cal = new GregorianCalendar(year, monthOfYear, dayOfMonth);
+		mExportStartDate.setText(TransactionFormFragment.DATE_FORMATTER.format(cal.getTime()));
+		mExportStartCalendar.set(Calendar.YEAR, year);
+		mExportStartCalendar.set(Calendar.MONTH, monthOfYear);
+		mExportStartCalendar.set(Calendar.DAY_OF_MONTH, dayOfMonth);
+	}
+
+	@Override
+	public void onTimeSet(RadialTimePickerDialog dialog, int hourOfDay, int minute) {
+		Calendar cal = new GregorianCalendar(0, 0, 0, hourOfDay, minute);
+		mExportStartTime.setText(TransactionFormFragment.TIME_FORMATTER.format(cal.getTime()));
+		mExportStartCalendar.set(Calendar.HOUR_OF_DAY, hourOfDay);
+		mExportStartCalendar.set(Calendar.MINUTE, minute);
+	}
 }
 
diff --git a/app/src/main/java/org/gnucash/android/ui/transaction/SplitEditorFragment.java b/app/src/main/java/org/gnucash/android/ui/transaction/SplitEditorFragment.java
index f4500c7f..a3a141a3 100644
--- a/app/src/main/java/org/gnucash/android/ui/transaction/SplitEditorFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/transaction/SplitEditorFragment.java
@@ -265,7 +265,7 @@ public void onClick(View view) {
             splitUidTextView.setText(BaseModel.generateUID());
 
             if (split != null) {
-                splitAmountEditText.setCurrency(split.getValue().getCurrency());
+                splitAmountEditText.setCommodity(split.getValue().getCommodity());
                 splitAmountEditText.setValue(split.getFormattedValue().asBigDecimal());
                 splitCurrencyTextView.setText(split.getValue().getCurrency().getSymbol());
                 splitMemoEditText.setText(split.getMemo());
diff --git a/app/src/main/java/org/gnucash/android/ui/util/widget/CalculatorEditText.java b/app/src/main/java/org/gnucash/android/ui/util/widget/CalculatorEditText.java
index d58de4a4..193d2f66 100644
--- a/app/src/main/java/org/gnucash/android/ui/util/widget/CalculatorEditText.java
+++ b/app/src/main/java/org/gnucash/android/ui/util/widget/CalculatorEditText.java
@@ -55,7 +55,8 @@
  */
 public class CalculatorEditText extends EditText {
     CalculatorKeyboard mCalculatorKeyboard;
-    private Currency mCurrency = Currency.getInstance(GnuCashApplication.getDefaultCurrencyCode());
+
+    private Commodity mCommodity = Commodity.DEFAULT_COMMODITY;
     private Context mContext;
 
     /**
@@ -238,17 +239,17 @@ public void setCalculatorKeyboard(CalculatorKeyboard keyboard){
      * Returns the currency used for computations
      * @return ISO 4217 currency
      */
-    public Currency getCurrency() {
-        return mCurrency;
+    public Commodity getCommodity() {
+        return mCommodity;
     }
 
     /**
-     * Sets the currency to use for calculations
-     * The currency determines the number of decimal places used
-     * @param currency ISO 4217 currency
+     * Sets the commodity to use for calculations
+     * The commodity determines the number of decimal places used
+     * @param commodity ISO 4217 currency
      */
-    public void setCurrency(Currency currency) {
-        this.mCurrency = currency;
+    public void setCommodity(Commodity commodity) {
+        this.mCommodity = commodity;
     }
 
     /**
@@ -337,12 +338,11 @@ public BigDecimal getValue(){
      * @param amount BigDecimal amount
      */
     public void setValue(BigDecimal amount){
-        Commodity commodity = CommoditiesDbAdapter.getInstance().getCommodity(mCurrency.getCurrencyCode());
-        BigDecimal newAmount = amount.setScale(commodity.getSmallestFractionDigits(), BigDecimal.ROUND_HALF_EVEN);
+        BigDecimal newAmount = amount.setScale(mCommodity.getSmallestFractionDigits(), BigDecimal.ROUND_HALF_EVEN);
 
         DecimalFormat formatter = (DecimalFormat) NumberFormat.getInstance(Locale.getDefault());
         formatter.setMinimumFractionDigits(0);
-        formatter.setMaximumFractionDigits(commodity.getSmallestFractionDigits());
+        formatter.setMaximumFractionDigits(mCommodity.getSmallestFractionDigits());
         formatter.setGroupingUsed(false);
         String resultString = formatter.format(newAmount.doubleValue());
 
diff --git a/app/src/main/res/layout/fragment_export_form.xml b/app/src/main/res/layout/fragment_export_form.xml
index 3fafbc43..0d2944c3 100644
--- a/app/src/main/res/layout/fragment_export_form.xml
+++ b/app/src/main/res/layout/fragment_export_form.xml
@@ -17,8 +17,10 @@
 
 <ScrollView xmlns:android="http://schemas.android.com/apk/res/android"
     xmlns:tools="http://schemas.android.com/tools"
+    android:animateLayoutChanges="true"
     android:layout_width="match_parent"
-    android:layout_height="match_parent">
+    android:layout_height="match_parent"
+    tools:context=".ui.common.FormActivity">
     <LinearLayout
         android:layout_width="match_parent"
         android:layout_height="wrap_content"
@@ -88,18 +90,51 @@
             tools:text="Some format-based export warning"
             android:textColor="@color/title_green"
             android:layout_marginBottom="@dimen/dialog_padding"
-            android:layout_marginLeft="@dimen/dialog_padding"
+            android:layout_marginLeft="100dp"
             style="@style/TextAppearance.Hint" />
 
-        <CheckBox android:id="@+id/checkbox_export_all"
-            android:layout_width="wrap_content"
+    <LinearLayout android:id="@+id/export_date_layout"
+        android:layout_width="match_parent"
+        android:layout_height="?android:attr/listPreferredItemHeight"
+        android:orientation="horizontal">
+        <TextView
+            android:id="@+id/label_export_date"
+            android:text="Since"
+            android:gravity="center_vertical"
+            android:layout_marginLeft="8dp"
+            android:layout_marginRight="8dp"
             android:layout_height="wrap_content"
-            android:textAppearance="?android:attr/textAppearanceMedium"
-            android:text="@string/option_export_all_transactions"
-            />
-        <TextView android:layout_marginLeft="8dp"
-            android:text="@string/hint_export_choice"
-            style="@style/TextAppearance.Hint" />
+            android:layout_width="wrap_content"
+            style="@style/TextAppearance.EditTransaction_Small" />
+        <TextView android:id="@+id/export_start_date"
+            android:layout_width="0dp"
+            android:layout_weight="2"
+            android:layout_height="match_parent"
+            android:gravity="center"
+            android:textSize="15sp"
+            tools:text="25.12.2015"
+            android:textColor="@android:color/black"
+            android:clickable="true"/>
+
+        <TextView android:id="@+id/export_start_time"
+            android:layout_width="0dp"
+            android:layout_weight="1.2"
+            android:layout_height="match_parent"
+            android:gravity="center"
+            android:textSize="15sp"
+            tools:text="15:30H"
+            android:textColor="@android:color/black"
+            android:clickable="true"/>
+        <android.support.v7.widget.SwitchCompat
+            android:id="@+id/switch_export_all"
+            android:text="All time"
+            android:paddingLeft="5dp"
+            android:paddingRight="5dp"
+            android:layout_marginLeft="5dp"
+            android:checked="false"
+            android:layout_width="wrap_content"
+            android:layout_height="wrap_content" />
+    </LinearLayout>
 
         <CheckBox android:id="@+id/checkbox_post_export_delete"
             android:layout_width="wrap_content"
@@ -109,15 +144,12 @@
             android:text="@string/option_delete_after_export"
             />
 
-        <TextView android:layout_marginLeft="8dp"
-            android:text="@string/hint_delete_after_export"
-            style="@style/TextAppearance.Hint" />
-
         <LinearLayout android:id="@+id/recurrence_options"
             style="@style/FormRow">
             <TextView
                 android:id="@+id/label_recurring_transaction"
                 android:text="@string/label_recurring_transaction"
+                android:layout_marginLeft="8dp"
                 android:layout_height="wrap_content"
                 android:layout_width="wrap_content"
                 style="@style/TextAppearance.EditTransaction_Small" />
diff --git a/app/src/main/res/values/strings.xml b/app/src/main/res/values/strings.xml
index 948ec1b4..b0dd8388 100644
--- a/app/src/main/res/values/strings.xml
+++ b/app/src/main/res/values/strings.xml
@@ -57,7 +57,7 @@
     <string name="hint_export_choice">By default, only new transactions since last export will be exported. Check this option to export all transactions</string>
     <string name="toast_export_error">Error exporting %1$s file</string>
     <string name="btn_export">Export</string>
-    <string name="option_delete_after_export">Delete after export</string>
+    <string name="option_delete_after_export">Delete transactions after export</string>
     <string name="hint_delete_after_export">All exported transactions will be deleted when exporting is completed</string>
     <string name="title_settings">Settings</string>
     <string-array name="export_destinations">

From 6e0e8538be964f5555ea0cfa7cd039c2d6241481 Mon Sep 17 00:00:00 2001
From: Ngewi Fet <ngewif@gmail.com>
Date: Mon, 9 Nov 2015 14:04:02 +0100
Subject: [PATCH 13/25] Add test for setting default commodity during XML
 import

Code refactoring
---
 .../gnucash/android/app/GnuCashApplication.java    | 20 +++++++++++----
 .../gnucash/android/importer/GncXmlHandler.java    | 13 ++++------
 .../java/org/gnucash/android/model/Commodity.java  |  3 +++
 .../android/ui/account/AccountsActivity.java       | 10 +++-----
 .../ui/settings/AccountPreferencesFragment.java    |  8 +++---
 .../ui/settings/BackupPreferenceFragment.java      |  5 ++--
 .../android/ui/settings/SettingsActivity.java      |  8 ++----
 .../ui/transaction/TransactionFormFragment.java    |  3 ++-
 .../test/unit/db/AccountsDbAdapterTest.java        | 29 +++++++++++++++++++++-
 9 files changed, 63 insertions(+), 36 deletions(-)

diff --git a/app/src/main/java/org/gnucash/android/app/GnuCashApplication.java b/app/src/main/java/org/gnucash/android/app/GnuCashApplication.java
index bc0ae201..0b86856a 100644
--- a/app/src/main/java/org/gnucash/android/app/GnuCashApplication.java
+++ b/app/src/main/java/org/gnucash/android/app/GnuCashApplication.java
@@ -41,6 +41,7 @@
 import org.gnucash.android.db.SplitsDbAdapter;
 import org.gnucash.android.db.TransactionsDbAdapter;
 import org.gnucash.android.model.Commodity;
+import org.gnucash.android.model.Money;
 import org.gnucash.android.service.SchedulerService;
 
 import java.util.Currency;
@@ -124,7 +125,7 @@ public void onCreate(){
         mCommoditiesDbAdapter       = new CommoditiesDbAdapter(mDb);
         mPricesDbAdapter            = new PricesDbAdapter(mDb);
 
-        Commodity.DEFAULT_COMMODITY = mCommoditiesDbAdapter.getCommodity(getDefaultCurrencyCode());
+        setDefaultCurrencyCode(getDefaultCurrencyCode());
     }
 
     public static AccountsDbAdapter getAccountsDbAdapter() {
@@ -216,12 +217,21 @@ public static String getDefaultCurrencyCode(){
     }
 
     /**
-     * Returns the default commodity
-     * @return Default commodity of application
+     * Sets the default currency for the application in all relevant places:
+     * <ul>
+     *     <li>Shared preferences</li>
+     *     <li>{@link Money#DEFAULT_CURRENCY_CODE}</li>
+     *     <li>{@link Commodity#DEFAULT_COMMODITY}</li>
+     * </ul>
+     * @param currencyCode ISO 4217 currency code
      * @see #getDefaultCurrencyCode()
      */
-    public static Commodity getDefaultCommodity(){
-        return Commodity.DEFAULT_COMMODITY;
+    public static void setDefaultCurrencyCode(String currencyCode){
+        PreferenceManager.getDefaultSharedPreferences(getAppContext()).edit()
+                .putString(getAppContext().getString(R.string.key_default_currency), currencyCode)
+                .apply();
+        Money.DEFAULT_CURRENCY_CODE = currencyCode;
+        Commodity.DEFAULT_COMMODITY = mCommoditiesDbAdapter.getCommodity(currencyCode);
     }
 
     /**
diff --git a/app/src/main/java/org/gnucash/android/importer/GncXmlHandler.java b/app/src/main/java/org/gnucash/android/importer/GncXmlHandler.java
index 514300b8..b4ac1235 100644
--- a/app/src/main/java/org/gnucash/android/importer/GncXmlHandler.java
+++ b/app/src/main/java/org/gnucash/android/importer/GncXmlHandler.java
@@ -18,13 +18,11 @@
 package org.gnucash.android.importer;
 
 import android.database.sqlite.SQLiteDatabase;
-import android.preference.PreferenceManager;
 import android.support.annotation.Nullable;
 import android.util.Log;
 
 import com.crashlytics.android.Crashlytics;
 
-import org.gnucash.android.R;
 import org.gnucash.android.app.GnuCashApplication;
 import org.gnucash.android.db.AccountsDbAdapter;
 import org.gnucash.android.db.CommoditiesDbAdapter;
@@ -378,15 +376,15 @@ public void endElement(String uri, String localName, String qualifiedName) throw
                 String currencyCode = mISO4217Currency ? characterString : NO_CURRENCY_CODE;
                 if (mAccount != null) {
                     mAccount.setCurrencyCode(currencyCode);
-                }
-                if (mTransaction != null) {
-                    mTransaction.setCurrencyCode(currencyCode);
                     if (mCurrencyCount.containsKey(currencyCode)) {
                         mCurrencyCount.put(currencyCode, mCurrencyCount.get(currencyCode) + 1);
                     } else {
                         mCurrencyCount.put(currencyCode, 1);
                     }
                 }
+                if (mTransaction != null) {
+                    mTransaction.setCurrencyCode(currencyCode);
+                }
                 if (mPrice != null) {
                     if (mPriceCommodity) {
                         mPrice.setCommodityUID(mCommoditiesDbAdapter.getCommodityUID(currencyCode));
@@ -865,8 +863,7 @@ public void endDocument() throws SAXException {
             }
         }
         if (mostCurrencyAppearance > 0) {
-            PreferenceManager.getDefaultSharedPreferences(GnuCashApplication.getAppContext()).edit().putString(GnuCashApplication.getAppContext().getString(R.string.key_default_currency), mostAppearedCurrency).apply();
-            Money.DEFAULT_CURRENCY_CODE = mostAppearedCurrency;
+            GnuCashApplication.setDefaultCurrencyCode(mostAppearedCurrency);
         }
     }
 
@@ -881,7 +878,7 @@ private Commodity getCommodityForAccount(String accountUID){
             return mAccountMap.get(accountUID).getCommodity();
         } catch (Exception e) {
             Crashlytics.logException(e);
-            return Commodity.getInstance(Money.DEFAULT_CURRENCY_CODE);
+            return Commodity.DEFAULT_COMMODITY;
         }
     }
 
diff --git a/app/src/main/java/org/gnucash/android/model/Commodity.java b/app/src/main/java/org/gnucash/android/model/Commodity.java
index 8169f417..da0c39e2 100644
--- a/app/src/main/java/org/gnucash/android/model/Commodity.java
+++ b/app/src/main/java/org/gnucash/android/model/Commodity.java
@@ -15,6 +15,7 @@
  */
 package org.gnucash.android.model;
 
+import org.gnucash.android.app.GnuCashApplication;
 import org.gnucash.android.db.CommoditiesDbAdapter;
 
 /**
@@ -29,6 +30,8 @@
 
     /**
      * Default commodity for device locale
+     * <p>This value is set when a new application instance is created in {@link GnuCashApplication#onCreate()}.
+     * The value initialized here is just a placeholder for unit tests</p>
      */
     public static Commodity DEFAULT_COMMODITY = new Commodity("US Dollars", "USD", 100); //this value is a stub. Will be overwritten when the app is launched
 
diff --git a/app/src/main/java/org/gnucash/android/ui/account/AccountsActivity.java b/app/src/main/java/org/gnucash/android/ui/account/AccountsActivity.java
index 6a1915a6..b80d835c 100644
--- a/app/src/main/java/org/gnucash/android/ui/account/AccountsActivity.java
+++ b/app/src/main/java/org/gnucash/android/ui/account/AccountsActivity.java
@@ -42,7 +42,7 @@
 import android.support.v4.app.Fragment;
 import android.support.v4.app.FragmentActivity;
 import android.support.v4.app.FragmentManager;
-import android.support.v4.app.FragmentStatePagerAdapter;
+import android.support.v4.app.FragmentPagerAdapter;
 import android.support.v4.view.PagerAdapter;
 import android.support.v4.view.ViewPager;
 import android.support.v7.widget.Toolbar;
@@ -65,7 +65,6 @@
 import org.gnucash.android.db.DatabaseSchema;
 import org.gnucash.android.export.xml.GncXmlExporter;
 import org.gnucash.android.importer.ImportAsyncTask;
-import org.gnucash.android.model.Money;
 import org.gnucash.android.ui.common.BaseDrawerActivity;
 import org.gnucash.android.ui.common.FormActivity;
 import org.gnucash.android.ui.common.UxArgument;
@@ -77,7 +76,6 @@
 
 import java.io.FileNotFoundException;
 import java.io.InputStream;
-import java.util.ArrayList;
 
 import butterknife.Bind;
 import butterknife.ButterKnife;
@@ -152,12 +150,12 @@
     /**
      * Configuration for rating the app
      */
-    public static RateThisApp.Config rateAppConfig = new RateThisApp.Config(14, 100);
+    public static RateThisApp.Config rateAppConfig = new RateThisApp.Config(30, 100);
 
     /**
      * Adapter for managing the sub-account and transaction fragment pages in the accounts view
      */
-    private class AccountViewPagerAdapter extends FragmentStatePagerAdapter {
+    private class AccountViewPagerAdapter extends FragmentPagerAdapter {
 
         public AccountViewPagerAdapter(FragmentManager fm){
             super(fm);
@@ -380,8 +378,6 @@ public void setTab(int index){
     private void init() {
         PreferenceManager.setDefaultValues(this, R.xml.fragment_transaction_preferences, false);
 
-        Money.DEFAULT_CURRENCY_CODE = GnuCashApplication.getDefaultCurrencyCode();
-
         SharedPreferences prefs = PreferenceManager.getDefaultSharedPreferences(this);
         boolean firstRun = prefs.getBoolean(getString(R.string.key_first_run), true);
 
diff --git a/app/src/main/java/org/gnucash/android/ui/settings/AccountPreferencesFragment.java b/app/src/main/java/org/gnucash/android/ui/settings/AccountPreferencesFragment.java
index 81804ccc..91ffd196 100644
--- a/app/src/main/java/org/gnucash/android/ui/settings/AccountPreferencesFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/settings/AccountPreferencesFragment.java
@@ -20,15 +20,13 @@
 import android.app.Activity;
 import android.app.AlertDialog;
 import android.content.DialogInterface;
-import android.content.SharedPreferences;
 import android.os.Bundle;
 import android.preference.Preference;
 import android.preference.PreferenceFragment;
-import android.preference.PreferenceManager;
 import android.support.v7.app.ActionBar;
-import android.support.v7.app.AppCompatActivity;
 
 import org.gnucash.android.R;
+import org.gnucash.android.app.GnuCashApplication;
 import org.gnucash.android.model.Money;
 import org.gnucash.android.ui.account.AccountsActivity;
 
@@ -59,8 +57,8 @@ public void onCreate(Bundle savedInstanceState) {
     @Override
     public void onResume() {
         super.onResume();
-        SharedPreferences sharedPreferences = PreferenceManager.getDefaultSharedPreferences(getActivity());
-        String defaultCurrency = sharedPreferences.getString(getString(R.string.key_default_currency), Money.DEFAULT_CURRENCY_CODE);
+
+        String defaultCurrency = GnuCashApplication.getDefaultCurrencyCode();
         Preference pref = findPreference(getString(R.string.key_default_currency));
         pref.setSummary(defaultCurrency);
         pref.setOnPreferenceChangeListener((SettingsActivity)getActivity());
diff --git a/app/src/main/java/org/gnucash/android/ui/settings/BackupPreferenceFragment.java b/app/src/main/java/org/gnucash/android/ui/settings/BackupPreferenceFragment.java
index 0f222e71..32ff184f 100644
--- a/app/src/main/java/org/gnucash/android/ui/settings/BackupPreferenceFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/settings/BackupPreferenceFragment.java
@@ -24,10 +24,9 @@
 import android.preference.PreferenceFragment;
 import android.preference.PreferenceManager;
 import android.support.v7.app.ActionBar;
-import android.support.v7.app.AppCompatActivity;
 
 import org.gnucash.android.R;
-import org.gnucash.android.model.Money;
+import org.gnucash.android.app.GnuCashApplication;
 
 
 /**
@@ -96,7 +95,7 @@ public void onResume() {
 	public boolean onPreferenceChange(Preference preference, Object newValue) {
 		preference.setSummary(newValue.toString());
 		if (preference.getKey().equals(getString(R.string.key_default_currency))){
-			Money.DEFAULT_CURRENCY_CODE = newValue.toString();
+			GnuCashApplication.setDefaultCurrencyCode(newValue.toString());
 		}
 		
 		if (preference.getKey().equals(getString(R.string.key_default_export_email))){
diff --git a/app/src/main/java/org/gnucash/android/ui/settings/SettingsActivity.java b/app/src/main/java/org/gnucash/android/ui/settings/SettingsActivity.java
index 2e1e6247..84eb810a 100644
--- a/app/src/main/java/org/gnucash/android/ui/settings/SettingsActivity.java
+++ b/app/src/main/java/org/gnucash/android/ui/settings/SettingsActivity.java
@@ -56,7 +56,6 @@
 import org.gnucash.android.export.Exporter;
 import org.gnucash.android.export.xml.GncXmlExporter;
 import org.gnucash.android.importer.ImportAsyncTask;
-import org.gnucash.android.model.Money;
 import org.gnucash.android.model.Transaction;
 import org.gnucash.android.ui.account.AccountsActivity;
 import org.gnucash.android.ui.common.UxArgument;
@@ -66,7 +65,6 @@
 import java.io.File;
 import java.io.FileInputStream;
 import java.io.FileNotFoundException;
-import java.io.InputStream;
 import java.text.DateFormat;
 import java.text.SimpleDateFormat;
 import java.util.ArrayList;
@@ -249,7 +247,7 @@ public boolean onOptionsItemSelected(MenuItem item) {
 	@Override
  	public boolean onPreferenceChange(Preference preference, Object newValue) {
 		if (preference.getKey().equals(getString(R.string.key_default_currency))){
-			Money.DEFAULT_CURRENCY_CODE = newValue.toString();
+			GnuCashApplication.setDefaultCurrencyCode(newValue.toString());
             preference.setSummary(newValue.toString());
 		} else if (preference.getKey().equals(getString(R.string.key_enable_passcode))) {
             if ((Boolean) newValue) {
@@ -289,11 +287,9 @@ public void setImbalanceAccountsHidden(boolean useDoubleEntry) {
     }
 
     private void setDefaultCurrencyListener() {
-		SharedPreferences manager = PreferenceManager.getDefaultSharedPreferences(this);
-		String defaultCurrency = manager.getString(getString(R.string.key_default_currency), Money.DEFAULT_CURRENCY_CODE);
 		@SuppressWarnings("deprecation")
 		Preference pref = findPreference(getString(R.string.key_default_currency));
-		pref.setSummary(defaultCurrency);
+		pref.setSummary(GnuCashApplication.getDefaultCurrencyCode());
 		pref.setOnPreferenceChangeListener(this);
 	}
 
diff --git a/app/src/main/java/org/gnucash/android/ui/transaction/TransactionFormFragment.java b/app/src/main/java/org/gnucash/android/ui/transaction/TransactionFormFragment.java
index dd252045..430b233b 100644
--- a/app/src/main/java/org/gnucash/android/ui/transaction/TransactionFormFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/transaction/TransactionFormFragment.java
@@ -57,6 +57,7 @@
 import com.codetroopers.betterpickers.recurrencepicker.RecurrencePickerDialog;
 
 import org.gnucash.android.R;
+import org.gnucash.android.app.GnuCashApplication;
 import org.gnucash.android.db.AccountsDbAdapter;
 import org.gnucash.android.db.CommoditiesDbAdapter;
 import org.gnucash.android.db.DatabaseSchema;
@@ -533,7 +534,7 @@ private void initalizeViews() {
 		String typePref = PreferenceManager.getDefaultSharedPreferences(getActivity()).getString(getString(R.string.key_default_transaction_type), "DEBIT");
         mTransactionTypeSwitch.setChecked(TransactionType.valueOf(typePref));
 
-		String code = Money.DEFAULT_CURRENCY_CODE;
+		String code = GnuCashApplication.getDefaultCurrencyCode();
 		if (mAccountUID != null){
 			code = mTransactionsDbAdapter.getAccountCurrencyCode(mAccountUID);
 		}
diff --git a/app/src/test/java/org/gnucash/android/test/unit/db/AccountsDbAdapterTest.java b/app/src/test/java/org/gnucash/android/test/unit/db/AccountsDbAdapterTest.java
index 6ea614e3..260f98b5 100644
--- a/app/src/test/java/org/gnucash/android/test/unit/db/AccountsDbAdapterTest.java
+++ b/app/src/test/java/org/gnucash/android/test/unit/db/AccountsDbAdapterTest.java
@@ -5,6 +5,7 @@
 import org.gnucash.android.R;
 import org.gnucash.android.app.GnuCashApplication;
 import org.gnucash.android.db.AccountsDbAdapter;
+import org.gnucash.android.db.CommoditiesDbAdapter;
 import org.gnucash.android.db.ScheduledActionDbAdapter;
 import org.gnucash.android.db.SplitsDbAdapter;
 import org.gnucash.android.db.TransactionsDbAdapter;
@@ -375,10 +376,36 @@ public void shouldCreateImbalanceAccountOnDemand(){
         assertThat(mAccountsDbAdapter.getRecordsCount()).isEqualTo(2);
     }
 
+
+    /**
+     * Opening an XML file should set the default currency to that used by the most accounts in the file
+     */
+    @Test
+    public void importingXml_shouldSetDefaultCurrency(){
+        GnuCashApplication.setDefaultCurrencyCode("JPY");
+
+        assertThat(GnuCashApplication.getDefaultCurrencyCode()).isEqualTo("JPY");
+        assertThat(Commodity.DEFAULT_COMMODITY).isEqualTo(Commodity.JPY);
+
+        mAccountsDbAdapter.deleteAllRecords();
+        loadDefaultAccounts();
+
+        assertThat(GnuCashApplication.getDefaultCurrencyCode()).isNotEqualTo("JPY");
+
+        Currency currency = Currency.getInstance(GnuCashApplication.getDefaultLocale());
+        String expectedCode = currency.getCurrencyCode();
+        Commodity expectedDefaultCommodity = CommoditiesDbAdapter.getInstance().getCommodity(expectedCode);
+
+        assertThat(GnuCashApplication.getDefaultCurrencyCode()).isEqualTo(expectedCode);
+        assertThat(Commodity.DEFAULT_COMMODITY).isEqualTo(expectedDefaultCommodity);
+
+        System.out.println("Default currency is now: " + expectedCode);
+    }
+
     /**
      * Loads the default accounts from file resource
      */
-    private void loadDefaultAccounts(){
+    public static void loadDefaultAccounts(){
         try {
             GncXmlImporter.parse(GnuCashApplication.getAppContext().getResources().openRawResource(R.raw.default_accounts));
         } catch (ParserConfigurationException | SAXException | IOException e) {

From 7de49a1e839acf7c97f5f7a3e02ab1c63ff937a4 Mon Sep 17 00:00:00 2001
From: Ngewi Fet <ngewif@gmail.com>
Date: Fri, 13 Nov 2015 00:33:34 +0100
Subject: [PATCH 14/25] Remember last export destination

Fix crash when importing amounts with very big precision
Fix crash when parsing large split amounts
Fix crash on some devices when searching
Fix crash when saving with invalid amount
Fixes #408
---
 .../java/org/gnucash/android/model/Commodity.java  | 15 +++------
 .../main/java/org/gnucash/android/model/Money.java | 36 ++++++++++------------
 .../main/java/org/gnucash/android/model/Split.java |  8 ++---
 .../android/ui/account/AccountsListFragment.java   |  4 ++-
 .../android/ui/export/ExportFormFragment.java      |  8 +++++
 .../ui/transaction/TransactionFormFragment.java    |  6 ++++
 .../android/ui/util/widget/CalculatorEditText.java |  2 +-
 .../android/ui/util/widget/CalculatorKeyboard.java |  4 +++
 .../res/layout/activity_transaction_detail.xml     |  1 +
 .../main/res/layout/fragment_transaction_form.xml  |  2 ++
 app/src/main/res/values/donottranslate.xml         |  1 +
 11 files changed, 50 insertions(+), 37 deletions(-)

diff --git a/app/src/main/java/org/gnucash/android/model/Commodity.java b/app/src/main/java/org/gnucash/android/model/Commodity.java
index da0c39e2..13019221 100644
--- a/app/src/main/java/org/gnucash/android/model/Commodity.java
+++ b/app/src/main/java/org/gnucash/android/model/Commodity.java
@@ -164,17 +164,10 @@ public int getSmallestFraction() {
      * @see #getSmallestFraction()
      */
     public int getSmallestFractionDigits(){
-        switch (mSmallestFraction) {
-            case 1:     return 0;
-            case 10:    return 1;
-            case 100:   return 2;
-            case 1000:  return 3;
-            case 10000: return 4;
-            case 100000: return 5;
-            case 1000000: return 6;
-            default:
-                return 2;
-                //throw new UnsupportedOperationException("Invalid fraction digits in commodity with fraction: " + mSmallestFraction);
+        if (mSmallestFraction == 0){
+            return 0;
+        } else {
+            return Integer.numberOfTrailingZeros(mSmallestFraction);
         }
     }
 
diff --git a/app/src/main/java/org/gnucash/android/model/Money.java b/app/src/main/java/org/gnucash/android/model/Money.java
index a30b5675..6c5796b1 100644
--- a/app/src/main/java/org/gnucash/android/model/Money.java
+++ b/app/src/main/java/org/gnucash/android/model/Money.java
@@ -90,19 +90,19 @@ public static Money getZeroInstance(){
 		return sDefaultZero;
     }
 
+	/**
+	 * Returns the {@link BigDecimal} from the {@code numerator} and {@code denominator}
+	 * @param numerator Number of the fraction
+	 * @param denominator Denominator of the fraction
+	 * @return BigDecimal representation of the number
+	 */
 	public static BigDecimal getBigDecimal(long numerator, long denominator) {
 		int scale;
 		if (numerator == 0 && denominator == 0) {
 			denominator = 1;
 		}
-		switch ((int)denominator) {
-			case 1: scale = 0; break;
-			case 10: scale = 1; break;
-			case 100: scale = 2; break;
-			case 1000: scale = 3; break;
-			default:
-				throw new InvalidParameterException("invalid denominator " + denominator);
-		}
+
+		scale = Integer.numberOfTrailingZeros((int)denominator);
 		return new BigDecimal(BigInteger.valueOf(numerator), scale);
 	}
 
@@ -112,8 +112,8 @@ public static BigDecimal getBigDecimal(long numerator, long denominator) {
 	 * @param commodity Commodity of the money
 	 */
 	public Money(BigDecimal amount, Commodity commodity){
-		this.mAmount = amount;
 		this.mCommodity = commodity;
+		setAmount(amount); //commodity has to be set first. Because we use it's scale
 	}
 
 	/**
@@ -123,6 +123,7 @@ public Money(BigDecimal amount, Commodity commodity){
 	 * @param currencyCode Currency code as specified by ISO 4217
 	 */
 	public Money(String amount, String currencyCode){
+		//commodity has to be set first
 		mCommodity = Commodity.getInstance(currencyCode);
 		setAmount(amount);
 	}
@@ -226,22 +227,17 @@ public long getNumerator() {
 	 * @return GnuCash format denominator
 	 */
 	public long getDenominator() {
-		switch (getScale()) {
-			case 0: return 1;
-			case 1: return 10;
-			case 2: return 100;
-			case 3: return 1000;
-			case 4: return 10000;
-			case 5: return 100000;
-			case 6: return 1000000; //I think GnuCash XML can have gold and silver with this denom
-
+		int scale = getScale();
+		if (scale == 0){
+			return 0;
+		} else {
+			return Integer.numberOfTrailingZeros(scale);
 		}
-		throw new RuntimeException("Unsupported number of fraction digits " + getScale());
 	}
 
 	/**
 	 * Returns the scale (precision) used for the decimal places of this amount.
-	 * <p>The scale used depends on the currency</p>
+	 * <p>The scale used depends on the commodity</p>
 	 * @return Scale of amount as integer
 	 */
 	private int getScale() {
diff --git a/app/src/main/java/org/gnucash/android/model/Split.java b/app/src/main/java/org/gnucash/android/model/Split.java
index 39b61906..5e19936c 100644
--- a/app/src/main/java/org/gnucash/android/model/Split.java
+++ b/app/src/main/java/org/gnucash/android/model/Split.java
@@ -336,11 +336,11 @@ public static Split parseSplit(String splitCsvString) {
             }
             return split;
         } else {
-            int valueNum = Integer.parseInt(tokens[1]);
-            int valueDenom = Integer.parseInt(tokens[2]);
+            long valueNum = Long.parseLong(tokens[1]);
+            long valueDenom = Long.parseLong(tokens[2]);
             String valueCurrencyCode = tokens[3];
-            int quantityNum = Integer.parseInt(tokens[4]);
-            int quantityDenom = Integer.parseInt(tokens[5]);
+            long quantityNum = Long.parseLong(tokens[4]);
+            long quantityDenom = Long.parseLong(tokens[5]);
             String qtyCurrencyCode = tokens[6];
 
             Money value = new Money(valueNum, valueDenom, valueCurrencyCode);
diff --git a/app/src/main/java/org/gnucash/android/ui/account/AccountsListFragment.java b/app/src/main/java/org/gnucash/android/ui/account/AccountsListFragment.java
index 74deec21..a1623f23 100644
--- a/app/src/main/java/org/gnucash/android/ui/account/AccountsListFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/account/AccountsListFragment.java
@@ -49,6 +49,7 @@
 import android.widget.TextView;
 
 import org.gnucash.android.R;
+import org.gnucash.android.app.GnuCashApplication;
 import org.gnucash.android.db.AccountsDbAdapter;
 import org.gnucash.android.db.DatabaseCursorLoader;
 import org.gnucash.android.db.DatabaseSchema;
@@ -256,8 +257,9 @@ public void onCreateOptionsMenu(Menu menu, MenuInflater inflater) {
         else {
             inflater.inflate(R.menu.account_actions, menu);
             // Associate searchable configuration with the SearchView
+
             SearchManager searchManager =
-                    (SearchManager) getActivity().getSystemService(Context.SEARCH_SERVICE);
+                    (SearchManager) GnuCashApplication.getAppContext().getSystemService(Context.SEARCH_SERVICE);
             mSearchView = (android.support.v7.widget.SearchView)
                 MenuItemCompat.getActionView(menu.findItem(R.id.menu_search));
             if (mSearchView == null)
diff --git a/app/src/main/java/org/gnucash/android/ui/export/ExportFormFragment.java b/app/src/main/java/org/gnucash/android/ui/export/ExportFormFragment.java
index 45d707c1..410b48a7 100644
--- a/app/src/main/java/org/gnucash/android/ui/export/ExportFormFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/export/ExportFormFragment.java
@@ -286,6 +286,11 @@ private void startExport(){
 		Log.i(TAG, "Commencing async export of transactions");
 		new ExportAsyncTask(getActivity()).execute(exportParameters);
 
+		int position = mDestinationSpinner.getSelectedItemPosition();
+		PreferenceManager.getDefaultSharedPreferences(getActivity())
+				.edit().putInt(getString(R.string.key_last_export_destination), position)
+				.apply();
+
 		// finish the activity will cause the progress dialog to be leaked
 		// which would throw an exception
 		//getActivity().finish();
@@ -340,6 +345,9 @@ public void onNothingSelected(AdapterView<?> parent) {
 			}
 		});
 
+		int position = PreferenceManager.getDefaultSharedPreferences(getActivity())
+				.getInt(getString(R.string.key_last_export_destination), 0);
+		mDestinationSpinner.setSelection(position);
 
 		//**************** export start time bindings ******************
 		String lastExportTimeStamp = PreferenceManager.getDefaultSharedPreferences(getActivity())
diff --git a/app/src/main/java/org/gnucash/android/ui/transaction/TransactionFormFragment.java b/app/src/main/java/org/gnucash/android/ui/transaction/TransactionFormFragment.java
index 430b233b..ed4c48f1 100644
--- a/app/src/main/java/org/gnucash/android/ui/transaction/TransactionFormFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/transaction/TransactionFormFragment.java
@@ -726,6 +726,12 @@ private void saveNewTransaction() {
 		String notes = mNotesEditText.getText().toString();
 		BigDecimal amountBigd = mAmountEditText.getValue();
 
+        if (amountBigd == null){ //if for whatever reason we cannot process the amount
+            Toast.makeText(getActivity(), R.string.toast_transanction_amount_required,
+                    Toast.LENGTH_SHORT).show();
+            return;
+        }
+
 		Currency currency = Currency.getInstance(mTransactionsDbAdapter.getAccountCurrencyCode(mAccountUID));
 		Money amount 	= new Money(amountBigd, Commodity.getInstance(currency.getCurrencyCode())).absolute();
 
diff --git a/app/src/main/java/org/gnucash/android/ui/util/widget/CalculatorEditText.java b/app/src/main/java/org/gnucash/android/ui/util/widget/CalculatorEditText.java
index 193d2f66..2b6bb455 100644
--- a/app/src/main/java/org/gnucash/android/ui/util/widget/CalculatorEditText.java
+++ b/app/src/main/java/org/gnucash/android/ui/util/widget/CalculatorEditText.java
@@ -322,7 +322,7 @@ public BigDecimal getValue(){
             return null;
         try { //catch any exceptions in the conversion e.g. if a string with only "-" is entered
             return new BigDecimal(amountString);
-        } catch (Exception e){
+        } catch (NumberFormatException e){
             String msg = "Error parsing amount string " + amountString + " from CalculatorEditText";
             Log.i(getClass().getSimpleName(), msg, e);
             Crashlytics.log(msg);
diff --git a/app/src/main/java/org/gnucash/android/ui/util/widget/CalculatorKeyboard.java b/app/src/main/java/org/gnucash/android/ui/util/widget/CalculatorKeyboard.java
index 64bd1501..56368565 100644
--- a/app/src/main/java/org/gnucash/android/ui/util/widget/CalculatorKeyboard.java
+++ b/app/src/main/java/org/gnucash/android/ui/util/widget/CalculatorKeyboard.java
@@ -77,6 +77,10 @@ public void onKey(int primaryCode, int[] keyCodes) {
                 return;
             */
 
+            if (!(focusCurrent instanceof CalculatorEditText)){
+                return;
+            }
+
             CalculatorEditText calculatorEditText = (CalculatorEditText) focusCurrent;
             Editable editable = calculatorEditText.getText();
             int start = calculatorEditText.getSelectionStart();
diff --git a/app/src/main/res/layout/activity_transaction_detail.xml b/app/src/main/res/layout/activity_transaction_detail.xml
index 70af78a2..695f3bb5 100644
--- a/app/src/main/res/layout/activity_transaction_detail.xml
+++ b/app/src/main/res/layout/activity_transaction_detail.xml
@@ -64,6 +64,7 @@
                     android:gravity="bottom"
                     android:layout_gravity="bottom"
                     android:maxLines="1"
+                    android:singleLine="true"
                     android:ellipsize="start"
                     android:textStyle="italic"
                     android:textColor="@android:color/white"
diff --git a/app/src/main/res/layout/fragment_transaction_form.xml b/app/src/main/res/layout/fragment_transaction_form.xml
index dcb5b7eb..ec8f9004 100644
--- a/app/src/main/res/layout/fragment_transaction_form.xml
+++ b/app/src/main/res/layout/fragment_transaction_form.xml
@@ -41,6 +41,7 @@
                     android:hint="@string/label_transaction_name"
                     android:inputType="textCapSentences"
                     android:imeOptions="actionNext"
+                    android:singleLine="true"
                     android:nextFocusDown="@+id/input_transaction_amount"
                     android:background="@android:color/transparent"
                     android:textSize="22sp" />
@@ -63,6 +64,7 @@
                     android:layout_height="wrap_content"
                     android:hint="@string/label_transaction_amount"
                     android:inputType="none"
+                    android:singleLine="true"
                     android:nextFocusDown="@+id/input_description"
                     android:background="@android:color/transparent"
                     android:textColor="@color/debit_red"
diff --git a/app/src/main/res/values/donottranslate.xml b/app/src/main/res/values/donottranslate.xml
index 41b86548..21340b27 100644
--- a/app/src/main/res/values/donottranslate.xml
+++ b/app/src/main/res/values/donottranslate.xml
@@ -29,6 +29,7 @@
     <string name="key_report_currency" translatable="false">report_currency</string>
     <string name="key_enable_crashlytics" translatable="false">enable_crashlytics</string>
     <string name="key_use_account_color" translatable="false">use_account_color</string>
+    <string name="key_last_export_destination">last_export_destination</string>
 
     <string-array name="key_transaction_type_values" translatable="false">
         <item>CREDIT</item>

From 409114eef8e66de725236f1ab6abc8edfa6fa315 Mon Sep 17 00:00:00 2001
From: Ngewi Fet <ngewif@gmail.com>
Date: Fri, 13 Nov 2015 11:57:58 +0100
Subject: [PATCH 15/25] Add support for unlimited number of decimal places in
 commodities

Add tests for Money/Commodity
Fix breaking build
---
 .../java/org/gnucash/android/model/Commodity.java  |  7 +---
 .../main/java/org/gnucash/android/model/Money.java | 42 +++-------------------
 .../android/test/unit/model/CommodityTest.java     |  4 +--
 .../gnucash/android/test/unit/model/MoneyTest.java | 29 +++++++++++----
 4 files changed, 29 insertions(+), 53 deletions(-)

diff --git a/app/src/main/java/org/gnucash/android/model/Commodity.java b/app/src/main/java/org/gnucash/android/model/Commodity.java
index 13019221..f60b787e 100644
--- a/app/src/main/java/org/gnucash/android/model/Commodity.java
+++ b/app/src/main/java/org/gnucash/android/model/Commodity.java
@@ -179,12 +179,7 @@ public int getSmallestFractionDigits(){
      * @throws IllegalArgumentException if the smallest fraction is not a power of 10
      */
     public void setSmallestFraction(int smallestFraction) {
-        if (smallestFraction != 1 && smallestFraction != 10 && smallestFraction != 100
-                && smallestFraction != 1000 && smallestFraction != 10000
-                && smallestFraction != 1000000 ) //make sure we are not getting digits
-            this.mSmallestFraction = 100;
-        else
-            this.mSmallestFraction = smallestFraction;
+        this.mSmallestFraction = smallestFraction;
     }
 
     public int getQuoteFlag() {
diff --git a/app/src/main/java/org/gnucash/android/model/Money.java b/app/src/main/java/org/gnucash/android/model/Money.java
index 6c5796b1..a69f8435 100644
--- a/app/src/main/java/org/gnucash/android/model/Money.java
+++ b/app/src/main/java/org/gnucash/android/model/Money.java
@@ -125,7 +125,7 @@ public Money(BigDecimal amount, Commodity commodity){
 	public Money(String amount, String currencyCode){
 		//commodity has to be set first
 		mCommodity = Commodity.getInstance(currencyCode);
-		setAmount(amount);
+		setAmount(new BigDecimal(amount));
 	}
 
 	/**
@@ -228,11 +228,7 @@ public long getNumerator() {
 	 */
 	public long getDenominator() {
 		int scale = getScale();
-		if (scale == 0){
-			return 0;
-		} else {
-			return Integer.numberOfTrailingZeros(scale);
-		}
+		return BigDecimal.ONE.scaleByPowerOfTen(scale).longValueExact();
 	}
 
 	/**
@@ -291,7 +287,7 @@ public String formattedString(Locale locale){
 		String symbol;
 		if (mCommodity.equals(Commodity.USD) && !locale.equals(Locale.US)) {
 			symbol = "US$";
-		} else if (mCommodity.equals(Commodity.EUR) {
+		} else if (mCommodity.equals(Commodity.EUR)) {
 			symbol = currency.getSymbol(Locale.GERMANY); //euro currency is pretty unique around the world
 		} else {
 			symbol = currency.getSymbol(Locale.US); // US locale has the best symbol formatting table.
@@ -336,16 +332,7 @@ public Money negate(){
 	private void setAmount(@NonNull BigDecimal amount) {
 		mAmount = amount.setScale(mCommodity.getSmallestFractionDigits(), ROUNDING_MODE);
 	}
-	
-	/**
-	 * Sets the amount value of this <code>Money</code> object
-	 * The <code>amount</code> is parsed by the {@link BigDecimal} constructor
-	 * @param amount {@link String} amount to be set
-	 */
-	private void setAmount(String amount){
-		setAmount(parseToDecimal(amount));
-	}	
-	
+
 	/**
 	 * Returns a new <code>Money</code> object whose value is the sum of the values of 
 	 * this object and <code>addend</code>.
@@ -507,27 +494,6 @@ public int compareTo(@NonNull Money another) {
 		return mAmount.compareTo(another.mAmount);
 	}
 
-	/**
-	 * Parses a Locale specific string into a number using format for {@link Locale#US}
-	 * @param amountString Formatted String amount
-	 * @return String amount formatted in the default locale
-	 */
-    public static BigDecimal parseToDecimal(String amountString){
-		char separator = new DecimalFormatSymbols(Locale.US).getGroupingSeparator();
-		amountString = amountString.replace(Character.toString(separator), "");
-		NumberFormat formatter = NumberFormat.getInstance(Locale.US);		
-		if (formatter instanceof DecimalFormat) {
-		     ((DecimalFormat)formatter).setParseBigDecimal(true);		     
-		}
-		BigDecimal result = new BigDecimal(0);
-		try {
-			result = (BigDecimal) formatter.parse(amountString);
-		} catch (ParseException e) {
-			Crashlytics.logException(e);
-		}
-        return result;
-	}
-
     /**
      * Returns a new instance of {@link Money} object with the absolute value of the current object
      * @return Money object with absolute value of this instance
diff --git a/app/src/test/java/org/gnucash/android/test/unit/model/CommodityTest.java b/app/src/test/java/org/gnucash/android/test/unit/model/CommodityTest.java
index 14d82b9b..28195340 100644
--- a/app/src/test/java/org/gnucash/android/test/unit/model/CommodityTest.java
+++ b/app/src/test/java/org/gnucash/android/test/unit/model/CommodityTest.java
@@ -27,7 +27,7 @@
 
     @Test
     public void setSmallestFraction_shouldNotUseDigits(){
-        Commodity commodity = new Commodity("Test", "USD", 4);
+        Commodity commodity = new Commodity("Test", "USD", 100);
         assertThat(commodity.getSmallestFraction()).isEqualTo(100);
 
         commodity.setSmallestFraction(1000);
@@ -36,7 +36,7 @@ public void setSmallestFraction_shouldNotUseDigits(){
 
     @Test
     public void testSmallestFractionDigits(){
-        Commodity commodity = new Commodity("Test", "USD", 4);
+        Commodity commodity = new Commodity("Test", "USD", 100);
         assertThat(commodity.getSmallestFractionDigits()).isEqualTo(2);
 
         commodity.setSmallestFraction(10);
diff --git a/app/src/test/java/org/gnucash/android/test/unit/model/MoneyTest.java b/app/src/test/java/org/gnucash/android/test/unit/model/MoneyTest.java
index 1340dc20..4f7bb97f 100644
--- a/app/src/test/java/org/gnucash/android/test/unit/model/MoneyTest.java
+++ b/app/src/test/java/org/gnucash/android/test/unit/model/MoneyTest.java
@@ -57,18 +57,15 @@ public void testCreation(){
 		
 		Money temp = new Money(amount, CURRENCY_CODE);
 		assertThat("12.25").isEqualTo(temp.toPlainString());
+		assertThat(temp.getNumerator()).isEqualTo(1225L);
+		assertThat(temp.getDenominator()).isEqualTo(100L);
 
 		Commodity commodity = Commodity.getInstance(CURRENCY_CODE);
 		temp = new Money(BigDecimal.TEN, commodity);
 		
-		assertEquals("10", temp.asBigDecimal().toPlainString());
+		assertEquals("10.00", temp.asBigDecimal().toPlainString()); //decimal places for EUR currency
 		assertEquals(commodity, temp.getCommodity());
-
-		//test only Locale.US parsing even under different locale
-		Locale.setDefault(Locale.GERMANY);
-		amount = "12,25";
-		temp = new Money(amount, CURRENCY_CODE);
-		assertEquals("1225.00", temp.toPlainString());
+		assertThat("10").isNotEqualTo(temp.asBigDecimal().toPlainString());
 	}
 
 	@Test
@@ -135,6 +132,24 @@ public void testNegation(){
 	}
 
 	@Test
+	public void testFractionParts(){
+		Money money = new Money("14.15", "USD");
+		assertThat(money.getNumerator()).isEqualTo(1415L);
+		assertThat(money.getDenominator()).isEqualTo(100L);
+
+		money = new Money("125", "JPY");
+		assertThat(money.getNumerator()).isEqualTo(125L);
+		assertThat(money.getDenominator()).isEqualTo(1L);
+	}
+
+	@Test
+	public void nonMatchingCommodityFraction_shouldThrowException(){
+		Money money = new Money("12.345", "JPY");
+		assertThat(money.getNumerator()).isEqualTo(12L);
+		assertThat(money.getDenominator()).isEqualTo(1);
+	}
+
+	@Test
 	public void testPrinting(){
 		assertEquals(mMoneyInEur.asString(), mMoneyInEur.toPlainString());
 		assertEquals(amountString, mMoneyInEur.asString());

From 05ea0582cd8aded5c5a912ccb52c83540ff51136 Mon Sep 17 00:00:00 2001
From: Oleksandr Tyshkovets <olexandr.tyshkovets@gmail.com>
Date: Fri, 13 Nov 2015 21:37:19 +0200
Subject: [PATCH 16/25] Disable reports summary labels

---
 .../main/java/org/gnucash/android/ui/report/ReportSummaryFragment.java   | 1 +
 1 file changed, 1 insertion(+)

diff --git a/app/src/main/java/org/gnucash/android/ui/report/ReportSummaryFragment.java b/app/src/main/java/org/gnucash/android/ui/report/ReportSummaryFragment.java
index a4341705..88d2257a 100644
--- a/app/src/main/java/org/gnucash/android/ui/report/ReportSummaryFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/report/ReportSummaryFragment.java
@@ -140,6 +140,7 @@ public void onActivityCreated(@Nullable Bundle savedInstanceState) {
 
         mChart.setCenterTextSize(PieChartFragment.CENTER_TEXT_SIZE);
         mChart.setDescription("");
+        mChart.setDrawSliceText(false);
         mChart.getLegend().setEnabled(true);
         mChart.getLegend().setWordWrapEnabled(true);
         mChart.getLegend().setForm(LegendForm.CIRCLE);

From fd1fe4b6705fae4a6e77702fdb6f255848c4860c Mon Sep 17 00:00:00 2001
From: Oleksandr Tyshkovets <olexandr.tyshkovets@gmail.com>
Date: Sat, 14 Nov 2015 20:30:10 +0200
Subject: [PATCH 17/25] Uncheck legend when legend disabled

---
 app/src/main/java/org/gnucash/android/ui/report/BarChartFragment.java | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/app/src/main/java/org/gnucash/android/ui/report/BarChartFragment.java b/app/src/main/java/org/gnucash/android/ui/report/BarChartFragment.java
index f79fa3ae..e0fbe83e 100644
--- a/app/src/main/java/org/gnucash/android/ui/report/BarChartFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/report/BarChartFragment.java
@@ -439,7 +439,9 @@ public boolean onOptionsItemSelected(MenuItem item) {
                 Legend legend = mChart.getLegend();
                 if (!legend.isLegendCustom()) {
                     Toast.makeText(getActivity(), R.string.toast_legend_too_long, Toast.LENGTH_LONG).show();
+                    item.setChecked(false);
                 } else {
+                    item.setChecked(!mChart.getLegend().isEnabled());
                     legend.setEnabled(!mChart.getLegend().isEnabled());
                     mChart.invalidate();
                 }

From 5544ffc0c164951004ff1bc3da4ca59588badc28 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?=C3=80lex=20Magaz=20Gra=C3=A7a?= <rivaldi8@gmail.com>
Date: Mon, 16 Nov 2015 10:24:32 +0100
Subject: [PATCH 18/25] Fix: sharing exported files via external service not
 working

Exporter now generates a list of exported files on internal storage which can then be directed to any destination
Splitting of QIF files (per currency) now occurs during the export process itself

Fixes #423
Closes #425
---
 .../gnucash/android/export/ExportAsyncTask.java    | 201 +++++++++------------
 .../org/gnucash/android/export/ExportParams.java   |   5 +-
 .../java/org/gnucash/android/export/Exporter.java  |  69 ++-----
 .../gnucash/android/export/ofx/OfxExporter.java    |  47 +++--
 .../gnucash/android/export/qif/QifExporter.java    |  50 ++---
 .../gnucash/android/export/xml/GncXmlExporter.java |  71 ++++++--
 6 files changed, 216 insertions(+), 227 deletions(-)

diff --git a/app/src/main/java/org/gnucash/android/export/ExportAsyncTask.java b/app/src/main/java/org/gnucash/android/export/ExportAsyncTask.java
index 6709a9af..97c219bf 100644
--- a/app/src/main/java/org/gnucash/android/export/ExportAsyncTask.java
+++ b/app/src/main/java/org/gnucash/android/export/ExportAsyncTask.java
@@ -28,6 +28,7 @@
 import android.os.AsyncTask;
 import android.os.Build;
 import android.preference.PreferenceManager;
+import android.support.annotation.NonNull;
 import android.util.Log;
 import android.widget.Toast;
 
@@ -59,13 +60,11 @@
 import org.gnucash.android.ui.settings.SettingsActivity;
 import org.gnucash.android.ui.transaction.TransactionsActivity;
 
-import java.io.BufferedWriter;
 import java.io.File;
 import java.io.FileInputStream;
 import java.io.FileOutputStream;
 import java.io.IOException;
 import java.io.OutputStream;
-import java.io.OutputStreamWriter;
 import java.nio.channels.FileChannel;
 import java.text.SimpleDateFormat;
 import java.util.ArrayList;
@@ -96,6 +95,11 @@
      */
     private ExportParams mExportParams;
 
+    // File paths generated by the exporter
+    private List<String> mExportedFiles;
+
+    private Exporter mExporter;
+
     public ExportAsyncTask(Context context){
         this.mContext = context;
     }
@@ -126,7 +130,6 @@ protected void onPreExecute() {
     protected Boolean doInBackground(ExportParams... params) {
         mExportParams = params[0];
 
-        Exporter mExporter;
         switch (mExportParams.getExportFormat()) {
                 case QIF:
                     mExporter = new QifExporter(mExportParams);
@@ -140,20 +143,11 @@ protected Boolean doInBackground(ExportParams... params) {
                 default:
                     mExporter = new GncXmlExporter(mExportParams);
                     break;
-            }
+        }
 
         try {
-            File file = new File(mExportParams.getInternalExportPath());
-            BufferedWriter writer = new BufferedWriter(new OutputStreamWriter(new FileOutputStream(file), "UTF-8"));
-            try {
-                // FIXME: detect if there aren't transactions to export and inform the user
-                mExporter.generateExport(writer);
-                writer.flush();
-            }
-            finally {
-                writer.close();
-            }
-
+            // FIXME: detect if there aren't transactions to export and inform the user
+            mExportedFiles = mExporter.generateExport();
         } catch (final Exception e) {
             Log.e(TAG, "Error exporting: " + e.getMessage());
             Crashlytics.logException(e);
@@ -174,16 +168,16 @@ public void run() {
 
         switch (mExportParams.getExportTarget()) {
             case SHARING:
-                File output = moveExportToSDCard();
-                shareFile(output.getAbsolutePath());
+                List<String> sdCardExportedFiles = moveExportToSDCard();
+                shareFiles(sdCardExportedFiles);
                 return true;
 
             case DROPBOX:
-                copyExportToDropbox();
+                moveExportToDropbox();
                 return true;
 
             case GOOGLE_DRIVE:
-                copyExportToGoogleDrive();
+                moveExportToGoogleDrive();
                 return true;
 
             case SD_CARD:
@@ -250,7 +244,7 @@ protected void onPostExecute(Boolean exportResult) {
         }
     }
 
-    private void copyExportToGoogleDrive(){
+    private void moveExportToGoogleDrive(){
         Log.i(TAG, "Moving exported file to Google Drive");
         final GoogleApiClient googleApiClient = SettingsActivity.getGoogleApiClient(GnuCashApplication.getAppContext());
         googleApiClient.blockingConnect();
@@ -258,11 +252,10 @@ private void copyExportToGoogleDrive(){
                 ResultCallback<DriveFolder.DriveFileResult>() {
                     @Override
                     public void onResult(DriveFolder.DriveFileResult result) {
-                        if (!result.getStatus().isSuccess()) {
+                        if (!result.getStatus().isSuccess())
                             Log.e(TAG, "Error while trying to sync to Google Drive");
-                            return;
-                        }
-                        Log.i(TAG, "Created a file with content: " + result.getDriveFile().getDriveId());
+                        else
+                            Log.i(TAG, "Created a file with content: " + result.getDriveFile().getDriveId());
                     }
                 };
 
@@ -277,12 +270,11 @@ public void onResult(DriveApi.DriveContentsResult result) {
                 try {
                     // write content to DriveContents
                     OutputStream outputStream = driveContents.getOutputStream();
-                    List<String> exportedFilePaths = getExportedFiles();
-                    for (String exportedFilePath : exportedFilePaths) {
+                    for (String exportedFilePath : mExportedFiles) {
                         File exportedFile = new File(exportedFilePath);
                         FileInputStream fileInputStream = new FileInputStream(exportedFile);
                         byte[] buffer = new byte[1024];
-                        int count = 0;
+                        int count;
 
                         while ((count = fileInputStream.read(buffer)) >= 0) {
                             outputStream.write(buffer, 0, count);
@@ -293,7 +285,7 @@ public void onResult(DriveApi.DriveContentsResult result) {
 
                         MetadataChangeSet changeSet = new MetadataChangeSet.Builder()
                                 .setTitle(exportedFile.getName())
-                                .setMimeType(getExportMimeType())
+                                .setMimeType(mExporter.getExportMimeType())
                                 .build();
 
                         SharedPreferences sharedPreferences = PreferenceManager.getDefaultSharedPreferences(mContext);
@@ -312,22 +304,7 @@ public void onResult(DriveApi.DriveContentsResult result) {
         });
     }
 
-    /**
-     * Returns the mime type for the configured export format
-     * @return MIME type as string
-     */
-    public String getExportMimeType(){
-        switch (mExportParams.getExportFormat()){
-            case OFX:
-            case XML:
-                return "text/xml";
-            case QIF:
-            default:
-                return "text/plain";
-        }
-    }
-
-    private void copyExportToDropbox() {
+    private void moveExportToDropbox() {
         Log.i(TAG, "Copying exported file to DropBox");
         String dropboxAppKey = mContext.getString(R.string.dropbox_app_key, SettingsActivity.DROPBOX_APP_KEY);
         String dropboxAppSecret = mContext.getString(R.string.dropbox_app_secret, SettingsActivity.DROPBOX_APP_SECRET);
@@ -336,8 +313,7 @@ private void copyExportToDropbox() {
         DbxFile dbExportFile = null;
         try {
             DbxFileSystem dbxFileSystem = DbxFileSystem.forAccount(mDbxAcctMgr.getLinkedAccount());
-            List<String> exportedFilePaths = getExportedFiles();
-            for (String exportedFilePath : exportedFilePaths) {
+            for (String exportedFilePath : mExportedFiles) {
                 File exportedFile = new File(exportedFilePath);
                 dbExportFile = dbxFileSystem.create(new DbxPath(exportedFile.getName()));
                 dbExportFile.writeFromExistingFile(exportedFile, false);
@@ -357,43 +333,35 @@ private void copyExportToDropbox() {
         }
     }
 
-    /**
-     * Returns the list of files generated by one export session.
-     * <p>Typically it is one file. But QIF export generate multiple files per currency.</p>
-     * @return List of paths to exported files
-     * @throws IOException if the exported files could not be created
-     */
-    private List<String> getExportedFiles() throws IOException {
-        List<String> exportedFilePaths;
-        if (mExportParams.getExportFormat() == ExportFormat.QIF) {
-            String path = mExportParams.getInternalExportPath();
-            exportedFilePaths = QifExporter.splitQIF(new File(path));
-        } else {
-            exportedFilePaths = new ArrayList<>();
-            exportedFilePaths.add(mExportParams.getInternalExportPath());
-        }
-        return exportedFilePaths;
-    }
 
     /**
-     * Moves the exported file from the internal storage where it is generated to external storage
-     * which is accessible to the user.
-     * @return File to which the export was moved.
+     * Moves the exported files from the internal storage where they are generated to
+     * external storage, which is accessible to the user.
+     * @return The list of files moved to the SD card.
      */
-    private File moveExportToSDCard() {
+    private List<String> moveExportToSDCard() {
         Log.i(TAG, "Moving exported file to external storage");
-        File src = new File(mExportParams.getInternalExportPath());
-        File dst = Exporter.createExportFile(mExportParams.getExportFormat());
+        new File(Exporter.EXPORT_FOLDER_PATH).mkdirs();
+        List<String> dstFiles = new ArrayList<>();
 
-        try {
-            copyFile(src, dst);
-            src.delete();
-            return dst;
-        } catch (IOException e) {
-            Crashlytics.logException(e);
-            Log.e(TAG, e.getMessage());
-            throw new Exporter.ExporterException(mExportParams, e);
+        for (String src: mExportedFiles) {
+            String dst = Exporter.EXPORT_FOLDER_PATH + stripPathPart(src);
+            try {
+                moveFile(src, dst);
+                dstFiles.add(dst);
+            } catch (IOException e) {
+                Crashlytics.logException(e);
+                Log.e(TAG, e.getMessage());
+                throw new Exporter.ExporterException(mExportParams, e);
+            }
         }
+
+        return dstFiles;
+    }
+
+    // "/some/path/filename.ext" -> "filename.ext"
+    private String stripPathPart(String fullPathName) {
+        return (new File(fullPathName)).getName();
     }
 
     /**
@@ -418,37 +386,25 @@ private void backupAndDeleteTransactions(){
 
     /**
      * Starts an intent chooser to allow the user to select an activity to receive
-     * the exported OFX file
-     * @param path String path to the file on disk
+     * the exported files.
+     * @param paths list of full paths of the files to send to the activity.
      */
-    private void shareFile(String path) {
-        String defaultEmail = PreferenceManager.getDefaultSharedPreferences(mContext)
-                .getString(mContext.getString(R.string.key_default_export_email), null);
+    private void shareFiles(List<String> paths) {
         Intent shareIntent = new Intent(Intent.ACTION_SEND_MULTIPLE);
         shareIntent.setType("text/xml");
-        ArrayList<Uri> exportFiles = new ArrayList<>();
-        if (mExportParams.getExportFormat() == ExportFormat.QIF) {
-            try {
-                List<String> splitFiles = QifExporter.splitQIF(new File(path));
-                for (String file : splitFiles) {
-                    exportFiles.add(Uri.parse("file://" + file));
-                }
-            } catch (IOException e) {
-                Log.e(TAG, "Error split up files in shareFile. " + e.getMessage());
-                Crashlytics.logException(e);
-                return;
-            }
-        } else {
-            exportFiles.add(Uri.parse("file://" + path));
-        }
+
+        ArrayList<Uri> exportFiles = convertPathsToUris(paths);
         shareIntent.putExtra(Intent.EXTRA_STREAM, exportFiles);
+
         shareIntent.putExtra(Intent.EXTRA_SUBJECT, mContext.getString(R.string.title_export_email,
                 mExportParams.getExportFormat().name()));
-        if (defaultEmail != null && defaultEmail.trim().length() > 0) {
+
+        String defaultEmail = PreferenceManager.getDefaultSharedPreferences(mContext)
+                .getString(mContext.getString(R.string.key_default_export_email), null);
+        if (defaultEmail != null && defaultEmail.trim().length() > 0)
             shareIntent.putExtra(Intent.EXTRA_EMAIL, new String[]{defaultEmail});
-        }
-        SimpleDateFormat formatter = (SimpleDateFormat) SimpleDateFormat.getDateTimeInstance();
 
+        SimpleDateFormat formatter = (SimpleDateFormat) SimpleDateFormat.getDateTimeInstance();
         ArrayList<CharSequence> extraText = new ArrayList<>();
         extraText.add(mContext.getString(R.string.description_export_email)
                 + " " + formatter.format(new Date(System.currentTimeMillis())));
@@ -457,7 +413,8 @@ private void shareFile(String path) {
         if (mContext instanceof Activity) {
             List<ResolveInfo> activities = mContext.getPackageManager().queryIntentActivities(shareIntent, 0);
             if (activities != null && !activities.isEmpty()) {
-                mContext.startActivity(Intent.createChooser(shareIntent, mContext.getString(R.string.title_select_export_destination)));
+                mContext.startActivity(Intent.createChooser(shareIntent,
+                        mContext.getString(R.string.title_select_export_destination)));
             } else {
                 Toast.makeText(mContext, R.string.toast_no_compatible_apps_to_receive_export,
                         Toast.LENGTH_LONG).show();
@@ -465,27 +422,37 @@ private void shareFile(String path) {
         }
     }
 
+    // /some/path/file.ext -> file:///some/path/file.ext
+    @NonNull
+    private ArrayList<Uri> convertPathsToUris(List<String> paths) {
+        ArrayList<Uri> exportFiles = new ArrayList<>();
+
+        for (String file : paths)
+            exportFiles.add(Uri.parse("file://" + file));
+
+        return exportFiles;
+    }
+
     /**
-     * Copies a file from <code>src</code> to <code>dst</code>
+     * Moves a file from <code>src</code> to <code>dst</code>
      * @param src Absolute path to the source file
      * @param dst Absolute path to the destination file
-     * @throws IOException if the file could not be copied
+     * @throws IOException if the file could not be moved.
      */
-    public void copyFile(File src, File dst) throws IOException {
-        //TODO: Make this asynchronous at some time, t in the future
-        if (mExportParams.getExportFormat() == ExportFormat.QIF) {
-            QifExporter.splitQIF(src, dst);
-        } else {
-            FileChannel inChannel = new FileInputStream(src).getChannel();
-            FileChannel outChannel = new FileOutputStream(dst).getChannel();
-            try {
-                inChannel.transferTo(0, inChannel.size(), outChannel);
-            } finally {
-                if (inChannel != null)
-                    inChannel.close();
-                outChannel.close();
-            }
+    public void moveFile(String src, String dst) throws IOException {
+        //TODO: Make this asynchronous at some time, t in the future.
+        File srcFile = new File(src);
+        File dstFile = new File(dst);
+        FileChannel inChannel = new FileInputStream(srcFile).getChannel();
+        FileChannel outChannel = new FileOutputStream(dstFile).getChannel();
+        try {
+            inChannel.transferTo(0, inChannel.size(), outChannel);
+        } finally {
+            if (inChannel != null)
+                inChannel.close();
+            outChannel.close();
         }
+        srcFile.delete();
     }
 
 }
diff --git a/app/src/main/java/org/gnucash/android/export/ExportParams.java b/app/src/main/java/org/gnucash/android/export/ExportParams.java
index 50619cc4..7d859621 100644
--- a/app/src/main/java/org/gnucash/android/export/ExportParams.java
+++ b/app/src/main/java/org/gnucash/android/export/ExportParams.java
@@ -166,11 +166,10 @@ public String toString() {
      */
     public String toCsv(){
         String separator = ";";
-        String csv = mExportFormat.name() + separator + mExportTarget.name() + separator
+
+        return mExportFormat.name() + separator + mExportTarget.name() + separator
                 + mExportStartTime.toString() + separator
                 + Boolean.toString(mDeleteTransactionsAfterExport);
-
-        return csv;
     }
 
     /**
diff --git a/app/src/main/java/org/gnucash/android/export/Exporter.java b/app/src/main/java/org/gnucash/android/export/Exporter.java
index 41f04166..bbbb7b46 100644
--- a/app/src/main/java/org/gnucash/android/export/Exporter.java
+++ b/app/src/main/java/org/gnucash/android/export/Exporter.java
@@ -34,13 +34,11 @@
 import org.gnucash.android.db.SplitsDbAdapter;
 import org.gnucash.android.db.TransactionsDbAdapter;
 
-import java.io.File;
-import java.io.FileFilter;
-import java.io.Writer;
 import java.sql.Timestamp;
 import java.text.ParseException;
 import java.text.SimpleDateFormat;
 import java.util.Date;
+import java.util.List;
 import java.util.Locale;
 
 /**
@@ -92,7 +90,7 @@
     protected TransactionsDbAdapter mTransactionsDbAdapter;
     protected SplitsDbAdapter mSplitsDbAdapter;
     protected ScheduledActionDbAdapter mScheduledActionDbAdapter;
-    protected PricesDbAdapter mPricesDbAdpater;
+    protected PricesDbAdapter mPricesDbAdapter;
     protected CommoditiesDbAdapter mCommoditiesDbAdapter;
     protected Context mContext;
 
@@ -104,14 +102,14 @@ public Exporter(ExportParams params, SQLiteDatabase db) {
             mTransactionsDbAdapter = TransactionsDbAdapter.getInstance();
             mSplitsDbAdapter = SplitsDbAdapter.getInstance();
             mScheduledActionDbAdapter = ScheduledActionDbAdapter.getInstance();
-            mPricesDbAdpater = PricesDbAdapter.getInstance();
+            mPricesDbAdapter = PricesDbAdapter.getInstance();
             mCommoditiesDbAdapter = CommoditiesDbAdapter.getInstance();
         } else {
             mSplitsDbAdapter = new SplitsDbAdapter(db);
             mTransactionsDbAdapter = new TransactionsDbAdapter(db, mSplitsDbAdapter);
             mAccountsDbAdapter = new AccountsDbAdapter(db, mTransactionsDbAdapter);
             mScheduledActionDbAdapter = new ScheduledActionDbAdapter(db);
-            mPricesDbAdpater = new PricesDbAdapter(db);
+            mPricesDbAdapter = new PricesDbAdapter(db);
             mCommoditiesDbAdapter = new CommoditiesDbAdapter(db);
         }
     }
@@ -121,10 +119,8 @@ public Exporter(ExportParams params, SQLiteDatabase db) {
      * @return String containing the file name
      */
     public static String buildExportFilename(ExportFormat format) {
-        String filename = EXPORT_FILENAME_DATE_FORMAT.format(
-                new Date(System.currentTimeMillis()))
+        return EXPORT_FILENAME_DATE_FORMAT.format(new Date(System.currentTimeMillis()))
                 + "_gnucash_export" + format.getExtension();
-        return filename;
     }
 
     /**
@@ -149,60 +145,19 @@ public static long getExportTime(String filename){
     }
 
     /**
-     * Builds a file (creating folders where necessary) for saving the exported data
-     * @param format Export format which determines the file extension
-     * @return File for export
-     * @see #EXPORT_FOLDER_PATH
+     * Generates the export output
+     * @throws ExporterException if an error occurs during export
      */
-    public static File createExportFile(ExportFormat format){
-        new File(EXPORT_FOLDER_PATH).mkdirs();
-        return new File(EXPORT_FOLDER_PATH + buildExportFilename(format));
-    }
+    public abstract List<String> generateExport() throws ExporterException;
 
     /**
-     * Builds a file for backups of the database (in XML) format.
-     * Backups are usually zipped and have extension ".zip"
-     * @return File for saving backups
-     * @see #BACKUP_FOLDER_PATH
+     * Returns the MIME type for this exporter.
+     * @return MIME type as string
      */
-    public static File buildBackupFile(){
-        new File(BACKUP_FOLDER_PATH).mkdirs();
-        return new File(BACKUP_FOLDER_PATH + buildExportFilename(ExportFormat.XML) + ".zip");
+    public String getExportMimeType(){
+        return "text/plain";
     }
 
-    /**
-     * Returns the most recent backup file from the backup folder
-     * @return Last modified file from backup folder
-     * @see #BACKUP_FOLDER_PATH
-     */
-    public static File getMostRecentBackupFile(){
-        File backupFolder = new File(BACKUP_FOLDER_PATH);
-        if (!backupFolder.exists())
-            return null;
-
-        File[] files = backupFolder.listFiles(new FileFilter() {
-            public boolean accept(File file) {
-                return file.isFile();
-            }
-        });
-        long lastMod = Long.MIN_VALUE;
-        File backupFile = null;
-        for (File file : files) {
-            if (file.lastModified() > lastMod) {
-                backupFile = file;
-                lastMod = file.lastModified();
-            }
-        }
-        return backupFile;
-    }
-
-    /**
-     * Generates the export output
-     * @param writer A Writer to export result to
-     * @throws ExporterException if an error occurs during export
-     */
-    public abstract void generateExport(Writer writer) throws ExporterException;
-
     public static class ExporterException extends RuntimeException{
 
         public ExporterException(ExportParams params){
diff --git a/app/src/main/java/org/gnucash/android/export/ofx/OfxExporter.java b/app/src/main/java/org/gnucash/android/export/ofx/OfxExporter.java
index ab915e40..b116f34f 100644
--- a/app/src/main/java/org/gnucash/android/export/ofx/OfxExporter.java
+++ b/app/src/main/java/org/gnucash/android/export/ofx/OfxExporter.java
@@ -34,10 +34,15 @@
 import org.w3c.dom.Node;
 import org.w3c.dom.ProcessingInstruction;
 
+import java.io.BufferedWriter;
+import java.io.File;
+import java.io.FileOutputStream;
 import java.io.IOException;
+import java.io.OutputStreamWriter;
 import java.io.StringWriter;
 import java.io.Writer;
 import java.sql.Timestamp;
+import java.util.ArrayList;
 import java.util.List;
 
 import javax.xml.parsers.DocumentBuilder;
@@ -107,7 +112,8 @@ private void generateOfx(Document doc, Element parent){
 		}
 	}
 
-    public String generateExport() throws ExporterException {
+    // FIXME: Move code to generateExport()
+    private String generateOfxExport() throws ExporterException {
         mAccountsList = mAccountsDbAdapter.getExportableAccounts(mParameters.getExportStartTime());
 
         DocumentBuilderFactory docFactory = DocumentBuilderFactory
@@ -141,25 +147,36 @@ public String generateExport() throws ExporterException {
             return stringWriter.toString();
         } else {
             Node ofxNode = document.getElementsByTagName("OFX").item(0);
-
             write(ofxNode, stringWriter, true);
-
-            StringBuffer stringBuffer = new StringBuffer(OfxHelper.OFX_SGML_HEADER);
-            stringBuffer.append('\n');
-            stringBuffer.append(stringWriter.toString());
             PreferenceManager.getDefaultSharedPreferences(mContext).edit().putString(Exporter.PREF_LAST_EXPORT_TIME, timeStamp).apply();
-            return stringBuffer.toString();
+            return OfxHelper.OFX_SGML_HEADER + '\n' + stringWriter.toString();
         }
     }
 
     @Override
-    public void generateExport(Writer writer) throws ExporterException {
+    public List<String> generateExport() throws ExporterException {
+        BufferedWriter writer = null;
+
         try {
-            writer.write(generateExport());
-        }
-        catch (IOException e) {
+            File file = new File(mParameters.getInternalExportPath());
+            writer = new BufferedWriter(new OutputStreamWriter(new FileOutputStream(file), "UTF-8"));
+            writer.write(generateOfxExport());
+        } catch (IOException e) {
             throw new ExporterException(mParameters, e);
+        } finally {
+            if (writer != null) {
+                try {
+                    writer.close();
+                } catch (IOException e) {
+                    throw new ExporterException(mParameters, e);
+                }
+            }
         }
+
+        List<String> exportedFiles = new ArrayList<>();
+        exportedFiles.add(mParameters.getInternalExportPath());
+
+        return exportedFiles;
     }
 
     /**
@@ -188,4 +205,12 @@ private void write(Node node, Writer outputWriter, boolean omitXmlDeclaration){
             Crashlytics.logException(tfException);
         }
     }
+
+    /**
+     * Returns the MIME type for this exporter.
+     * @return MIME type as string
+     */
+    public String getExportMimeType(){
+        return "text/xml";
+    }
 }
diff --git a/app/src/main/java/org/gnucash/android/export/qif/QifExporter.java b/app/src/main/java/org/gnucash/android/export/qif/QifExporter.java
index 95b7485c..1f3eb6aa 100644
--- a/app/src/main/java/org/gnucash/android/export/qif/QifExporter.java
+++ b/app/src/main/java/org/gnucash/android/export/qif/QifExporter.java
@@ -21,19 +21,18 @@
 import android.preference.PreferenceManager;
 
 import org.gnucash.android.db.AccountsDbAdapter;
-import org.gnucash.android.db.DatabaseSchema;
 import org.gnucash.android.db.TransactionsDbAdapter;
 import org.gnucash.android.export.ExportParams;
 import org.gnucash.android.export.Exporter;
-import org.gnucash.android.model.Transaction;
 
 import java.io.BufferedReader;
 import java.io.BufferedWriter;
 import java.io.File;
+import java.io.FileOutputStream;
 import java.io.FileReader;
 import java.io.FileWriter;
 import java.io.IOException;
-import java.io.Writer;
+import java.io.OutputStreamWriter;
 import java.math.BigDecimal;
 import java.sql.Timestamp;
 import java.util.ArrayList;
@@ -57,7 +56,7 @@ public QifExporter(ExportParams params){
     }
 
     @Override
-    public void generateExport(Writer writer) throws ExporterException {
+    public List<String> generateExport() throws ExporterException {
         final String newLine = "\n";
         TransactionsDbAdapter transactionsDbAdapter = mTransactionsDbAdapter;
         try {
@@ -95,6 +94,10 @@ public void generateExport(Writer writer) throws ExporterException {
                     // trans_uid ASC  : put splits from the same transaction together
                    "acct1_currency ASC, trans_time ASC, trans_uid ASC"
                     );
+
+            File file = new File(mParameters.getInternalExportPath());
+            BufferedWriter writer = new BufferedWriter(new OutputStreamWriter(new FileOutputStream(file), "UTF-8"));
+
             try {
                 String currentCurrencyCode = "";
                 String currentAccountUID = "";
@@ -202,22 +205,23 @@ public void generateExport(Writer writer) throws ExporterException {
                     // end last transaction
                     writer.append(QifHelper.ENTRY_TERMINATOR).append(newLine);
                 }
-            }
-            finally {
+                writer.flush();
+            } finally {
                 cursor.close();
+                writer.close();
             }
+
             ContentValues contentValues = new ContentValues();
             contentValues.put(TransactionEntry.COLUMN_EXPORTED, 1);
             transactionsDbAdapter.updateTransaction(contentValues, null, null);
-        }
-        catch (IOException e)
-        {
+
+            /// export successful
+            String timeStamp = new Timestamp(System.currentTimeMillis()).toString();
+            PreferenceManager.getDefaultSharedPreferences(mContext).edit().putString(Exporter.PREF_LAST_EXPORT_TIME, timeStamp).apply();
+            return splitQIF(file);
+        } catch (IOException e) {
             throw new ExporterException(mParameters, e);
         }
-
-        /// export successful
-        String timeStamp = new Timestamp(System.currentTimeMillis()).toString();
-        PreferenceManager.getDefaultSharedPreferences(mContext).edit().putString(Exporter.PREF_LAST_EXPORT_TIME, timeStamp).apply();
     }
 
     /**
@@ -227,16 +231,12 @@ public void generateExport(Writer writer) throws ExporterException {
      * @return a list of paths of the newly created Qif files.
      * @throws IOException if something went wrong while splitting the file.
      */
-    public static List<String> splitQIF(File file) throws IOException {
-        return splitQIF(file, file);
-    }
-
-    public static List<String> splitQIF(File src, File dst) throws IOException {
+    public List<String> splitQIF(File file) throws IOException {
         // split only at the last dot
-        String[] pathParts = dst.getPath().split("(?=\\.[^\\.]+$)");
+        String[] pathParts = file.getPath().split("(?=\\.[^\\.]+$)");
         ArrayList<String> splitFiles = new ArrayList<>();
         String line;
-        BufferedReader in = new BufferedReader(new FileReader(src));
+        BufferedReader in = new BufferedReader(new FileReader(file));
         BufferedWriter out = null;
         try {
             while ((line = in.readLine()) != null) {
@@ -250,7 +250,7 @@ public void generateExport(Writer writer) throws ExporterException {
                     out = new BufferedWriter(new FileWriter(newFileName));
                 } else {
                     if (out == null) {
-                        throw new IllegalArgumentException(src.getPath() + " format is not correct");
+                        throw new IllegalArgumentException(file.getPath() + " format is not correct");
                     }
                     out.append(line).append('\n');
                 }
@@ -263,4 +263,12 @@ public void generateExport(Writer writer) throws ExporterException {
         }
         return splitFiles;
     }
+
+    /**
+     * Returns the mime type for this Exporter.
+     * @return MIME type as string
+     */
+    public String getExportMimeType(){
+        return "text/plain";
+    }
 }
diff --git a/app/src/main/java/org/gnucash/android/export/xml/GncXmlExporter.java b/app/src/main/java/org/gnucash/android/export/xml/GncXmlExporter.java
index 6d8179eb..b148e5a6 100644
--- a/app/src/main/java/org/gnucash/android/export/xml/GncXmlExporter.java
+++ b/app/src/main/java/org/gnucash/android/export/xml/GncXmlExporter.java
@@ -41,10 +41,10 @@
 import org.xmlpull.v1.XmlSerializer;
 
 import java.io.BufferedOutputStream;
+import java.io.File;
 import java.io.FileOutputStream;
 import java.io.IOException;
 import java.io.OutputStreamWriter;
-import java.io.Writer;
 import java.math.BigDecimal;
 import java.sql.Timestamp;
 import java.util.ArrayList;
@@ -53,7 +53,6 @@
 import java.util.List;
 import java.util.Map;
 import java.util.TreeMap;
-import java.util.UUID;
 import java.util.zip.GZIPOutputStream;
 
 import static org.gnucash.android.db.DatabaseSchema.ScheduledActionEntry;
@@ -426,7 +425,7 @@ private void exportTransactions(XmlSerializer xmlSerializer, boolean exportTempl
             // account guid
             xmlSerializer.startTag(null, GncXmlHelper.TAG_SPLIT_ACCOUNT);
             xmlSerializer.attribute(null, GncXmlHelper.ATTR_KEY_TYPE, GncXmlHelper.ATTR_VALUE_GUID);
-            String splitAccountUID = null;
+            String splitAccountUID;
             if (exportTemplates){
                 //get the UID of the template account
                  splitAccountUID = mTransactionToTemplateAccountMap.get(curTrxUID).getUID();
@@ -636,7 +635,7 @@ private void exportCommodity(XmlSerializer xmlSerializer, List<Currency> currenc
     private void exportPrices(XmlSerializer xmlSerializer) throws IOException {
         xmlSerializer.startTag(null, GncXmlHelper.TAG_PRICEDB);
         xmlSerializer.attribute(null, GncXmlHelper.ATTR_KEY_VERSION, "1");
-        Cursor cursor = mPricesDbAdpater.fetchAllRecords();
+        Cursor cursor = mPricesDbAdapter.fetchAllRecords();
         try {
             while(cursor.moveToNext()) {
                 xmlSerializer.startTag(null, GncXmlHelper.TAG_PRICE);
@@ -650,7 +649,7 @@ private void exportPrices(XmlSerializer xmlSerializer) throws IOException {
                 xmlSerializer.startTag(null, GncXmlHelper.TAG_COMMODITY_SPACE);
                 xmlSerializer.text("ISO4217");
                 xmlSerializer.endTag(null, GncXmlHelper.TAG_COMMODITY_SPACE);
-                xmlSerializer.startTag(null, GncXmlHelper.TAG_COMMODITY_ID);;
+                xmlSerializer.startTag(null, GncXmlHelper.TAG_COMMODITY_ID);
                 xmlSerializer.text(mCommoditiesDbAdapter.getCurrencyCode(cursor.getString(cursor.getColumnIndexOrThrow(DatabaseSchema.PriceEntry.COLUMN_COMMODITY_UID))));
                 xmlSerializer.endTag(null, GncXmlHelper.TAG_COMMODITY_ID);
                 xmlSerializer.endTag(null, GncXmlHelper.TAG_PRICE_COMMODITY);
@@ -659,7 +658,7 @@ private void exportPrices(XmlSerializer xmlSerializer) throws IOException {
                 xmlSerializer.startTag(null, GncXmlHelper.TAG_COMMODITY_SPACE);
                 xmlSerializer.text("ISO4217");
                 xmlSerializer.endTag(null, GncXmlHelper.TAG_COMMODITY_SPACE);
-                xmlSerializer.startTag(null, GncXmlHelper.TAG_COMMODITY_ID);;
+                xmlSerializer.startTag(null, GncXmlHelper.TAG_COMMODITY_ID);
                 xmlSerializer.text(mCommoditiesDbAdapter.getCurrencyCode(cursor.getString(cursor.getColumnIndexOrThrow(DatabaseSchema.PriceEntry.COLUMN_CURRENCY_UID))));
                 xmlSerializer.endTag(null, GncXmlHelper.TAG_COMMODITY_ID);
                 xmlSerializer.endTag(null, GncXmlHelper.TAG_PRICE_CURRENCY);
@@ -695,16 +694,24 @@ private void exportPrices(XmlSerializer xmlSerializer) throws IOException {
     }
 
     @Override
-    public void generateExport(Writer writer) throws ExporterException{
+    public List<String> generateExport() throws ExporterException {
+        OutputStreamWriter writer = null;
+
         try {
-            String[] namespaces = new String[] {"gnc", "act", "book", "cd", "cmdty", "price", "slot",
+            String[] namespaces = new String[]{"gnc", "act", "book", "cd", "cmdty", "price", "slot",
                     "split", "trn", "ts", "sx", "recurrence"};
+            new File(BACKUP_FOLDER_PATH).mkdirs();
+            FileOutputStream fileOutputStream = new FileOutputStream(getBackupFilePath());
+            BufferedOutputStream bufferedOutputStream = new BufferedOutputStream(fileOutputStream);
+            GZIPOutputStream gzipOutputStream = new GZIPOutputStream(bufferedOutputStream);
+            writer = new OutputStreamWriter(gzipOutputStream);
+
             XmlSerializer xmlSerializer = XmlPullParserFactory.newInstance().newSerializer();
             xmlSerializer.setOutput(writer);
             xmlSerializer.startDocument("utf-8", true);
             // root tag
             xmlSerializer.startTag(null, GncXmlHelper.TAG_ROOT);
-            for(String ns : namespaces) {
+            for (String ns : namespaces) {
                 xmlSerializer.attribute(null, "xmlns:" + ns, "http://www.gnucash.org/XML/" + ns);
             }
             // book count
@@ -722,7 +729,7 @@ public void generateExport(Writer writer) throws ExporterException{
             xmlSerializer.endTag(null, GncXmlHelper.TAG_BOOK_ID);
             //commodity count
             List<Currency> currencies = mAccountsDbAdapter.getCurrenciesInUse();
-            for (int i = 0; i< currencies.size();i++) {
+            for (int i = 0; i < currencies.size(); i++) {
                 if (currencies.get(i).getCurrencyCode().equals("XXX")) {
                     currencies.remove(i);
                 }
@@ -742,7 +749,7 @@ public void generateExport(Writer writer) throws ExporterException{
             xmlSerializer.text(mTransactionsDbAdapter.getRecordsCount() + "");
             xmlSerializer.endTag(null, GncXmlHelper.TAG_COUNT_DATA);
             //price count
-            long priceCount = mPricesDbAdpater.getRecordsCount();
+            long priceCount = mPricesDbAdapter.getRecordsCount();
             if (priceCount > 0) {
                 xmlSerializer.startTag(null, GncXmlHelper.TAG_COUNT_DATA);
                 xmlSerializer.attribute(null, GncXmlHelper.ATTR_KEY_CD_TYPE, "price");
@@ -775,8 +782,31 @@ public void generateExport(Writer writer) throws ExporterException{
         } catch (Exception e) {
             Crashlytics.logException(e);
             throw new ExporterException(mParameters, e);
+        } finally {
+            if (writer != null) {
+                try {
+                    writer.close();
+                } catch (IOException e) {
+                    throw new ExporterException(mParameters, e);
+                }
+            }
         }
+
+        List<String> exportedFiles = new ArrayList<>();
+        // FIXME: this looks weird
+        exportedFiles.add(getBackupFilePath());
+
+        return exportedFiles;
     }
+
+    /**
+     * Returns the MIME type for this exporter.
+     * @return MIME type as string
+     */
+    public String getExportMimeType(){
+        return "text/xml";
+    }
+
     /**
      * Creates a backup of current database contents to the default backup location
      * @return {@code true} if backup was successful, {@code false} otherwise
@@ -784,17 +814,22 @@ public void generateExport(Writer writer) throws ExporterException{
     public static boolean createBackup(){
         ExportParams params = new ExportParams(ExportFormat.XML);
         try {
-            FileOutputStream fileOutputStream = new FileOutputStream(Exporter.buildBackupFile());
-            BufferedOutputStream bufferedOutputStream = new BufferedOutputStream(fileOutputStream);
-            GZIPOutputStream gzipOutputStream = new GZIPOutputStream(bufferedOutputStream);
-            OutputStreamWriter outputStreamWriter = new OutputStreamWriter(gzipOutputStream);
-            new GncXmlExporter(params).generateExport(outputStreamWriter);
-            outputStreamWriter.close();
+            new GncXmlExporter(params).generateExport();
             return true;
-        } catch (IOException e) {
+        } catch (ExporterException e) {
             Crashlytics.logException(e);
             Log.e("GncXmlExporter", "Error creating backup", e);
             return false;
         }
     }
+
+    /**
+     * Returns the full path of a file to make database backup.
+     * Backups are done in XML format and are zipped (with ".zip" extension).
+     * @return the file path for backups of the database.
+     * @see #BACKUP_FOLDER_PATH
+     */
+    private static String getBackupFilePath(){
+        return BACKUP_FOLDER_PATH + buildExportFilename(ExportFormat.XML) + ".zip";
+    }
 }

From 9ab4e04b4ff296ca8a9238d971a7c68c5991583a Mon Sep 17 00:00:00 2001
From: Ngewi Fet <ngewif@gmail.com>
Date: Mon, 16 Nov 2015 13:24:07 +0100
Subject: [PATCH 19/25] Fix: export start time not respected

Add tests for creating backup
Use cache directory as primary export destination
Code refactoring
---
 .../android/test/ui/ExportTransactionsTest.java    | 28 +++++++++
 .../gnucash/android/export/ExportAsyncTask.java    | 25 +++++---
 .../org/gnucash/android/export/ExportParams.java   | 26 +-------
 .../java/org/gnucash/android/export/Exporter.java  | 44 +++++++++++++-
 .../gnucash/android/export/ofx/OfxExporter.java    | 14 ++---
 .../gnucash/android/export/qif/QifExporter.java    |  8 +--
 .../gnucash/android/export/xml/GncXmlExporter.java | 71 ++++++++++++++--------
 .../android/test/unit/export/BackupTest.java       | 66 ++++++++++++++++++++
 .../android/test/unit/export/GncXmlHelperTest.java | 16 +++++
 9 files changed, 228 insertions(+), 70 deletions(-)
 create mode 100644 app/src/test/java/org/gnucash/android/test/unit/export/BackupTest.java

diff --git a/app/src/androidTest/java/org/gnucash/android/test/ui/ExportTransactionsTest.java b/app/src/androidTest/java/org/gnucash/android/test/ui/ExportTransactionsTest.java
index 5b51bdce..05c9bbed 100644
--- a/app/src/androidTest/java/org/gnucash/android/test/ui/ExportTransactionsTest.java
+++ b/app/src/androidTest/java/org/gnucash/android/test/ui/ExportTransactionsTest.java
@@ -61,6 +61,7 @@
 import static android.support.test.espresso.Espresso.onView;
 import static android.support.test.espresso.action.ViewActions.click;
 import static android.support.test.espresso.assertion.ViewAssertions.matches;
+import static android.support.test.espresso.matcher.RootMatchers.withDecorView;
 import static android.support.test.espresso.matcher.ViewMatchers.isAssignableFrom;
 import static android.support.test.espresso.matcher.ViewMatchers.isDisplayed;
 import static android.support.test.espresso.matcher.ViewMatchers.isEnabled;
@@ -69,6 +70,8 @@
 import static android.support.test.espresso.matcher.ViewMatchers.withText;
 import static org.assertj.core.api.Assertions.assertThat;
 import static org.hamcrest.Matchers.allOf;
+import static org.hamcrest.Matchers.is;
+import static org.hamcrest.Matchers.not;
 
 @RunWith(AndroidJUnit4.class)
 @FixMethodOrder(MethodSorters.NAME_ASCENDING)
@@ -192,6 +195,11 @@ public void testExport(ExportFormat format){
 
 		DrawerActions.openDrawer(R.id.drawer_layout);
 		onView(withText(R.string.nav_menu_export)).perform(click());
+
+		onView(withId(R.id.spinner_export_destination)).perform(click());
+		String[] destinations = getActivity().getResources().getStringArray(R.array.export_destinations);
+
+		onView(withText(destinations[0])).perform(click());
 		onView(withText(format.name())).perform(click());
 
 		onView(withId(R.id.menu_save)).perform(click());
@@ -243,6 +251,26 @@ public void testShouldCreateExportSchedule(){
 		assertThat(action.getEndTime()).isEqualTo(0);
 	}
 
+	@Test
+	public void testCreateBackup(){
+		DrawerActions.openDrawer(R.id.drawer_layout);
+		onView(withText(R.string.title_settings)).perform(click());
+		onView(withText(R.string.header_backup_and_export_settings)).perform(click());
+
+		onView(withText(R.string.title_create_backup_pref)).perform(click());
+		assertToastDisplayed(R.string.toast_backup_successful);
+	}
+
+	/**
+	 * Checks that a specific toast message is displayed
+	 * @param toastString String that should be displayed
+	 */
+	private void assertToastDisplayed(int toastString) {
+		onView(withText(toastString))
+				.inRoot(withDecorView(not(is(getActivity().getWindow().getDecorView()))))
+				.check(matches(isDisplayed()));
+	}
+
 	//todo: add testing of export flag to unit test
 	//todo: add test of ignore exported transactions to unit tests
 	@Override
diff --git a/app/src/main/java/org/gnucash/android/export/ExportAsyncTask.java b/app/src/main/java/org/gnucash/android/export/ExportAsyncTask.java
index 97c219bf..0e17ef28 100644
--- a/app/src/main/java/org/gnucash/android/export/ExportAsyncTask.java
+++ b/app/src/main/java/org/gnucash/android/export/ExportAsyncTask.java
@@ -393,8 +393,9 @@ private void shareFiles(List<String> paths) {
         Intent shareIntent = new Intent(Intent.ACTION_SEND_MULTIPLE);
         shareIntent.setType("text/xml");
 
-        ArrayList<Uri> exportFiles = convertPathsToUris(paths);
-        shareIntent.putExtra(Intent.EXTRA_STREAM, exportFiles);
+        ArrayList<Uri> exportFiles = convertFilePathsToUris(paths);
+//        shareIntent.putExtra(Intent.EXTRA_STREAM, exportFiles);
+        shareIntent.putParcelableArrayListExtra(Intent.EXTRA_STREAM, exportFiles);
 
         shareIntent.putExtra(Intent.EXTRA_SUBJECT, mContext.getString(R.string.title_export_email,
                 mExportParams.getExportFormat().name()));
@@ -422,14 +423,24 @@ private void shareFiles(List<String> paths) {
         }
     }
 
-    // /some/path/file.ext -> file:///some/path/file.ext
+    //
+
+    /**
+     * Convert file paths to URIs by adding the file// prefix
+     * <p>e.g. /some/path/file.ext --> file:///some/path/file.ext</p>
+     * @param paths List of file paths to convert
+     * @return List of file URIs
+     */
     @NonNull
-    private ArrayList<Uri> convertPathsToUris(List<String> paths) {
+    private ArrayList<Uri> convertFilePathsToUris(List<String> paths) {
         ArrayList<Uri> exportFiles = new ArrayList<>();
 
-        for (String file : paths)
-            exportFiles.add(Uri.parse("file://" + file));
-
+        for (String path : paths) {
+            File file = new File(path);
+            file.setReadable(true, false);
+            exportFiles.add(Uri.fromFile(file));
+//            exportFiles.add(Uri.parse("file://" + file));
+        }
         return exportFiles;
     }
 
diff --git a/app/src/main/java/org/gnucash/android/export/ExportParams.java b/app/src/main/java/org/gnucash/android/export/ExportParams.java
index 7d859621..04d860e0 100644
--- a/app/src/main/java/org/gnucash/android/export/ExportParams.java
+++ b/app/src/main/java/org/gnucash/android/export/ExportParams.java
@@ -16,12 +16,6 @@
 
 package org.gnucash.android.export;
 
-import android.preference.PreferenceManager;
-import android.util.Log;
-
-import com.crashlytics.android.Crashlytics;
-
-import org.gnucash.android.app.GnuCashApplication;
 import org.gnucash.android.ui.export.ExportFormFragment;
 
 import java.sql.Timestamp;
@@ -65,11 +59,6 @@
     private ExportTarget mExportTarget      = ExportTarget.SHARING;
 
     /**
-     * File path for the internal saving of transactions before determining export destination.
-     */
-    private String mTargetFilepath;
-
-    /**
      * Creates a new set of paramters and specifies the export format
      * @param format Format to use when exporting the transactions
      */
@@ -91,8 +80,6 @@ public ExportFormat getExportFormat() {
      */
     public void setExportFormat(ExportFormat exportFormat) {
         this.mExportFormat = exportFormat;
-        this.mTargetFilepath = GnuCashApplication.getAppContext().getFilesDir() + "/"
-                            + Exporter.buildExportFilename(mExportFormat);
     }
 
     /**
@@ -144,19 +131,10 @@ public void setExportTarget(ExportTarget mExportTarget) {
         this.mExportTarget = mExportTarget;
     }
 
-    /**
-     * Returns the internal target file path for the exported transactions.
-     * This file path is not accessible outside the context of the application
-     * @return String path to exported transactions
-     */
-    public String getInternalExportPath() {
-        return mTargetFilepath;
-    }
-
     @Override
     public String toString() {
-        return "Export " + mExportFormat.name() + " to " + mExportTarget.name() + " at "
-                + mTargetFilepath;
+        return "Export all transactions created since " + mExportStartTime.toString()
+                + " as "+ mExportFormat.name() + " to " + mExportTarget.name();
     }
 
     /**
diff --git a/app/src/main/java/org/gnucash/android/export/Exporter.java b/app/src/main/java/org/gnucash/android/export/Exporter.java
index bbbb7b46..9727f101 100644
--- a/app/src/main/java/org/gnucash/android/export/Exporter.java
+++ b/app/src/main/java/org/gnucash/android/export/Exporter.java
@@ -34,6 +34,7 @@
 import org.gnucash.android.db.SplitsDbAdapter;
 import org.gnucash.android.db.TransactionsDbAdapter;
 
+import java.io.File;
 import java.sql.Timestamp;
 import java.text.ParseException;
 import java.text.SimpleDateFormat;
@@ -72,7 +73,16 @@
     /**
      * Export options
      */
-    protected ExportParams mParameters;
+    protected ExportParams mExportParams;
+
+    /**
+     * Cache directory to which files will be first exported before moved to final destination.
+     * <p>There is a different cache dir per export format, which has the name of the export format.<br/>
+     *    The cache dir is cleared every time a new {@link Exporter} is instantiated.
+     *    The files created here are only accessible within this application, and should be copied to SD card before they can be shared
+     * </p>
+     */
+    protected File mCacheDir;
 
     private static final SimpleDateFormat EXPORT_FILENAME_DATE_FORMAT = new SimpleDateFormat("yyyyMMdd_HHmmss", Locale.US);
 
@@ -95,7 +105,7 @@
     protected Context mContext;
 
     public Exporter(ExportParams params, SQLiteDatabase db) {
-        this.mParameters = params;
+        this.mExportParams = params;
         mContext = GnuCashApplication.getAppContext();
         if (db == null) {
             mAccountsDbAdapter = AccountsDbAdapter.getInstance();
@@ -112,6 +122,10 @@ public Exporter(ExportParams params, SQLiteDatabase db) {
             mPricesDbAdapter = new PricesDbAdapter(db);
             mCommoditiesDbAdapter = new CommoditiesDbAdapter(db);
         }
+
+        mCacheDir = new File(mContext.getCacheDir(), params.getExportFormat().name());
+        mCacheDir.mkdir();
+        purgeDirectory(mCacheDir);
     }
 
     /**
@@ -151,6 +165,32 @@ public static long getExportTime(String filename){
     public abstract List<String> generateExport() throws ExporterException;
 
     /**
+     * Recursively delete all files in a directory
+     * @param directory File descriptor for directory
+     */
+    private void purgeDirectory(File directory){
+        for (File file : directory.listFiles()) {
+            if (file.isDirectory())
+                purgeDirectory(file);
+            else
+                file.delete();
+        }
+    }
+
+    /**
+     * Returns the path to the file where the exporter should save the export during generation
+     * <p>This path is a temporary cache file whose file extension matches the export format.<br>
+     *     This file is deleted every time a new export is started</p>
+     * @return Absolute path to file
+     */
+    protected String getExportCacheFilePath(){
+        String cachePath = mCacheDir.getAbsolutePath();
+        if (!cachePath.endsWith("/"))
+            cachePath += "/";
+        return cachePath + buildExportFilename(mExportParams.getExportFormat());
+    }
+
+    /**
      * Returns the MIME type for this exporter.
      * @return MIME type as string
      */
diff --git a/app/src/main/java/org/gnucash/android/export/ofx/OfxExporter.java b/app/src/main/java/org/gnucash/android/export/ofx/OfxExporter.java
index b116f34f..c29e426b 100644
--- a/app/src/main/java/org/gnucash/android/export/ofx/OfxExporter.java
+++ b/app/src/main/java/org/gnucash/android/export/ofx/OfxExporter.java
@@ -104,7 +104,7 @@ private void generateOfx(Document doc, Element parent){
 
 
 			//add account details (transactions) to the XML document			
-			account.toOfx(doc, statementTransactionResponse, mParameters.getExportStartTime());
+			account.toOfx(doc, statementTransactionResponse, mExportParams.getExportStartTime());
 			
 			//mark as exported
 			accountsDbAdapter.markAsExported(account.getUID());
@@ -114,7 +114,7 @@ private void generateOfx(Document doc, Element parent){
 
     // FIXME: Move code to generateExport()
     private String generateOfxExport() throws ExporterException {
-        mAccountsList = mAccountsDbAdapter.getExportableAccounts(mParameters.getExportStartTime());
+        mAccountsList = mAccountsDbAdapter.getExportableAccounts(mExportParams.getExportStartTime());
 
         DocumentBuilderFactory docFactory = DocumentBuilderFactory
                 .newInstance();
@@ -122,7 +122,7 @@ private String generateOfxExport() throws ExporterException {
         try {
             docBuilder = docFactory.newDocumentBuilder();
         } catch (ParserConfigurationException e) {
-            throw new ExporterException(mParameters, e);
+            throw new ExporterException(mExportParams, e);
         }
 
         Document document = docBuilder.newDocument();
@@ -158,23 +158,23 @@ private String generateOfxExport() throws ExporterException {
         BufferedWriter writer = null;
 
         try {
-            File file = new File(mParameters.getInternalExportPath());
+            File file = new File(getExportCacheFilePath());
             writer = new BufferedWriter(new OutputStreamWriter(new FileOutputStream(file), "UTF-8"));
             writer.write(generateOfxExport());
         } catch (IOException e) {
-            throw new ExporterException(mParameters, e);
+            throw new ExporterException(mExportParams, e);
         } finally {
             if (writer != null) {
                 try {
                     writer.close();
                 } catch (IOException e) {
-                    throw new ExporterException(mParameters, e);
+                    throw new ExporterException(mExportParams, e);
                 }
             }
         }
 
         List<String> exportedFiles = new ArrayList<>();
-        exportedFiles.add(mParameters.getInternalExportPath());
+        exportedFiles.add(getExportCacheFilePath());
 
         return exportedFiles;
     }
diff --git a/app/src/main/java/org/gnucash/android/export/qif/QifExporter.java b/app/src/main/java/org/gnucash/android/export/qif/QifExporter.java
index 1f3eb6aa..6c1fcfde 100644
--- a/app/src/main/java/org/gnucash/android/export/qif/QifExporter.java
+++ b/app/src/main/java/org/gnucash/android/export/qif/QifExporter.java
@@ -60,7 +60,7 @@ public QifExporter(ExportParams params){
         final String newLine = "\n";
         TransactionsDbAdapter transactionsDbAdapter = mTransactionsDbAdapter;
         try {
-            String lastExportTimeStamp = PreferenceManager.getDefaultSharedPreferences(mContext).getString(Exporter.PREF_LAST_EXPORT_TIME, Exporter.TIMESTAMP_ZERO);
+            String lastExportTimeStamp = mExportParams.getExportStartTime().toString();
             Cursor cursor = transactionsDbAdapter.fetchTransactionsWithSplitsWithTransactionAccount(
                     new String[]{
                             TransactionEntry.TABLE_NAME + "_" + TransactionEntry.COLUMN_UID + " AS trans_uid",
@@ -95,7 +95,7 @@ public QifExporter(ExportParams params){
                    "acct1_currency ASC, trans_time ASC, trans_uid ASC"
                     );
 
-            File file = new File(mParameters.getInternalExportPath());
+            File file = new File(getExportCacheFilePath());
             BufferedWriter writer = new BufferedWriter(new OutputStreamWriter(new FileOutputStream(file), "UTF-8"));
 
             try {
@@ -190,7 +190,7 @@ public QifExporter(ExportParams params){
                             precision = 3;
                             break;
                         default:
-                            throw new ExporterException(mParameters, "split quantity has illegal denominator: "+ quantity_denom);
+                            throw new ExporterException(mExportParams, "split quantity has illegal denominator: "+ quantity_denom);
                     }
                     Double quantity = 0.0;
                     if (quantity_denom != 0) {
@@ -220,7 +220,7 @@ public QifExporter(ExportParams params){
             PreferenceManager.getDefaultSharedPreferences(mContext).edit().putString(Exporter.PREF_LAST_EXPORT_TIME, timeStamp).apply();
             return splitQIF(file);
         } catch (IOException e) {
-            throw new ExporterException(mParameters, e);
+            throw new ExporterException(mExportParams, e);
         }
     }
 
diff --git a/app/src/main/java/org/gnucash/android/export/xml/GncXmlExporter.java b/app/src/main/java/org/gnucash/android/export/xml/GncXmlExporter.java
index b148e5a6..407d65ad 100644
--- a/app/src/main/java/org/gnucash/android/export/xml/GncXmlExporter.java
+++ b/app/src/main/java/org/gnucash/android/export/xml/GncXmlExporter.java
@@ -45,6 +45,7 @@
 import java.io.FileOutputStream;
 import java.io.IOException;
 import java.io.OutputStreamWriter;
+import java.io.Writer;
 import java.math.BigDecimal;
 import java.sql.Timestamp;
 import java.util.ArrayList;
@@ -696,16 +697,41 @@ private void exportPrices(XmlSerializer xmlSerializer) throws IOException {
     @Override
     public List<String> generateExport() throws ExporterException {
         OutputStreamWriter writer = null;
+        String outputFile = getExportCacheFilePath();
+        try {
+            FileOutputStream fileOutputStream = new FileOutputStream(outputFile);
+            BufferedOutputStream bufferedOutputStream = new BufferedOutputStream(fileOutputStream);
+            writer = new OutputStreamWriter(bufferedOutputStream);
+
+            generateExport(writer);
+        } catch (IOException ex){
+            Crashlytics.log("Error exporting XML");
+            Crashlytics.logException(ex);
+        } finally {
+            if (writer != null) {
+                try {
+                    writer.close();
+                } catch (IOException e) {
+                    throw new ExporterException(mExportParams, e);
+                }
+            }
+        }
+
+        List<String> exportedFiles = new ArrayList<>();
+        exportedFiles.add(outputFile);
+
+        return exportedFiles;
+    }
 
+    /**
+     * Generates an XML export of the database and writes it to the {@code writer} output stream
+     * @param writer Output stream
+     * @throws ExporterException
+     */
+    public void generateExport(Writer writer) throws ExporterException {
         try {
             String[] namespaces = new String[]{"gnc", "act", "book", "cd", "cmdty", "price", "slot",
                     "split", "trn", "ts", "sx", "recurrence"};
-            new File(BACKUP_FOLDER_PATH).mkdirs();
-            FileOutputStream fileOutputStream = new FileOutputStream(getBackupFilePath());
-            BufferedOutputStream bufferedOutputStream = new BufferedOutputStream(fileOutputStream);
-            GZIPOutputStream gzipOutputStream = new GZIPOutputStream(bufferedOutputStream);
-            writer = new OutputStreamWriter(gzipOutputStream);
-
             XmlSerializer xmlSerializer = XmlPullParserFactory.newInstance().newSerializer();
             xmlSerializer.setOutput(writer);
             xmlSerializer.startDocument("utf-8", true);
@@ -779,24 +805,11 @@ private void exportPrices(XmlSerializer xmlSerializer) throws IOException {
             xmlSerializer.endTag(null, GncXmlHelper.TAG_BOOK);
             xmlSerializer.endTag(null, GncXmlHelper.TAG_ROOT);
             xmlSerializer.endDocument();
+            xmlSerializer.flush();
         } catch (Exception e) {
             Crashlytics.logException(e);
-            throw new ExporterException(mParameters, e);
-        } finally {
-            if (writer != null) {
-                try {
-                    writer.close();
-                } catch (IOException e) {
-                    throw new ExporterException(mParameters, e);
-                }
-            }
+            throw new ExporterException(mExportParams, e);
         }
-
-        List<String> exportedFiles = new ArrayList<>();
-        // FIXME: this looks weird
-        exportedFiles.add(getBackupFilePath());
-
-        return exportedFiles;
     }
 
     /**
@@ -808,17 +821,23 @@ public String getExportMimeType(){
     }
 
     /**
-     * Creates a backup of current database contents to the default backup location
+     * Creates a backup of current database contents to the directory {@link Exporter#BACKUP_FOLDER_PATH}
      * @return {@code true} if backup was successful, {@code false} otherwise
      */
     public static boolean createBackup(){
-        ExportParams params = new ExportParams(ExportFormat.XML);
         try {
-            new GncXmlExporter(params).generateExport();
+            new File(BACKUP_FOLDER_PATH).mkdirs();
+            FileOutputStream fileOutputStream = new FileOutputStream(getBackupFilePath());
+            BufferedOutputStream bufferedOutputStream = new BufferedOutputStream(fileOutputStream);
+            GZIPOutputStream gzipOutputStream = new GZIPOutputStream(bufferedOutputStream);
+            OutputStreamWriter writer = new OutputStreamWriter(gzipOutputStream);
+
+            ExportParams params = new ExportParams(ExportFormat.XML);
+            new GncXmlExporter(params).generateExport(writer);
             return true;
-        } catch (ExporterException e) {
+        } catch (IOException | ExporterException e) {
             Crashlytics.logException(e);
-            Log.e("GncXmlExporter", "Error creating backup", e);
+            Log.e("GncXmlExporter", "Error creating XML  backup", e);
             return false;
         }
     }
diff --git a/app/src/test/java/org/gnucash/android/test/unit/export/BackupTest.java b/app/src/test/java/org/gnucash/android/test/unit/export/BackupTest.java
new file mode 100644
index 00000000..411299b5
--- /dev/null
+++ b/app/src/test/java/org/gnucash/android/test/unit/export/BackupTest.java
@@ -0,0 +1,66 @@
+/*
+ * Copyright (c) 2015 Ngewi Fet <ngewif@gmail.com>
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.gnucash.android.test.unit.export;
+
+import org.gnucash.android.BuildConfig;
+import org.gnucash.android.export.ExportFormat;
+import org.gnucash.android.export.ExportParams;
+import org.gnucash.android.export.Exporter;
+import org.gnucash.android.export.xml.GncXmlExporter;
+import org.gnucash.android.test.unit.db.AccountsDbAdapterTest;
+import org.gnucash.android.test.unit.util.GnucashTestRunner;
+import org.gnucash.android.test.unit.util.ShadowCrashlytics;
+import org.gnucash.android.test.unit.util.ShadowUserVoice;
+import org.junit.Before;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+import org.robolectric.annotation.Config;
+
+import java.io.File;
+import java.util.List;
+
+import static org.assertj.core.api.Assertions.assertThat;
+
+/**
+ * Test backup and restore functionality
+ */
+@RunWith(GnucashTestRunner.class)
+@Config(constants = BuildConfig.class, sdk = 21, packageName = "org.gnucash.android", shadows = {ShadowCrashlytics.class, ShadowUserVoice.class})
+public class BackupTest {
+
+    @Before
+    public void setUp(){
+        AccountsDbAdapterTest.loadDefaultAccounts();
+    }
+
+    @Test
+    public void shouldCreateBackup(){
+        boolean backupResult = GncXmlExporter.createBackup();
+        assertThat(backupResult).isTrue();
+    }
+
+    @Test
+    public void shouldCreateBackupFileName(){
+        Exporter exporter = new GncXmlExporter(new ExportParams(ExportFormat.XML));
+        List<String> xmlFiles = exporter.generateExport();
+
+        assertThat(xmlFiles).hasSize(1);
+        assertThat(new File(xmlFiles.get(0)))
+                .exists()
+                .hasExtension(ExportFormat.XML.getExtension().substring(1));
+
+    }
+}
diff --git a/app/src/test/java/org/gnucash/android/test/unit/export/GncXmlHelperTest.java b/app/src/test/java/org/gnucash/android/test/unit/export/GncXmlHelperTest.java
index 0e4c811f..320b218b 100644
--- a/app/src/test/java/org/gnucash/android/test/unit/export/GncXmlHelperTest.java
+++ b/app/src/test/java/org/gnucash/android/test/unit/export/GncXmlHelperTest.java
@@ -1,3 +1,19 @@
+/*
+ * Copyright (c) 2014 - 2015 Ngewi Fet <ngewif@gmail.com>
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
 package org.gnucash.android.test.unit.export;
 
 import org.gnucash.android.export.xml.GncXmlHelper;

From c533d276018910682abca08ed4f4e5391dbc5792 Mon Sep 17 00:00:00 2001
From: Ngewi Fet <ngewif@gmail.com>
Date: Mon, 16 Nov 2015 14:12:33 +0100
Subject: [PATCH 20/25] Improve formatting of money amounts

Sort currencies alphabetically in settings
Fixes #40
---
 .../gnucash/android/app/GnuCashApplication.java    |   3 +-
 .../main/java/org/gnucash/android/model/Money.java |   8 +-
 .../android/ui/account/AccountFormFragment.java    |   1 -
 .../android/ui/account/AccountsActivity.java       |   1 +
 .../ui/settings/AccountPreferencesFragment.java    |  36 +-
 .../android/ui/settings/SettingsActivity.java      |  33 +-
 .../android/ui/wizard/FirstRunWizardActivity.java  |   3 +-
 app/src/main/res/values-af-rZA/strings.xml         | 177 -------
 app/src/main/res/values-ar-rSA/strings.xml         | 177 -------
 app/src/main/res/values-ca-rES/strings.xml         | 177 -------
 app/src/main/res/values-cs-rCZ/strings.xml         | 177 -------
 app/src/main/res/values-da-rDK/strings.xml         | 579 ---------------------
 app/src/main/res/values-de/strings.xml             | 177 -------
 app/src/main/res/values-el-rGR/strings.xml         | 177 -------
 app/src/main/res/values-en-rGB/strings.xml         | 177 -------
 app/src/main/res/values-es-rMX/strings.xml         | 177 -------
 app/src/main/res/values-es/strings.xml             | 177 -------
 app/src/main/res/values-fi-rFI/strings.xml         | 177 -------
 app/src/main/res/values-fr/strings.xml             | 177 -------
 app/src/main/res/values-hu-rHU/strings.xml         | 177 -------
 app/src/main/res/values-it-rIT/strings.xml         | 177 -------
 app/src/main/res/values-iw-rIL/strings.xml         | 177 -------
 app/src/main/res/values-ja-rJP/strings.xml         | 177 -------
 app/src/main/res/values-ko-rKR/strings.xml         | 177 -------
 app/src/main/res/values-nb/strings.xml             | 177 -------
 app/src/main/res/values-nl-rNL/strings.xml         | 177 -------
 app/src/main/res/values-no-rNO/strings.xml         | 177 -------
 app/src/main/res/values-pl-rPL/strings.xml         | 177 -------
 app/src/main/res/values-pt-rBR/strings.xml         | 177 -------
 app/src/main/res/values-pt-rPT/strings.xml         | 177 -------
 app/src/main/res/values-ro-rRO/strings.xml         | 177 -------
 app/src/main/res/values-ru/strings.xml             | 177 -------
 app/src/main/res/values-sr-rSP/strings.xml         | 177 -------
 app/src/main/res/values-sv-rSE/strings.xml         | 177 -------
 app/src/main/res/values-tr-rTR/strings.xml         | 177 -------
 app/src/main/res/values-uk-rUA/strings.xml         | 177 -------
 app/src/main/res/values-vi-rVN/strings.xml         | 177 -------
 app/src/main/res/values-zh-rCN/strings.xml         | 177 -------
 app/src/main/res/values-zh-rTW/strings.xml         | 177 -------
 app/src/main/res/values/strings.xml                | 177 -------
 .../res/xml-v11/fragment_account_preferences.xml   |   2 +-
 .../main/res/xml/fragment_account_preferences.xml  |   2 +-
 42 files changed, 73 insertions(+), 6259 deletions(-)
 delete mode 100644 app/src/main/res/values-da-rDK/strings.xml

diff --git a/app/src/main/java/org/gnucash/android/app/GnuCashApplication.java b/app/src/main/java/org/gnucash/android/app/GnuCashApplication.java
index 0b86856a..8e998563 100644
--- a/app/src/main/java/org/gnucash/android/app/GnuCashApplication.java
+++ b/app/src/main/java/org/gnucash/android/app/GnuCashApplication.java
@@ -25,6 +25,7 @@
 import android.database.sqlite.SQLiteDatabase;
 import android.graphics.Color;
 import android.preference.PreferenceManager;
+import android.support.annotation.NonNull;
 import android.util.Log;
 
 import com.crashlytics.android.Crashlytics;
@@ -226,7 +227,7 @@ public static String getDefaultCurrencyCode(){
      * @param currencyCode ISO 4217 currency code
      * @see #getDefaultCurrencyCode()
      */
-    public static void setDefaultCurrencyCode(String currencyCode){
+    public static void setDefaultCurrencyCode(@NonNull String currencyCode){
         PreferenceManager.getDefaultSharedPreferences(getAppContext()).edit()
                 .putString(getAppContext().getString(R.string.key_default_currency), currencyCode)
                 .apply();
diff --git a/app/src/main/java/org/gnucash/android/model/Money.java b/app/src/main/java/org/gnucash/android/model/Money.java
index a69f8435..02c6930c 100644
--- a/app/src/main/java/org/gnucash/android/model/Money.java
+++ b/app/src/main/java/org/gnucash/android/model/Money.java
@@ -279,8 +279,7 @@ public String asString(){
 	 * @return String containing formatted Money representation
 	 */
     public String formattedString(Locale locale){
-/*
-//todo: enable this code for 2.1 release. Test better too
+
 		NumberFormat currencyFormat = NumberFormat.getCurrencyInstance(locale);
 		Currency currency = Currency.getInstance(mCommodity.getCurrencyCode());
 
@@ -299,13 +298,14 @@ public String formattedString(Locale locale){
 		currencyFormat.setMaximumFractionDigits(mCommodity.getSmallestFractionDigits());
 
 		return currencyFormat.format(asDouble());
-*/
-
+/*
+// 	old currency formatting code
 		NumberFormat formatter = NumberFormat.getInstance(locale);
 		formatter.setMinimumFractionDigits(mCommodity.getSmallestFractionDigits());
 		formatter.setMaximumFractionDigits(mCommodity.getSmallestFractionDigits());
 		Currency currency = Currency.getInstance(mCommodity.getCurrencyCode());
 		return formatter.format(asDouble()) + " " + currency.getSymbol(locale);
+*/
 	}
 
     /**
diff --git a/app/src/main/java/org/gnucash/android/ui/account/AccountFormFragment.java b/app/src/main/java/org/gnucash/android/ui/account/AccountFormFragment.java
index 0108312f..b83b0288 100644
--- a/app/src/main/java/org/gnucash/android/ui/account/AccountFormFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/account/AccountFormFragment.java
@@ -328,7 +328,6 @@ public void onClick(View view) {
 	public void onActivityCreated(Bundle savedInstanceState) {
 		super.onActivityCreated(savedInstanceState);
 
-        Cursor cursor = CommoditiesDbAdapter.getInstance().fetchAllRecords();
         CommoditiesCursorAdapter commoditiesAdapter = new CommoditiesCursorAdapter(
                 getActivity(), android.R.layout.simple_spinner_item);
         commoditiesAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
diff --git a/app/src/main/java/org/gnucash/android/ui/account/AccountsActivity.java b/app/src/main/java/org/gnucash/android/ui/account/AccountsActivity.java
index b80d835c..9bca152c 100644
--- a/app/src/main/java/org/gnucash/android/ui/account/AccountsActivity.java
+++ b/app/src/main/java/org/gnucash/android/ui/account/AccountsActivity.java
@@ -491,6 +491,7 @@ public static void createDefaultAccounts(final String currencyCode, final Activi
                 @Override
                 public void onTaskComplete() {
                     AccountsDbAdapter.getInstance().updateAllAccounts(DatabaseSchema.AccountEntry.COLUMN_CURRENCY, currencyCode);
+                    GnuCashApplication.setDefaultCurrencyCode(currencyCode);
                 }
             };
         }
diff --git a/app/src/main/java/org/gnucash/android/ui/settings/AccountPreferencesFragment.java b/app/src/main/java/org/gnucash/android/ui/settings/AccountPreferencesFragment.java
index 91ffd196..5242df81 100644
--- a/app/src/main/java/org/gnucash/android/ui/settings/AccountPreferencesFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/settings/AccountPreferencesFragment.java
@@ -20,16 +20,24 @@
 import android.app.Activity;
 import android.app.AlertDialog;
 import android.content.DialogInterface;
+import android.database.Cursor;
 import android.os.Bundle;
+import android.preference.ListPreference;
 import android.preference.Preference;
 import android.preference.PreferenceFragment;
 import android.support.v7.app.ActionBar;
 
 import org.gnucash.android.R;
 import org.gnucash.android.app.GnuCashApplication;
+import org.gnucash.android.db.CommoditiesDbAdapter;
+import org.gnucash.android.db.DatabaseSchema;
+import org.gnucash.android.model.Commodity;
 import org.gnucash.android.model.Money;
 import org.gnucash.android.ui.account.AccountsActivity;
 
+import java.util.ArrayList;
+import java.util.List;
+
 /**
  * Account settings fragment inside the Settings activity
  *
@@ -39,7 +47,10 @@
 @TargetApi(11)
 public class AccountPreferencesFragment extends PreferenceFragment {
 
-    private Activity activity;
+    private Activity mActivity;
+
+    List<CharSequence> mCurrencyEntries = new ArrayList<>();
+    List<CharSequence> mCurrencyEntryValues = new ArrayList<>();
 
     @Override
     public void onCreate(Bundle savedInstanceState) {
@@ -51,7 +62,16 @@ public void onCreate(Bundle savedInstanceState) {
         actionBar.setDisplayHomeAsUpEnabled(true);
         actionBar.setTitle(R.string.title_account_preferences);
 
-        activity = getActivity();
+        mActivity = getActivity();
+
+        Cursor cursor = CommoditiesDbAdapter.getInstance().fetchAllRecords(DatabaseSchema.CommodityEntry.COLUMN_MNEMONIC + " ASC");
+        while(cursor.moveToNext()){
+            String code = cursor.getString(cursor.getColumnIndexOrThrow(DatabaseSchema.CommodityEntry.COLUMN_MNEMONIC));
+            String name = cursor.getString(cursor.getColumnIndexOrThrow(DatabaseSchema.CommodityEntry.COLUMN_FULLNAME));
+            mCurrencyEntries.add(code + " - " + name);
+            mCurrencyEntryValues.add(code);
+        }
+        cursor.close();
     }
 
     @Override
@@ -60,8 +80,14 @@ public void onResume() {
 
         String defaultCurrency = GnuCashApplication.getDefaultCurrencyCode();
         Preference pref = findPreference(getString(R.string.key_default_currency));
-        pref.setSummary(defaultCurrency);
-        pref.setOnPreferenceChangeListener((SettingsActivity)getActivity());
+        String currencyName = CommoditiesDbAdapter.getInstance().getCommodity(defaultCurrency).getFullname();
+        pref.setSummary(currencyName);
+        pref.setOnPreferenceChangeListener((SettingsActivity) getActivity());
+
+        CharSequence[] entries = new CharSequence[mCurrencyEntries.size()];
+        CharSequence[] entryValues = new CharSequence[mCurrencyEntryValues.size()];
+        ((ListPreference) pref).setEntries(mCurrencyEntries.toArray(entries));
+        ((ListPreference) pref).setEntryValues(mCurrencyEntryValues.toArray(entryValues));
 
         Preference preference = findPreference(getString(R.string.key_import_accounts));
         preference.setOnPreferenceClickListener((SettingsActivity)getActivity());
@@ -86,7 +112,7 @@ public boolean onPreferenceClick(Preference preference) {
                         .setPositiveButton(R.string.btn_create_accounts, new DialogInterface.OnClickListener() {
                             @Override
                             public void onClick(DialogInterface dialogInterface, int i) {
-                                AccountsActivity.createDefaultAccounts(Money.DEFAULT_CURRENCY_CODE, activity);
+                                AccountsActivity.createDefaultAccounts(Money.DEFAULT_CURRENCY_CODE, mActivity);
                             }
                         })
                         .setNegativeButton(R.string.btn_cancel, new DialogInterface.OnClickListener() {
diff --git a/app/src/main/java/org/gnucash/android/ui/settings/SettingsActivity.java b/app/src/main/java/org/gnucash/android/ui/settings/SettingsActivity.java
index 84eb810a..21dc8fcc 100644
--- a/app/src/main/java/org/gnucash/android/ui/settings/SettingsActivity.java
+++ b/app/src/main/java/org/gnucash/android/ui/settings/SettingsActivity.java
@@ -26,9 +26,11 @@
 import android.content.Intent;
 import android.content.IntentSender;
 import android.content.SharedPreferences;
+import android.database.Cursor;
 import android.os.Build;
 import android.os.Bundle;
 import android.preference.CheckBoxPreference;
+import android.preference.ListPreference;
 import android.preference.Preference;
 import android.preference.Preference.OnPreferenceChangeListener;
 import android.preference.PreferenceManager;
@@ -51,6 +53,7 @@
 import org.gnucash.android.R;
 import org.gnucash.android.app.GnuCashApplication;
 import org.gnucash.android.db.AccountsDbAdapter;
+import org.gnucash.android.db.CommoditiesDbAdapter;
 import org.gnucash.android.db.DatabaseSchema;
 import org.gnucash.android.db.TransactionsDbAdapter;
 import org.gnucash.android.export.Exporter;
@@ -248,7 +251,8 @@ public boolean onOptionsItemSelected(MenuItem item) {
  	public boolean onPreferenceChange(Preference preference, Object newValue) {
 		if (preference.getKey().equals(getString(R.string.key_default_currency))){
 			GnuCashApplication.setDefaultCurrencyCode(newValue.toString());
-            preference.setSummary(newValue.toString());
+            String fullname = CommoditiesDbAdapter.getInstance().getCommodity(newValue.toString()).getFullname();
+            preference.setSummary(fullname);
 		} else if (preference.getKey().equals(getString(R.string.key_enable_passcode))) {
             if ((Boolean) newValue) {
                 startActivityForResult(new Intent(this, PasscodePreferenceActivity.class),
@@ -274,6 +278,10 @@ protected boolean isValidFragment(String fragmentName) {
                 || AboutPreferenceFragment.class.getName().equals(fragmentName);
     }
 
+    /**
+     * Hide all imbalance accounts when double-entry mode is disabled
+     * @param useDoubleEntry flag if double entry is enabled or not
+     */
     public void setImbalanceAccountsHidden(boolean useDoubleEntry) {
         String isHidden = useDoubleEntry ? "0" : "1";
         AccountsDbAdapter accountsDbAdapter = AccountsDbAdapter.getInstance();
@@ -286,11 +294,34 @@ public void setImbalanceAccountsHidden(boolean useDoubleEntry) {
         }
     }
 
+    /**
+     * Load the commodities from the database and set the options on the list preference
+     * Also sets this activity as a listener for preference changes
+     */
     private void setDefaultCurrencyListener() {
+        CommoditiesDbAdapter commoditiesDbAdapter = CommoditiesDbAdapter.getInstance();
+        List<CharSequence> currencyEntries = new ArrayList<>((int)commoditiesDbAdapter.getRecordsCount());
+        List<CharSequence> currencyEntryValues = new ArrayList<>((int)commoditiesDbAdapter.getRecordsCount());
+        Cursor cursor = commoditiesDbAdapter.fetchAllRecords(DatabaseSchema.CommodityEntry.COLUMN_MNEMONIC + " ASC");
+        while(cursor.moveToNext()){
+            String code = cursor.getString(cursor.getColumnIndexOrThrow(DatabaseSchema.CommodityEntry.COLUMN_MNEMONIC));
+            String name = cursor.getString(cursor.getColumnIndexOrThrow(DatabaseSchema.CommodityEntry.COLUMN_FULLNAME));
+
+            currencyEntries.add(code + " - " + name);
+            currencyEntryValues.add(code);
+        }
+        cursor.close();
+
+        CharSequence[] entries = new CharSequence[currencyEntries.size()];
+        CharSequence[] entryValues = new CharSequence[currencyEntryValues.size()];
+
 		@SuppressWarnings("deprecation")
 		Preference pref = findPreference(getString(R.string.key_default_currency));
 		pref.setSummary(GnuCashApplication.getDefaultCurrencyCode());
 		pref.setOnPreferenceChangeListener(this);
+
+        ((ListPreference) pref).setEntries(currencyEntries.toArray(entries));
+        ((ListPreference) pref).setEntryValues(currencyEntryValues.toArray(entryValues));
 	}
 
     @Override
diff --git a/app/src/main/java/org/gnucash/android/ui/wizard/FirstRunWizardActivity.java b/app/src/main/java/org/gnucash/android/ui/wizard/FirstRunWizardActivity.java
index 83c27400..850d8032 100644
--- a/app/src/main/java/org/gnucash/android/ui/wizard/FirstRunWizardActivity.java
+++ b/app/src/main/java/org/gnucash/android/ui/wizard/FirstRunWizardActivity.java
@@ -154,10 +154,9 @@ public void onClick(View view) {
                         }
                     }
 
+                    GnuCashApplication.setDefaultCurrencyCode(mCurrencyCode);
                     SharedPreferences preferences = PreferenceManager.getDefaultSharedPreferences(FirstRunWizardActivity.this);
                     SharedPreferences.Editor preferenceEditor = preferences.edit();
-                    preferenceEditor.putString(getString(R.string.key_default_currency), mCurrencyCode);
-
 
                     if (feedbackOption.equals(getString(R.string.wizard_option_auto_send_crash_reports))){
                         preferenceEditor.putBoolean(getString(R.string.key_enable_crashlytics), true);
diff --git a/app/src/main/res/values-af-rZA/strings.xml b/app/src/main/res/values-af-rZA/strings.xml
index c68c7e3c..54aa639b 100644
--- a/app/src/main/res/values-af-rZA/strings.xml
+++ b/app/src/main/res/values-af-rZA/strings.xml
@@ -85,183 +85,6 @@
   <string name="label_display_account">Display account</string>
   <string name="btn_create_accounts">Create Accounts</string>
   <string name="title_default_accounts">Select accounts to create</string>
-  <string-array name="currency_names">
-    <item>Afghani</item>
-    <item>Algerian Dinar</item>
-    <item>Argentine Peso</item>
-    <item>Armenian Dram</item>
-    <item>Aruban Florin</item>
-    <item>Australian Dollar</item>
-    <item>Azerbaijanian Manat</item>
-    <item>Bahamian Dollar</item>
-    <item>Bahraini Dinar</item>
-    <item>Baht</item>
-    <item>Balboa</item>
-    <item>Barbados Dollar</item>
-    <item>Belarussian Ruble</item>
-    <item>Belize Dollar</item>
-    <item>Bermudian Dollar</item>
-    <item>Bolivar Fuerte</item>
-    <item>Boliviano</item>
-    <item>Brazilian Real</item>
-    <item>Brunei Dollar</item>
-    <item>Bulgarian Lev</item>
-    <item>Burundi Franc</item>
-    <item>Canadian Dollar</item>
-    <item>Cape Verde Escudo</item>
-    <item>Cayman Islands Dollar</item>
-    <item>CFA Franc BCEAO</item>
-    <item>CFA Franc BEAC</item>
-    <item>CFP Franc</item>
-    <item>Chilean Peso</item>
-    <item>Testing currency</item>
-    <item>Colombian Peso</item>
-    <item>Comoro Franc</item>
-    <item>Congolese Franc</item>
-    <item>Convertible Mark</item>
-    <item>Cordoba Oro</item>
-    <item>Costa Rican Colon</item>
-    <item>Croatian Kuna</item>
-    <item>Cuban Convertible Peso</item>
-    <item>Cuban Peso</item>
-    <item>Czech Koruna</item>
-    <item>Dalasi</item>
-    <item>Danish Krone</item>
-    <item>Denar</item>
-    <item>Djibouti Franc</item>
-    <item>Dobra</item>
-    <item>Dominican Peso</item>
-    <item>Dong</item>
-    <item>East Caribbean Dollar</item>
-    <item>Egyptian Pound</item>
-    <item>El Salvador Colon</item>
-    <item>Ethiopian Birr</item>
-    <item>Euro</item>
-    <item>Falkland Islands Pound</item>
-    <item>Fiji Dollar</item>
-    <item>Forint</item>
-    <item>Ghana Cedi</item>
-    <item>Gibraltar Pound</item>
-    <item>Gold</item>
-    <item>Gourde</item>
-    <item>Guarani</item>
-    <item>Guinea Franc</item>
-    <item>Guyana Dollar</item>
-    <item>Hong Kong Dollar</item>
-    <item>Hryvnia</item>
-    <item>Iceland Krona</item>
-    <item>Indian Rupee</item>
-    <item>Iranian Rial</item>
-    <item>Iraqi Dinar</item>
-    <item>Jamaican Dollar</item>
-    <item>Jordanian Dinar</item>
-    <item>Kenyan Shilling</item>
-    <item>Kina</item>
-    <item>Kip</item>
-    <item>Kuwaiti Dinar</item>
-    <item>Kwacha</item>
-    <item>Kwanza</item>
-    <item>Kyat</item>
-    <item>Lari</item>
-    <item>Latvian Lats</item>
-    <item>Lebanese Pound</item>
-    <item>Lek</item>
-    <item>Lempira</item>
-    <item>Leone</item>
-    <item>Liberian Dollar</item>
-    <item>Libyan Dinar</item>
-    <item>Lilangeni</item>
-    <item>Lithuanian Litas</item>
-    <item>Loti</item>
-    <item>Malagasy Ariary</item>
-    <item>Malaysian Ringgit</item>
-    <item>Mauritius Rupee</item>
-    <item>Mexican Peso</item>
-    <item>Mexican Unidad de Inversion (UDI)</item>
-    <item>Moldovan Leu</item>
-    <item>Moroccan Dirham</item>
-    <item>Mozambique Metical</item>
-    <item>Mvdol</item>
-    <item>Naira</item>
-    <item>Nakfa</item>
-    <item>Namibia Dollar</item>
-    <item>Nepalese Rupee</item>
-    <item>Netherlands Antillean Guilder</item>
-    <item>New Israeli Sheqel</item>
-    <item>New Romanian Leu</item>
-    <item>New Taiwan Dollar</item>
-    <item>New Zealand Dollar</item>
-    <item>Ngultrum</item>
-    <item>North Korean Won</item>
-    <item>Norwegian Krone</item>
-    <item>Nuevo Sol</item>
-    <item>Ouguiya</item>
-    <item>Paanga</item>
-    <item>Pakistan Rupee</item>
-    <item>Palladium</item>
-    <item>Pataca</item>
-    <item>Philippine Peso</item>
-    <item>Platinum</item>
-    <item>Pound Sterling</item>
-    <item>Pula</item>
-    <item>Qatari Rial</item>
-    <item>Quetzal</item>
-    <item>Rand</item>
-    <item>Rial Omani</item>
-    <item>Riel</item>
-    <item>Rufiyaa</item>
-    <item>Rupiah</item>
-    <item>Russian Ruble</item>
-    <item>Rwanda Franc</item>
-    <item>Saint Helena Pound</item>
-    <item>Saudi Riyal</item>
-    <item>SDR (Special Drawing Right)</item>
-    <item>Serbian Dinar</item>
-    <item>Seychelles Rupee</item>
-    <item>Silver</item>
-    <item>Singapore Dollar</item>
-    <item>Solomon Islands Dollar</item>
-    <item>Som</item>
-    <item>Somali Shilling</item>
-    <item>Somoni</item>
-    <item>South Sudanese Pound</item>
-    <item>Sri Lanka Rupee</item>
-    <item>Sucre</item>
-    <item>Sudanese Pound</item>
-    <item>Surinam Dollar</item>
-    <item>Swedish Krona</item>
-    <item>Swiss Franc</item>
-    <item>Syrian Pound</item>
-    <item>Taka</item>
-    <item>Tala</item>
-    <item>Tanzanian Shilling</item>
-    <item>Tenge</item>
-    <item>No currency</item>
-    <item>Trinidad and Tobago Dollar</item>
-    <item>Tugrik</item>
-    <item>Tunisian Dinar</item>
-    <item>Turkish Lira</item>
-    <item>Turkmenistan New Manat</item>
-    <item>UAE Dirham</item>
-    <item>Uganda Shilling</item>
-    <item>UIC-Franc</item>
-    <item>Unidad de Valor Real</item>
-    <item>Unidades de fomento</item>
-    <item>Uruguay Peso en Unidades Indexadas (URUIURUI)</item>
-    <item>Uruguayan peso</item>
-    <item>US Dollar</item>
-    <item>Uzbekistan Sum</item>
-    <item>Vatu</item>
-    <item>WIR Euro</item>
-    <item>WIR Franc</item>
-    <item>Won</item>
-    <item>Yemeni Rial</item>
-    <item>Yen</item>
-    <item>Yuan Renminbi</item>
-    <item>Zambian Kwacha</item>
-    <item>Zimbabwe Dollar</item>
-    <item>Zloty</item>
-  </string-array>
   <string name="error_no_accounts">No accounts exist in GnuCash.\nCreate an account before adding a widget</string>
   <string name="title_build_version">Build version</string>
   <string name="title_license">License</string>
diff --git a/app/src/main/res/values-ar-rSA/strings.xml b/app/src/main/res/values-ar-rSA/strings.xml
index a20a0ecc..107153ca 100644
--- a/app/src/main/res/values-ar-rSA/strings.xml
+++ b/app/src/main/res/values-ar-rSA/strings.xml
@@ -85,183 +85,6 @@
   <string name="label_display_account">Display account</string>
   <string name="btn_create_accounts">Create Accounts</string>
   <string name="title_default_accounts">Select accounts to create</string>
-  <string-array name="currency_names">
-    <item>Afghani</item>
-    <item>Algerian Dinar</item>
-    <item>Argentine Peso</item>
-    <item>Armenian Dram</item>
-    <item>Aruban Florin</item>
-    <item>Australian Dollar</item>
-    <item>Azerbaijanian Manat</item>
-    <item>Bahamian Dollar</item>
-    <item>Bahraini Dinar</item>
-    <item>Baht</item>
-    <item>Balboa</item>
-    <item>Barbados Dollar</item>
-    <item>Belarussian Ruble</item>
-    <item>Belize Dollar</item>
-    <item>Bermudian Dollar</item>
-    <item>Bolivar Fuerte</item>
-    <item>Boliviano</item>
-    <item>Brazilian Real</item>
-    <item>Brunei Dollar</item>
-    <item>Bulgarian Lev</item>
-    <item>Burundi Franc</item>
-    <item>Canadian Dollar</item>
-    <item>Cape Verde Escudo</item>
-    <item>Cayman Islands Dollar</item>
-    <item>CFA Franc BCEAO</item>
-    <item>CFA Franc BEAC</item>
-    <item>CFP Franc</item>
-    <item>Chilean Peso</item>
-    <item>Testing currency</item>
-    <item>Colombian Peso</item>
-    <item>Comoro Franc</item>
-    <item>Congolese Franc</item>
-    <item>Convertible Mark</item>
-    <item>Cordoba Oro</item>
-    <item>Costa Rican Colon</item>
-    <item>Croatian Kuna</item>
-    <item>Cuban Convertible Peso</item>
-    <item>Cuban Peso</item>
-    <item>Czech Koruna</item>
-    <item>Dalasi</item>
-    <item>Danish Krone</item>
-    <item>Denar</item>
-    <item>Djibouti Franc</item>
-    <item>Dobra</item>
-    <item>Dominican Peso</item>
-    <item>Dong</item>
-    <item>East Caribbean Dollar</item>
-    <item>Egyptian Pound</item>
-    <item>El Salvador Colon</item>
-    <item>Ethiopian Birr</item>
-    <item>Euro</item>
-    <item>Falkland Islands Pound</item>
-    <item>Fiji Dollar</item>
-    <item>Forint</item>
-    <item>Ghana Cedi</item>
-    <item>Gibraltar Pound</item>
-    <item>Gold</item>
-    <item>Gourde</item>
-    <item>Guarani</item>
-    <item>Guinea Franc</item>
-    <item>Guyana Dollar</item>
-    <item>Hong Kong Dollar</item>
-    <item>Hryvnia</item>
-    <item>Iceland Krona</item>
-    <item>Indian Rupee</item>
-    <item>Iranian Rial</item>
-    <item>Iraqi Dinar</item>
-    <item>Jamaican Dollar</item>
-    <item>Jordanian Dinar</item>
-    <item>Kenyan Shilling</item>
-    <item>Kina</item>
-    <item>Kip</item>
-    <item>Kuwaiti Dinar</item>
-    <item>Kwacha</item>
-    <item>Kwanza</item>
-    <item>Kyat</item>
-    <item>Lari</item>
-    <item>Latvian Lats</item>
-    <item>Lebanese Pound</item>
-    <item>Lek</item>
-    <item>Lempira</item>
-    <item>Leone</item>
-    <item>Liberian Dollar</item>
-    <item>Libyan Dinar</item>
-    <item>Lilangeni</item>
-    <item>Lithuanian Litas</item>
-    <item>Loti</item>
-    <item>Malagasy Ariary</item>
-    <item>Malaysian Ringgit</item>
-    <item>Mauritius Rupee</item>
-    <item>Mexican Peso</item>
-    <item>Mexican Unidad de Inversion (UDI)</item>
-    <item>Moldovan Leu</item>
-    <item>Moroccan Dirham</item>
-    <item>Mozambique Metical</item>
-    <item>Mvdol</item>
-    <item>Naira</item>
-    <item>Nakfa</item>
-    <item>Namibia Dollar</item>
-    <item>Nepalese Rupee</item>
-    <item>Netherlands Antillean Guilder</item>
-    <item>New Israeli Sheqel</item>
-    <item>New Romanian Leu</item>
-    <item>New Taiwan Dollar</item>
-    <item>New Zealand Dollar</item>
-    <item>Ngultrum</item>
-    <item>North Korean Won</item>
-    <item>Norwegian Krone</item>
-    <item>Nuevo Sol</item>
-    <item>Ouguiya</item>
-    <item>Paanga</item>
-    <item>Pakistan Rupee</item>
-    <item>Palladium</item>
-    <item>Pataca</item>
-    <item>Philippine Peso</item>
-    <item>Platinum</item>
-    <item>Pound Sterling</item>
-    <item>Pula</item>
-    <item>Qatari Rial</item>
-    <item>Quetzal</item>
-    <item>Rand</item>
-    <item>Rial Omani</item>
-    <item>Riel</item>
-    <item>Rufiyaa</item>
-    <item>Rupiah</item>
-    <item>Russian Ruble</item>
-    <item>Rwanda Franc</item>
-    <item>Saint Helena Pound</item>
-    <item>Saudi Riyal</item>
-    <item>SDR (Special Drawing Right)</item>
-    <item>Serbian Dinar</item>
-    <item>Seychelles Rupee</item>
-    <item>Silver</item>
-    <item>Singapore Dollar</item>
-    <item>Solomon Islands Dollar</item>
-    <item>Som</item>
-    <item>Somali Shilling</item>
-    <item>Somoni</item>
-    <item>South Sudanese Pound</item>
-    <item>Sri Lanka Rupee</item>
-    <item>Sucre</item>
-    <item>Sudanese Pound</item>
-    <item>Surinam Dollar</item>
-    <item>Swedish Krona</item>
-    <item>Swiss Franc</item>
-    <item>Syrian Pound</item>
-    <item>Taka</item>
-    <item>Tala</item>
-    <item>Tanzanian Shilling</item>
-    <item>Tenge</item>
-    <item>No currency</item>
-    <item>Trinidad and Tobago Dollar</item>
-    <item>Tugrik</item>
-    <item>Tunisian Dinar</item>
-    <item>Turkish Lira</item>
-    <item>Turkmenistan New Manat</item>
-    <item>UAE Dirham</item>
-    <item>Uganda Shilling</item>
-    <item>UIC-Franc</item>
-    <item>Unidad de Valor Real</item>
-    <item>Unidades de fomento</item>
-    <item>Uruguay Peso en Unidades Indexadas (URUIURUI)</item>
-    <item>Uruguayan peso</item>
-    <item>US Dollar</item>
-    <item>Uzbekistan Sum</item>
-    <item>Vatu</item>
-    <item>WIR Euro</item>
-    <item>WIR Franc</item>
-    <item>Won</item>
-    <item>Yemeni Rial</item>
-    <item>Yen</item>
-    <item>Yuan Renminbi</item>
-    <item>Zambian Kwacha</item>
-    <item>Zimbabwe Dollar</item>
-    <item>Zloty</item>
-  </string-array>
   <string name="error_no_accounts">No accounts exist in GnuCash.\nCreate an account before adding a widget</string>
   <string name="title_build_version">Build version</string>
   <string name="title_license">License</string>
diff --git a/app/src/main/res/values-ca-rES/strings.xml b/app/src/main/res/values-ca-rES/strings.xml
index 37298124..7b935d0b 100644
--- a/app/src/main/res/values-ca-rES/strings.xml
+++ b/app/src/main/res/values-ca-rES/strings.xml
@@ -85,183 +85,6 @@
   <string name="label_display_account">Display account</string>
   <string name="btn_create_accounts">Crea els comptes</string>
   <string name="title_default_accounts">Seleccioneu els comptes a crear</string>
-  <string-array name="currency_names">
-    <item>Afghani</item>
-    <item>Algerian Dinar</item>
-    <item>Argentine Peso</item>
-    <item>Armenian Dram</item>
-    <item>Aruban Florin</item>
-    <item>Australian Dollar</item>
-    <item>Azerbaijanian Manat</item>
-    <item>Bahamian Dollar</item>
-    <item>Bahraini Dinar</item>
-    <item>Baht</item>
-    <item>Balboa</item>
-    <item>Barbados Dollar</item>
-    <item>Belarussian Ruble</item>
-    <item>Belize Dollar</item>
-    <item>Bermudian Dollar</item>
-    <item>Bolivar Fuerte</item>
-    <item>Boliviano</item>
-    <item>Brazilian Real</item>
-    <item>Brunei Dollar</item>
-    <item>Bulgarian Lev</item>
-    <item>Burundi Franc</item>
-    <item>Canadian Dollar</item>
-    <item>Cape Verde Escudo</item>
-    <item>Cayman Islands Dollar</item>
-    <item>CFA Franc BCEAO</item>
-    <item>CFA Franc BEAC</item>
-    <item>CFP Franc</item>
-    <item>Chilean Peso</item>
-    <item>Testing currency</item>
-    <item>Colombian Peso</item>
-    <item>Comoro Franc</item>
-    <item>Congolese Franc</item>
-    <item>Convertible Mark</item>
-    <item>Cordoba Oro</item>
-    <item>Costa Rican Colon</item>
-    <item>Croatian Kuna</item>
-    <item>Cuban Convertible Peso</item>
-    <item>Cuban Peso</item>
-    <item>Czech Koruna</item>
-    <item>Dalasi</item>
-    <item>Danish Krone</item>
-    <item>Denar</item>
-    <item>Djibouti Franc</item>
-    <item>Dobra</item>
-    <item>Dominican Peso</item>
-    <item>Dong</item>
-    <item>East Caribbean Dollar</item>
-    <item>Egyptian Pound</item>
-    <item>El Salvador Colon</item>
-    <item>Ethiopian Birr</item>
-    <item>Euro</item>
-    <item>Falkland Islands Pound</item>
-    <item>Fiji Dollar</item>
-    <item>Forint</item>
-    <item>Ghana Cedi</item>
-    <item>Gibraltar Pound</item>
-    <item>Gold</item>
-    <item>Gourde</item>
-    <item>Guarani</item>
-    <item>Guinea Franc</item>
-    <item>Guyana Dollar</item>
-    <item>Hong Kong Dollar</item>
-    <item>Hryvnia</item>
-    <item>Iceland Krona</item>
-    <item>Indian Rupee</item>
-    <item>Iranian Rial</item>
-    <item>Iraqi Dinar</item>
-    <item>Jamaican Dollar</item>
-    <item>Jordanian Dinar</item>
-    <item>Kenyan Shilling</item>
-    <item>Kina</item>
-    <item>Kip</item>
-    <item>Kuwaiti Dinar</item>
-    <item>Kwacha</item>
-    <item>Kwanza</item>
-    <item>Kyat</item>
-    <item>Lari</item>
-    <item>Latvian Lats</item>
-    <item>Lebanese Pound</item>
-    <item>Lek</item>
-    <item>Lempira</item>
-    <item>Leone</item>
-    <item>Liberian Dollar</item>
-    <item>Libyan Dinar</item>
-    <item>Lilangeni</item>
-    <item>Lithuanian Litas</item>
-    <item>Loti</item>
-    <item>Malagasy Ariary</item>
-    <item>Malaysian Ringgit</item>
-    <item>Mauritius Rupee</item>
-    <item>Mexican Peso</item>
-    <item>Mexican Unidad de Inversion (UDI)</item>
-    <item>Moldovan Leu</item>
-    <item>Moroccan Dirham</item>
-    <item>Mozambique Metical</item>
-    <item>Mvdol</item>
-    <item>Naira</item>
-    <item>Nakfa</item>
-    <item>Namibia Dollar</item>
-    <item>Nepalese Rupee</item>
-    <item>Netherlands Antillean Guilder</item>
-    <item>New Israeli Sheqel</item>
-    <item>New Romanian Leu</item>
-    <item>New Taiwan Dollar</item>
-    <item>New Zealand Dollar</item>
-    <item>Ngultrum</item>
-    <item>North Korean Won</item>
-    <item>Norwegian Krone</item>
-    <item>Nuevo Sol</item>
-    <item>Ouguiya</item>
-    <item>Paanga</item>
-    <item>Pakistan Rupee</item>
-    <item>Palladium</item>
-    <item>Pataca</item>
-    <item>Philippine Peso</item>
-    <item>Platinum</item>
-    <item>Pound Sterling</item>
-    <item>Pula</item>
-    <item>Qatari Rial</item>
-    <item>Quetzal</item>
-    <item>Rand</item>
-    <item>Rial Omani</item>
-    <item>Riel</item>
-    <item>Rufiyaa</item>
-    <item>Rupiah</item>
-    <item>Russian Ruble</item>
-    <item>Rwanda Franc</item>
-    <item>Saint Helena Pound</item>
-    <item>Saudi Riyal</item>
-    <item>SDR (Special Drawing Right)</item>
-    <item>Serbian Dinar</item>
-    <item>Seychelles Rupee</item>
-    <item>Silver</item>
-    <item>Singapore Dollar</item>
-    <item>Solomon Islands Dollar</item>
-    <item>Som</item>
-    <item>Somali Shilling</item>
-    <item>Somoni</item>
-    <item>South Sudanese Pound</item>
-    <item>Sri Lanka Rupee</item>
-    <item>Sucre</item>
-    <item>Sudanese Pound</item>
-    <item>Surinam Dollar</item>
-    <item>Swedish Krona</item>
-    <item>Swiss Franc</item>
-    <item>Syrian Pound</item>
-    <item>Taka</item>
-    <item>Tala</item>
-    <item>Tanzanian Shilling</item>
-    <item>Tenge</item>
-    <item>No currency</item>
-    <item>Trinidad and Tobago Dollar</item>
-    <item>Tugrik</item>
-    <item>Tunisian Dinar</item>
-    <item>Turkish Lira</item>
-    <item>Turkmenistan New Manat</item>
-    <item>UAE Dirham</item>
-    <item>Uganda Shilling</item>
-    <item>UIC-Franc</item>
-    <item>Unidad de Valor Real</item>
-    <item>Unidades de fomento</item>
-    <item>Uruguay Peso en Unidades Indexadas (URUIURUI)</item>
-    <item>Uruguayan peso</item>
-    <item>US Dollar</item>
-    <item>Uzbekistan Sum</item>
-    <item>Vatu</item>
-    <item>WIR Euro</item>
-    <item>WIR Franc</item>
-    <item>Won</item>
-    <item>Yemeni Rial</item>
-    <item>Yen</item>
-    <item>Yuan Renminbi</item>
-    <item>Zambian Kwacha</item>
-    <item>Zimbabwe Dollar</item>
-    <item>Zloty</item>
-  </string-array>
   <string name="error_no_accounts">No accounts exist in GnuCash.\nCreate an account before adding a widget</string>
   <string name="title_build_version">Build version</string>
   <string name="title_license">Llicncia</string>
diff --git a/app/src/main/res/values-cs-rCZ/strings.xml b/app/src/main/res/values-cs-rCZ/strings.xml
index e9bb88a3..92c01bd4 100644
--- a/app/src/main/res/values-cs-rCZ/strings.xml
+++ b/app/src/main/res/values-cs-rCZ/strings.xml
@@ -85,183 +85,6 @@
   <string name="label_display_account">Display account</string>
   <string name="btn_create_accounts">Create Accounts</string>
   <string name="title_default_accounts">Select accounts to create</string>
-  <string-array name="currency_names">
-    <item>Afghani</item>
-    <item>Algerian Dinar</item>
-    <item>Argentine Peso</item>
-    <item>Armenian Dram</item>
-    <item>Aruban Florin</item>
-    <item>Australian Dollar</item>
-    <item>Azerbaijanian Manat</item>
-    <item>Bahamian Dollar</item>
-    <item>Bahraini Dinar</item>
-    <item>Baht</item>
-    <item>Balboa</item>
-    <item>Barbados Dollar</item>
-    <item>Belarussian Ruble</item>
-    <item>Belize Dollar</item>
-    <item>Bermudian Dollar</item>
-    <item>Bolivar Fuerte</item>
-    <item>Boliviano</item>
-    <item>Brazilian Real</item>
-    <item>Brunei Dollar</item>
-    <item>Bulgarian Lev</item>
-    <item>Burundi Franc</item>
-    <item>Canadian Dollar</item>
-    <item>Cape Verde Escudo</item>
-    <item>Cayman Islands Dollar</item>
-    <item>CFA Franc BCEAO</item>
-    <item>CFA Franc BEAC</item>
-    <item>CFP Franc</item>
-    <item>Chilean Peso</item>
-    <item>Testing currency</item>
-    <item>Colombian Peso</item>
-    <item>Comoro Franc</item>
-    <item>Congolese Franc</item>
-    <item>Convertible Mark</item>
-    <item>Cordoba Oro</item>
-    <item>Costa Rican Colon</item>
-    <item>Croatian Kuna</item>
-    <item>Cuban Convertible Peso</item>
-    <item>Cuban Peso</item>
-    <item>Czech Koruna</item>
-    <item>Dalasi</item>
-    <item>Danish Krone</item>
-    <item>Denar</item>
-    <item>Djibouti Franc</item>
-    <item>Dobra</item>
-    <item>Dominican Peso</item>
-    <item>Dong</item>
-    <item>East Caribbean Dollar</item>
-    <item>Egyptian Pound</item>
-    <item>El Salvador Colon</item>
-    <item>Ethiopian Birr</item>
-    <item>Euro</item>
-    <item>Falkland Islands Pound</item>
-    <item>Fiji Dollar</item>
-    <item>Forint</item>
-    <item>Ghana Cedi</item>
-    <item>Gibraltar Pound</item>
-    <item>Gold</item>
-    <item>Gourde</item>
-    <item>Guarani</item>
-    <item>Guinea Franc</item>
-    <item>Guyana Dollar</item>
-    <item>Hong Kong Dollar</item>
-    <item>Hryvnia</item>
-    <item>Iceland Krona</item>
-    <item>Indian Rupee</item>
-    <item>Iranian Rial</item>
-    <item>Iraqi Dinar</item>
-    <item>Jamaican Dollar</item>
-    <item>Jordanian Dinar</item>
-    <item>Kenyan Shilling</item>
-    <item>Kina</item>
-    <item>Kip</item>
-    <item>Kuwaiti Dinar</item>
-    <item>Kwacha</item>
-    <item>Kwanza</item>
-    <item>Kyat</item>
-    <item>Lari</item>
-    <item>Latvian Lats</item>
-    <item>Lebanese Pound</item>
-    <item>Lek</item>
-    <item>Lempira</item>
-    <item>Leone</item>
-    <item>Liberian Dollar</item>
-    <item>Libyan Dinar</item>
-    <item>Lilangeni</item>
-    <item>Lithuanian Litas</item>
-    <item>Loti</item>
-    <item>Malagasy Ariary</item>
-    <item>Malaysian Ringgit</item>
-    <item>Mauritius Rupee</item>
-    <item>Mexican Peso</item>
-    <item>Mexican Unidad de Inversion (UDI)</item>
-    <item>Moldovan Leu</item>
-    <item>Moroccan Dirham</item>
-    <item>Mozambique Metical</item>
-    <item>Mvdol</item>
-    <item>Naira</item>
-    <item>Nakfa</item>
-    <item>Namibia Dollar</item>
-    <item>Nepalese Rupee</item>
-    <item>Netherlands Antillean Guilder</item>
-    <item>New Israeli Sheqel</item>
-    <item>New Romanian Leu</item>
-    <item>New Taiwan Dollar</item>
-    <item>New Zealand Dollar</item>
-    <item>Ngultrum</item>
-    <item>North Korean Won</item>
-    <item>Norwegian Krone</item>
-    <item>Nuevo Sol</item>
-    <item>Ouguiya</item>
-    <item>Paanga</item>
-    <item>Pakistan Rupee</item>
-    <item>Palladium</item>
-    <item>Pataca</item>
-    <item>Philippine Peso</item>
-    <item>Platinum</item>
-    <item>Pound Sterling</item>
-    <item>Pula</item>
-    <item>Qatari Rial</item>
-    <item>Quetzal</item>
-    <item>Rand</item>
-    <item>Rial Omani</item>
-    <item>Riel</item>
-    <item>Rufiyaa</item>
-    <item>Rupiah</item>
-    <item>Russian Ruble</item>
-    <item>Rwanda Franc</item>
-    <item>Saint Helena Pound</item>
-    <item>Saudi Riyal</item>
-    <item>SDR (Special Drawing Right)</item>
-    <item>Serbian Dinar</item>
-    <item>Seychelles Rupee</item>
-    <item>Silver</item>
-    <item>Singapore Dollar</item>
-    <item>Solomon Islands Dollar</item>
-    <item>Som</item>
-    <item>Somali Shilling</item>
-    <item>Somoni</item>
-    <item>South Sudanese Pound</item>
-    <item>Sri Lanka Rupee</item>
-    <item>Sucre</item>
-    <item>Sudanese Pound</item>
-    <item>Surinam Dollar</item>
-    <item>Swedish Krona</item>
-    <item>Swiss Franc</item>
-    <item>Syrian Pound</item>
-    <item>Taka</item>
-    <item>Tala</item>
-    <item>Tanzanian Shilling</item>
-    <item>Tenge</item>
-    <item>No currency</item>
-    <item>Trinidad and Tobago Dollar</item>
-    <item>Tugrik</item>
-    <item>Tunisian Dinar</item>
-    <item>Turkish Lira</item>
-    <item>Turkmenistan New Manat</item>
-    <item>UAE Dirham</item>
-    <item>Uganda Shilling</item>
-    <item>UIC-Franc</item>
-    <item>Unidad de Valor Real</item>
-    <item>Unidades de fomento</item>
-    <item>Uruguay Peso en Unidades Indexadas (URUIURUI)</item>
-    <item>Uruguayan peso</item>
-    <item>US Dollar</item>
-    <item>Uzbekistan Sum</item>
-    <item>Vatu</item>
-    <item>WIR Euro</item>
-    <item>WIR Franc</item>
-    <item>Won</item>
-    <item>Yemeni Rial</item>
-    <item>Yen</item>
-    <item>Yuan Renminbi</item>
-    <item>Zambian Kwacha</item>
-    <item>Zimbabwe Dollar</item>
-    <item>Zloty</item>
-  </string-array>
   <string name="error_no_accounts">No accounts exist in GnuCash.\nCreate an account before adding a widget</string>
   <string name="title_build_version">Build version</string>
   <string name="title_license">License</string>
diff --git a/app/src/main/res/values-da-rDK/strings.xml b/app/src/main/res/values-da-rDK/strings.xml
deleted file mode 100644
index 7cea4700..00000000
--- a/app/src/main/res/values-da-rDK/strings.xml
+++ /dev/null
@@ -1,579 +0,0 @@
-<?xml version="1.0" encoding="utf-8"?>
-<!--
- Copyright (c) 2012 - 2014 Ngewi Fet <ngewif@gmail.com>
- 
- Licensed under the Apache License, Version 2.0 (the "License");
- you may not use this file except in compliance with the License.
- You may obtain a copy of the License at
- 
-    http://www.apache.org/licenses/LICENSE-2.0
- 
- Unless required by applicable law or agreed to in writing, software
- distributed under the License is distributed on an "AS IS" BASIS,
- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- See the License for the specific language governing permissions and
- limitations under the License.
--->
-
-<resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
-  <string name="title_create_account">Create Account</string>
-  <string name="title_edit_account">Edit Account</string>
-  <string name="info_details">Info</string>
-  <string name="menu_export">Export</string>
-  <string name="description_add_transaction_icon">Add a new transaction to an account</string>
-  <string name="label_no_accounts">No accounts to display</string>
-  <string name="label_account_name">Account name</string>
-  <string name="btn_cancel">Cancel</string>
-  <string name="btn_save">Save</string>
-  <string name="label_passcode">Enter Passcode</string>
-  <string name="toast_wrong_passcode">Wrong passcode, please try again</string>
-  <string name="toast_passcode_set">Passcode set</string>
-  <string name="label_confirm_passcode">Please confirm your passcode</string>
-  <string name="toast_invalid_passcode_confirmation">Invalid passcode confirmation. Please try again</string>
-  <string name="label_transaction_name">Description</string>
-  <string name="label_transaction_amount">Amount</string>
-  <string name="title_add_transaction">New transaction</string>
-  <string name="label_no_transactions">No transactions to display</string>
-  <string name="label_timeanddate">DATE &amp; TIME</string>
-  <string name="label_account">Account</string>
-  <string name="label_debit">DEBIT</string>
-  <string name="label_credit">CREDIT</string>
-  <string name="title_accounts">Accounts</string>
-  <string name="title_transactions">Transactions</string>
-  <string name="menu_delete">Delete</string>
-  <string name="alert_dialog_ok_delete">Delete</string>
-  <string name="alert_dialog_cancel">Cancel</string>
-  <string name="toast_account_deleted">Account deleted</string>
-  <string name="title_confirm_delete">Confirm delete</string>
-  <string name="delete_account_confirmation_message">All transactions in this account will also be deleted</string>
-  <string name="title_edit_transaction">Edit Transaction</string>
-  <string name="label_transaction_description">Add note</string>
-  <string name="menu_move">MOVE</string>
-  <string name="title_selected">%1$d selected</string>
-  <string name="label_account_balance">Balance:</string>
-  <string name="label_export_destination">Export To:</string>
-  <string name="title_export_dialog">Export Transactions</string>
-  <string name="option_export_all_transactions">Export all transactions</string>
-  <string name="hint_export_choice">By default, only new transactions since last export will be exported. Check this option to export all transactions</string>
-  <string name="toast_export_error">Error exporting %1$s file</string>
-  <string name="btn_export">Export</string>
-  <string name="option_delete_after_export">Delete after export</string>
-  <string name="hint_delete_after_export">All exported transactions will be deleted when exporting is completed</string>
-  <string name="title_settings">Settings</string>
-  <string-array name="export_destinations">
-    <item>SD Card</item>
-    <item>DropBox</item>
-    <item>Google Drive</item>
-    <item>Send to&#8230;</item>
-  </string-array>
-  <string name="btn_move">Move</string>
-  <string name="title_move_transactions">Move %1$d transaction(s)</string>
-  <string name="label_move_destination">Destination Account</string>
-  <string name="permission_access_sdcard">Access SD Card</string>
-  <string name="toast_incompatible_currency">Cannot move transactions.\nThe destination account uses a different currency from origin account</string>
-  <string name="header_general_settings">General</string>
-  <string name="header_about_gnucash">About</string>
-  <string name="title_choose_currency">Choose default currency</string>
-  <string name="title_default_currency">Default currency</string>
-  <string name="summary_default_currency">Default currency to assign to new accounts</string>
-  <string name="label_permission_record_transactions">Enables recording transactions in GnuCash for Android</string>
-  <string name="label_permission_create_accounts">Enables creation of accounts in GnuCash for Android</string>
-  <string name="label_permission_group">Your GnuCash data</string>
-  <string name="description_permission_group">Read and modify GnuCash data</string>
-  <string name="label_permission_record_transaction">Record transactions in GnuCash</string>
-  <string name="label_permission_create_account">Create accounts in GnuCash</string>
-  <string name="label_display_account">Display account</string>
-  <string name="btn_create_accounts">Create Accounts</string>
-  <string name="title_default_accounts">Select accounts to create</string>
-  <string-array name="currency_names">
-    <item>Afghani</item>
-    <item>Algerian Dinar</item>
-    <item>Argentine Peso</item>
-    <item>Armenian Dram</item>
-    <item>Aruban Florin</item>
-    <item>Australian Dollar</item>
-    <item>Azerbaijanian Manat</item>
-    <item>Bahamian Dollar</item>
-    <item>Bahraini Dinar</item>
-    <item>Baht</item>
-    <item>Balboa</item>
-    <item>Barbados Dollar</item>
-    <item>Belarussian Ruble</item>
-    <item>Belize Dollar</item>
-    <item>Bermudian Dollar</item>
-    <item>Bolivar Fuerte</item>
-    <item>Boliviano</item>
-    <item>Brazilian Real</item>
-    <item>Brunei Dollar</item>
-    <item>Bulgarian Lev</item>
-    <item>Burundi Franc</item>
-    <item>Canadian Dollar</item>
-    <item>Cape Verde Escudo</item>
-    <item>Cayman Islands Dollar</item>
-    <item>CFA Franc BCEAO</item>
-    <item>CFA Franc BEAC</item>
-    <item>CFP Franc</item>
-    <item>Chilean Peso</item>
-    <item>Testing currency</item>
-    <item>Colombian Peso</item>
-    <item>Comoro Franc</item>
-    <item>Congolese Franc</item>
-    <item>Convertible Mark</item>
-    <item>Cordoba Oro</item>
-    <item>Costa Rican Colon</item>
-    <item>Croatian Kuna</item>
-    <item>Cuban Convertible Peso</item>
-    <item>Cuban Peso</item>
-    <item>Czech Koruna</item>
-    <item>Dalasi</item>
-    <item>Danish Krone</item>
-    <item>Denar</item>
-    <item>Djibouti Franc</item>
-    <item>Dobra</item>
-    <item>Dominican Peso</item>
-    <item>Dong</item>
-    <item>East Caribbean Dollar</item>
-    <item>Egyptian Pound</item>
-    <item>El Salvador Colon</item>
-    <item>Ethiopian Birr</item>
-    <item>Euro</item>
-    <item>Falkland Islands Pound</item>
-    <item>Fiji Dollar</item>
-    <item>Forint</item>
-    <item>Ghana Cedi</item>
-    <item>Gibraltar Pound</item>
-    <item>Gold</item>
-    <item>Gourde</item>
-    <item>Guarani</item>
-    <item>Guinea Franc</item>
-    <item>Guyana Dollar</item>
-    <item>Hong Kong Dollar</item>
-    <item>Hryvnia</item>
-    <item>Iceland Krona</item>
-    <item>Indian Rupee</item>
-    <item>Iranian Rial</item>
-    <item>Iraqi Dinar</item>
-    <item>Jamaican Dollar</item>
-    <item>Jordanian Dinar</item>
-    <item>Kenyan Shilling</item>
-    <item>Kina</item>
-    <item>Kip</item>
-    <item>Kuwaiti Dinar</item>
-    <item>Kwacha</item>
-    <item>Kwanza</item>
-    <item>Kyat</item>
-    <item>Lari</item>
-    <item>Latvian Lats</item>
-    <item>Lebanese Pound</item>
-    <item>Lek</item>
-    <item>Lempira</item>
-    <item>Leone</item>
-    <item>Liberian Dollar</item>
-    <item>Libyan Dinar</item>
-    <item>Lilangeni</item>
-    <item>Lithuanian Litas</item>
-    <item>Loti</item>
-    <item>Malagasy Ariary</item>
-    <item>Malaysian Ringgit</item>
-    <item>Mauritius Rupee</item>
-    <item>Mexican Peso</item>
-    <item>Mexican Unidad de Inversion (UDI)</item>
-    <item>Moldovan Leu</item>
-    <item>Moroccan Dirham</item>
-    <item>Mozambique Metical</item>
-    <item>Mvdol</item>
-    <item>Naira</item>
-    <item>Nakfa</item>
-    <item>Namibia Dollar</item>
-    <item>Nepalese Rupee</item>
-    <item>Netherlands Antillean Guilder</item>
-    <item>New Israeli Sheqel</item>
-    <item>New Romanian Leu</item>
-    <item>New Taiwan Dollar</item>
-    <item>New Zealand Dollar</item>
-    <item>Ngultrum</item>
-    <item>North Korean Won</item>
-    <item>Norwegian Krone</item>
-    <item>Nuevo Sol</item>
-    <item>Ouguiya</item>
-    <item>Paanga</item>
-    <item>Pakistan Rupee</item>
-    <item>Palladium</item>
-    <item>Pataca</item>
-    <item>Philippine Peso</item>
-    <item>Platinum</item>
-    <item>Pound Sterling</item>
-    <item>Pula</item>
-    <item>Qatari Rial</item>
-    <item>Quetzal</item>
-    <item>Rand</item>
-    <item>Rial Omani</item>
-    <item>Riel</item>
-    <item>Rufiyaa</item>
-    <item>Rupiah</item>
-    <item>Russian Ruble</item>
-    <item>Rwanda Franc</item>
-    <item>Saint Helena Pound</item>
-    <item>Saudi Riyal</item>
-    <item>SDR (Special Drawing Right)</item>
-    <item>Serbian Dinar</item>
-    <item>Seychelles Rupee</item>
-    <item>Silver</item>
-    <item>Singapore Dollar</item>
-    <item>Solomon Islands Dollar</item>
-    <item>Som</item>
-    <item>Somali Shilling</item>
-    <item>Somoni</item>
-    <item>South Sudanese Pound</item>
-    <item>Sri Lanka Rupee</item>
-    <item>Sucre</item>
-    <item>Sudanese Pound</item>
-    <item>Surinam Dollar</item>
-    <item>Swedish Krona</item>
-    <item>Swiss Franc</item>
-    <item>Syrian Pound</item>
-    <item>Taka</item>
-    <item>Tala</item>
-    <item>Tanzanian Shilling</item>
-    <item>Tenge</item>
-    <item>No currency</item>
-    <item>Trinidad and Tobago Dollar</item>
-    <item>Tugrik</item>
-    <item>Tunisian Dinar</item>
-    <item>Turkish Lira</item>
-    <item>Turkmenistan New Manat</item>
-    <item>UAE Dirham</item>
-    <item>Uganda Shilling</item>
-    <item>UIC-Franc</item>
-    <item>Unidad de Valor Real</item>
-    <item>Unidades de fomento</item>
-    <item>Uruguay Peso en Unidades Indexadas (URUIURUI)</item>
-    <item>Uruguayan peso</item>
-    <item>US Dollar</item>
-    <item>Uzbekistan Sum</item>
-    <item>Vatu</item>
-    <item>WIR Euro</item>
-    <item>WIR Franc</item>
-    <item>Won</item>
-    <item>Yemeni Rial</item>
-    <item>Yen</item>
-    <item>Yuan Renminbi</item>
-    <item>Zambian Kwacha</item>
-    <item>Zimbabwe Dollar</item>
-    <item>Zloty</item>
-  </string-array>
-  <string name="error_no_accounts">No accounts exist in GnuCash.\nCreate an account before adding a widget</string>
-  <string name="title_build_version">Build version</string>
-  <string name="title_license">License</string>
-  <string name="summary_licence_details">Apache License v2.0. Click for details</string>
-  <string name="title_general_prefs">General Preferences</string>
-  <string name="label_widget_configuration">Select Account</string>
-  <string name="toast_no_transactions_to_export">There are no transactions available to export</string>
-  <string name="header_passcode_settings">Passcode</string>
-  <string name="title_passcode_preferences">Passcode Preferences</string>
-  <string name="title_passcode_enabled">Passcode Turned On</string>
-  <string name="title_passcode_disabled">Passcode Turned Off</string>
-  <string name="title_change_passcode">Change Passcode</string>
-  <string name="title_about_gnucash">About GnuCash</string>
-  <string name="summary_about_gnucash">A mobile finance management and expense-tracker designed for Android</string>
-  <string name="title_about">About</string>
-  <string name="toast_format_exported_to">%1$s file exported to:\n</string>
-  <string name="title_export_email">GnuCash Android %1$s export</string>
-  <string name="description_export_email">GnuCash Android Export from </string>
-  <string name="header_transaction_settings">Transactions</string>
-  <string name="title_transaction_preferences">Transaction Preferences</string>
-  <string name="title_account_preferences">Account Preferences</string>
-  <string name="title_default_transaction_type">Default Transaction Type</string>
-  <string name="summary_default_transaction_type">The type of transaction to use by default, CREDIT or DEBIT</string>
-  <string-array name="transaction_types">
-    <item>CREDIT</item>
-    <item>DEBIT</item>
-  </string-array>
-  <string name="msg_delete_all_transactions_confirmation">Are you sure you want to delete ALL transactions?</string>
-  <string name="msg_delete_transaction_confirmation">Are you sure you want to delete this transaction?</string>
-  <string name="title_export_preference_category">Export</string>
-  <string name="title_export_all_transactions">Export all transactions</string>
-  <string name="title_always_delete_exported_transactions">Delete exported transactions</string>
-  <string name="title_default_export_email">Default export email</string>
-  <string name="summary_default_export_email">The default email address to send exports to. You can still change this when you export.</string>
-  <string name="label_double_entry_account">Transfer Account</string>
-  <string name="summary_use_double_entry">All transactions will be a transfer from one account to another</string>
-  <string name="title_use_double_entry">Activate Double Entry</string>
-  <string name="account_balance">Balance</string>
-  <string name="toast_no_account_name_entered">Enter an account name to create an account</string>
-  <string name="label_account_currency">Currency</string>
-  <string name="label_parent_account">Parent account</string>
-  <string name="title_xml_ofx_header">Use XML OFX header</string>
-  <string name="summary_xml_ofx_header">Enable this option when exporting to third-party application other than GnuCash for desktop</string>
-  <string name="title_whats_new">What\'s New</string>
-	<string name="whats_new">
-        - New Material app design \n
-        - Multi-currency transactions\n
-        - Calculator to transaction amounts\n
-        - Better reporting options\n
-        - New help &amp; feedback section\n
-        - Multiple bug fixes and improvements\n
-	</string>
-  <string name="label_dismiss">Dismiss</string>
-  <string name="toast_transanction_amount_required">Enter an amount to save the transaction</string>
-  <string name="toast_error_edit_multi_currency_transaction">Multi-currency transactions cannot be modified</string>
-  <string name="menu_import_accounts">Import GnuCash Accounts</string>
-  <string name="btn_import_accounts">Import Accounts</string>
-  <string name="toast_error_importing_accounts">An error occurred while importing the GnuCash accounts</string>
-  <string name="toast_success_importing_accounts">GnuCash Accounts successfully imported</string>
-  <string name="summary_import_accounts">Import account structure exported from GnuCash desktop</string>
-  <string name="title_import_accounts">Import GnuCash XML</string>
-    <string name="summary_delete_all_accounts">Delete all accounts in the database. All transactions will be deleted as
-        well.
-    </string>
-  <string name="title_delete_all_accounts">Delete all accounts</string>
-  <string name="header_account_settings">Accounts</string>
-  <string name="toast_all_accounts_deleted">All accounts have been successfully deleted</string>
-    <string name="confirm_delete_all_accounts">Are you sure you want to delete all accounts and transactions?\n\nThis
-        operation cannot be undone!
-    </string>
-  <string name="label_account_type">Account Type</string>
-  <string name="summary_delete_all_transactions">All transactions in all accounts will be deleted!</string>
-  <string name="title_delete_all_transactions">Delete all transactions</string>
-  <string name="toast_all_transactions_deleted">All transactions successfully deleted!</string>
-  <string name="title_progress_importing_accounts">Importing accounts</string>
-  <string name="toast_tap_again_to_confirm_delete">Tap again to confirm. ALL entries will be deleted!!</string>
-  <string name="section_header_transactions">Transactions</string>
-  <string name="section_header_subaccounts">Sub-Accounts</string>
-  <string name="menu_search_accounts">Search</string>
-  <string name="title_default_export_format">Default Export Format</string>
-  <string name="summary_default_export_format">File format to use by default when exporting transactions</string>
-  <string name="menu_export_transactions">Export transactions</string>
-  <string name="label_recurring_transaction">Recurrence</string>
-  <!-- This should be the same name used by GnuCash desktop for imbalance accounts -->
-  <string name="imbalance_account_name">Imbalance</string>
-  <string name="title_progress_exporting_transactions">Exporting transactions</string>
-  <string name="label_no_recurring_transactions">No recurring transactions to display.</string>
-  <string name="toast_recurring_transaction_deleted">Successfully deleted recurring transaction</string>
-  <string name="label_placeholder_account">Placeholder account</string>
-  <string name="label_default_transfer_account">Default Transfer Account</string>
-  <plurals name="label_sub_accounts">
-    <item quantity="one">%d sub-account</item>
-    <item quantity="other">%d sub-accounts</item>
-  </plurals>
-  <string-array name="account_type_entry_values">
-    <item>CASH</item>
-    <item>BANK</item>
-    <item>CREDIT CARD</item>
-    <item>ASSET</item>
-    <item>LIABILITY</item>
-    <item>INCOME</item>
-    <item>EXPENSE</item>
-    <item>PAYABLE</item>
-    <item>RECEIVABLE</item>
-    <item>EQUITY</item>
-    <item>CURRENCY</item>
-    <item>STOCK</item>
-    <item>MUTUAL FUND</item>
-    <item>TRADING</item>
-  </string-array>
-  <string-array name="export_formats">
-    <item>QIF</item>
-    <item>OFX</item>
-    <item>XML</item>
-  </string-array>
-  <!-- Default title for color picker dialog [CHAR LIMIT=30] -->
-  <string name="color_picker_default_title">Select a Color</string>
-  <!-- Content description for a color square. -->
-  <string name="color_swatch_description" translatable="false">Color <xliff:g id="color_index" example="14">%1$d</xliff:g></string>
-  <!-- Content description for a selected color square. -->
-  <string name="color_swatch_description_selected" translatable="false">Color <xliff:g id="color_index" example="14">%1$d</xliff:g> selected</string>
-  <string name="label_account_color_and_type">Account Color &amp; Type</string>
-  <string name="label_delete_sub_accounts">Delete sub-accounts</string>
-  <string name="title_recent_accounts">Recent</string>
-  <string name="title_favorite_accounts">Favorites</string>
-  <string name="title_all_accounts">All</string>
-  <string name="summary_create_default_accounts">Creates default GnuCash commonly-used account structure</string>
-  <string name="title_create_default_accounts">Create default accounts</string>
-  <string name="msg_confirm_create_default_accounts_setting">All existing accounts and transactions on the device will be deleted.\n\nAre you sure you want to proceed?</string>
-  <string name="menu_scheduled_transactions">Scheduled Transactions</string>
-    <string name="msg_confirm_create_default_accounts_first_run">Welcome to GnuCash Android! \nYou can either create
-        a hierarchy of commonly-used accounts, or import your own GnuCash account structure. \n\nBoth options are also
-        available in app Settings so you can decide later.
-    </string>
-  <string name="title_scheduled_transactions">Transactions</string>
-  <string name="title_select_export_destination">Select destination for export</string>
-  <string name="hint_split_memo">Memo</string>
-  <string name="label_spend">Spend</string>
-  <string name="label_receive">Receive</string>
-  <string name="label_withdrawal">Withdrawal</string>
-  <string name="label_deposit">Deposit</string>
-  <string name="label_payment">Payment</string>
-  <string name="label_charge">Charge</string>
-  <string name="label_decrease">Decrease</string>
-  <string name="label_increase">Increase</string>
-  <string name="label_income">Income</string>
-  <string name="label_rebate">Rebate</string>
-  <string name="label_expense">Expense</string>
-  <string name="label_bill">Bill</string>
-  <string name="label_invoice">Invoice</string>
-  <string name="label_buy">Buy</string>
-  <string name="label_sell">Sell</string>
-  <string name="label_repeats">Repeats</string>
-  <string name="toast_no_recent_backup">No recent backup found</string>
-  <string name="account_name_opening_balances">Opening Balances</string>
-  <string name="account_name_equity">Equity</string>
-    <string name="summary_save_opening_balances">Enable to save the current account balance (before deleting transactions) as new opening balance after deleting transactions
-    </string>
-  <string name="title_save_opening_balances">Save account opening balances</string>
-  <string name="export_warning_ofx">OFX does not support double-entry transactions</string>
-  <string name="export_warning_qif">Generates separate QIF files per currency</string>
-  <string name="title_transaction_splits">Transaction splits</string>
-  <string name="label_imbalance">Imbalance:</string>
-  <string name="btn_add_split">Add split</string>
-  <string name="menu_title_favorite">Favorite</string>
-  <string name="drawer_open">Navigation drawer opened</string>
-  <string name="drawer_close">Navigation drawer closed</string>
-  <string name="title_reports">Reports</string>
-  <string name="title_pie_chart">Pie Chart</string>
-  <string name="title_line_chart">Line Chart</string>
-  <string name="title_bar_chart">Bar Chart</string>
-  <string name="title_report_prefs">Report Preferences</string>
-  <string name="label_report_currency">Select currency</string>
-  <string name="title_use_account_color">Account color in reports</string>
-  <string name="summary_use_account_color">Use account color in the bar/pie chart</string>
-  <string name="header_report_settings">Reports</string>
-  <string name="menu_order_by_size">Order by size</string>
-  <string name="menu_toggle_legend">Show legend</string>
-  <string name="menu_toggle_labels">Show labels</string>
-  <string name="menu_toggle_percentage_mode">Show percentage</string>
-  <string name="menu_toggle_average_lines">Show average lines</string>
-  <string name="menu_group_smaller_slices">Group Smaller Slices</string>
-  <string name="label_chart_no_data">No chart data available</string>
-  <string name="label_chart_overall">Overall</string>
-  <string name="label_chart_total">Total</string>
-  <string name="label_other_slice">Other</string>
-  <string name="toast_chart_percentage_mode_total">The percentage of selected value calculated from the total amount</string>
-  <string name="toast_chart_percentage_mode_current_bar">The percentage of selected value calculated from the current stacked bar amount</string>
-  <string name="label_save_template">Save as template</string>
-  <string name="label_delete_account_transactions_description">This account contains transactions. \nWhat would you like to do with these transactions</string>
-  <string name="label_delete_account_subaccounts_description">This account contains sub-accounts. \nWhat would you like to do with these sub-accounts</string>
-  <string name="label_delete_transactions">Delete transactions</string>
-  <string name="toast_disable_double_entry_to_save_transaction">Create and specify a transfer account OR disable double-entry in settings to save the transaction</string>
-  <string name="label_tap_to_create_schedule">Tap to create schedule</string>
-  <string name="title_restore_backup">Restore Backup</string>
-  <string name="header_backup_and_export_settings">Backup &amp; export</string>
-  <string name="title_dropbox_sync_preference">DropBox Sync</string>
-  <string name="title_backup_preference_category">Backup</string>
-  <string name="summary_dropbox_sync">Enable to sync to DropBox</string>
-  <string name="title_select_gnucash_xml_file">Select GnuCash XML file</string>
-  <string name="title_backup_prefs">Backup Preferences</string>
-  <string name="title_create_backup_pref">Create Backup</string>
-  <string name="summary_create_backup_pref">By default backups are saved to the SDCARD</string>
-  <string name="summary_restore_backup_pref">Select a specific backup to restore</string>
-  <string name="toast_backup_successful">Backup successful</string>
-  <string name="toast_backup_failed">Backup failed</string>
-  <string name="export_warning_xml">Exports all accounts and transactions</string>
-  <string name="title_google_drive_sync_pref">Google Drive Sync</string>
-  <string name="summary_google_drive_sync">Enable to sync to Google Drive</string>
-  <string name="toast_install_file_manager">Install a file manager to select files</string>
-  <string name="title_select_backup_to_restore">Select backup to restore</string>
-  <string name="nav_menu_favorites">Favorites</string>
-  <string name="nav_menu_open">Open</string>
-  <string name="nav_menu_reports">Reports</string>
-  <string name="nav_menu_scheduled_transactions">Scheduled Transactions</string>
-  <string name="nav_menu_export">Export</string>
-  <string name="nav_menu_settings">Settings</string>
-  <plurals name="label_every_x_days">
-    <item quantity="one">Daily</item>
-    <item quantity="other">Every %d days</item>
-  </plurals>
-  <plurals name="label_every_x_weeks">
-    <item quantity="one">Weekly</item>
-    <item quantity="other">Every %d weeks</item>
-  </plurals>
-  <plurals name="label_every_x_months">
-    <item quantity="one">Monthly</item>
-    <item quantity="other">Every %d months</item>
-  </plurals>
-  <plurals name="label_every_x_years">
-    <item quantity="one">Yearly</item>
-    <item quantity="other">Every %d years</item>
-  </plurals>
-  <string name="title_enable_crashlytics">Enable Crash Logging</string>
-  <string name="msg_enable_crashlytics">Automatically send information about app malfunction to the developers.</string>
-  <string name="label_export_format"> Format</string>
-  <string name="toast_backup_folder_not_found">Backup folder cannot be found. Make sure the SD Card is mounted!</string>
-  <string name="label_old_passcode">Enter your old passcode</string>
-  <string name="label_new_passcode">Enter your new passcode</string>
-  <string name="nav_menu_scheduled_backups">Scheduled Exports</string>
-  <string name="title_scheduled_exports">Exports</string>
-  <string name="label_no_scheduled_exports_to_display">No scheduled exports to display</string>
-  <string name="title_create_export_schedule">Create export schedule</string>
-  <string name="toast_exported_to">Exported to: %1$s</string>
-  <string name="toast_legend_too_long">The legend is too long</string>
-  <string name="hint_account_description">Account description</string>
-  <string name="label_no_recent_accounts">No recent accounts</string>
-  <string name="label_no_favorite_accounts">No favorite accounts</string>
-  <string name="nav_menu_scheduled_actions">Scheduled Actions</string>
-  <string name="label_scheduled_action_ended">"Ended, last executed on %1$s"</string>
-  <string name="label_select_bar_to_view_details">Select a bar to view details</string>
-  <string name="btn_wizard_next">Next</string>
-  <string name="btn_wizard_finish">Done</string>
-  <string name="wizard_title_default_currency">Default Currency</string>
-  <string name="wizard_title_account_setup">Account Setup</string>
-  <string name="wizard_title_select_currency">Select Currency</string>
-  <string name="wizard_title_feedback_options">Feedback Options</string>
-  <string name="wizard_option_create_default_accounts">Create default accounts</string>
-  <string name="wizard_option_import_my_accounts">Import my accounts</string>
-  <string name="wizard_option_let_me_handle_it">Let me handle it</string>
-  <string name="wizard_option_currency_other">Other</string>
-  <string name="wizard_option_auto_send_crash_reports">Automatically send crash reports</string>
-  <string name="wizard_option_disable_crash_reports">Disable crash reports</string>
-  <string name="wizard_btn_back">Back</string>
-  <string name="title_setup_gnucash">Setup GnuCash</string>
-  <string name="wizard_title_welcome_to_gnucash">Welcome to GnuCash</string>
-  <string name="msg_wizard_welcome_page">Before you dive in, \nlet\'s setup a few things first\n\nTo continue, press Next</string>
-  <string name="title_split_editor">Split Editor</string>
-  <string name="toast_error_check_split_amounts">Check that all splits have valid amounts before saving!</string>
-  <string name="label_error_invalid_expression">Invalid expression!</string>
-  <string name="toast_scheduled_recurring_transaction">Scheduled recurring transaction</string>
-  <string name="error_exchange_rate_required">An exchange rate is required</string>
-  <string name="error_converted_amount_required">The converted amount is required</string>
-  <string name="title_transfer_funds">Transfer Funds</string>
-  <string name="nav_menu_help"><![CDATA[Help & Feedback]]></string>
-  <string name="label_select_pie_slice_to_see_details">Select a slice to see details</string>
-  <string name="label_report_period">Period:</string>
-  <string name="label_convert_from">From:</string>
-  <string name="label_convert_to">To:</string>
-  <string name="msg_provide_exchange_rate">Provide either the converted amount or exchange rate in order to transfer funds</string>
-  <string name="hint_exchange_rate">Exchange rate</string>
-  <string name="btn_fetch_quote">Fetch quote</string>
-  <string name="hint_converted_amount">Converted Amount</string>
-  <string name="title_report_sheet">Sheet</string>
-  <string name="label_last_3_months_expenses">Expenses for last 3 months</string>
-  <string name="label_total_assets">Total Assets</string>
-  <string name="label_total_liabilities">Total Liabilities</string>
-  <string name="label_net_worth">Net Worth</string>
-  <string name="label_assets">Assets</string>
-  <string name="label_liabilities">Liabilities</string>
-  <string name="label_equity">Equity</string>
-  <string name="label_total_liabilities_and_equity"><![CDATA[Total Liabilites & Equity]]></string>
-  <string name="label_move_to">Move to:</string>
-  <string name="menu_group_by">Group By</string>
-  <string name="menu_group_by_month">Month</string>
-  <string name="menu_group_by_quarter">Quarter</string>
-  <string name="menu_group_by_year">Year</string>
-  <string name="title_balance_sheet_report">Balance Sheet</string>
-  <string name="label_balance_sheet_total">Total:</string>
-  <string name="title_google_plus_community">Google+ Community</string>
-  <string name="title_translate_gnucash">Translate GnuCash</string>
-  <string name="summary_google_plus">Share ideas, discuss changes or report problems</string>
-  <string name="summary_translate_gnucash">Translate or proof-read on CrowdIn</string>
-  <string name="toast_no_compatible_apps_to_receive_export">No compatible apps to receive the exported transactions!</string>
-  <string name="menu_move_transaction">Move...</string>
-  <string name="menu_duplicate_transaction">Duplicate</string>
-  <string-array name="report_time_range">
-    <item>Current month</item>
-    <item>Last 3 months</item>
-    <item>Last 6 months</item>
-    <item>Last 12 months</item>
-    <item>All time</item>
-    <item>Custom range</item>
-  </string-array>
-</resources>
diff --git a/app/src/main/res/values-de/strings.xml b/app/src/main/res/values-de/strings.xml
index 385b3bba..b16e201b 100644
--- a/app/src/main/res/values-de/strings.xml
+++ b/app/src/main/res/values-de/strings.xml
@@ -85,183 +85,6 @@
   <string name="label_display_account">Konto anzeigen</string>
   <string name="btn_create_accounts">Konten erstellen</string>
   <string name="title_default_accounts">Zu erstellende Konten auswhlen</string>
-  <string-array name="currency_names">
-    <item>Afghani</item>
-    <item>Algerischer Dinar</item>
-    <item>Argentinischer Peso</item>
-    <item>Armenischer Dram</item>
-    <item>Aruban Florin</item>
-    <item>Australischer Dollar</item>
-    <item>Azerbaijanian Manat</item>
-    <item>Bahamian Dollar</item>
-    <item>Bahraini Dinar</item>
-    <item>Baht</item>
-    <item>Balboa</item>
-    <item>Barbados Dollar</item>
-    <item>Belarussian Ruble</item>
-    <item>Belize Dollar</item>
-    <item>Bermudian Dollar</item>
-    <item>Bolivar Fuerte</item>
-    <item>Boliviano</item>
-    <item>Brasilianischer Real</item>
-    <item>Brunei Dollar</item>
-    <item>Bulgarian Lev</item>
-    <item>Burundi Franc</item>
-    <item>Kanadische Dollar</item>
-    <item>Cape Verde Escudo</item>
-    <item>Cayman Islands Dollar</item>
-    <item>CFA Franc BCEAO</item>
-    <item>CFA Franc BEAC</item>
-    <item>CFP Franc</item>
-    <item>Chilean Peso</item>
-    <item>Testing currency</item>
-    <item>Kolumbianischer Peso</item>
-    <item>Comoro Franc</item>
-    <item>Kongolesischer Franc</item>
-    <item>Convertible Mark</item>
-    <item>Cordoba Oro</item>
-    <item>Costa Rican Colon</item>
-    <item>Kroatische Kuna</item>
-    <item>Cuban Convertible Peso</item>
-    <item>Kubanischer Peso</item>
-    <item>Tschechische Krone</item>
-    <item>Dalasi</item>
-    <item>Dnische Krone</item>
-    <item>Denar</item>
-    <item>Djibouti Franc</item>
-    <item>Dobra</item>
-    <item>Dominican Peso</item>
-    <item>Dong</item>
-    <item>East Caribbean Dollar</item>
-    <item>Egyptian Pound</item>
-    <item>El Salvador Colon</item>
-    <item>Ethiopian Birr</item>
-    <item>Euro</item>
-    <item>Falkland Islands Pound</item>
-    <item>Fiji Dollar</item>
-    <item>Forint</item>
-    <item>Ghana Cedi</item>
-    <item>Gibraltar Pound</item>
-    <item>Gold</item>
-    <item>Gourde</item>
-    <item>Guarani</item>
-    <item>Guinea Franc</item>
-    <item>Guyana Dollar</item>
-    <item>Hong Kong Dollar</item>
-    <item>Hryvnia</item>
-    <item>Iceland Krona</item>
-    <item>Indische Rupie</item>
-    <item>Iranischer Rial</item>
-    <item>Irakischer Dinar</item>
-    <item>Jamaican Dollar</item>
-    <item>Jordanischer Dinar</item>
-    <item>Kenyan Shilling</item>
-    <item>Kina</item>
-    <item>Kip</item>
-    <item>Kuwaiti Dinar</item>
-    <item>Kwacha</item>
-    <item>Kwanza</item>
-    <item>Kyat</item>
-    <item>Lari</item>
-    <item>Latvian Lats</item>
-    <item>Lebanese Pound</item>
-    <item>Lek</item>
-    <item>Lempira</item>
-    <item>Leone</item>
-    <item>Liberianischer Dollar</item>
-    <item>Libyscher Dinar</item>
-    <item>Lilangeni</item>
-    <item>Lithuanian Litas</item>
-    <item>Loti</item>
-    <item>Malagasy Ariary</item>
-    <item>Malaysian Ringgit</item>
-    <item>Mauritius Rupee</item>
-    <item>Mexikanischer Peso</item>
-    <item>Mexican Unidad de Inversion (UDI)</item>
-    <item>Moldovan Leu</item>
-    <item>Moroccan Dirham</item>
-    <item>Mozambique Metical</item>
-    <item>Mvdol</item>
-    <item>Naira</item>
-    <item>Nakfa</item>
-    <item>Namibia Dollar</item>
-    <item>Nepalese Rupee</item>
-    <item>Netherlands Antillean Guilder</item>
-    <item>New Israeli Sheqel</item>
-    <item>New Romanian Leu</item>
-    <item>New Taiwan Dollar</item>
-    <item>New Zealand Dollar</item>
-    <item>Ngultrum</item>
-    <item>North Korean Won</item>
-    <item>Norwegian Krone</item>
-    <item>Nuevo Sol</item>
-    <item>Ouguiya</item>
-    <item>Paanga</item>
-    <item>Pakistan Rupee</item>
-    <item>Palladium</item>
-    <item>Pataca</item>
-    <item>Philippine Peso</item>
-    <item>Platinum</item>
-    <item>Pound Sterling</item>
-    <item>Pula</item>
-    <item>Qatari Rial</item>
-    <item>Quetzal</item>
-    <item>Rand</item>
-    <item>Rial Omani</item>
-    <item>Riel</item>
-    <item>Rufiyaa</item>
-    <item>Rupiah</item>
-    <item>Russian Ruble</item>
-    <item>Rwanda Franc</item>
-    <item>Saint Helena Pound</item>
-    <item>Saudi Riyal</item>
-    <item>SDR (Special Drawing Right)</item>
-    <item>Serbian Dinar</item>
-    <item>Seychelles Rupee</item>
-    <item>Silver</item>
-    <item>Singapore Dollar</item>
-    <item>Solomon Islands Dollar</item>
-    <item>Som</item>
-    <item>Somali Shilling</item>
-    <item>Somoni</item>
-    <item>South Sudanese Pound</item>
-    <item>Sri Lanka Rupee</item>
-    <item>Sucre</item>
-    <item>Sudanese Pound</item>
-    <item>Surinam Dollar</item>
-    <item>Swedish Krona</item>
-    <item>Swiss Franc</item>
-    <item>Syrian Pound</item>
-    <item>Taka</item>
-    <item>Tala</item>
-    <item>Tanzanian Shilling</item>
-    <item>Tenge</item>
-    <item>No currency</item>
-    <item>Trinidad and Tobago Dollar</item>
-    <item>Tugrik</item>
-    <item>Tunisian Dinar</item>
-    <item>Turkish Lira</item>
-    <item>Turkmenistan New Manat</item>
-    <item>UAE Dirham</item>
-    <item>Uganda Shilling</item>
-    <item>UIC-Franc</item>
-    <item>Unidad de Valor Real</item>
-    <item>Unidades de fomento</item>
-    <item>Uruguay Peso en Unidades Indexadas (URUIURUI)</item>
-    <item>Uruguayan Peso</item>
-    <item>US Dollar</item>
-    <item>Uzbekistan Sum</item>
-    <item>Vatu</item>
-    <item>WIR Euro</item>
-    <item>WIR Franc</item>
-    <item>Won</item>
-    <item>Yemeni Rial</item>
-    <item>Yen</item>
-    <item>Yuan Renminbi</item>
-    <item>Zambian Kwacha</item>
-    <item>Zimbabwe Dollar</item>
-    <item>Zloty</item>
-  </string-array>
   <string name="error_no_accounts">Keine Konten vorhanden.\nSie mssen ein Konto erstellen um Widgets anfgen zu knnen.</string>
   <string name="title_build_version">Version</string>
   <string name="title_license">Lizenz</string>
diff --git a/app/src/main/res/values-el-rGR/strings.xml b/app/src/main/res/values-el-rGR/strings.xml
index 1eb4bb06..9b033a1b 100644
--- a/app/src/main/res/values-el-rGR/strings.xml
+++ b/app/src/main/res/values-el-rGR/strings.xml
@@ -85,183 +85,6 @@
   <string name="label_display_account"> </string>
   <string name="btn_create_accounts"> </string>
   <string name="title_default_accounts">   </string>
-  <string-array name="currency_names">
-    <item>Afghani</item>
-    <item>Algerian Dinar</item>
-    <item>Argentine Peso</item>
-    <item>Armenian Dram</item>
-    <item>Aruban Florin</item>
-    <item>Australian Dollar</item>
-    <item>Azerbaijanian Manat</item>
-    <item>Bahamian Dollar</item>
-    <item>Bahraini Dinar</item>
-    <item>Baht</item>
-    <item>Balboa</item>
-    <item>Barbados Dollar</item>
-    <item>Belarussian Ruble</item>
-    <item>Belize Dollar</item>
-    <item>Bermudian Dollar</item>
-    <item>Bolivar Fuerte</item>
-    <item>Boliviano</item>
-    <item>Brazilian Real</item>
-    <item>Brunei Dollar</item>
-    <item>Bulgarian Lev</item>
-    <item>Burundi Franc</item>
-    <item>Canadian Dollar</item>
-    <item>Cape Verde Escudo</item>
-    <item>Cayman Islands Dollar</item>
-    <item>CFA Franc BCEAO</item>
-    <item>CFA Franc BEAC</item>
-    <item>CFP Franc</item>
-    <item>Chilean Peso</item>
-    <item> </item>
-    <item>Colombian Peso</item>
-    <item>Comoro Franc</item>
-    <item>Congolese Franc</item>
-    <item>Convertible Mark</item>
-    <item>Cordoba Oro</item>
-    <item>Costa Rican Colon</item>
-    <item>Croatian Kuna</item>
-    <item>Cuban Convertible Peso</item>
-    <item>Cuban Peso</item>
-    <item>Czech Koruna</item>
-    <item>Dalasi</item>
-    <item>Danish Krone</item>
-    <item>Denar</item>
-    <item>Djibouti Franc</item>
-    <item>Dobra</item>
-    <item>Dominican Peso</item>
-    <item>Dong</item>
-    <item>East Caribbean Dollar</item>
-    <item>Egyptian Pound</item>
-    <item>El Salvador Colon</item>
-    <item>Ethiopian Birr</item>
-    <item></item>
-    <item>Falkland Islands Pound</item>
-    <item>Fiji Dollar</item>
-    <item>Forint</item>
-    <item>Ghana Cedi</item>
-    <item>Gibraltar Pound</item>
-    <item>Gold</item>
-    <item>Gourde</item>
-    <item>Guarani</item>
-    <item>Guinea Franc</item>
-    <item>Guyana Dollar</item>
-    <item>Hong Kong Dollar</item>
-    <item>Hryvnia</item>
-    <item>Iceland Krona</item>
-    <item>Indian Rupee</item>
-    <item>Iranian Rial</item>
-    <item>Iraqi Dinar</item>
-    <item>Jamaican Dollar</item>
-    <item>Jordanian Dinar</item>
-    <item>Kenyan Shilling</item>
-    <item>Kina</item>
-    <item>Kip</item>
-    <item>Kuwaiti Dinar</item>
-    <item>Kwacha</item>
-    <item>Kwanza</item>
-    <item>Kyat</item>
-    <item>Lari</item>
-    <item>Latvian Lats</item>
-    <item>Lebanese Pound</item>
-    <item>Lek</item>
-    <item>Lempira</item>
-    <item>Leone</item>
-    <item>Liberian Dollar</item>
-    <item>Libyan Dinar</item>
-    <item>Lilangeni</item>
-    <item>Lithuanian Litas</item>
-    <item>Loti</item>
-    <item>Malagasy Ariary</item>
-    <item>Malaysian Ringgit</item>
-    <item>Mauritius Rupee</item>
-    <item>Mexican Peso</item>
-    <item>Mexican Unidad de Inversion (UDI)</item>
-    <item>Moldovan Leu</item>
-    <item>Moroccan Dirham</item>
-    <item>Mozambique Metical</item>
-    <item>Mvdol</item>
-    <item>Naira</item>
-    <item>Nakfa</item>
-    <item>Namibia Dollar</item>
-    <item>Nepalese Rupee</item>
-    <item>Netherlands Antillean Guilder</item>
-    <item>New Israeli Sheqel</item>
-    <item>New Romanian Leu</item>
-    <item>New Taiwan Dollar</item>
-    <item>New Zealand Dollar</item>
-    <item>Ngultrum</item>
-    <item>North Korean Won</item>
-    <item>Norwegian Krone</item>
-    <item>Nuevo Sol</item>
-    <item>Ouguiya</item>
-    <item>Paanga</item>
-    <item>Pakistan Rupee</item>
-    <item>Palladium</item>
-    <item>Pataca</item>
-    <item>Philippine Peso</item>
-    <item>Platinum</item>
-    <item>Pound Sterling</item>
-    <item>Pula</item>
-    <item>Qatari Rial</item>
-    <item>Quetzal</item>
-    <item>Rand</item>
-    <item>Rial Omani</item>
-    <item>Riel</item>
-    <item>Rufiyaa</item>
-    <item>Rupiah</item>
-    <item>Russian Ruble</item>
-    <item>Rwanda Franc</item>
-    <item>Saint Helena Pound</item>
-    <item>Saudi Riyal</item>
-    <item>SDR (Special Drawing Right)</item>
-    <item>Serbian Dinar</item>
-    <item>Seychelles Rupee</item>
-    <item>Silver</item>
-    <item>Singapore Dollar</item>
-    <item>Solomon Islands Dollar</item>
-    <item>Som</item>
-    <item>Somali Shilling</item>
-    <item>Somoni</item>
-    <item>South Sudanese Pound</item>
-    <item>Sri Lanka Rupee</item>
-    <item>Sucre</item>
-    <item>Sudanese Pound</item>
-    <item>Surinam Dollar</item>
-    <item>Swedish Krona</item>
-    <item>Swiss Franc</item>
-    <item>Syrian Pound</item>
-    <item>Taka</item>
-    <item>Tala</item>
-    <item>Tanzanian Shilling</item>
-    <item>Tenge</item>
-    <item> </item>
-    <item>Trinidad and Tobago Dollar</item>
-    <item>Tugrik</item>
-    <item>Tunisian Dinar</item>
-    <item>Turkish Lira</item>
-    <item>Turkmenistan New Manat</item>
-    <item>UAE Dirham</item>
-    <item>Uganda Shilling</item>
-    <item>UIC-Franc</item>
-    <item>Unidad de Valor Real</item>
-    <item>Unidades de fomento</item>
-    <item>Uruguay Peso en Unidades Indexadas (URUIURUI)</item>
-    <item>Uruguayan Peso</item>
-    <item>US Dolar</item>
-    <item>Uzbekistan Sum</item>
-    <item>Vatu</item>
-    <item>WIR Euro</item>
-    <item>WIR Franc</item>
-    <item>Won</item>
-    <item>Yemeni Rial</item>
-    <item>Yen</item>
-    <item>Yuan Renminbi</item>
-    <item>Zambian Kwacha</item>
-    <item>Zimbabwe Dollar</item>
-    <item>Zloty</item>
-  </string-array>
   <string name="error_no_accounts">   
 	GnuCash.\n       </string>
   <string name="title_build_version"></string>
diff --git a/app/src/main/res/values-en-rGB/strings.xml b/app/src/main/res/values-en-rGB/strings.xml
index c68c7e3c..54aa639b 100644
--- a/app/src/main/res/values-en-rGB/strings.xml
+++ b/app/src/main/res/values-en-rGB/strings.xml
@@ -85,183 +85,6 @@
   <string name="label_display_account">Display account</string>
   <string name="btn_create_accounts">Create Accounts</string>
   <string name="title_default_accounts">Select accounts to create</string>
-  <string-array name="currency_names">
-    <item>Afghani</item>
-    <item>Algerian Dinar</item>
-    <item>Argentine Peso</item>
-    <item>Armenian Dram</item>
-    <item>Aruban Florin</item>
-    <item>Australian Dollar</item>
-    <item>Azerbaijanian Manat</item>
-    <item>Bahamian Dollar</item>
-    <item>Bahraini Dinar</item>
-    <item>Baht</item>
-    <item>Balboa</item>
-    <item>Barbados Dollar</item>
-    <item>Belarussian Ruble</item>
-    <item>Belize Dollar</item>
-    <item>Bermudian Dollar</item>
-    <item>Bolivar Fuerte</item>
-    <item>Boliviano</item>
-    <item>Brazilian Real</item>
-    <item>Brunei Dollar</item>
-    <item>Bulgarian Lev</item>
-    <item>Burundi Franc</item>
-    <item>Canadian Dollar</item>
-    <item>Cape Verde Escudo</item>
-    <item>Cayman Islands Dollar</item>
-    <item>CFA Franc BCEAO</item>
-    <item>CFA Franc BEAC</item>
-    <item>CFP Franc</item>
-    <item>Chilean Peso</item>
-    <item>Testing currency</item>
-    <item>Colombian Peso</item>
-    <item>Comoro Franc</item>
-    <item>Congolese Franc</item>
-    <item>Convertible Mark</item>
-    <item>Cordoba Oro</item>
-    <item>Costa Rican Colon</item>
-    <item>Croatian Kuna</item>
-    <item>Cuban Convertible Peso</item>
-    <item>Cuban Peso</item>
-    <item>Czech Koruna</item>
-    <item>Dalasi</item>
-    <item>Danish Krone</item>
-    <item>Denar</item>
-    <item>Djibouti Franc</item>
-    <item>Dobra</item>
-    <item>Dominican Peso</item>
-    <item>Dong</item>
-    <item>East Caribbean Dollar</item>
-    <item>Egyptian Pound</item>
-    <item>El Salvador Colon</item>
-    <item>Ethiopian Birr</item>
-    <item>Euro</item>
-    <item>Falkland Islands Pound</item>
-    <item>Fiji Dollar</item>
-    <item>Forint</item>
-    <item>Ghana Cedi</item>
-    <item>Gibraltar Pound</item>
-    <item>Gold</item>
-    <item>Gourde</item>
-    <item>Guarani</item>
-    <item>Guinea Franc</item>
-    <item>Guyana Dollar</item>
-    <item>Hong Kong Dollar</item>
-    <item>Hryvnia</item>
-    <item>Iceland Krona</item>
-    <item>Indian Rupee</item>
-    <item>Iranian Rial</item>
-    <item>Iraqi Dinar</item>
-    <item>Jamaican Dollar</item>
-    <item>Jordanian Dinar</item>
-    <item>Kenyan Shilling</item>
-    <item>Kina</item>
-    <item>Kip</item>
-    <item>Kuwaiti Dinar</item>
-    <item>Kwacha</item>
-    <item>Kwanza</item>
-    <item>Kyat</item>
-    <item>Lari</item>
-    <item>Latvian Lats</item>
-    <item>Lebanese Pound</item>
-    <item>Lek</item>
-    <item>Lempira</item>
-    <item>Leone</item>
-    <item>Liberian Dollar</item>
-    <item>Libyan Dinar</item>
-    <item>Lilangeni</item>
-    <item>Lithuanian Litas</item>
-    <item>Loti</item>
-    <item>Malagasy Ariary</item>
-    <item>Malaysian Ringgit</item>
-    <item>Mauritius Rupee</item>
-    <item>Mexican Peso</item>
-    <item>Mexican Unidad de Inversion (UDI)</item>
-    <item>Moldovan Leu</item>
-    <item>Moroccan Dirham</item>
-    <item>Mozambique Metical</item>
-    <item>Mvdol</item>
-    <item>Naira</item>
-    <item>Nakfa</item>
-    <item>Namibia Dollar</item>
-    <item>Nepalese Rupee</item>
-    <item>Netherlands Antillean Guilder</item>
-    <item>New Israeli Sheqel</item>
-    <item>New Romanian Leu</item>
-    <item>New Taiwan Dollar</item>
-    <item>New Zealand Dollar</item>
-    <item>Ngultrum</item>
-    <item>North Korean Won</item>
-    <item>Norwegian Krone</item>
-    <item>Nuevo Sol</item>
-    <item>Ouguiya</item>
-    <item>Paanga</item>
-    <item>Pakistan Rupee</item>
-    <item>Palladium</item>
-    <item>Pataca</item>
-    <item>Philippine Peso</item>
-    <item>Platinum</item>
-    <item>Pound Sterling</item>
-    <item>Pula</item>
-    <item>Qatari Rial</item>
-    <item>Quetzal</item>
-    <item>Rand</item>
-    <item>Rial Omani</item>
-    <item>Riel</item>
-    <item>Rufiyaa</item>
-    <item>Rupiah</item>
-    <item>Russian Ruble</item>
-    <item>Rwanda Franc</item>
-    <item>Saint Helena Pound</item>
-    <item>Saudi Riyal</item>
-    <item>SDR (Special Drawing Right)</item>
-    <item>Serbian Dinar</item>
-    <item>Seychelles Rupee</item>
-    <item>Silver</item>
-    <item>Singapore Dollar</item>
-    <item>Solomon Islands Dollar</item>
-    <item>Som</item>
-    <item>Somali Shilling</item>
-    <item>Somoni</item>
-    <item>South Sudanese Pound</item>
-    <item>Sri Lanka Rupee</item>
-    <item>Sucre</item>
-    <item>Sudanese Pound</item>
-    <item>Surinam Dollar</item>
-    <item>Swedish Krona</item>
-    <item>Swiss Franc</item>
-    <item>Syrian Pound</item>
-    <item>Taka</item>
-    <item>Tala</item>
-    <item>Tanzanian Shilling</item>
-    <item>Tenge</item>
-    <item>No currency</item>
-    <item>Trinidad and Tobago Dollar</item>
-    <item>Tugrik</item>
-    <item>Tunisian Dinar</item>
-    <item>Turkish Lira</item>
-    <item>Turkmenistan New Manat</item>
-    <item>UAE Dirham</item>
-    <item>Uganda Shilling</item>
-    <item>UIC-Franc</item>
-    <item>Unidad de Valor Real</item>
-    <item>Unidades de fomento</item>
-    <item>Uruguay Peso en Unidades Indexadas (URUIURUI)</item>
-    <item>Uruguayan peso</item>
-    <item>US Dollar</item>
-    <item>Uzbekistan Sum</item>
-    <item>Vatu</item>
-    <item>WIR Euro</item>
-    <item>WIR Franc</item>
-    <item>Won</item>
-    <item>Yemeni Rial</item>
-    <item>Yen</item>
-    <item>Yuan Renminbi</item>
-    <item>Zambian Kwacha</item>
-    <item>Zimbabwe Dollar</item>
-    <item>Zloty</item>
-  </string-array>
   <string name="error_no_accounts">No accounts exist in GnuCash.\nCreate an account before adding a widget</string>
   <string name="title_build_version">Build version</string>
   <string name="title_license">License</string>
diff --git a/app/src/main/res/values-es-rMX/strings.xml b/app/src/main/res/values-es-rMX/strings.xml
index dadd5fb7..276b7d0e 100644
--- a/app/src/main/res/values-es-rMX/strings.xml
+++ b/app/src/main/res/values-es-rMX/strings.xml
@@ -85,183 +85,6 @@
   <string name="label_display_account">Mostrar cuentas</string>
   <string name="btn_create_accounts">Crear Cuentas</string>
   <string name="title_default_accounts">Seleccionar cuentas a crear</string>
-  <string-array name="currency_names">
-    <item>Afgani</item>
-    <item>Dinar Argelino</item>
-    <item>Peso Argentino</item>
-    <item>Dram Armenio</item>
-    <item>Florin Arubeo</item>
-    <item>Dolar Australiano</item>
-    <item>Manat Azer</item>
-    <item>Dolar Bahameo</item>
-    <item>Dinar Barein</item>
-    <item>Baht Tailands</item>
-    <item>Balboa Panameo</item>
-    <item>Dolar Barbadense</item>
-    <item>Rublo Bieloruso</item>
-    <item>Dolar Beliceo</item>
-    <item>Dolar Bermudeo</item>
-    <item>Bolivar Fuerte</item>
-    <item>Boliviano</item>
-    <item>Real Brasileo</item>
-    <item>Dolar Bruneano</item>
-    <item>Lev Blgaro</item>
-    <item>Franco Burunds</item>
-    <item>Dolar Canadiense</item>
-    <item>Escudo caboverdiano</item>
-    <item>Dolar de las slas Caimn</item>
-    <item>Franco CFA de frica Occidental</item>
-    <item>Franco CFA de frica Central</item>
-    <item>Franco CFP</item>
-    <item>Peso Chileno</item>
-    <item>Moneda de prueba</item>
-    <item>Peso Colombiano</item>
-    <item>Franco Comorono</item>
-    <item>Franco Congols</item>
-    <item>Marco Bosnioherzegovino</item>
-    <item>Crdoba Nicaragense</item>
-    <item>Coln Costarricense</item>
-    <item>Kuna Croata</item>
-    <item>Peso convertible</item>
-    <item>Peso Cubano</item>
-    <item>Corona Checa</item>
-    <item>Dalasi</item>
-    <item>Corona Danesa</item>
-    <item>Denar Macedonio</item>
-    <item>Franco Yibutiano</item>
-    <item>Dobra santotomense</item>
-    <item>Peso dominicano</item>
-    <item>Dong vietnamita</item>
-    <item>Dlar del Caribe Oriental</item>
-    <item>Libra egipcia</item>
-    <item>Coln salvadoreo</item>
-    <item>Birr etope</item>
-    <item>Euro</item>
-    <item>Libra malvinense</item>
-    <item>Dlar fiyiano</item>
-    <item>Forinto hngaro</item>
-    <item>Cedi</item>
-    <item>Libra gibraltarea</item>
-    <item>Oro</item>
-    <item>Gourde</item>
-    <item>Guaran</item>
-    <item>Franco guineano</item>
-    <item>Dlar guyans</item>
-    <item>Dlar de Hong Kong</item>
-    <item>Grivna</item>
-    <item>Corona islandesa</item>
-    <item>Rupia india</item>
-    <item>Rial iran</item>
-    <item>Dinar iraqu</item>
-    <item>Dlar jamaiquino</item>
-    <item>Dinar jodano</item>
-    <item>Cheln keniano</item>
-    <item>Kina</item>
-    <item>Kip</item>
-    <item>Dinar kuwait</item>
-    <item>Kwacha</item>
-    <item>Kwanza angoleo</item>
-    <item>Kyat birmano</item>
-    <item>Lari georgiano</item>
-    <item>Lats letn</item>
-    <item>Libra libanesa</item>
-    <item>Lek albans</item>
-    <item>Lempira hondurea</item>
-    <item>Leone</item>
-    <item>Dlar liberiano</item>
-    <item>Dinar libio</item>
-    <item>Lilangeni suazi</item>
-    <item>Litas lituana</item>
-    <item>Loti</item>
-    <item>Ariary malgache</item>
-    <item>Ringgit malayo</item>
-    <item>Rupia de Mauricio</item>
-    <item>Peso mexicano</item>
-    <item>Unidad de Inversin Mexicana (UDI)</item>
-    <item>Leu moldavo</item>
-    <item>Drham marroqu</item>
-    <item>Metical mozambiqueo</item>
-    <item>Mvdol</item>
-    <item>Naira nigeriana</item>
-    <item>Nakfa</item>
-    <item>Dlar namibio</item>
-    <item>Rupia nepal</item>
-    <item>Florn antillano neerlands</item>
-    <item>Nuevo shquel israel</item>
-    <item>Nuevo leu rumano</item>
-    <item>Nuevo dlar taiwans</item>
-    <item>Dlar neozelands</item>
-    <item>Ngultrum butans</item>
-    <item>Won norcoreano</item>
-    <item>Corona noruega</item>
-    <item>Nuevo Sol</item>
-    <item>Uguiya</item>
-    <item>Dlar tongano</item>
-    <item>Rupia pakistan</item>
-    <item>Palladium</item>
-    <item>Pataca</item>
-    <item>Peso filipino</item>
-    <item>Platino</item>
-    <item>Libra esterlina</item>
-    <item>Pula</item>
-    <item>Riyal catar</item>
-    <item>Quetzal</item>
-    <item>Rand sudafricano</item>
-    <item>Rial oman</item>
-    <item>Riel</item>
-    <item>Rupia de Maldivas</item>
-    <item>Rupia indonesia</item>
-    <item>Rublo ruso</item>
-    <item>Franco ruands</item>
-    <item>Libra de Santa Elena</item>
-    <item>Riyal saud</item>
-    <item>Derechos Especiales de Giro (SDR)</item>
-    <item>Dinar serbio</item>
-    <item>Rupia de Seychelles</item>
-    <item>Plata</item>
-    <item>Dlar de Singapur</item>
-    <item>Dlar de las Islas Salomn</item>
-    <item>Som</item>
-    <item>Cheln somal</item>
-    <item>Somoni tayiko</item>
-    <item>Libra sursudanesa</item>
-    <item>Rupia de Sri Lanka</item>
-    <item>Sucre</item>
-    <item>Libra sudanesa</item>
-    <item>Dlar surinams</item>
-    <item>Corona sueca</item>
-    <item>Franco suizo</item>
-    <item>Libra siria</item>
-    <item>Taka</item>
-    <item>Tala samoana</item>
-    <item>Cheln tanzano</item>
-    <item>Tenge kazajo</item>
-    <item>Sin moneda</item>
-    <item>Dlar trinitense</item>
-    <item>Tugrik mongol</item>
-    <item>Dinar tunecino</item>
-    <item>Lira turca</item>
-    <item>Manat turkmeno</item>
-    <item>Drham de los Emiratos rabes Unidos</item>
-    <item>Cheln ugands</item>
-    <item>Franco UIC</item>
-    <item>Unidad de Valor Real</item>
-    <item>Unidades de fomento</item>
-    <item>Peso uruguayo en Unidades Indexadas (URUIURUI)</item>
-    <item>Peso uruguayo</item>
-    <item>Dlar Estadounidense</item>
-    <item>Som uzbeko</item>
-    <item>Vatu</item>
-    <item>Euro WIR</item>
-    <item>Franco WIR</item>
-    <item>Won surcoreano</item>
-    <item>Rail yemen</item>
-    <item>Yen japons</item>
-    <item>Yuan chino</item>
-    <item>Kwacha zambiano</item>
-    <item>Dlar zimbabuense</item>
-    <item>Zloty polaco</item>
-  </string-array>
   <string name="error_no_accounts">No hay cuentas en Gnucash.\nCree una cuenta antes de aadir un widget</string>
   <string name="title_build_version">Versin de compilacin</string>
   <string name="title_license">Licencia</string>
diff --git a/app/src/main/res/values-es/strings.xml b/app/src/main/res/values-es/strings.xml
index 48e4feae..d0f5da33 100644
--- a/app/src/main/res/values-es/strings.xml
+++ b/app/src/main/res/values-es/strings.xml
@@ -85,183 +85,6 @@
   <string name="label_display_account">Mostrar cuentas</string>
   <string name="btn_create_accounts">Crear Cuentas</string>
   <string name="title_default_accounts">Seleccionar cuentas a crear</string>
-  <string-array name="currency_names">
-    <item>Afgani</item>
-    <item>Dinar Argelino</item>
-    <item>Peso Argentino</item>
-    <item>Dram Armenio</item>
-    <item>Florin Arubeo</item>
-    <item>Dolar Australiano</item>
-    <item>Manat Azer</item>
-    <item>Dolar Bahameo</item>
-    <item>Dinar Barein</item>
-    <item>Baht Tailands</item>
-    <item>Balboa Panameo</item>
-    <item>Dolar Barbadense</item>
-    <item>Rublo Bieloruso</item>
-    <item>Dolar Beliceo</item>
-    <item>Dolar Bermudeo</item>
-    <item>Bolvar Fuerte</item>
-    <item>Boliviano</item>
-    <item>Real Brasileo</item>
-    <item>Dolar Bruneano</item>
-    <item>Lev Blgaro</item>
-    <item>Franco Burunds</item>
-    <item>Dolar Canadiense</item>
-    <item>Escudo caboverdiano</item>
-    <item>Dolar de las slas Caimn</item>
-    <item>Franco CFA de frica Occidental</item>
-    <item>Franco CFA de frica Central</item>
-    <item>Franco CFP</item>
-    <item>Peso Chileno</item>
-    <item>Moneda de prueba</item>
-    <item>Peso Colombiano</item>
-    <item>Franco Comorono</item>
-    <item>Franco Congols</item>
-    <item>Marco Bosnioherzegovino</item>
-    <item>Crdoba Nicaragense</item>
-    <item>Coln Costarricense</item>
-    <item>Kuna Croata</item>
-    <item>Peso convertible</item>
-    <item>Peso Cubano</item>
-    <item>Corona Checa</item>
-    <item>Dalasi</item>
-    <item>Corona Danesa</item>
-    <item>Denar Macedonio</item>
-    <item>Franco Yibutiano</item>
-    <item>Dobra santotomense</item>
-    <item>Peso dominicano</item>
-    <item>Dong vietnamita</item>
-    <item>Dlar del Caribe Oriental</item>
-    <item>Libra egipcia</item>
-    <item>Coln salvadoreo</item>
-    <item>Birr etope</item>
-    <item>Euro</item>
-    <item>Libra malvinense</item>
-    <item>Dlar fiyiano</item>
-    <item>Forinto hngaro</item>
-    <item>Cedi</item>
-    <item>Libra gibraltarea</item>
-    <item>Oro</item>
-    <item>Gourde</item>
-    <item>Guaran</item>
-    <item>Franco guineano</item>
-    <item>Dlar guyans</item>
-    <item>Dlar de Hong Kong</item>
-    <item>Grivna</item>
-    <item>Corona islandesa</item>
-    <item>Rupia india</item>
-    <item>Rial iran</item>
-    <item>Dinar iraqu</item>
-    <item>Dlar jamaiquino</item>
-    <item>Dinar jodano</item>
-    <item>Cheln keniano</item>
-    <item>Kina</item>
-    <item>Kip</item>
-    <item>Dinar kuwait</item>
-    <item>Kwacha</item>
-    <item>Kwanza angoleo</item>
-    <item>Kyat birmano</item>
-    <item>Lari georgiano</item>
-    <item>Lats letn</item>
-    <item>Libra libanesa</item>
-    <item>Lek albans</item>
-    <item>Lempira hondurea</item>
-    <item>Leone</item>
-    <item>Dlar liberiano</item>
-    <item>Dinar libio</item>
-    <item>Lilangeni suazi</item>
-    <item>Litas lituana</item>
-    <item>Loti</item>
-    <item>Ariary malgache</item>
-    <item>Ringgit malayo</item>
-    <item>Rupia de Mauricio</item>
-    <item>Peso mexicano</item>
-    <item>Unidad de Inversin Mexicana (UDI)</item>
-    <item>Leu moldavo</item>
-    <item>Drham marroqu</item>
-    <item>Metical mozambiqueo</item>
-    <item>Mvdol</item>
-    <item>Naira nigeriana</item>
-    <item>Nakfa</item>
-    <item>Dlar namibio</item>
-    <item>Rupia nepal</item>
-    <item>Florn antillano neerlands</item>
-    <item>Nuevo shquel israel</item>
-    <item>Nuevo leu rumano</item>
-    <item>Nuevo dlar taiwans</item>
-    <item>Dlar neozelands</item>
-    <item>Ngultrum butans</item>
-    <item>Won norcoreano</item>
-    <item>Corona noruega</item>
-    <item>Nuevo Sol</item>
-    <item>Uguiya</item>
-    <item>Dlar tongano</item>
-    <item>Rupia pakistan</item>
-    <item>Palladium</item>
-    <item>Pataca</item>
-    <item>Peso filipino</item>
-    <item>Platino</item>
-    <item>Libra esterlina</item>
-    <item>Pula</item>
-    <item>Riyal catar</item>
-    <item>Quetzal</item>
-    <item>Rand sudafricano</item>
-    <item>Rial oman</item>
-    <item>Riel</item>
-    <item>Rupia de Maldivas</item>
-    <item>Rupia indonesia</item>
-    <item>Rublo ruso</item>
-    <item>Franco ruands</item>
-    <item>Libra de Santa Elena</item>
-    <item>Riyal saud</item>
-    <item>Derechos Especiales de Giro (SDR)</item>
-    <item>Dinar serbio</item>
-    <item>Rupia de Seychelles</item>
-    <item>Plata</item>
-    <item>Dlar de Singapur</item>
-    <item>Dlar de las Islas Salomn</item>
-    <item>Som</item>
-    <item>Cheln somal</item>
-    <item>Somoni tayiko</item>
-    <item>Libra sursudanesa</item>
-    <item>Rupia de Sri Lanka</item>
-    <item>Sucre</item>
-    <item>Libra sudanesa</item>
-    <item>Dlar surinams</item>
-    <item>Corona sueca</item>
-    <item>Franco suizo</item>
-    <item>Libra siria</item>
-    <item>Taka</item>
-    <item>Tala samoana</item>
-    <item>Cheln tanzano</item>
-    <item>Tenge kazajo</item>
-    <item>Sin moneda</item>
-    <item>Dlar trinitense</item>
-    <item>Tugrik mongol</item>
-    <item>Dinar tunecino</item>
-    <item>Lira turca</item>
-    <item>Manat turkmeno</item>
-    <item>Drham de los Emiratos rabes Unidos</item>
-    <item>Cheln ugands</item>
-    <item>Franco UIC</item>
-    <item>Unidad de Valor Real</item>
-    <item>Unidades de fomento</item>
-    <item>Peso uruguayo en Unidades Indexadas (URUIURUI)</item>
-    <item>Peso uruguayo</item>
-    <item>Dlar Estadounidense</item>
-    <item>Som uzbeko</item>
-    <item>Vatu</item>
-    <item>Euro WIR</item>
-    <item>Franco WIR</item>
-    <item>Won surcoreano</item>
-    <item>Rail yemen</item>
-    <item>Yen japons</item>
-    <item>Yuan chino</item>
-    <item>Kwacha zambiano</item>
-    <item>Dlar zimbabuense</item>
-    <item>Zloty polaco</item>
-  </string-array>
   <string name="error_no_accounts">No hay cuentas en Gnucash.\nCree una cuenta antes de aadir un widget</string>
   <string name="title_build_version">Versin de compilacin</string>
   <string name="title_license">Licencia</string>
diff --git a/app/src/main/res/values-fi-rFI/strings.xml b/app/src/main/res/values-fi-rFI/strings.xml
index c68c7e3c..54aa639b 100644
--- a/app/src/main/res/values-fi-rFI/strings.xml
+++ b/app/src/main/res/values-fi-rFI/strings.xml
@@ -85,183 +85,6 @@
   <string name="label_display_account">Display account</string>
   <string name="btn_create_accounts">Create Accounts</string>
   <string name="title_default_accounts">Select accounts to create</string>
-  <string-array name="currency_names">
-    <item>Afghani</item>
-    <item>Algerian Dinar</item>
-    <item>Argentine Peso</item>
-    <item>Armenian Dram</item>
-    <item>Aruban Florin</item>
-    <item>Australian Dollar</item>
-    <item>Azerbaijanian Manat</item>
-    <item>Bahamian Dollar</item>
-    <item>Bahraini Dinar</item>
-    <item>Baht</item>
-    <item>Balboa</item>
-    <item>Barbados Dollar</item>
-    <item>Belarussian Ruble</item>
-    <item>Belize Dollar</item>
-    <item>Bermudian Dollar</item>
-    <item>Bolivar Fuerte</item>
-    <item>Boliviano</item>
-    <item>Brazilian Real</item>
-    <item>Brunei Dollar</item>
-    <item>Bulgarian Lev</item>
-    <item>Burundi Franc</item>
-    <item>Canadian Dollar</item>
-    <item>Cape Verde Escudo</item>
-    <item>Cayman Islands Dollar</item>
-    <item>CFA Franc BCEAO</item>
-    <item>CFA Franc BEAC</item>
-    <item>CFP Franc</item>
-    <item>Chilean Peso</item>
-    <item>Testing currency</item>
-    <item>Colombian Peso</item>
-    <item>Comoro Franc</item>
-    <item>Congolese Franc</item>
-    <item>Convertible Mark</item>
-    <item>Cordoba Oro</item>
-    <item>Costa Rican Colon</item>
-    <item>Croatian Kuna</item>
-    <item>Cuban Convertible Peso</item>
-    <item>Cuban Peso</item>
-    <item>Czech Koruna</item>
-    <item>Dalasi</item>
-    <item>Danish Krone</item>
-    <item>Denar</item>
-    <item>Djibouti Franc</item>
-    <item>Dobra</item>
-    <item>Dominican Peso</item>
-    <item>Dong</item>
-    <item>East Caribbean Dollar</item>
-    <item>Egyptian Pound</item>
-    <item>El Salvador Colon</item>
-    <item>Ethiopian Birr</item>
-    <item>Euro</item>
-    <item>Falkland Islands Pound</item>
-    <item>Fiji Dollar</item>
-    <item>Forint</item>
-    <item>Ghana Cedi</item>
-    <item>Gibraltar Pound</item>
-    <item>Gold</item>
-    <item>Gourde</item>
-    <item>Guarani</item>
-    <item>Guinea Franc</item>
-    <item>Guyana Dollar</item>
-    <item>Hong Kong Dollar</item>
-    <item>Hryvnia</item>
-    <item>Iceland Krona</item>
-    <item>Indian Rupee</item>
-    <item>Iranian Rial</item>
-    <item>Iraqi Dinar</item>
-    <item>Jamaican Dollar</item>
-    <item>Jordanian Dinar</item>
-    <item>Kenyan Shilling</item>
-    <item>Kina</item>
-    <item>Kip</item>
-    <item>Kuwaiti Dinar</item>
-    <item>Kwacha</item>
-    <item>Kwanza</item>
-    <item>Kyat</item>
-    <item>Lari</item>
-    <item>Latvian Lats</item>
-    <item>Lebanese Pound</item>
-    <item>Lek</item>
-    <item>Lempira</item>
-    <item>Leone</item>
-    <item>Liberian Dollar</item>
-    <item>Libyan Dinar</item>
-    <item>Lilangeni</item>
-    <item>Lithuanian Litas</item>
-    <item>Loti</item>
-    <item>Malagasy Ariary</item>
-    <item>Malaysian Ringgit</item>
-    <item>Mauritius Rupee</item>
-    <item>Mexican Peso</item>
-    <item>Mexican Unidad de Inversion (UDI)</item>
-    <item>Moldovan Leu</item>
-    <item>Moroccan Dirham</item>
-    <item>Mozambique Metical</item>
-    <item>Mvdol</item>
-    <item>Naira</item>
-    <item>Nakfa</item>
-    <item>Namibia Dollar</item>
-    <item>Nepalese Rupee</item>
-    <item>Netherlands Antillean Guilder</item>
-    <item>New Israeli Sheqel</item>
-    <item>New Romanian Leu</item>
-    <item>New Taiwan Dollar</item>
-    <item>New Zealand Dollar</item>
-    <item>Ngultrum</item>
-    <item>North Korean Won</item>
-    <item>Norwegian Krone</item>
-    <item>Nuevo Sol</item>
-    <item>Ouguiya</item>
-    <item>Paanga</item>
-    <item>Pakistan Rupee</item>
-    <item>Palladium</item>
-    <item>Pataca</item>
-    <item>Philippine Peso</item>
-    <item>Platinum</item>
-    <item>Pound Sterling</item>
-    <item>Pula</item>
-    <item>Qatari Rial</item>
-    <item>Quetzal</item>
-    <item>Rand</item>
-    <item>Rial Omani</item>
-    <item>Riel</item>
-    <item>Rufiyaa</item>
-    <item>Rupiah</item>
-    <item>Russian Ruble</item>
-    <item>Rwanda Franc</item>
-    <item>Saint Helena Pound</item>
-    <item>Saudi Riyal</item>
-    <item>SDR (Special Drawing Right)</item>
-    <item>Serbian Dinar</item>
-    <item>Seychelles Rupee</item>
-    <item>Silver</item>
-    <item>Singapore Dollar</item>
-    <item>Solomon Islands Dollar</item>
-    <item>Som</item>
-    <item>Somali Shilling</item>
-    <item>Somoni</item>
-    <item>South Sudanese Pound</item>
-    <item>Sri Lanka Rupee</item>
-    <item>Sucre</item>
-    <item>Sudanese Pound</item>
-    <item>Surinam Dollar</item>
-    <item>Swedish Krona</item>
-    <item>Swiss Franc</item>
-    <item>Syrian Pound</item>
-    <item>Taka</item>
-    <item>Tala</item>
-    <item>Tanzanian Shilling</item>
-    <item>Tenge</item>
-    <item>No currency</item>
-    <item>Trinidad and Tobago Dollar</item>
-    <item>Tugrik</item>
-    <item>Tunisian Dinar</item>
-    <item>Turkish Lira</item>
-    <item>Turkmenistan New Manat</item>
-    <item>UAE Dirham</item>
-    <item>Uganda Shilling</item>
-    <item>UIC-Franc</item>
-    <item>Unidad de Valor Real</item>
-    <item>Unidades de fomento</item>
-    <item>Uruguay Peso en Unidades Indexadas (URUIURUI)</item>
-    <item>Uruguayan peso</item>
-    <item>US Dollar</item>
-    <item>Uzbekistan Sum</item>
-    <item>Vatu</item>
-    <item>WIR Euro</item>
-    <item>WIR Franc</item>
-    <item>Won</item>
-    <item>Yemeni Rial</item>
-    <item>Yen</item>
-    <item>Yuan Renminbi</item>
-    <item>Zambian Kwacha</item>
-    <item>Zimbabwe Dollar</item>
-    <item>Zloty</item>
-  </string-array>
   <string name="error_no_accounts">No accounts exist in GnuCash.\nCreate an account before adding a widget</string>
   <string name="title_build_version">Build version</string>
   <string name="title_license">License</string>
diff --git a/app/src/main/res/values-fr/strings.xml b/app/src/main/res/values-fr/strings.xml
index 10ac0756..547ffb19 100644
--- a/app/src/main/res/values-fr/strings.xml
+++ b/app/src/main/res/values-fr/strings.xml
@@ -85,183 +85,6 @@
   <string name="label_display_account">Afficher le compte</string>
   <string name="btn_create_accounts">Crer les comptes</string>
   <string name="title_default_accounts">Choisisez les comptes  crs</string>
-  <string-array name="currency_names">
-    <item>Afghani</item>
-    <item>Algerian Dinar</item>
-    <item>Argentine Peso</item>
-    <item>Armenian Dram</item>
-    <item>Aruban Florin</item>
-    <item>Australian Dollar</item>
-    <item>Azerbaijanian Manat</item>
-    <item>Bahamian Dollar</item>
-    <item>Bahraini Dinar</item>
-    <item>Baht</item>
-    <item>Balboa</item>
-    <item>Barbados Dollar</item>
-    <item>Belarussian Ruble</item>
-    <item>Belize Dollar</item>
-    <item>Bermudian Dollar</item>
-    <item>Bolivar Fuerte</item>
-    <item>Boliviano</item>
-    <item>Brazilian Real</item>
-    <item>Brunei Dollar</item>
-    <item>Bulgarian Lev</item>
-    <item>Burundi Franc</item>
-    <item>Canadian Dollar</item>
-    <item>Cape Verde Escudo</item>
-    <item>Cayman Islands Dollar</item>
-    <item>CFA Franc BCEAO</item>
-    <item>CFA Franc BEAC</item>
-    <item>CFP Franc</item>
-    <item>Chilean Peso</item>
-    <item>Testing currency</item>
-    <item>Colombian Peso</item>
-    <item>Comoro Franc</item>
-    <item>Congolese Franc</item>
-    <item>Convertible Mark</item>
-    <item>Cordoba Oro</item>
-    <item>Costa Rican Colon</item>
-    <item>Croatian Kuna</item>
-    <item>Cuban Convertible Peso</item>
-    <item>Cuban Peso</item>
-    <item>Czech Koruna</item>
-    <item>Dalasi</item>
-    <item>Danish Krone</item>
-    <item>Denar</item>
-    <item>Djibouti Franc</item>
-    <item>Dobra</item>
-    <item>Dominican Peso</item>
-    <item>Dong</item>
-    <item>East Caribbean Dollar</item>
-    <item>Egyptian Pound</item>
-    <item>El Salvador Colon</item>
-    <item>Ethiopian Birr</item>
-    <item>Euro</item>
-    <item>Falkland Islands Pound</item>
-    <item>Fiji Dollar</item>
-    <item>Forint</item>
-    <item>Ghana Cedi</item>
-    <item>Gibraltar Pound</item>
-    <item>Gold</item>
-    <item>Gourde</item>
-    <item>Guarani</item>
-    <item>Guinea Franc</item>
-    <item>Guyana Dollar</item>
-    <item>Hong Kong Dollar</item>
-    <item>Hryvnia</item>
-    <item>Iceland Krona</item>
-    <item>Indian Rupee</item>
-    <item>Iranian Rial</item>
-    <item>Iraqi Dinar</item>
-    <item>Jamaican Dollar</item>
-    <item>Jordanian Dinar</item>
-    <item>Kenyan Shilling</item>
-    <item>Kina</item>
-    <item>Kip</item>
-    <item>Kuwaiti Dinar</item>
-    <item>Kwacha</item>
-    <item>Kwanza</item>
-    <item>Kyat</item>
-    <item>Lari</item>
-    <item>Latvian Lats</item>
-    <item>Lebanese Pound</item>
-    <item>Lek</item>
-    <item>Lempira</item>
-    <item>Leone</item>
-    <item>Liberian Dollar</item>
-    <item>Libyan Dinar</item>
-    <item>Lilangeni</item>
-    <item>Lithuanian Litas</item>
-    <item>Loti</item>
-    <item>Malagasy Ariary</item>
-    <item>Malaysian Ringgit</item>
-    <item>Mauritius Rupee</item>
-    <item>Mexican Peso</item>
-    <item>Mexican Unidad de Inversion (UDI)</item>
-    <item>Moldovan Leu</item>
-    <item>Moroccan Dirham</item>
-    <item>Mozambique Metical</item>
-    <item>Mvdol</item>
-    <item>Naira</item>
-    <item>Nakfa</item>
-    <item>Namibia Dollar</item>
-    <item>Nepalese Rupee</item>
-    <item>Netherlands Antillean Guilder</item>
-    <item>New Israeli Sheqel</item>
-    <item>New Romanian Leu</item>
-    <item>New Taiwan Dollar</item>
-    <item>New Zealand Dollar</item>
-    <item>Ngultrum</item>
-    <item>North Korean Won</item>
-    <item>Norwegian Krone</item>
-    <item>Nuevo Sol</item>
-    <item>Ouguiya</item>
-    <item>Paanga</item>
-    <item>Pakistan Rupee</item>
-    <item>Palladium</item>
-    <item>Pataca</item>
-    <item>Philippine Peso</item>
-    <item>Platinum</item>
-    <item>Pound Sterling</item>
-    <item>Pula</item>
-    <item>Qatari Rial</item>
-    <item>Quetzal</item>
-    <item>Rand</item>
-    <item>Rial Omani</item>
-    <item>Riel</item>
-    <item>Rufiyaa</item>
-    <item>Rupiah</item>
-    <item>Russian Ruble</item>
-    <item>Rwanda Franc</item>
-    <item>Saint Helena Pound</item>
-    <item>Saudi Riyal</item>
-    <item>SDR (Special Drawing Right)</item>
-    <item>Serbian Dinar</item>
-    <item>Seychelles Rupee</item>
-    <item>Silver</item>
-    <item>Singapore Dollar</item>
-    <item>Solomon Islands Dollar</item>
-    <item>Som</item>
-    <item>Somali Shilling</item>
-    <item>Somoni</item>
-    <item>South Sudanese Pound</item>
-    <item>Sri Lanka Rupee</item>
-    <item>Sucre</item>
-    <item>Sudanese Pound</item>
-    <item>Surinam Dollar</item>
-    <item>Swedish Krona</item>
-    <item>Swiss Franc</item>
-    <item>Syrian Pound</item>
-    <item>Taka</item>
-    <item>Tala</item>
-    <item>Tanzanian Shilling</item>
-    <item>Tenge</item>
-    <item>No currency</item>
-    <item>Trinidad and Tobago Dollar</item>
-    <item>Tugrik</item>
-    <item>Tunisian Dinar</item>
-    <item>Turkish Lira</item>
-    <item>Turkmenistan New Manat</item>
-    <item>UAE Dirham</item>
-    <item>Uganda Shilling</item>
-    <item>UIC-Franc</item>
-    <item>Unidad de Valor Real</item>
-    <item>Unidades de fomento</item>
-    <item>Uruguay Peso en Unidades Indexadas (URUIURUI)</item>
-    <item>Uruguayan Peso</item>
-    <item>US Dollar</item>
-    <item>Uzbekistan Sum</item>
-    <item>Vatu</item>
-    <item>WIR Euro</item>
-    <item>WIR Franc</item>
-    <item>Won</item>
-    <item>Yemeni Rial</item>
-    <item>Yen</item>
-    <item>Yuan Renminbi</item>
-    <item>Zambian Kwacha</item>
-    <item>Zimbabwe Dollar</item>
-    <item>Zloty</item>
-  </string-array>
   <string name="error_no_accounts">Aucun compte xistant dans GnuCash.\nCrez un compte avant d\'ajouter un widget</string>
   <string name="title_build_version">Version logiciel</string>
   <string name="title_license">Licence</string>
diff --git a/app/src/main/res/values-hu-rHU/strings.xml b/app/src/main/res/values-hu-rHU/strings.xml
index d16cedb1..f6e4e0ff 100644
--- a/app/src/main/res/values-hu-rHU/strings.xml
+++ b/app/src/main/res/values-hu-rHU/strings.xml
@@ -85,183 +85,6 @@
   <string name="label_display_account">Display account</string>
   <string name="btn_create_accounts">Create Accounts</string>
   <string name="title_default_accounts">Select accounts to create</string>
-  <string-array name="currency_names">
-    <item>Afghani</item>
-    <item>Algerian Dinar</item>
-    <item>Argentine Peso</item>
-    <item>Armenian Dram</item>
-    <item>Aruban Florin</item>
-    <item>Australian Dollar</item>
-    <item>Azerbaijanian Manat</item>
-    <item>Bahamian Dollar</item>
-    <item>Bahraini Dinar</item>
-    <item>Baht</item>
-    <item>Balboa</item>
-    <item>Barbados Dollar</item>
-    <item>Belarussian Ruble</item>
-    <item>Belize Dollar</item>
-    <item>Bermudian Dollar</item>
-    <item>Bolivar Fuerte</item>
-    <item>Boliviano</item>
-    <item>Brazilian Real</item>
-    <item>Brunei Dollar</item>
-    <item>Bulgarian Lev</item>
-    <item>Burundi Franc</item>
-    <item>Canadian Dollar</item>
-    <item>Cape Verde Escudo</item>
-    <item>Cayman Islands Dollar</item>
-    <item>CFA Franc BCEAO</item>
-    <item>CFA Franc BEAC</item>
-    <item>CFP Franc</item>
-    <item>Chilean Peso</item>
-    <item>Testing currency</item>
-    <item>Colombian Peso</item>
-    <item>Comoro Franc</item>
-    <item>Congolese Franc</item>
-    <item>Convertible Mark</item>
-    <item>Cordoba Oro</item>
-    <item>Costa Rican Colon</item>
-    <item>Croatian Kuna</item>
-    <item>Cuban Convertible Peso</item>
-    <item>Cuban Peso</item>
-    <item>Czech Koruna</item>
-    <item>Dalasi</item>
-    <item>Danish Krone</item>
-    <item>Denar</item>
-    <item>Djibouti Franc</item>
-    <item>Dobra</item>
-    <item>Dominican Peso</item>
-    <item>Dong</item>
-    <item>East Caribbean Dollar</item>
-    <item>Egyptian Pound</item>
-    <item>El Salvador Colon</item>
-    <item>Ethiopian Birr</item>
-    <item>Euro</item>
-    <item>Falkland Islands Pound</item>
-    <item>Fiji Dollar</item>
-    <item>Forint</item>
-    <item>Ghana Cedi</item>
-    <item>Gibraltar Pound</item>
-    <item>Gold</item>
-    <item>Gourde</item>
-    <item>Guarani</item>
-    <item>Guinea Franc</item>
-    <item>Guyana Dollar</item>
-    <item>Hong Kong Dollar</item>
-    <item>Hryvnia</item>
-    <item>Iceland Krona</item>
-    <item>Indian Rupee</item>
-    <item>Iranian Rial</item>
-    <item>Iraqi Dinar</item>
-    <item>Jamaican Dollar</item>
-    <item>Jordanian Dinar</item>
-    <item>Kenyan Shilling</item>
-    <item>Kina</item>
-    <item>Kip</item>
-    <item>Kuwaiti Dinar</item>
-    <item>Kwacha</item>
-    <item>Kwanza</item>
-    <item>Kyat</item>
-    <item>Lari</item>
-    <item>Latvian Lats</item>
-    <item>Lebanese Pound</item>
-    <item>Lek</item>
-    <item>Lempira</item>
-    <item>Leone</item>
-    <item>Liberian Dollar</item>
-    <item>Libyan Dinar</item>
-    <item>Lilangeni</item>
-    <item>Lithuanian Litas</item>
-    <item>Loti</item>
-    <item>Malagasy Ariary</item>
-    <item>Malaysian Ringgit</item>
-    <item>Mauritius Rupee</item>
-    <item>Mexican Peso</item>
-    <item>Mexican Unidad de Inversion (UDI)</item>
-    <item>Moldovan Leu</item>
-    <item>Moroccan Dirham</item>
-    <item>Mozambique Metical</item>
-    <item>Mvdol</item>
-    <item>Naira</item>
-    <item>Nakfa</item>
-    <item>Namibia Dollar</item>
-    <item>Nepalese Rupee</item>
-    <item>Netherlands Antillean Guilder</item>
-    <item>New Israeli Sheqel</item>
-    <item>New Romanian Leu</item>
-    <item>New Taiwan Dollar</item>
-    <item>New Zealand Dollar</item>
-    <item>Ngultrum</item>
-    <item>North Korean Won</item>
-    <item>Norwegian Krone</item>
-    <item>Nuevo Sol</item>
-    <item>Ouguiya</item>
-    <item>Paanga</item>
-    <item>Pakistan Rupee</item>
-    <item>Palladium</item>
-    <item>Pataca</item>
-    <item>Philippine Peso</item>
-    <item>Platinum</item>
-    <item>Pound Sterling</item>
-    <item>Pula</item>
-    <item>Qatari Rial</item>
-    <item>Quetzal</item>
-    <item>Rand</item>
-    <item>Rial Omani</item>
-    <item>Riel</item>
-    <item>Rufiyaa</item>
-    <item>Rupiah</item>
-    <item>Russian Ruble</item>
-    <item>Rwanda Franc</item>
-    <item>Saint Helena Pound</item>
-    <item>Saudi Riyal</item>
-    <item>SDR (Special Drawing Right)</item>
-    <item>Serbian Dinar</item>
-    <item>Seychelles Rupee</item>
-    <item>Silver</item>
-    <item>Singapore Dollar</item>
-    <item>Solomon Islands Dollar</item>
-    <item>Som</item>
-    <item>Somali Shilling</item>
-    <item>Somoni</item>
-    <item>South Sudanese Pound</item>
-    <item>Sri Lanka Rupee</item>
-    <item>Sucre</item>
-    <item>Sudanese Pound</item>
-    <item>Surinam Dollar</item>
-    <item>Swedish Krona</item>
-    <item>Swiss Franc</item>
-    <item>Syrian Pound</item>
-    <item>Taka</item>
-    <item>Tala</item>
-    <item>Tanzanian Shilling</item>
-    <item>Tenge</item>
-    <item>No currency</item>
-    <item>Trinidad and Tobago Dollar</item>
-    <item>Tugrik</item>
-    <item>Tunisian Dinar</item>
-    <item>Turkish Lira</item>
-    <item>Turkmenistan New Manat</item>
-    <item>UAE Dirham</item>
-    <item>Uganda Shilling</item>
-    <item>UIC-Franc</item>
-    <item>Unidad de Valor Real</item>
-    <item>Unidades de fomento</item>
-    <item>Uruguay Peso en Unidades Indexadas (URUIURUI)</item>
-    <item>Uruguayan Peso</item>
-    <item>US Dollar</item>
-    <item>Uzbekistan Sum</item>
-    <item>Vatu</item>
-    <item>WIR Euro</item>
-    <item>WIR Franc</item>
-    <item>Won</item>
-    <item>Yemeni Rial</item>
-    <item>Yen</item>
-    <item>Yuan Renminbi</item>
-    <item>Zambian Kwacha</item>
-    <item>Zimbabwe Dollar</item>
-    <item>Zloty</item>
-  </string-array>
   <string name="error_no_accounts">No accounts exist in GnuCash.\nCreate an account before adding a widget</string>
   <string name="title_build_version">Build version</string>
   <string name="title_license">License</string>
diff --git a/app/src/main/res/values-it-rIT/strings.xml b/app/src/main/res/values-it-rIT/strings.xml
index 93f5e808..313ddee2 100644
--- a/app/src/main/res/values-it-rIT/strings.xml
+++ b/app/src/main/res/values-it-rIT/strings.xml
@@ -85,183 +85,6 @@
   <string name="label_display_account">Visualizza conto</string>
   <string name="btn_create_accounts">Crea conti</string>
   <string name="title_default_accounts">Selezione dei conti da creare</string>
-  <string-array name="currency_names">
-    <item>Afghani</item>
-    <item>Algerian Dinar</item>
-    <item>Argentine Peso</item>
-    <item>Armenian Dram</item>
-    <item>Aruban Florin</item>
-    <item>Australian Dollar</item>
-    <item>Azerbaijanian Manat</item>
-    <item>Bahamian Dollar</item>
-    <item>Bahraini Dinar</item>
-    <item>Baht</item>
-    <item>Balboa</item>
-    <item>Barbados Dollar</item>
-    <item>Belarussian Ruble</item>
-    <item>Belize Dollar</item>
-    <item>Bermudian Dollar</item>
-    <item>Bolivar Fuerte</item>
-    <item>Boliviano</item>
-    <item>Brazilian Real</item>
-    <item>Brunei Dollar</item>
-    <item>Bulgarian Lev</item>
-    <item>Burundi Franc</item>
-    <item>Canadian Dollar</item>
-    <item>Cape Verde Escudo</item>
-    <item>Cayman Islands Dollar</item>
-    <item>CFA Franc BCEAO</item>
-    <item>CFA Franc BEAC</item>
-    <item>CFP Franc</item>
-    <item>Chilean Peso</item>
-    <item>Testing currency</item>
-    <item>Colombian Peso</item>
-    <item>Comoro Franc</item>
-    <item>Congolese Franc</item>
-    <item>Convertible Mark</item>
-    <item>Cordoba Oro</item>
-    <item>Costa Rican Colon</item>
-    <item>Croatian Kuna</item>
-    <item>Cuban Convertible Peso</item>
-    <item>Cuban Peso</item>
-    <item>Czech Koruna</item>
-    <item>Dalasi</item>
-    <item>Danish Krone</item>
-    <item>Denar</item>
-    <item>Djibouti Franc</item>
-    <item>Dobra</item>
-    <item>Dominican Peso</item>
-    <item>Dong</item>
-    <item>East Caribbean Dollar</item>
-    <item>Egyptian Pound</item>
-    <item>El Salvador Colon</item>
-    <item>Ethiopian Birr</item>
-    <item>Euro</item>
-    <item>Falkland Islands Pound</item>
-    <item>Fiji Dollar</item>
-    <item>Forint</item>
-    <item>Ghana Cedi</item>
-    <item>Gibraltar Pound</item>
-    <item>Gold</item>
-    <item>Gourde</item>
-    <item>Guarani</item>
-    <item>Guinea Franc</item>
-    <item>Guyana Dollar</item>
-    <item>Hong Kong Dollar</item>
-    <item>Hryvnia</item>
-    <item>Iceland Krona</item>
-    <item>Indian Rupee</item>
-    <item>Iranian Rial</item>
-    <item>Iraqi Dinar</item>
-    <item>Jamaican Dollar</item>
-    <item>Jordanian Dinar</item>
-    <item>Kenyan Shilling</item>
-    <item>Kina</item>
-    <item>Kip</item>
-    <item>Kuwaiti Dinar</item>
-    <item>Kwacha</item>
-    <item>Kwanza</item>
-    <item>Kyat</item>
-    <item>Lari</item>
-    <item>Latvian Lats</item>
-    <item>Lebanese Pound</item>
-    <item>Lek</item>
-    <item>Lempira</item>
-    <item>Leone</item>
-    <item>Liberian Dollar</item>
-    <item>Libyan Dinar</item>
-    <item>Lilangeni</item>
-    <item>Lithuanian Litas</item>
-    <item>Loti</item>
-    <item>Malagasy Ariary</item>
-    <item>Malaysian Ringgit</item>
-    <item>Mauritius Rupee</item>
-    <item>Mexican Peso</item>
-    <item>Mexican Unidad de Inversion (UDI)</item>
-    <item>Moldovan Leu</item>
-    <item>Moroccan Dirham</item>
-    <item>Mozambique Metical</item>
-    <item>Mvdol</item>
-    <item>Naira</item>
-    <item>Nakfa</item>
-    <item>Namibia Dollar</item>
-    <item>Nepalese Rupee</item>
-    <item>Netherlands Antillean Guilder</item>
-    <item>New Israeli Sheqel</item>
-    <item>New Romanian Leu</item>
-    <item>New Taiwan Dollar</item>
-    <item>New Zealand Dollar</item>
-    <item>Ngultrum</item>
-    <item>North Korean Won</item>
-    <item>Norwegian Krone</item>
-    <item>Nuevo Sol</item>
-    <item>Ouguiya</item>
-    <item>Paanga</item>
-    <item>Pakistan Rupee</item>
-    <item>Palladium</item>
-    <item>Pataca</item>
-    <item>Philippine Peso</item>
-    <item>Platinum</item>
-    <item>Pound Sterling</item>
-    <item>Pula</item>
-    <item>Qatari Rial</item>
-    <item>Quetzal</item>
-    <item>Rand</item>
-    <item>Rial Omani</item>
-    <item>Riel</item>
-    <item>Rufiyaa</item>
-    <item>Rupiah</item>
-    <item>Russian Ruble</item>
-    <item>Rwanda Franc</item>
-    <item>Saint Helena Pound</item>
-    <item>Saudi Riyal</item>
-    <item>SDR (Special Drawing Right)</item>
-    <item>Serbian Dinar</item>
-    <item>Seychelles Rupee</item>
-    <item>Silver</item>
-    <item>Singapore Dollar</item>
-    <item>Solomon Islands Dollar</item>
-    <item>Som</item>
-    <item>Somali Shilling</item>
-    <item>Somoni</item>
-    <item>South Sudanese Pound</item>
-    <item>Sri Lanka Rupee</item>
-    <item>Sucre</item>
-    <item>Sudanese Pound</item>
-    <item>Surinam Dollar</item>
-    <item>Swedish Krona</item>
-    <item>Swiss Franc</item>
-    <item>Syrian Pound</item>
-    <item>Taka</item>
-    <item>Tala</item>
-    <item>Tanzanian Shilling</item>
-    <item>Tenge</item>
-    <item>No currency</item>
-    <item>Trinidad and Tobago Dollar</item>
-    <item>Tugrik</item>
-    <item>Tunisian Dinar</item>
-    <item>Turkish Lira</item>
-    <item>Turkmenistan New Manat</item>
-    <item>UAE Dirham</item>
-    <item>Uganda Shilling</item>
-    <item>UIC-Franc</item>
-    <item>Unidad de Valor Real</item>
-    <item>Unidades de fomento</item>
-    <item>Uruguay Peso en Unidades Indexadas (URUIURUI)</item>
-    <item>Uruguayan Peso</item>
-    <item>US Dollar</item>
-    <item>Uzbekistan Sum</item>
-    <item>Vatu</item>
-    <item>WIR Euro</item>
-    <item>WIR Franc</item>
-    <item>Won</item>
-    <item>Yemeni Rial</item>
-    <item>Yen</item>
-    <item>Yuan Renminbi</item>
-    <item>Zambian Kwacha</item>
-    <item>Zimbabwe Dollar</item>
-    <item>Zloty</item>
-  </string-array>
   <string name="error_no_accounts">Non esiste alcun conto in GnuCash.\nCreare un conto prima di aggiungere il widget</string>
   <string name="title_build_version">Versione build</string>
   <string name="title_license">Licenza</string>
diff --git a/app/src/main/res/values-iw-rIL/strings.xml b/app/src/main/res/values-iw-rIL/strings.xml
index c68c7e3c..54aa639b 100644
--- a/app/src/main/res/values-iw-rIL/strings.xml
+++ b/app/src/main/res/values-iw-rIL/strings.xml
@@ -85,183 +85,6 @@
   <string name="label_display_account">Display account</string>
   <string name="btn_create_accounts">Create Accounts</string>
   <string name="title_default_accounts">Select accounts to create</string>
-  <string-array name="currency_names">
-    <item>Afghani</item>
-    <item>Algerian Dinar</item>
-    <item>Argentine Peso</item>
-    <item>Armenian Dram</item>
-    <item>Aruban Florin</item>
-    <item>Australian Dollar</item>
-    <item>Azerbaijanian Manat</item>
-    <item>Bahamian Dollar</item>
-    <item>Bahraini Dinar</item>
-    <item>Baht</item>
-    <item>Balboa</item>
-    <item>Barbados Dollar</item>
-    <item>Belarussian Ruble</item>
-    <item>Belize Dollar</item>
-    <item>Bermudian Dollar</item>
-    <item>Bolivar Fuerte</item>
-    <item>Boliviano</item>
-    <item>Brazilian Real</item>
-    <item>Brunei Dollar</item>
-    <item>Bulgarian Lev</item>
-    <item>Burundi Franc</item>
-    <item>Canadian Dollar</item>
-    <item>Cape Verde Escudo</item>
-    <item>Cayman Islands Dollar</item>
-    <item>CFA Franc BCEAO</item>
-    <item>CFA Franc BEAC</item>
-    <item>CFP Franc</item>
-    <item>Chilean Peso</item>
-    <item>Testing currency</item>
-    <item>Colombian Peso</item>
-    <item>Comoro Franc</item>
-    <item>Congolese Franc</item>
-    <item>Convertible Mark</item>
-    <item>Cordoba Oro</item>
-    <item>Costa Rican Colon</item>
-    <item>Croatian Kuna</item>
-    <item>Cuban Convertible Peso</item>
-    <item>Cuban Peso</item>
-    <item>Czech Koruna</item>
-    <item>Dalasi</item>
-    <item>Danish Krone</item>
-    <item>Denar</item>
-    <item>Djibouti Franc</item>
-    <item>Dobra</item>
-    <item>Dominican Peso</item>
-    <item>Dong</item>
-    <item>East Caribbean Dollar</item>
-    <item>Egyptian Pound</item>
-    <item>El Salvador Colon</item>
-    <item>Ethiopian Birr</item>
-    <item>Euro</item>
-    <item>Falkland Islands Pound</item>
-    <item>Fiji Dollar</item>
-    <item>Forint</item>
-    <item>Ghana Cedi</item>
-    <item>Gibraltar Pound</item>
-    <item>Gold</item>
-    <item>Gourde</item>
-    <item>Guarani</item>
-    <item>Guinea Franc</item>
-    <item>Guyana Dollar</item>
-    <item>Hong Kong Dollar</item>
-    <item>Hryvnia</item>
-    <item>Iceland Krona</item>
-    <item>Indian Rupee</item>
-    <item>Iranian Rial</item>
-    <item>Iraqi Dinar</item>
-    <item>Jamaican Dollar</item>
-    <item>Jordanian Dinar</item>
-    <item>Kenyan Shilling</item>
-    <item>Kina</item>
-    <item>Kip</item>
-    <item>Kuwaiti Dinar</item>
-    <item>Kwacha</item>
-    <item>Kwanza</item>
-    <item>Kyat</item>
-    <item>Lari</item>
-    <item>Latvian Lats</item>
-    <item>Lebanese Pound</item>
-    <item>Lek</item>
-    <item>Lempira</item>
-    <item>Leone</item>
-    <item>Liberian Dollar</item>
-    <item>Libyan Dinar</item>
-    <item>Lilangeni</item>
-    <item>Lithuanian Litas</item>
-    <item>Loti</item>
-    <item>Malagasy Ariary</item>
-    <item>Malaysian Ringgit</item>
-    <item>Mauritius Rupee</item>
-    <item>Mexican Peso</item>
-    <item>Mexican Unidad de Inversion (UDI)</item>
-    <item>Moldovan Leu</item>
-    <item>Moroccan Dirham</item>
-    <item>Mozambique Metical</item>
-    <item>Mvdol</item>
-    <item>Naira</item>
-    <item>Nakfa</item>
-    <item>Namibia Dollar</item>
-    <item>Nepalese Rupee</item>
-    <item>Netherlands Antillean Guilder</item>
-    <item>New Israeli Sheqel</item>
-    <item>New Romanian Leu</item>
-    <item>New Taiwan Dollar</item>
-    <item>New Zealand Dollar</item>
-    <item>Ngultrum</item>
-    <item>North Korean Won</item>
-    <item>Norwegian Krone</item>
-    <item>Nuevo Sol</item>
-    <item>Ouguiya</item>
-    <item>Paanga</item>
-    <item>Pakistan Rupee</item>
-    <item>Palladium</item>
-    <item>Pataca</item>
-    <item>Philippine Peso</item>
-    <item>Platinum</item>
-    <item>Pound Sterling</item>
-    <item>Pula</item>
-    <item>Qatari Rial</item>
-    <item>Quetzal</item>
-    <item>Rand</item>
-    <item>Rial Omani</item>
-    <item>Riel</item>
-    <item>Rufiyaa</item>
-    <item>Rupiah</item>
-    <item>Russian Ruble</item>
-    <item>Rwanda Franc</item>
-    <item>Saint Helena Pound</item>
-    <item>Saudi Riyal</item>
-    <item>SDR (Special Drawing Right)</item>
-    <item>Serbian Dinar</item>
-    <item>Seychelles Rupee</item>
-    <item>Silver</item>
-    <item>Singapore Dollar</item>
-    <item>Solomon Islands Dollar</item>
-    <item>Som</item>
-    <item>Somali Shilling</item>
-    <item>Somoni</item>
-    <item>South Sudanese Pound</item>
-    <item>Sri Lanka Rupee</item>
-    <item>Sucre</item>
-    <item>Sudanese Pound</item>
-    <item>Surinam Dollar</item>
-    <item>Swedish Krona</item>
-    <item>Swiss Franc</item>
-    <item>Syrian Pound</item>
-    <item>Taka</item>
-    <item>Tala</item>
-    <item>Tanzanian Shilling</item>
-    <item>Tenge</item>
-    <item>No currency</item>
-    <item>Trinidad and Tobago Dollar</item>
-    <item>Tugrik</item>
-    <item>Tunisian Dinar</item>
-    <item>Turkish Lira</item>
-    <item>Turkmenistan New Manat</item>
-    <item>UAE Dirham</item>
-    <item>Uganda Shilling</item>
-    <item>UIC-Franc</item>
-    <item>Unidad de Valor Real</item>
-    <item>Unidades de fomento</item>
-    <item>Uruguay Peso en Unidades Indexadas (URUIURUI)</item>
-    <item>Uruguayan peso</item>
-    <item>US Dollar</item>
-    <item>Uzbekistan Sum</item>
-    <item>Vatu</item>
-    <item>WIR Euro</item>
-    <item>WIR Franc</item>
-    <item>Won</item>
-    <item>Yemeni Rial</item>
-    <item>Yen</item>
-    <item>Yuan Renminbi</item>
-    <item>Zambian Kwacha</item>
-    <item>Zimbabwe Dollar</item>
-    <item>Zloty</item>
-  </string-array>
   <string name="error_no_accounts">No accounts exist in GnuCash.\nCreate an account before adding a widget</string>
   <string name="title_build_version">Build version</string>
   <string name="title_license">License</string>
diff --git a/app/src/main/res/values-ja-rJP/strings.xml b/app/src/main/res/values-ja-rJP/strings.xml
index f57b1dda..52fe7ce5 100644
--- a/app/src/main/res/values-ja-rJP/strings.xml
+++ b/app/src/main/res/values-ja-rJP/strings.xml
@@ -85,183 +85,6 @@
   <string name="label_display_account">Display account</string>
   <string name="btn_create_accounts">Create Accounts</string>
   <string name="title_default_accounts">Select accounts to create</string>
-  <string-array name="currency_names">
-    <item>Afghani</item>
-    <item>Algerian Dinar</item>
-    <item>Argentine Peso</item>
-    <item>Armenian Dram</item>
-    <item>Aruban Florin</item>
-    <item>Australian Dollar</item>
-    <item>Azerbaijanian Manat</item>
-    <item>Bahamian Dollar</item>
-    <item>Bahraini Dinar</item>
-    <item>Baht</item>
-    <item>Balboa</item>
-    <item>Barbados Dollar</item>
-    <item>Belarussian Ruble</item>
-    <item>Belize Dollar</item>
-    <item>Bermudian Dollar</item>
-    <item>Bolivar Fuerte</item>
-    <item>Boliviano</item>
-    <item>Brazilian Real</item>
-    <item>Brunei Dollar</item>
-    <item>Bulgarian Lev</item>
-    <item>Burundi Franc</item>
-    <item>Canadian Dollar</item>
-    <item>Cape Verde Escudo</item>
-    <item>Cayman Islands Dollar</item>
-    <item>CFA Franc BCEAO</item>
-    <item>CFA Franc BEAC</item>
-    <item>CFP Franc</item>
-    <item>Chilean Peso</item>
-    <item>Testing currency</item>
-    <item>Colombian Peso</item>
-    <item>Comoro Franc</item>
-    <item>Congolese Franc</item>
-    <item>Convertible Mark</item>
-    <item>Cordoba Oro</item>
-    <item>Costa Rican Colon</item>
-    <item>Croatian Kuna</item>
-    <item>Cuban Convertible Peso</item>
-    <item>Cuban Peso</item>
-    <item>Czech Koruna</item>
-    <item>Dalasi</item>
-    <item>Danish Krone</item>
-    <item>Denar</item>
-    <item>Djibouti Franc</item>
-    <item>Dobra</item>
-    <item>Dominican Peso</item>
-    <item>Dong</item>
-    <item>East Caribbean Dollar</item>
-    <item>Egyptian Pound</item>
-    <item>El Salvador Colon</item>
-    <item>Ethiopian Birr</item>
-    <item>Euro</item>
-    <item>Falkland Islands Pound</item>
-    <item>Fiji Dollar</item>
-    <item>Forint</item>
-    <item>Ghana Cedi</item>
-    <item>Gibraltar Pound</item>
-    <item>Gold</item>
-    <item>Gourde</item>
-    <item>Guarani</item>
-    <item>Guinea Franc</item>
-    <item>Guyana Dollar</item>
-    <item>Hong Kong Dollar</item>
-    <item>Hryvnia</item>
-    <item>Iceland Krona</item>
-    <item>Indian Rupee</item>
-    <item>Iranian Rial</item>
-    <item>Iraqi Dinar</item>
-    <item>Jamaican Dollar</item>
-    <item>Jordanian Dinar</item>
-    <item>Kenyan Shilling</item>
-    <item>Kina</item>
-    <item>Kip</item>
-    <item>Kuwaiti Dinar</item>
-    <item>Kwacha</item>
-    <item>Kwanza</item>
-    <item>Kyat</item>
-    <item>Lari</item>
-    <item>Latvian Lats</item>
-    <item>Lebanese Pound</item>
-    <item>Lek</item>
-    <item>Lempira</item>
-    <item>Leone</item>
-    <item>Liberian Dollar</item>
-    <item>Libyan Dinar</item>
-    <item>Lilangeni</item>
-    <item>Lithuanian Litas</item>
-    <item>Loti</item>
-    <item>Malagasy Ariary</item>
-    <item>Malaysian Ringgit</item>
-    <item>Mauritius Rupee</item>
-    <item>Mexican Peso</item>
-    <item>Mexican Unidad de Inversion (UDI)</item>
-    <item>Moldovan Leu</item>
-    <item>Moroccan Dirham</item>
-    <item>Mozambique Metical</item>
-    <item>Mvdol</item>
-    <item>Naira</item>
-    <item>Nakfa</item>
-    <item>Namibia Dollar</item>
-    <item>Nepalese Rupee</item>
-    <item>Netherlands Antillean Guilder</item>
-    <item>New Israeli Sheqel</item>
-    <item>New Romanian Leu</item>
-    <item>New Taiwan Dollar</item>
-    <item>New Zealand Dollar</item>
-    <item>Ngultrum</item>
-    <item>North Korean Won</item>
-    <item>Norwegian Krone</item>
-    <item>Nuevo Sol</item>
-    <item>Ouguiya</item>
-    <item>Paanga</item>
-    <item>Pakistan Rupee</item>
-    <item>Palladium</item>
-    <item>Pataca</item>
-    <item>Philippine Peso</item>
-    <item>Platinum</item>
-    <item>Pound Sterling</item>
-    <item>Pula</item>
-    <item>Qatari Rial</item>
-    <item>Quetzal</item>
-    <item>Rand</item>
-    <item>Rial Omani</item>
-    <item>Riel</item>
-    <item>Rufiyaa</item>
-    <item>Rupiah</item>
-    <item>Russian Ruble</item>
-    <item>Rwanda Franc</item>
-    <item>Saint Helena Pound</item>
-    <item>Saudi Riyal</item>
-    <item>SDR (Special Drawing Right)</item>
-    <item>Serbian Dinar</item>
-    <item>Seychelles Rupee</item>
-    <item>Silver</item>
-    <item>Singapore Dollar</item>
-    <item>Solomon Islands Dollar</item>
-    <item>Som</item>
-    <item>Somali Shilling</item>
-    <item>Somoni</item>
-    <item>South Sudanese Pound</item>
-    <item>Sri Lanka Rupee</item>
-    <item>Sucre</item>
-    <item>Sudanese Pound</item>
-    <item>Surinam Dollar</item>
-    <item>Swedish Krona</item>
-    <item>Swiss Franc</item>
-    <item>Syrian Pound</item>
-    <item>Taka</item>
-    <item>Tala</item>
-    <item>Tanzanian Shilling</item>
-    <item>Tenge</item>
-    <item>No currency</item>
-    <item>Trinidad and Tobago Dollar</item>
-    <item>Tugrik</item>
-    <item>Tunisian Dinar</item>
-    <item>Turkish Lira</item>
-    <item>Turkmenistan New Manat</item>
-    <item>UAE Dirham</item>
-    <item>Uganda Shilling</item>
-    <item>UIC-Franc</item>
-    <item>Unidad de Valor Real</item>
-    <item>Unidades de fomento</item>
-    <item>Uruguay Peso en Unidades Indexadas (URUIURUI)</item>
-    <item>Uruguayan peso</item>
-    <item>US Dollar</item>
-    <item>Uzbekistan Sum</item>
-    <item>Vatu</item>
-    <item>WIR Euro</item>
-    <item>WIR Franc</item>
-    <item>Won</item>
-    <item>Yemeni Rial</item>
-    <item>Yen</item>
-    <item>Yuan Renminbi</item>
-    <item>Zambian Kwacha</item>
-    <item>Zimbabwe Dollar</item>
-    <item>Zloty</item>
-  </string-array>
   <string name="error_no_accounts">No accounts exist in GnuCash.\nCreate an account before adding a widget</string>
   <string name="title_build_version">Build version</string>
   <string name="title_license">License</string>
diff --git a/app/src/main/res/values-ko-rKR/strings.xml b/app/src/main/res/values-ko-rKR/strings.xml
index 46251403..1656ad73 100644
--- a/app/src/main/res/values-ko-rKR/strings.xml
+++ b/app/src/main/res/values-ko-rKR/strings.xml
@@ -85,183 +85,6 @@
   <string name="label_display_account">Display account</string>
   <string name="btn_create_accounts">Create Accounts</string>
   <string name="title_default_accounts">Select accounts to create</string>
-  <string-array name="currency_names">
-    <item>Afghani</item>
-    <item>Algerian Dinar</item>
-    <item>Argentine Peso</item>
-    <item>Armenian Dram</item>
-    <item>Aruban Florin</item>
-    <item>Australian Dollar</item>
-    <item>Azerbaijanian Manat</item>
-    <item>Bahamian Dollar</item>
-    <item>Bahraini Dinar</item>
-    <item>Baht</item>
-    <item>Balboa</item>
-    <item>Barbados Dollar</item>
-    <item>Belarussian Ruble</item>
-    <item>Belize Dollar</item>
-    <item>Bermudian Dollar</item>
-    <item>Bolivar Fuerte</item>
-    <item>Boliviano</item>
-    <item>Brazilian Real</item>
-    <item>Brunei Dollar</item>
-    <item>Bulgarian Lev</item>
-    <item>Burundi Franc</item>
-    <item>Canadian Dollar</item>
-    <item>Cape Verde Escudo</item>
-    <item>Cayman Islands Dollar</item>
-    <item>CFA Franc BCEAO</item>
-    <item>CFA Franc BEAC</item>
-    <item>CFP Franc</item>
-    <item>Chilean Peso</item>
-    <item>Testing currency</item>
-    <item>Colombian Peso</item>
-    <item>Comoro Franc</item>
-    <item>Congolese Franc</item>
-    <item>Convertible Mark</item>
-    <item>Cordoba Oro</item>
-    <item>Costa Rican Colon</item>
-    <item>Croatian Kuna</item>
-    <item>Cuban Convertible Peso</item>
-    <item>Cuban Peso</item>
-    <item>Czech Koruna</item>
-    <item>Dalasi</item>
-    <item>Danish Krone</item>
-    <item>Denar</item>
-    <item>Djibouti Franc</item>
-    <item>Dobra</item>
-    <item>Dominican Peso</item>
-    <item>Dong</item>
-    <item>East Caribbean Dollar</item>
-    <item>Egyptian Pound</item>
-    <item>El Salvador Colon</item>
-    <item>Ethiopian Birr</item>
-    <item>Euro</item>
-    <item>Falkland Islands Pound</item>
-    <item>Fiji Dollar</item>
-    <item>Forint</item>
-    <item>Ghana Cedi</item>
-    <item>Gibraltar Pound</item>
-    <item>Gold</item>
-    <item>Gourde</item>
-    <item>Guarani</item>
-    <item>Guinea Franc</item>
-    <item>Guyana Dollar</item>
-    <item>Hong Kong Dollar</item>
-    <item>Hryvnia</item>
-    <item>Iceland Krona</item>
-    <item>Indian Rupee</item>
-    <item>Iranian Rial</item>
-    <item>Iraqi Dinar</item>
-    <item>Jamaican Dollar</item>
-    <item>Jordanian Dinar</item>
-    <item>Kenyan Shilling</item>
-    <item>Kina</item>
-    <item>Kip</item>
-    <item>Kuwaiti Dinar</item>
-    <item>Kwacha</item>
-    <item>Kwanza</item>
-    <item>Kyat</item>
-    <item>Lari</item>
-    <item>Latvian Lats</item>
-    <item>Lebanese Pound</item>
-    <item>Lek</item>
-    <item>Lempira</item>
-    <item>Leone</item>
-    <item>Liberian Dollar</item>
-    <item>Libyan Dinar</item>
-    <item>Lilangeni</item>
-    <item>Lithuanian Litas</item>
-    <item>Loti</item>
-    <item>Malagasy Ariary</item>
-    <item>Malaysian Ringgit</item>
-    <item>Mauritius Rupee</item>
-    <item>Mexican Peso</item>
-    <item>Mexican Unidad de Inversion (UDI)</item>
-    <item>Moldovan Leu</item>
-    <item>Moroccan Dirham</item>
-    <item>Mozambique Metical</item>
-    <item>Mvdol</item>
-    <item>Naira</item>
-    <item>Nakfa</item>
-    <item>Namibia Dollar</item>
-    <item>Nepalese Rupee</item>
-    <item>Netherlands Antillean Guilder</item>
-    <item>New Israeli Sheqel</item>
-    <item>New Romanian Leu</item>
-    <item>New Taiwan Dollar</item>
-    <item>New Zealand Dollar</item>
-    <item>Ngultrum</item>
-    <item>North Korean Won</item>
-    <item>Norwegian Krone</item>
-    <item>Nuevo Sol</item>
-    <item>Ouguiya</item>
-    <item>Paanga</item>
-    <item>Pakistan Rupee</item>
-    <item>Palladium</item>
-    <item>Pataca</item>
-    <item>Philippine Peso</item>
-    <item>Platinum</item>
-    <item>Pound Sterling</item>
-    <item>Pula</item>
-    <item>Qatari Rial</item>
-    <item>Quetzal</item>
-    <item>Rand</item>
-    <item>Rial Omani</item>
-    <item>Riel</item>
-    <item>Rufiyaa</item>
-    <item>Rupiah</item>
-    <item>Russian Ruble</item>
-    <item>Rwanda Franc</item>
-    <item>Saint Helena Pound</item>
-    <item>Saudi Riyal</item>
-    <item>SDR (Special Drawing Right)</item>
-    <item>Serbian Dinar</item>
-    <item>Seychelles Rupee</item>
-    <item>Silver</item>
-    <item>Singapore Dollar</item>
-    <item>Solomon Islands Dollar</item>
-    <item>Som</item>
-    <item>Somali Shilling</item>
-    <item>Somoni</item>
-    <item>South Sudanese Pound</item>
-    <item>Sri Lanka Rupee</item>
-    <item>Sucre</item>
-    <item>Sudanese Pound</item>
-    <item>Surinam Dollar</item>
-    <item>Swedish Krona</item>
-    <item>Swiss Franc</item>
-    <item>Syrian Pound</item>
-    <item>Taka</item>
-    <item>Tala</item>
-    <item>Tanzanian Shilling</item>
-    <item>Tenge</item>
-    <item>No currency</item>
-    <item>Trinidad and Tobago Dollar</item>
-    <item>Tugrik</item>
-    <item>Tunisian Dinar</item>
-    <item>Turkish Lira</item>
-    <item>Turkmenistan New Manat</item>
-    <item>UAE Dirham</item>
-    <item>Uganda Shilling</item>
-    <item>UIC-Franc</item>
-    <item>Unidad de Valor Real</item>
-    <item>Unidades de fomento</item>
-    <item>Uruguay Peso en Unidades Indexadas (URUIURUI)</item>
-    <item>Uruguayan peso</item>
-    <item>US Dollar</item>
-    <item>Uzbekistan Sum</item>
-    <item>Vatu</item>
-    <item>WIR Euro</item>
-    <item>WIR Franc</item>
-    <item>Won</item>
-    <item>Yemeni Rial</item>
-    <item>Yen</item>
-    <item>Yuan Renminbi</item>
-    <item>Zambian Kwacha</item>
-    <item>Zimbabwe Dollar</item>
-    <item>Zloty</item>
-  </string-array>
   <string name="error_no_accounts">No accounts exist in GnuCash.\nCreate an account before adding a widget</string>
   <string name="title_build_version">Build version</string>
   <string name="title_license">License</string>
diff --git a/app/src/main/res/values-nb/strings.xml b/app/src/main/res/values-nb/strings.xml
index e3ac6da3..05ee7407 100644
--- a/app/src/main/res/values-nb/strings.xml
+++ b/app/src/main/res/values-nb/strings.xml
@@ -85,183 +85,6 @@
   <string name="label_display_account">Vis konto</string>
   <string name="btn_create_accounts">Opprett konto</string>
   <string name="title_default_accounts">Velg kontoer  opprette</string>
-  <string-array name="currency_names">
-    <item>Afghanske</item>
-    <item>Algeriske dinarer</item>
-    <item>Argentinsk Peso</item>
-    <item>Armensk Dram</item>
-    <item>Arubiske gylden</item>
-    <item>Australske Dollar</item>
-    <item>Aserbajdsjanske Manat</item>
-    <item>Bahamian Dollar</item>
-    <item>Bahraini dinarer</item>
-    <item>Baht</item>
-    <item>Balboa</item>
-    <item>Barbados Dollar</item>
-    <item>Hviterussiske rubler</item>
-    <item>Belize Dollar</item>
-    <item>Bermudian Dollar</item>
-    <item>Bolivar Fuerte</item>
-    <item>Boliviano</item>
-    <item>Brasilianske Real</item>
-    <item>Brunei Dollar</item>
-    <item>Bulgarske Lev</item>
-    <item>Burundi Franc</item>
-    <item>Kanadiske Dollar</item>
-    <item>Kapp Verde Escudo</item>
-    <item>Caymanyene Dollar</item>
-    <item>CFA Franc BCEAO</item>
-    <item>CFA Franc BEAC</item>
-    <item>CFP Franc</item>
-    <item>Chilenske pesos</item>
-    <item>Testing valuta</item>
-    <item>Colombianske Peso</item>
-    <item>Comoro Franc</item>
-    <item>Kongolesiske Franc</item>
-    <item>Konvertible Mark</item>
-    <item>Cordoba Oro</item>
-    <item>Costa Rica kolon</item>
-    <item>Kroatiske Kuna</item>
-    <item>Cubansk konvertibel Peso</item>
-    <item>Cubansk Peso</item>
-    <item>Tsjekkiske Koruna</item>
-    <item>Dalasi</item>
-    <item>Dansk Krone</item>
-    <item>Denar</item>
-    <item>Djibouti Franc</item>
-    <item>Dobra</item>
-    <item>Dominikanske pesos</item>
-    <item>Dong</item>
-    <item>stkaribiske Dollar</item>
-    <item>Egyptisk pund</item>
-    <item>El Salvador kolon</item>
-    <item>Ethiopian Birr</item>
-    <item>Euro</item>
-    <item>Falklandske pund</item>
-    <item>Fiji Dollar</item>
-    <item>Forint</item>
-    <item>Ghana Cedi</item>
-    <item>Gibraltarske pund</item>
-    <item>Gull</item>
-    <item>Gourde</item>
-    <item>Guarani</item>
-    <item>Guinea Franc</item>
-    <item>Guyana Dollar</item>
-    <item>Hong Kong Dollar</item>
-    <item>Hryvnia</item>
-    <item>Islandske kroner</item>
-    <item>Indiske rupi</item>
-    <item>Iranske Rial</item>
-    <item>Irakiske dinarer</item>
-    <item>Jamaicanske Dollar</item>
-    <item>Jordanske dinarer</item>
-    <item>Kenyanske Shilling</item>
-    <item>Kina</item>
-    <item>Kip</item>
-    <item>Kuwaitiske dinarer</item>
-    <item>Kwacha</item>
-    <item>Kwanza</item>
-    <item>Kyat</item>
-    <item>Lari</item>
-    <item>Latviske Lats</item>
-    <item>Libanesiske pund</item>
-    <item>Lek</item>
-    <item>Lempira</item>
-    <item>Leone</item>
-    <item>Liberiske Dollar</item>
-    <item>Libyske dinarer</item>
-    <item>Lilangeni</item>
-    <item>Litauisk Litas</item>
-    <item>Loti</item>
-    <item>Gassiske Ariary</item>
-    <item>Malaysiske Ringgit</item>
-    <item>Mauritius rupi</item>
-    <item>Meksikansk Peso</item>
-    <item>Meksikansk Unidad de inversjon (UDI)</item>
-    <item>Moldova Leu</item>
-    <item>Marokkanske Dirham</item>
-    <item>Mosambik Metical</item>
-    <item>Mvdol</item>
-    <item>Naira</item>
-    <item>Nakfa</item>
-    <item>Namibiske Dollar</item>
-    <item>Nepalske rupi</item>
-    <item>Nederlandske antillegylden</item>
-    <item>Israelske shekel</item>
-    <item>Nye rumenske Leu</item>
-    <item>Nye taiwanske Dollar</item>
-    <item>Newzealandske Dollar</item>
-    <item>Ngultrum</item>
-    <item>Nordkoreanske Won</item>
-    <item>Norske kroner</item>
-    <item>Nuevo Sol</item>
-    <item>Ouguiya</item>
-    <item>Pa\'anga</item>
-    <item>Pakistanske rupi</item>
-    <item>Palladium</item>
-    <item>Pataca</item>
-    <item>Filippinske Peso</item>
-    <item>Platina</item>
-    <item>Pund Sterling</item>
-    <item>Pula</item>
-    <item>Qatari Rial</item>
-    <item>Quetzal</item>
-    <item>Rand</item>
-    <item>Omansk Rial</item>
-    <item>Riel</item>
-    <item>Rufiyaa</item>
-    <item>Rupiah</item>
-    <item>Russisk rubel</item>
-    <item>Rwanda Franc</item>
-    <item>Sankthelenske pund</item>
-    <item>Saudiarabiske Riyal</item>
-    <item>SDR (spesielle tegning rett)</item>
-    <item>Serbiske dinarer</item>
-    <item>Seychellene rupi</item>
-    <item>Slv</item>
-    <item>Singapor Dollar</item>
-    <item>Salomonyene Dollar</item>
-    <item>Som</item>
-    <item>Somaliske Shilling</item>
-    <item>Somoni</item>
-    <item>Sr Sudanske pund</item>
-    <item>Srilankiske rupi</item>
-    <item>Sucre</item>
-    <item>Sudanske pund</item>
-    <item>Surinam Dollar</item>
-    <item>Svenske kroner</item>
-    <item>Sveitsiske Franc</item>
-    <item>Syriske pund</item>
-    <item>Taka</item>
-    <item>Tala</item>
-    <item>Tanzanianske Shilling</item>
-    <item>Tenge</item>
-    <item>Ingen valuta</item>
-    <item>Trinidad og Tobagos Dollar</item>
-    <item>Tugrik</item>
-    <item>Tunisiske dinarer</item>
-    <item>Tyrkiske Lira</item>
-    <item>Turkmensk nye Manat</item>
-    <item>UAE Dirham</item>
-    <item>Ugandiske Shilling</item>
-    <item>UIC Franc</item>
-    <item>Unidad de Valor Real</item>
-    <item>Unidades de fomento</item>
-    <item>Uruguay Peso no Unidades Indexadas (URUIURUI)</item>
-    <item>Uruguayanske peso</item>
-    <item>US Dollar</item>
-    <item>Usbekiske Sum</item>
-    <item>Vatu</item>
-    <item>WIR Euro</item>
-    <item>WIR Franc</item>
-    <item>Won</item>
-    <item>Yemeni Rial</item>
-    <item>Yen</item>
-    <item>Yuan Renminbi</item>
-    <item>Zambiske Kwacha</item>
-    <item>Zimbabwiske Dollar</item>
-    <item>Zloty</item>
-  </string-array>
   <string name="error_no_accounts">Det finnes ingen kontoer i GnuCash.\nOpprett en konto fr du legger til en widget</string>
   <string name="title_build_version">Byggversjon</string>
   <string name="title_license">Lisens</string>
diff --git a/app/src/main/res/values-nl-rNL/strings.xml b/app/src/main/res/values-nl-rNL/strings.xml
index 92b7a075..6654dae5 100644
--- a/app/src/main/res/values-nl-rNL/strings.xml
+++ b/app/src/main/res/values-nl-rNL/strings.xml
@@ -85,183 +85,6 @@
   <string name="label_display_account">Rekening tonen</string>
   <string name="btn_create_accounts">Rekeningen aanmaken</string>
   <string name="title_default_accounts">Standaard rekeningen selecteren</string>
-  <string-array name="currency_names">
-    <item>Afghani</item>
-    <item>Algerijnse dinar</item>
-    <item>Argentijnse peso</item>
-    <item>Armeense dram</item>
-    <item>Arubaanse florin</item>
-    <item>Australische dollar</item>
-    <item>Azerbeidzjaanse manat</item>
-    <item>Bahamaanse dollar</item>
-    <item>Bahreinse dinar</item>
-    <item>Baht</item>
-    <item>Balboa</item>
-    <item>Barbadaanse dollar</item>
-    <item>Wit-Russische Roebel</item>
-    <item>Belizaanse Dollar</item>
-    <item>Bermuda Dollar</item>
-    <item>Bolivar Fuerte</item>
-    <item>Boliviano</item>
-    <item>Braziliaanse Real</item>
-    <item>Bruneise Dollar</item>
-    <item>Bulgaarse Lev</item>
-    <item>Burundese Frank</item>
-    <item>Canadese dollar</item>
-    <item>Kaapverdische Escudo</item>
-    <item>Caymaneilandse Dollar</item>
-    <item>CFA-Frank BCEAO</item>
-    <item>CFA-Frank BEAC</item>
-    <item>CFP-Frank</item>
-    <item>Chileense Peso</item>
-    <item>Testen van valuta</item>
-    <item>Colombiaanse Peso</item>
-    <item>Comorese Frank</item>
-    <item>Congolese frank</item>
-    <item>Converteerbare Mark</item>
-    <item>Cordoba Oro</item>
-    <item>Costaricaanse coln</item>
-    <item>Kroatische kuna</item>
-    <item>Cubaanse Convertibele Peso</item>
-    <item>Cubaanse peso</item>
-    <item>Tsjechische kroon</item>
-    <item>Dalasi</item>
-    <item>Deense kroon</item>
-    <item>Denar</item>
-    <item>Djiboutiaanse Frank</item>
-    <item>Dobra</item>
-    <item>Dominicaanse Peso</item>
-    <item>Dong</item>
-    <item>Oost-Caribische Dollar</item>
-    <item>Egyptische pond</item>
-    <item>Salvadoraanse coln</item>
-    <item>Ethiopische Birr</item>
-    <item>Euro</item>
-    <item>Falklandeilands pond</item>
-    <item>Fiji Dollar</item>
-    <item>Forint</item>
-    <item>Ghanese Cedi</item>
-    <item>Gibraltarees pond</item>
-    <item>Goud</item>
-    <item>Gourde</item>
-    <item>Guaran</item>
-    <item>Guinese Frank</item>
-    <item>Guyaanse Dollar</item>
-    <item>Hongkongse dollar</item>
-    <item>Hryvnia</item>
-    <item>Ijslandse kroon</item>
-    <item>Indiase roepie</item>
-    <item>Iraanse rial</item>
-    <item>Iraakse dinar</item>
-    <item>Jamaicaanse dollar</item>
-    <item>Jordaanse dinar</item>
-    <item>Keniaanse shilling</item>
-    <item>Kina</item>
-    <item>Kip</item>
-    <item>Koeweitse Dinar</item>
-    <item>Kwacha</item>
-    <item>Kwanza</item>
-    <item>Kyat</item>
-    <item>Lari</item>
-    <item>Letse Lats</item>
-    <item>Libanees pond</item>
-    <item>Lek</item>
-    <item>Lempira</item>
-    <item>Leone</item>
-    <item>Liberiaanse dollar</item>
-    <item>Libische Dinar</item>
-    <item>Lilangeni</item>
-    <item>Litouwse Litas</item>
-    <item>Loti</item>
-    <item>Malagasi Ariary</item>
-    <item>Maleisische Ringgit</item>
-    <item>Mauritiaanse Rupee</item>
-    <item>Mexicaanse peso</item>
-    <item>Mexicaanse Unidad de Inversion (UDI)</item>
-    <item>Moldavische Leu</item>
-    <item>Marokkaanse Dirham</item>
-    <item>Mozambique Metical</item>
-    <item>Mvdol</item>
-    <item>Naira</item>
-    <item>Nakfa</item>
-    <item>Namibische Dollar</item>
-    <item>Nepalese Rupee</item>
-    <item>Antilliaanse gulden</item>
-    <item>Isralische nieuwe shekel</item>
-    <item>Nieuwe Roemeense Leu</item>
-    <item>Taiwanese nieuwe Dollar</item>
-    <item>Nieuw-Zeelandse dollar</item>
-    <item>Ngultrum</item>
-    <item>Noord-Koreaanse Won</item>
-    <item>Noorse kroon</item>
-    <item>Nuevo Sol</item>
-    <item>Ouguiya</item>
-    <item>Pa\'anga</item>
-    <item>Pakistaanse Rupee</item>
-    <item>Palladium</item>
-    <item>Pataca</item>
-    <item>Filippijnse peso</item>
-    <item>Platina</item>
-    <item>Pond sterling</item>
-    <item>Pula</item>
-    <item>Qatarese Rial</item>
-    <item>Quetzal</item>
-    <item>Rand</item>
-    <item>Rial Omani</item>
-    <item>Riel</item>
-    <item>Rufiyaa</item>
-    <item>Roepie</item>
-    <item>Russische roebel</item>
-    <item>Rwanda Frank</item>
-    <item>Sint-Heleense pond</item>
-    <item>Saoedi-Arabische Riyal</item>
-    <item>SDR (bijzonder trekkingsrecht)</item>
-    <item>Servische Dinar</item>
-    <item>Seychelse Roepie</item>
-    <item>Zilver</item>
-    <item>Singaporese Dollar</item>
-    <item>Salomonseilandse Dollar</item>
-    <item>Som</item>
-    <item>Somalische Shilling</item>
-    <item>Somoni</item>
-    <item>Zuid Soedanese pond</item>
-    <item>Srilankaanse Rupee</item>
-    <item>Sucre</item>
-    <item>Soedanese pond</item>
-    <item>Surinaamse Dollar</item>
-    <item>Zweedse kroon</item>
-    <item>Zwitserse Frank</item>
-    <item>Syrisch pond</item>
-    <item>Taka</item>
-    <item>Tala</item>
-    <item>Tanzaniaanse Shilling</item>
-    <item>Tenge</item>
-    <item>Geen valuta</item>
-    <item>Trinidad en Tobago-Dollar</item>
-    <item>Tugrik</item>
-    <item>Tunesische dinar</item>
-    <item>Turkse lire</item>
-    <item>Turkmenistan nieuwe Manat</item>
-    <item>UAE Dirham</item>
-    <item>Oeganda Shilling</item>
-    <item>UIC-Frank</item>
-    <item>Unidad de Valor Real</item>
-    <item>Unidades de fomento</item>
-    <item>Uruguay Peso nl Unidades Indexadas (URUIURUI)</item>
-    <item>Uruguayan Peso</item>
-    <item>Amerikaanse Dollar</item>
-    <item>Oezbekistaanse Sum</item>
-    <item>Vatu</item>
-    <item>WIR Euro</item>
-    <item>WIR Frank</item>
-    <item>Won</item>
-    <item>Jemenitische Rial</item>
-    <item>Yen</item>
-    <item>Yuan Renminbi</item>
-    <item>Zambiaanse Kwacha</item>
-    <item>Zimbabwaanse Dollar</item>
-    <item>Zloty</item>
-  </string-array>
   <string name="error_no_accounts">Geen rekeningen beschikbaar.\nU moet een rekening aanmaken alvorens een widget toe te voegen</string>
   <string name="title_build_version">Versie</string>
   <string name="title_license">Licentie</string>
diff --git a/app/src/main/res/values-no-rNO/strings.xml b/app/src/main/res/values-no-rNO/strings.xml
index e3ac6da3..05ee7407 100644
--- a/app/src/main/res/values-no-rNO/strings.xml
+++ b/app/src/main/res/values-no-rNO/strings.xml
@@ -85,183 +85,6 @@
   <string name="label_display_account">Vis konto</string>
   <string name="btn_create_accounts">Opprett konto</string>
   <string name="title_default_accounts">Velg kontoer  opprette</string>
-  <string-array name="currency_names">
-    <item>Afghanske</item>
-    <item>Algeriske dinarer</item>
-    <item>Argentinsk Peso</item>
-    <item>Armensk Dram</item>
-    <item>Arubiske gylden</item>
-    <item>Australske Dollar</item>
-    <item>Aserbajdsjanske Manat</item>
-    <item>Bahamian Dollar</item>
-    <item>Bahraini dinarer</item>
-    <item>Baht</item>
-    <item>Balboa</item>
-    <item>Barbados Dollar</item>
-    <item>Hviterussiske rubler</item>
-    <item>Belize Dollar</item>
-    <item>Bermudian Dollar</item>
-    <item>Bolivar Fuerte</item>
-    <item>Boliviano</item>
-    <item>Brasilianske Real</item>
-    <item>Brunei Dollar</item>
-    <item>Bulgarske Lev</item>
-    <item>Burundi Franc</item>
-    <item>Kanadiske Dollar</item>
-    <item>Kapp Verde Escudo</item>
-    <item>Caymanyene Dollar</item>
-    <item>CFA Franc BCEAO</item>
-    <item>CFA Franc BEAC</item>
-    <item>CFP Franc</item>
-    <item>Chilenske pesos</item>
-    <item>Testing valuta</item>
-    <item>Colombianske Peso</item>
-    <item>Comoro Franc</item>
-    <item>Kongolesiske Franc</item>
-    <item>Konvertible Mark</item>
-    <item>Cordoba Oro</item>
-    <item>Costa Rica kolon</item>
-    <item>Kroatiske Kuna</item>
-    <item>Cubansk konvertibel Peso</item>
-    <item>Cubansk Peso</item>
-    <item>Tsjekkiske Koruna</item>
-    <item>Dalasi</item>
-    <item>Dansk Krone</item>
-    <item>Denar</item>
-    <item>Djibouti Franc</item>
-    <item>Dobra</item>
-    <item>Dominikanske pesos</item>
-    <item>Dong</item>
-    <item>stkaribiske Dollar</item>
-    <item>Egyptisk pund</item>
-    <item>El Salvador kolon</item>
-    <item>Ethiopian Birr</item>
-    <item>Euro</item>
-    <item>Falklandske pund</item>
-    <item>Fiji Dollar</item>
-    <item>Forint</item>
-    <item>Ghana Cedi</item>
-    <item>Gibraltarske pund</item>
-    <item>Gull</item>
-    <item>Gourde</item>
-    <item>Guarani</item>
-    <item>Guinea Franc</item>
-    <item>Guyana Dollar</item>
-    <item>Hong Kong Dollar</item>
-    <item>Hryvnia</item>
-    <item>Islandske kroner</item>
-    <item>Indiske rupi</item>
-    <item>Iranske Rial</item>
-    <item>Irakiske dinarer</item>
-    <item>Jamaicanske Dollar</item>
-    <item>Jordanske dinarer</item>
-    <item>Kenyanske Shilling</item>
-    <item>Kina</item>
-    <item>Kip</item>
-    <item>Kuwaitiske dinarer</item>
-    <item>Kwacha</item>
-    <item>Kwanza</item>
-    <item>Kyat</item>
-    <item>Lari</item>
-    <item>Latviske Lats</item>
-    <item>Libanesiske pund</item>
-    <item>Lek</item>
-    <item>Lempira</item>
-    <item>Leone</item>
-    <item>Liberiske Dollar</item>
-    <item>Libyske dinarer</item>
-    <item>Lilangeni</item>
-    <item>Litauisk Litas</item>
-    <item>Loti</item>
-    <item>Gassiske Ariary</item>
-    <item>Malaysiske Ringgit</item>
-    <item>Mauritius rupi</item>
-    <item>Meksikansk Peso</item>
-    <item>Meksikansk Unidad de inversjon (UDI)</item>
-    <item>Moldova Leu</item>
-    <item>Marokkanske Dirham</item>
-    <item>Mosambik Metical</item>
-    <item>Mvdol</item>
-    <item>Naira</item>
-    <item>Nakfa</item>
-    <item>Namibiske Dollar</item>
-    <item>Nepalske rupi</item>
-    <item>Nederlandske antillegylden</item>
-    <item>Israelske shekel</item>
-    <item>Nye rumenske Leu</item>
-    <item>Nye taiwanske Dollar</item>
-    <item>Newzealandske Dollar</item>
-    <item>Ngultrum</item>
-    <item>Nordkoreanske Won</item>
-    <item>Norske kroner</item>
-    <item>Nuevo Sol</item>
-    <item>Ouguiya</item>
-    <item>Pa\'anga</item>
-    <item>Pakistanske rupi</item>
-    <item>Palladium</item>
-    <item>Pataca</item>
-    <item>Filippinske Peso</item>
-    <item>Platina</item>
-    <item>Pund Sterling</item>
-    <item>Pula</item>
-    <item>Qatari Rial</item>
-    <item>Quetzal</item>
-    <item>Rand</item>
-    <item>Omansk Rial</item>
-    <item>Riel</item>
-    <item>Rufiyaa</item>
-    <item>Rupiah</item>
-    <item>Russisk rubel</item>
-    <item>Rwanda Franc</item>
-    <item>Sankthelenske pund</item>
-    <item>Saudiarabiske Riyal</item>
-    <item>SDR (spesielle tegning rett)</item>
-    <item>Serbiske dinarer</item>
-    <item>Seychellene rupi</item>
-    <item>Slv</item>
-    <item>Singapor Dollar</item>
-    <item>Salomonyene Dollar</item>
-    <item>Som</item>
-    <item>Somaliske Shilling</item>
-    <item>Somoni</item>
-    <item>Sr Sudanske pund</item>
-    <item>Srilankiske rupi</item>
-    <item>Sucre</item>
-    <item>Sudanske pund</item>
-    <item>Surinam Dollar</item>
-    <item>Svenske kroner</item>
-    <item>Sveitsiske Franc</item>
-    <item>Syriske pund</item>
-    <item>Taka</item>
-    <item>Tala</item>
-    <item>Tanzanianske Shilling</item>
-    <item>Tenge</item>
-    <item>Ingen valuta</item>
-    <item>Trinidad og Tobagos Dollar</item>
-    <item>Tugrik</item>
-    <item>Tunisiske dinarer</item>
-    <item>Tyrkiske Lira</item>
-    <item>Turkmensk nye Manat</item>
-    <item>UAE Dirham</item>
-    <item>Ugandiske Shilling</item>
-    <item>UIC Franc</item>
-    <item>Unidad de Valor Real</item>
-    <item>Unidades de fomento</item>
-    <item>Uruguay Peso no Unidades Indexadas (URUIURUI)</item>
-    <item>Uruguayanske peso</item>
-    <item>US Dollar</item>
-    <item>Usbekiske Sum</item>
-    <item>Vatu</item>
-    <item>WIR Euro</item>
-    <item>WIR Franc</item>
-    <item>Won</item>
-    <item>Yemeni Rial</item>
-    <item>Yen</item>
-    <item>Yuan Renminbi</item>
-    <item>Zambiske Kwacha</item>
-    <item>Zimbabwiske Dollar</item>
-    <item>Zloty</item>
-  </string-array>
   <string name="error_no_accounts">Det finnes ingen kontoer i GnuCash.\nOpprett en konto fr du legger til en widget</string>
   <string name="title_build_version">Byggversjon</string>
   <string name="title_license">Lisens</string>
diff --git a/app/src/main/res/values-pl-rPL/strings.xml b/app/src/main/res/values-pl-rPL/strings.xml
index 037c4241..aa736601 100644
--- a/app/src/main/res/values-pl-rPL/strings.xml
+++ b/app/src/main/res/values-pl-rPL/strings.xml
@@ -85,183 +85,6 @@
   <string name="label_display_account">Wywietl konto</string>
   <string name="btn_create_accounts">Utwrz konta</string>
   <string name="title_default_accounts">Wybierz konta do utworzenia</string>
-  <string-array name="currency_names">
-    <item>Afghani</item>
-    <item>Algerian Dinar</item>
-    <item>Argentine Peso</item>
-    <item>Armenian Dram</item>
-    <item>Aruban Florin</item>
-    <item>Australian Dollar</item>
-    <item>Azerbaijanian Manat</item>
-    <item>Bahamian Dollar</item>
-    <item>Bahraini Dinar</item>
-    <item>Baht</item>
-    <item>Balboa</item>
-    <item>Barbados Dollar</item>
-    <item>Belarussian Ruble</item>
-    <item>Belize Dollar</item>
-    <item>Bermudian Dollar</item>
-    <item>Bolivar Fuerte</item>
-    <item>Boliviano</item>
-    <item>Brazilian Real</item>
-    <item>Brunei Dollar</item>
-    <item>Bulgarian Lev</item>
-    <item>Burundi Franc</item>
-    <item>Canadian Dollar</item>
-    <item>Cape Verde Escudo</item>
-    <item>Cayman Islands Dollar</item>
-    <item>CFA Franc BCEAO</item>
-    <item>CFA Franc BEAC</item>
-    <item>CFP Franc</item>
-    <item>Chilean Peso</item>
-    <item>Testing currency</item>
-    <item>Colombian Peso</item>
-    <item>Comoro Franc</item>
-    <item>Congolese Franc</item>
-    <item>Convertible Mark</item>
-    <item>Cordoba Oro</item>
-    <item>Costa Rican Colon</item>
-    <item>Croatian Kuna</item>
-    <item>Cuban Convertible Peso</item>
-    <item>Cuban Peso</item>
-    <item>Czech Koruna</item>
-    <item>Dalasi</item>
-    <item>Danish Krone</item>
-    <item>Denar</item>
-    <item>Djibouti Franc</item>
-    <item>Dobra</item>
-    <item>Dominican Peso</item>
-    <item>Dong</item>
-    <item>East Caribbean Dollar</item>
-    <item>Egyptian Pound</item>
-    <item>El Salvador Colon</item>
-    <item>Ethiopian Birr</item>
-    <item>Euro</item>
-    <item>Falkland Islands Pound</item>
-    <item>Fiji Dollar</item>
-    <item>Forint</item>
-    <item>Ghana Cedi</item>
-    <item>Gibraltar Pound</item>
-    <item>Gold</item>
-    <item>Gourde</item>
-    <item>Guarani</item>
-    <item>Guinea Franc</item>
-    <item>Guyana Dollar</item>
-    <item>Hong Kong Dollar</item>
-    <item>Hryvnia</item>
-    <item>Iceland Krona</item>
-    <item>Indian Rupee</item>
-    <item>Iranian Rial</item>
-    <item>Iraqi Dinar</item>
-    <item>Jamaican Dollar</item>
-    <item>Jordanian Dinar</item>
-    <item>Kenyan Shilling</item>
-    <item>Kina</item>
-    <item>Kip</item>
-    <item>Kuwaiti Dinar</item>
-    <item>Kwacha</item>
-    <item>Kwanza</item>
-    <item>Kyat</item>
-    <item>Lari</item>
-    <item>Latvian Lats</item>
-    <item>Lebanese Pound</item>
-    <item>Lek</item>
-    <item>Lempira</item>
-    <item>Leone</item>
-    <item>Liberian Dollar</item>
-    <item>Libyan Dinar</item>
-    <item>Lilangeni</item>
-    <item>Lithuanian Litas</item>
-    <item>Loti</item>
-    <item>Malagasy Ariary</item>
-    <item>Malaysian Ringgit</item>
-    <item>Mauritius Rupee</item>
-    <item>Mexican Peso</item>
-    <item>Mexican Unidad de Inversion (UDI)</item>
-    <item>Moldovan Leu</item>
-    <item>Moroccan Dirham</item>
-    <item>Mozambique Metical</item>
-    <item>Mvdol</item>
-    <item>Naira</item>
-    <item>Nakfa</item>
-    <item>Namibia Dollar</item>
-    <item>Nepalese Rupee</item>
-    <item>Netherlands Antillean Guilder</item>
-    <item>New Israeli Sheqel</item>
-    <item>New Romanian Leu</item>
-    <item>New Taiwan Dollar</item>
-    <item>New Zealand Dollar</item>
-    <item>Ngultrum</item>
-    <item>North Korean Won</item>
-    <item>Norwegian Krone</item>
-    <item>Nuevo Sol</item>
-    <item>Ouguiya</item>
-    <item>Paanga</item>
-    <item>Pakistan Rupee</item>
-    <item>Palladium</item>
-    <item>Pataca</item>
-    <item>Philippine Peso</item>
-    <item>Platinum</item>
-    <item>Pound Sterling</item>
-    <item>Pula</item>
-    <item>Qatari Rial</item>
-    <item>Quetzal</item>
-    <item>Rand</item>
-    <item>Rial Omani</item>
-    <item>Riel</item>
-    <item>Rufiyaa</item>
-    <item>Rupiah</item>
-    <item>Russian Ruble</item>
-    <item>Rwanda Franc</item>
-    <item>Saint Helena Pound</item>
-    <item>Saudi Riyal</item>
-    <item>SDR (Special Drawing Right)</item>
-    <item>Serbian Dinar</item>
-    <item>Seychelles Rupee</item>
-    <item>Silver</item>
-    <item>Singapore Dollar</item>
-    <item>Solomon Islands Dollar</item>
-    <item>Som</item>
-    <item>Somali Shilling</item>
-    <item>Somoni</item>
-    <item>South Sudanese Pound</item>
-    <item>Sri Lanka Rupee</item>
-    <item>Sucre</item>
-    <item>Sudanese Pound</item>
-    <item>Surinam Dollar</item>
-    <item>Swedish Krona</item>
-    <item>Swiss Franc</item>
-    <item>Syrian Pound</item>
-    <item>Taka</item>
-    <item>Tala</item>
-    <item>Tanzanian Shilling</item>
-    <item>Tenge</item>
-    <item>No currency</item>
-    <item>Trinidad and Tobago Dollar</item>
-    <item>Tugrik</item>
-    <item>Tunisian Dinar</item>
-    <item>Turkish Lira</item>
-    <item>Turkmenistan New Manat</item>
-    <item>UAE Dirham</item>
-    <item>Uganda Shilling</item>
-    <item>UIC-Franc</item>
-    <item>Unidad de Valor Real</item>
-    <item>Unidades de fomento</item>
-    <item>Uruguay Peso en Unidades Indexadas (URUIURUI)</item>
-    <item>Uruguayan peso</item>
-    <item>US Dollar</item>
-    <item>Uzbekistan Sum</item>
-    <item>Vatu</item>
-    <item>WIR Euro</item>
-    <item>WIR Franc</item>
-    <item>Won</item>
-    <item>Yemeni Rial</item>
-    <item>Yen</item>
-    <item>Yuan Renminbi</item>
-    <item>Zambian Kwacha</item>
-    <item>Zimbabwe Dollar</item>
-    <item>Zloty</item>
-  </string-array>
   <string name="error_no_accounts">Brak kont w GnuCash.\nUtwrz konto zanim dodasz widet</string>
   <string name="title_build_version">Wersja builda</string>
   <string name="title_license">Licencja</string>
diff --git a/app/src/main/res/values-pt-rBR/strings.xml b/app/src/main/res/values-pt-rBR/strings.xml
index b65554ae..443b85b8 100644
--- a/app/src/main/res/values-pt-rBR/strings.xml
+++ b/app/src/main/res/values-pt-rBR/strings.xml
@@ -85,183 +85,6 @@
   <string name="label_display_account">Mostrar conta</string>
   <string name="btn_create_accounts">Criar Contas</string>
   <string name="title_default_accounts">Escolha as contas a criar</string>
-  <string-array name="currency_names">
-    <item>Afegane</item>
-    <item>Dinar Argelino</item>
-    <item>Peso Argentino</item>
-    <item>Dram Armeniano</item>
-    <item>Florim de Aruba</item>
-    <item>Dlar Australiano</item>
-    <item>Manat Azerbaijo</item>
-    <item>Dlar Bahamas</item>
-    <item>Dinar de Bahrein</item>
-    <item>Bath Tailandez</item>
-    <item>Balboa</item>
-    <item>Dlar de Barbados</item>
-    <item>Rublo Belarus</item>
-    <item>Dlar de Belize</item>
-    <item>Dlar de Bermudas</item>
-    <item>Bolivar Forte</item>
-    <item>Boliviano</item>
-    <item>Real Brasileiro</item>
-    <item>Dlar de Brunei</item>
-    <item>Lev Blgaro</item>
-    <item>Franco de Burundi</item>
-    <item>Dlar Canadense</item>
-    <item>Escudo de Cabo Verde</item>
-    <item>Dlar das Ilhas Cayman</item>
-    <item>Franco CFA BCEAO</item>
-    <item>Franco CFA BEAC</item>
-    <item>Franco CFP</item>
-    <item>Peso Chileno</item>
-    <item>Cotao de teste</item>
-    <item>Peso Colombiano</item>
-    <item>Franco de Comores</item>
-    <item>Franco Congoles</item>
-    <item>Marco Conversvel</item>
-    <item>Ouro Cordoba</item>
-    <item>Colon de Costa Rica</item>
-    <item>Kuna Croata</item>
-    <item>Peso conversvel Cubano</item>
-    <item>Peso Cubano</item>
-    <item>Coroa Tcheca</item>
-    <item>Dalassi</item>
-    <item>Coroa da Dinamarca</item>
-    <item>Dinar Macedonia</item>
-    <item>Franco de Djibuti</item>
-    <item>Dobra de So Tome e Principe</item>
-    <item>Peso Dominicano</item>
-    <item>Dongue</item>
-    <item>Dlar do Caribe Oriental</item>
-    <item>Libra Egpcia</item>
-    <item>Colon de El Salvador</item>
-    <item>Birr da Etiopia</item>
-    <item>Euro</item>
-    <item>Libra das Ilhas Falkland</item>
-    <item>Dlar Fiji</item>
-    <item>Florim Hngaro</item>
-    <item>Cedi de Gana</item>
-    <item>Libra de Gibraltar</item>
-    <item>Ouro</item>
-    <item>Gourde Haitiano</item>
-    <item>Guarani</item>
-    <item>Franco de Guine</item>
-    <item>Dlar da Guiana</item>
-    <item>Dlar de Hong Kong</item>
-    <item>Grvnia</item>
-    <item>Coroa da Islandia</item>
-    <item>Rupia Indiana</item>
-    <item>Rial Iraniano</item>
-    <item>Dinar Iraquiano</item>
-    <item>Dlar Jamaicano</item>
-    <item>Dinar Jordaniano</item>
-    <item>Xelim do Quenia</item>
-    <item>Kina</item>
-    <item>Quipe</item>
-    <item>Dinar Kwait</item>
-    <item>Quacha</item>
-    <item>Kwanza</item>
-    <item>Quiate</item>
-    <item>Lari</item>
-    <item>Lat da Letonia</item>
-    <item>Libra do Lbano</item>
-    <item>Lek</item>
-    <item>Lempira</item>
-    <item>Leone</item>
-    <item>Dlar Liberiano</item>
-    <item>Dinar Libia</item>
-    <item>Lilangeni</item>
-    <item>Lita da Lituania</item>
-    <item>Loti</item>
-    <item>Ariary de Madagascar</item>
-    <item>Ringgit da Malasia</item>
-    <item>Rupia de Mauricio</item>
-    <item>Peso Mexicano</item>
-    <item>Unidade Mexicana de Inverso</item>
-    <item>Leu da Moldvia</item>
-    <item>Dirham de Marrocos</item>
-    <item>Nova Metical de Moambique</item>
-    <item>Boliviano</item>
-    <item>Naira</item>
-    <item>Nakfa</item>
-    <item>Dlar da Nambia</item>
-    <item>Rupia do Nepal</item>
-    <item>Florim das Antilhas Holandesas</item>
-    <item>Shequl Israelense</item>
-    <item>Novo Leu Romeno</item>
-    <item>Novo Dlar Taiwanes</item>
-    <item>Dlar Neozelands</item>
-    <item>Ngultrume butanes</item>
-    <item>Won Norte Koreano</item>
-    <item>Krone Noruegues</item>
-    <item>Novo Sol</item>
-    <item>Uguia</item>
-    <item>Paanga</item>
-    <item>Rupia do Paquisto</item>
-    <item>Paladio</item>
-    <item>Pataca</item>
-    <item>Peso Filipino</item>
-    <item>Platina</item>
-    <item>Libra Esterlina</item>
-    <item>Pula</item>
-    <item>Rial do Catar</item>
-    <item>Quetzal</item>
-    <item>Rande</item>
-    <item>Rial de Om</item>
-    <item>Riel</item>
-    <item>Rufia</item>
-    <item>Rupia da Indonesia</item>
-    <item>Rublo Russo</item>
-    <item>Franco de Ruanda</item>
-    <item>Libra de Santa Helena</item>
-    <item>Rial da Arbia Saudita</item>
-    <item>Direito especial</item>
-    <item>Dinar Srvio</item>
-    <item>Rupia de Seycheles</item>
-    <item>Prata</item>
-    <item>Dlar de Cingapura</item>
-    <item>Dlar das Ilhas Salomo</item>
-    <item>Som Quirguisto</item>
-    <item>Xelim da Somlia</item>
-    <item>Somoni</item>
-    <item>Libra Sul Sudanesa</item>
-    <item>Rupia do Sri Lanka</item>
-    <item>Sucre</item>
-    <item>Nova Libra Sudanesa</item>
-    <item>Dlar do Suriname</item>
-    <item>Coroa Sueca</item>
-    <item>Franco Suio</item>
-    <item>Libra Siria</item>
-    <item>Taca</item>
-    <item>Tala</item>
-    <item>Xelim da Tanzania</item>
-    <item>Tenge</item>
-    <item>Sem moeda</item>
-    <item>Dlar de Trinidad e Tobago</item>
-    <item>Tugrik</item>
-    <item>Dinar Tunisiano</item>
-    <item>Nova Lira Turca</item>
-    <item>Novo Manat Turcomenisto</item>
-    <item>Dirham EAU</item>
-    <item>Xelim de Uganda</item>
-    <item>UIC-Franc</item>
-    <item>Unidade de Valor Real</item>
-    <item>unidades de fomento</item>
-    <item>Uruguai Peso em Unidades Indexadas</item>
-    <item>Peso Uruguaio</item>
-    <item>Dlar dos EUA</item>
-    <item>Som do Uzbequisto</item>
-    <item>Vatu</item>
-    <item>WIR Euro</item>
-    <item>WIR Franc</item>
-    <item>Won Sul Coreano</item>
-    <item>Rial de Iemen</item>
-    <item>Iene</item>
-    <item>Renmimbi de Iuan</item>
-    <item>Quacha do Zambia</item>
-    <item>Dlar do Zimbabue</item>
-    <item>Zloty</item>
-  </string-array>
   <string name="error_no_accounts">No existem contas no GnuCash.\nCrie uma conta antes de adicionar um widget</string>
   <string name="title_build_version">Verso</string>
   <string name="title_license">Licensa</string>
diff --git a/app/src/main/res/values-pt-rPT/strings.xml b/app/src/main/res/values-pt-rPT/strings.xml
index 8a053eaf..ce055634 100644
--- a/app/src/main/res/values-pt-rPT/strings.xml
+++ b/app/src/main/res/values-pt-rPT/strings.xml
@@ -85,183 +85,6 @@
   <string name="label_display_account">Mostrar conta</string>
   <string name="btn_create_accounts">Criar Contas</string>
   <string name="title_default_accounts">Escolha as contas a criar</string>
-  <string-array name="currency_names">
-    <item>Afego</item>
-    <item>Dinar argelino</item>
-    <item>Peso argentino</item>
-    <item>Dram armnio</item>
-    <item>Florin de Aruba</item>
-    <item>Dlar australiano</item>
-    <item>Manat do Arzebeijo</item>
-    <item>Dlar das Bahamas</item>
-    <item>Dinar do Bahrein</item>
-    <item>Baht</item>
-    <item>Balboa</item>
-    <item>Dlar de Barbados</item>
-    <item>Ruble de Bielorrussia</item>
-    <item>Dlar de Belize</item>
-    <item>Dlar das Bermudas</item>
-    <item>Bolivar Fuerte</item>
-    <item>Boliviano</item>
-    <item>Real brasileiro</item>
-    <item>Dlar de Brunei</item>
-    <item>Lev Blgaro</item>
-    <item>Franco de Burundi</item>
-    <item>Dlar canadiano</item>
-    <item>Escudo de Cabo Verde</item>
-    <item>Dlar das Ilhas Caimo</item>
-    <item>Franco CFA BCEAO</item>
-    <item>Franco CFA BEAC</item>
-    <item>Franco do CFP</item>
-    <item>Peso chileno</item>
-    <item>Moeda de teste</item>
-    <item>Peso colombiano</item>
-    <item>Franco das Comoros</item>
-    <item>Franco congols</item>
-    <item>Marco conversvel</item>
-    <item>Crdoba de ouro</item>
-    <item>Colon da Costa Rica</item>
-    <item>Kuna Croata</item>
-    <item>Peso cubano convertvel</item>
-    <item>Peso cubano</item>
-    <item>Coroa Checa</item>
-    <item>Dalasi</item>
-    <item>Coroa dinamarquesa</item>
-    <item>Denar</item>
-    <item>Franco do Djibuti</item>
-    <item>Dobra</item>
-    <item>Peso dominicano</item>
-    <item>Dong</item>
-    <item>Dlar das Carabas Orientais</item>
-    <item>Libra egpcia</item>
-    <item>Colon de El Salvador</item>
-    <item>Birr etope</item>
-    <item>Euro</item>
-    <item>Libra das Malvinas</item>
-    <item>Dlar das Fiji</item>
-    <item>Forint hngaro</item>
-    <item>Cedi Gana</item>
-    <item>Libra de Gibraltar</item>
-    <item>Ouro</item>
-    <item>Gourde</item>
-    <item>Guarani</item>
-    <item>Franco do Guinea</item>
-    <item>Dlar da Guiana</item>
-    <item>Dlar de Hong Kong</item>
-    <item>Hryvnia</item>
-    <item>Coroa islandesa</item>
-    <item>Rupia indiana</item>
-    <item>Rial iraniano</item>
-    <item>Dinar iraquiano</item>
-    <item>Dlar jamaicano</item>
-    <item>Dinar jordaniano</item>
-    <item>Xelim queniano</item>
-    <item>Kina</item>
-    <item>Kip</item>
-    <item>Dinar do Kuwait</item>
-    <item>Kwacha</item>
-    <item>Kwanza</item>
-    <item>Kyat</item>
-    <item>Lari</item>
-    <item>Lats Leto</item>
-    <item>Libra libanesa</item>
-    <item>Lek</item>
-    <item>Lempira</item>
-    <item>Leoa</item>
-    <item>Dlar da Libria</item>
-    <item>Dinar Lbio</item>
-    <item>Lilangeni</item>
-    <item>Litas lituana</item>
-    <item>Loti</item>
-    <item>Ariary malgaxe</item>
-    <item>Ringgit da Malsia</item>
-    <item>Rupia das Maurcias</item>
-    <item>Peso mexicano</item>
-    <item>Unidade de inverso mexicana (UDI)</item>
-    <item>Leu da Moldvia</item>
-    <item>Dirham marroquino</item>
-    <item>Metical de Moambique</item>
-    <item>Mvdol</item>
-    <item>Naira</item>
-    <item>Nakfa</item>
-    <item>Dlar de Nambia</item>
-    <item>Rupia nepalesa</item>
-    <item>Florim das Antilhas Holandesas</item>
-    <item>Novo Shequel israelita</item>
-    <item>Novo Leu romeno</item>
-    <item>Novo Dlar de Taiwan</item>
-    <item>Dlar da Nova Zelndia</item>
-    <item>Ngultrum</item>
-    <item>Won norte-coreano</item>
-    <item>Coroa norueguesa</item>
-    <item>Novo Sol</item>
-    <item>Ouguiya</item>
-    <item>Pa\'anga</item>
-    <item>Rupia paquistanesa</item>
-    <item>Paldio</item>
-    <item>Pataca</item>
-    <item>Peso filipino</item>
-    <item>Platina</item>
-    <item>Libra Esterlina</item>
-    <item>Pula</item>
-    <item>Rial do Qatar</item>
-    <item>Quetzal</item>
-    <item>Rand</item>
-    <item>Rial Omani</item>
-    <item>Riel</item>
-    <item>Rufiyaa</item>
-    <item>Rupia</item>
-    <item>Rublo Russo</item>
-    <item>Franco de Rwanda</item>
-    <item>Libra de Santa Helena</item>
-    <item>Rial saudita</item>
-    <item>SDR (direito especial de saque)</item>
-    <item>Dinar srvio</item>
-    <item>Rupia das Seychelles</item>
-    <item>Prata</item>
-    <item>Dlar de Singapura</item>
-    <item>Dlar das Ilhas Salomo</item>
-    <item>Som</item>
-    <item>Xelim somali</item>
-    <item>Somoni</item>
-    <item>Libra do Sudo do Sul</item>
-    <item>Rpia do Sri Lanka</item>
-    <item>Acar</item>
-    <item>Libra sudanesa</item>
-    <item>Dlar de Surinam</item>
-    <item>Coroa Sueca</item>
-    <item>Franco suo</item>
-    <item>Libra Sria</item>
-    <item>Taka</item>
-    <item>Tala</item>
-    <item>Xelim da Tanznia</item>
-    <item>Tenge</item>
-    <item>Nenhuma moeda</item>
-    <item>Dlar de Trinidad e Tobago</item>
-    <item>Tugrik da Monglia</item>
-    <item>Dinar tunisino</item>
-    <item>Lira turca</item>
-    <item>Novo Manat do Turcomenisto</item>
-    <item>Dirham dos UAE</item>
-    <item>Xelim de Uganda</item>
-    <item>UIC-Franco</item>
-    <item>Unidade de Valor Real</item>
-    <item>Unidade de fomento</item>
-    <item>Peso do uruguai em unidades indexadas (URUIURUI)</item>
-    <item>Peso uruguaio</item>
-    <item>Dlar dos USA</item>
-    <item>Sum do Usbequisto</item>
-    <item>Vatu</item>
-    <item>Euro WIR</item>
-    <item>Franco WIR</item>
-    <item>Won</item>
-    <item>Rial iemenita</item>
-    <item>Iene</item>
-    <item>Yuan Renminbi</item>
-    <item>Kwacha da Zmbia</item>
-    <item>Dlar de Zimbabwe</item>
-    <item>Zloty</item>
-  </string-array>
   <string name="error_no_accounts">No existem contas no GnuCash.\nCrie uma conta antes de adicionar um widget</string>
   <string name="title_build_version">Verso</string>
   <string name="title_license">Licensa</string>
diff --git a/app/src/main/res/values-ro-rRO/strings.xml b/app/src/main/res/values-ro-rRO/strings.xml
index e9bb88a3..92c01bd4 100644
--- a/app/src/main/res/values-ro-rRO/strings.xml
+++ b/app/src/main/res/values-ro-rRO/strings.xml
@@ -85,183 +85,6 @@
   <string name="label_display_account">Display account</string>
   <string name="btn_create_accounts">Create Accounts</string>
   <string name="title_default_accounts">Select accounts to create</string>
-  <string-array name="currency_names">
-    <item>Afghani</item>
-    <item>Algerian Dinar</item>
-    <item>Argentine Peso</item>
-    <item>Armenian Dram</item>
-    <item>Aruban Florin</item>
-    <item>Australian Dollar</item>
-    <item>Azerbaijanian Manat</item>
-    <item>Bahamian Dollar</item>
-    <item>Bahraini Dinar</item>
-    <item>Baht</item>
-    <item>Balboa</item>
-    <item>Barbados Dollar</item>
-    <item>Belarussian Ruble</item>
-    <item>Belize Dollar</item>
-    <item>Bermudian Dollar</item>
-    <item>Bolivar Fuerte</item>
-    <item>Boliviano</item>
-    <item>Brazilian Real</item>
-    <item>Brunei Dollar</item>
-    <item>Bulgarian Lev</item>
-    <item>Burundi Franc</item>
-    <item>Canadian Dollar</item>
-    <item>Cape Verde Escudo</item>
-    <item>Cayman Islands Dollar</item>
-    <item>CFA Franc BCEAO</item>
-    <item>CFA Franc BEAC</item>
-    <item>CFP Franc</item>
-    <item>Chilean Peso</item>
-    <item>Testing currency</item>
-    <item>Colombian Peso</item>
-    <item>Comoro Franc</item>
-    <item>Congolese Franc</item>
-    <item>Convertible Mark</item>
-    <item>Cordoba Oro</item>
-    <item>Costa Rican Colon</item>
-    <item>Croatian Kuna</item>
-    <item>Cuban Convertible Peso</item>
-    <item>Cuban Peso</item>
-    <item>Czech Koruna</item>
-    <item>Dalasi</item>
-    <item>Danish Krone</item>
-    <item>Denar</item>
-    <item>Djibouti Franc</item>
-    <item>Dobra</item>
-    <item>Dominican Peso</item>
-    <item>Dong</item>
-    <item>East Caribbean Dollar</item>
-    <item>Egyptian Pound</item>
-    <item>El Salvador Colon</item>
-    <item>Ethiopian Birr</item>
-    <item>Euro</item>
-    <item>Falkland Islands Pound</item>
-    <item>Fiji Dollar</item>
-    <item>Forint</item>
-    <item>Ghana Cedi</item>
-    <item>Gibraltar Pound</item>
-    <item>Gold</item>
-    <item>Gourde</item>
-    <item>Guarani</item>
-    <item>Guinea Franc</item>
-    <item>Guyana Dollar</item>
-    <item>Hong Kong Dollar</item>
-    <item>Hryvnia</item>
-    <item>Iceland Krona</item>
-    <item>Indian Rupee</item>
-    <item>Iranian Rial</item>
-    <item>Iraqi Dinar</item>
-    <item>Jamaican Dollar</item>
-    <item>Jordanian Dinar</item>
-    <item>Kenyan Shilling</item>
-    <item>Kina</item>
-    <item>Kip</item>
-    <item>Kuwaiti Dinar</item>
-    <item>Kwacha</item>
-    <item>Kwanza</item>
-    <item>Kyat</item>
-    <item>Lari</item>
-    <item>Latvian Lats</item>
-    <item>Lebanese Pound</item>
-    <item>Lek</item>
-    <item>Lempira</item>
-    <item>Leone</item>
-    <item>Liberian Dollar</item>
-    <item>Libyan Dinar</item>
-    <item>Lilangeni</item>
-    <item>Lithuanian Litas</item>
-    <item>Loti</item>
-    <item>Malagasy Ariary</item>
-    <item>Malaysian Ringgit</item>
-    <item>Mauritius Rupee</item>
-    <item>Mexican Peso</item>
-    <item>Mexican Unidad de Inversion (UDI)</item>
-    <item>Moldovan Leu</item>
-    <item>Moroccan Dirham</item>
-    <item>Mozambique Metical</item>
-    <item>Mvdol</item>
-    <item>Naira</item>
-    <item>Nakfa</item>
-    <item>Namibia Dollar</item>
-    <item>Nepalese Rupee</item>
-    <item>Netherlands Antillean Guilder</item>
-    <item>New Israeli Sheqel</item>
-    <item>New Romanian Leu</item>
-    <item>New Taiwan Dollar</item>
-    <item>New Zealand Dollar</item>
-    <item>Ngultrum</item>
-    <item>North Korean Won</item>
-    <item>Norwegian Krone</item>
-    <item>Nuevo Sol</item>
-    <item>Ouguiya</item>
-    <item>Paanga</item>
-    <item>Pakistan Rupee</item>
-    <item>Palladium</item>
-    <item>Pataca</item>
-    <item>Philippine Peso</item>
-    <item>Platinum</item>
-    <item>Pound Sterling</item>
-    <item>Pula</item>
-    <item>Qatari Rial</item>
-    <item>Quetzal</item>
-    <item>Rand</item>
-    <item>Rial Omani</item>
-    <item>Riel</item>
-    <item>Rufiyaa</item>
-    <item>Rupiah</item>
-    <item>Russian Ruble</item>
-    <item>Rwanda Franc</item>
-    <item>Saint Helena Pound</item>
-    <item>Saudi Riyal</item>
-    <item>SDR (Special Drawing Right)</item>
-    <item>Serbian Dinar</item>
-    <item>Seychelles Rupee</item>
-    <item>Silver</item>
-    <item>Singapore Dollar</item>
-    <item>Solomon Islands Dollar</item>
-    <item>Som</item>
-    <item>Somali Shilling</item>
-    <item>Somoni</item>
-    <item>South Sudanese Pound</item>
-    <item>Sri Lanka Rupee</item>
-    <item>Sucre</item>
-    <item>Sudanese Pound</item>
-    <item>Surinam Dollar</item>
-    <item>Swedish Krona</item>
-    <item>Swiss Franc</item>
-    <item>Syrian Pound</item>
-    <item>Taka</item>
-    <item>Tala</item>
-    <item>Tanzanian Shilling</item>
-    <item>Tenge</item>
-    <item>No currency</item>
-    <item>Trinidad and Tobago Dollar</item>
-    <item>Tugrik</item>
-    <item>Tunisian Dinar</item>
-    <item>Turkish Lira</item>
-    <item>Turkmenistan New Manat</item>
-    <item>UAE Dirham</item>
-    <item>Uganda Shilling</item>
-    <item>UIC-Franc</item>
-    <item>Unidad de Valor Real</item>
-    <item>Unidades de fomento</item>
-    <item>Uruguay Peso en Unidades Indexadas (URUIURUI)</item>
-    <item>Uruguayan peso</item>
-    <item>US Dollar</item>
-    <item>Uzbekistan Sum</item>
-    <item>Vatu</item>
-    <item>WIR Euro</item>
-    <item>WIR Franc</item>
-    <item>Won</item>
-    <item>Yemeni Rial</item>
-    <item>Yen</item>
-    <item>Yuan Renminbi</item>
-    <item>Zambian Kwacha</item>
-    <item>Zimbabwe Dollar</item>
-    <item>Zloty</item>
-  </string-array>
   <string name="error_no_accounts">No accounts exist in GnuCash.\nCreate an account before adding a widget</string>
   <string name="title_build_version">Build version</string>
   <string name="title_license">License</string>
diff --git a/app/src/main/res/values-ru/strings.xml b/app/src/main/res/values-ru/strings.xml
index 5049bae9..764b17f0 100644
--- a/app/src/main/res/values-ru/strings.xml
+++ b/app/src/main/res/values-ru/strings.xml
@@ -85,183 +85,6 @@
   <string name="label_display_account"> </string>
   <string name="btn_create_accounts"> </string>
   <string name="title_default_accounts">   </string>
-  <string-array name="currency_names">
-    <item>Afghani</item>
-    <item>Algerian Dinar</item>
-    <item>Argentine Peso</item>
-    <item>Armenian Dram</item>
-    <item>Aruban Florin</item>
-    <item>Australian Dollar</item>
-    <item>Azerbaijanian Manat</item>
-    <item>Bahamian Dollar</item>
-    <item>Bahraini Dinar</item>
-    <item>Baht</item>
-    <item>Balboa</item>
-    <item>Barbados Dollar</item>
-    <item> </item>
-    <item>Belize Dollar</item>
-    <item>Bermudian Dollar</item>
-    <item>Bolivar Fuerte</item>
-    <item>Boliviano</item>
-    <item>Brazilian Real</item>
-    <item>Brunei Dollar</item>
-    <item>Bulgarian Lev</item>
-    <item>Burundi Franc</item>
-    <item>Canadian Dollar</item>
-    <item>Cape Verde Escudo</item>
-    <item>Cayman Islands Dollar</item>
-    <item>CFA Franc BCEAO</item>
-    <item>CFA Franc BEAC</item>
-    <item>CFP Franc</item>
-    <item>Chilean Peso</item>
-    <item>Testing currency</item>
-    <item>Colombian Peso</item>
-    <item>Comoro Franc</item>
-    <item>Congolese Franc</item>
-    <item>Convertible Mark</item>
-    <item>Cordoba Oro</item>
-    <item>Costa Rican Colon</item>
-    <item>Croatian Kuna</item>
-    <item>Cuban Convertible Peso</item>
-    <item>Cuban Peso</item>
-    <item>Czech Koruna</item>
-    <item>Dalasi</item>
-    <item>Danish Krone</item>
-    <item>Denar</item>
-    <item>Djibouti Franc</item>
-    <item>Dobra</item>
-    <item>Dominican Peso</item>
-    <item>Dong</item>
-    <item>East Caribbean Dollar</item>
-    <item>Egyptian Pound</item>
-    <item>El Salvador Colon</item>
-    <item>Ethiopian Birr</item>
-    <item>Euro</item>
-    <item>Falkland Islands Pound</item>
-    <item>Fiji Dollar</item>
-    <item>Forint</item>
-    <item>Ghana Cedi</item>
-    <item>Gibraltar Pound</item>
-    <item>Gold</item>
-    <item>Gourde</item>
-    <item>Guarani</item>
-    <item>Guinea Franc</item>
-    <item>Guyana Dollar</item>
-    <item>Hong Kong Dollar</item>
-    <item></item>
-    <item>Iceland Krona</item>
-    <item>Indian Rupee</item>
-    <item>Iranian Rial</item>
-    <item>Iraqi Dinar</item>
-    <item>Jamaican Dollar</item>
-    <item>Jordanian Dinar</item>
-    <item>Kenyan Shilling</item>
-    <item>Kina</item>
-    <item>Kip</item>
-    <item>Kuwaiti Dinar</item>
-    <item>Kwacha</item>
-    <item>Kwanza</item>
-    <item>Kyat</item>
-    <item>Lari</item>
-    <item>Latvian Lats</item>
-    <item>Lebanese Pound</item>
-    <item>Lek</item>
-    <item>Lempira</item>
-    <item>Leone</item>
-    <item>Liberian Dollar</item>
-    <item>Libyan Dinar</item>
-    <item>Lilangeni</item>
-    <item>Lithuanian Litas</item>
-    <item>Loti</item>
-    <item>Malagasy Ariary</item>
-    <item>Malaysian Ringgit</item>
-    <item>Mauritius Rupee</item>
-    <item>Mexican Peso</item>
-    <item>Mexican Unidad de Inversion (UDI)</item>
-    <item>Moldovan Leu</item>
-    <item>Moroccan Dirham</item>
-    <item>Mozambique Metical</item>
-    <item>Mvdol</item>
-    <item>Naira</item>
-    <item>Nakfa</item>
-    <item>Namibia Dollar</item>
-    <item>Nepalese Rupee</item>
-    <item>Netherlands Antillean Guilder</item>
-    <item>New Israeli Sheqel</item>
-    <item>New Romanian Leu</item>
-    <item>New Taiwan Dollar</item>
-    <item>New Zealand Dollar</item>
-    <item>Ngultrum</item>
-    <item>North Korean Won</item>
-    <item>Norwegian Krone</item>
-    <item>Nuevo Sol</item>
-    <item>Ouguiya</item>
-    <item>Paanga</item>
-    <item>Pakistan Rupee</item>
-    <item>Palladium</item>
-    <item>Pataca</item>
-    <item>Philippine Peso</item>
-    <item>Platinum</item>
-    <item>Pound Sterling</item>
-    <item>Pula</item>
-    <item>Qatari Rial</item>
-    <item>Quetzal</item>
-    <item>Rand</item>
-    <item>Rial Omani</item>
-    <item>Riel</item>
-    <item>Rufiyaa</item>
-    <item>Rupiah</item>
-    <item> </item>
-    <item>Rwanda Franc</item>
-    <item>Saint Helena Pound</item>
-    <item>Saudi Riyal</item>
-    <item>SDR (Special Drawing Right)</item>
-    <item>Serbian Dinar</item>
-    <item>Seychelles Rupee</item>
-    <item>Silver</item>
-    <item>Singapore Dollar</item>
-    <item>Solomon Islands Dollar</item>
-    <item>Som</item>
-    <item>Somali Shilling</item>
-    <item>Somoni</item>
-    <item>South Sudanese Pound</item>
-    <item>Sri Lanka Rupee</item>
-    <item>Sucre</item>
-    <item>Sudanese Pound</item>
-    <item>Surinam Dollar</item>
-    <item>Swedish Krona</item>
-    <item>Swiss Franc</item>
-    <item>Syrian Pound</item>
-    <item>Taka</item>
-    <item>Tala</item>
-    <item>Tanzanian Shilling</item>
-    <item>Tenge</item>
-    <item> </item>
-    <item>Trinidad and Tobago Dollar</item>
-    <item>Tugrik</item>
-    <item>Tunisian Dinar</item>
-    <item>Turkish Lira</item>
-    <item>Turkmenistan New Manat</item>
-    <item>UAE Dirham</item>
-    <item>Uganda Shilling</item>
-    <item>UIC-Franc</item>
-    <item>Unidad de Valor Real</item>
-    <item>Unidades de fomento</item>
-    <item>Uruguay Peso en Unidades Indexadas (URUIURUI)</item>
-    <item>Uruguayan Peso</item>
-    <item> </item>
-    <item>Uzbekistan Sum</item>
-    <item>Vatu</item>
-    <item>WIR Euro</item>
-    <item>WIR Franc</item>
-    <item>Won</item>
-    <item>Yemeni Rial</item>
-    <item>Yen</item>
-    <item>Yuan Renminbi</item>
-    <item>Zambian Kwacha</item>
-    <item>Zimbabwe Dollar</item>
-    <item>Zloty</item>
-  </string-array>
   <string name="error_no_accounts">   Gnucash.\n  ,    .</string>
   <string name="title_build_version"> </string>
   <string name="title_license"></string>
diff --git a/app/src/main/res/values-sr-rSP/strings.xml b/app/src/main/res/values-sr-rSP/strings.xml
index 6dfa1c6c..c92cb105 100644
--- a/app/src/main/res/values-sr-rSP/strings.xml
+++ b/app/src/main/res/values-sr-rSP/strings.xml
@@ -85,183 +85,6 @@
   <string name="label_display_account">Display account</string>
   <string name="btn_create_accounts">Create Accounts</string>
   <string name="title_default_accounts">Select accounts to create</string>
-  <string-array name="currency_names">
-    <item>Afghani</item>
-    <item>Algerian Dinar</item>
-    <item>Argentine Peso</item>
-    <item>Armenian Dram</item>
-    <item>Aruban Florin</item>
-    <item>Australian Dollar</item>
-    <item>Azerbaijanian Manat</item>
-    <item>Bahamian Dollar</item>
-    <item>Bahraini Dinar</item>
-    <item>Baht</item>
-    <item>Balboa</item>
-    <item>Barbados Dollar</item>
-    <item>Belarussian Ruble</item>
-    <item>Belize Dollar</item>
-    <item>Bermudian Dollar</item>
-    <item>Bolivar Fuerte</item>
-    <item>Boliviano</item>
-    <item>Brazilian Real</item>
-    <item>Brunei Dollar</item>
-    <item>Bulgarian Lev</item>
-    <item>Burundi Franc</item>
-    <item>Canadian Dollar</item>
-    <item>Cape Verde Escudo</item>
-    <item>Cayman Islands Dollar</item>
-    <item>CFA Franc BCEAO</item>
-    <item>CFA Franc BEAC</item>
-    <item>CFP Franc</item>
-    <item>Chilean Peso</item>
-    <item>Testing currency</item>
-    <item>Colombian Peso</item>
-    <item>Comoro Franc</item>
-    <item>Congolese Franc</item>
-    <item>Convertible Mark</item>
-    <item>Cordoba Oro</item>
-    <item>Costa Rican Colon</item>
-    <item>Croatian Kuna</item>
-    <item>Cuban Convertible Peso</item>
-    <item>Cuban Peso</item>
-    <item>Czech Koruna</item>
-    <item>Dalasi</item>
-    <item>Danish Krone</item>
-    <item>Denar</item>
-    <item>Djibouti Franc</item>
-    <item>Dobra</item>
-    <item>Dominican Peso</item>
-    <item>Dong</item>
-    <item>East Caribbean Dollar</item>
-    <item>Egyptian Pound</item>
-    <item>El Salvador Colon</item>
-    <item>Ethiopian Birr</item>
-    <item>Euro</item>
-    <item>Falkland Islands Pound</item>
-    <item>Fiji Dollar</item>
-    <item>Forint</item>
-    <item>Ghana Cedi</item>
-    <item>Gibraltar Pound</item>
-    <item>Gold</item>
-    <item>Gourde</item>
-    <item>Guarani</item>
-    <item>Guinea Franc</item>
-    <item>Guyana Dollar</item>
-    <item>Hong Kong Dollar</item>
-    <item>Hryvnia</item>
-    <item>Iceland Krona</item>
-    <item>Indian Rupee</item>
-    <item>Iranian Rial</item>
-    <item>Iraqi Dinar</item>
-    <item>Jamaican Dollar</item>
-    <item>Jordanian Dinar</item>
-    <item>Kenyan Shilling</item>
-    <item>Kina</item>
-    <item>Kip</item>
-    <item>Kuwaiti Dinar</item>
-    <item>Kwacha</item>
-    <item>Kwanza</item>
-    <item>Kyat</item>
-    <item>Lari</item>
-    <item>Latvian Lats</item>
-    <item>Lebanese Pound</item>
-    <item>Lek</item>
-    <item>Lempira</item>
-    <item>Leone</item>
-    <item>Liberian Dollar</item>
-    <item>Libyan Dinar</item>
-    <item>Lilangeni</item>
-    <item>Lithuanian Litas</item>
-    <item>Loti</item>
-    <item>Malagasy Ariary</item>
-    <item>Malaysian Ringgit</item>
-    <item>Mauritius Rupee</item>
-    <item>Mexican Peso</item>
-    <item>Mexican Unidad de Inversion (UDI)</item>
-    <item>Moldovan Leu</item>
-    <item>Moroccan Dirham</item>
-    <item>Mozambique Metical</item>
-    <item>Mvdol</item>
-    <item>Naira</item>
-    <item>Nakfa</item>
-    <item>Namibia Dollar</item>
-    <item>Nepalese Rupee</item>
-    <item>Netherlands Antillean Guilder</item>
-    <item>New Israeli Sheqel</item>
-    <item>New Romanian Leu</item>
-    <item>New Taiwan Dollar</item>
-    <item>New Zealand Dollar</item>
-    <item>Ngultrum</item>
-    <item>North Korean Won</item>
-    <item>Norwegian Krone</item>
-    <item>Nuevo Sol</item>
-    <item>Ouguiya</item>
-    <item>Paanga</item>
-    <item>Pakistan Rupee</item>
-    <item>Palladium</item>
-    <item>Pataca</item>
-    <item>Philippine Peso</item>
-    <item>Platinum</item>
-    <item>Pound Sterling</item>
-    <item>Pula</item>
-    <item>Qatari Rial</item>
-    <item>Quetzal</item>
-    <item>Rand</item>
-    <item>Rial Omani</item>
-    <item>Riel</item>
-    <item>Rufiyaa</item>
-    <item>Rupiah</item>
-    <item>Russian Ruble</item>
-    <item>Rwanda Franc</item>
-    <item>Saint Helena Pound</item>
-    <item>Saudi Riyal</item>
-    <item>SDR (Special Drawing Right)</item>
-    <item>Serbian Dinar</item>
-    <item>Seychelles Rupee</item>
-    <item>Silver</item>
-    <item>Singapore Dollar</item>
-    <item>Solomon Islands Dollar</item>
-    <item>Som</item>
-    <item>Somali Shilling</item>
-    <item>Somoni</item>
-    <item>South Sudanese Pound</item>
-    <item>Sri Lanka Rupee</item>
-    <item>Sucre</item>
-    <item>Sudanese Pound</item>
-    <item>Surinam Dollar</item>
-    <item>Swedish Krona</item>
-    <item>Swiss Franc</item>
-    <item>Syrian Pound</item>
-    <item>Taka</item>
-    <item>Tala</item>
-    <item>Tanzanian Shilling</item>
-    <item>Tenge</item>
-    <item>No currency</item>
-    <item>Trinidad and Tobago Dollar</item>
-    <item>Tugrik</item>
-    <item>Tunisian Dinar</item>
-    <item>Turkish Lira</item>
-    <item>Turkmenistan New Manat</item>
-    <item>UAE Dirham</item>
-    <item>Uganda Shilling</item>
-    <item>UIC-Franc</item>
-    <item>Unidad de Valor Real</item>
-    <item>Unidades de fomento</item>
-    <item>Uruguay Peso en Unidades Indexadas (URUIURUI)</item>
-    <item>Uruguayan peso</item>
-    <item>US Dollar</item>
-    <item>Uzbekistan Sum</item>
-    <item>Vatu</item>
-    <item>WIR Euro</item>
-    <item>WIR Franc</item>
-    <item>Won</item>
-    <item>Yemeni Rial</item>
-    <item>Yen</item>
-    <item>Yuan Renminbi</item>
-    <item>Zambian Kwacha</item>
-    <item>Zimbabwe Dollar</item>
-    <item>Zloty</item>
-  </string-array>
   <string name="error_no_accounts">No accounts exist in GnuCash.\nCreate an account before adding a widget</string>
   <string name="title_build_version">Build version</string>
   <string name="title_license">License</string>
diff --git a/app/src/main/res/values-sv-rSE/strings.xml b/app/src/main/res/values-sv-rSE/strings.xml
index c68c7e3c..54aa639b 100644
--- a/app/src/main/res/values-sv-rSE/strings.xml
+++ b/app/src/main/res/values-sv-rSE/strings.xml
@@ -85,183 +85,6 @@
   <string name="label_display_account">Display account</string>
   <string name="btn_create_accounts">Create Accounts</string>
   <string name="title_default_accounts">Select accounts to create</string>
-  <string-array name="currency_names">
-    <item>Afghani</item>
-    <item>Algerian Dinar</item>
-    <item>Argentine Peso</item>
-    <item>Armenian Dram</item>
-    <item>Aruban Florin</item>
-    <item>Australian Dollar</item>
-    <item>Azerbaijanian Manat</item>
-    <item>Bahamian Dollar</item>
-    <item>Bahraini Dinar</item>
-    <item>Baht</item>
-    <item>Balboa</item>
-    <item>Barbados Dollar</item>
-    <item>Belarussian Ruble</item>
-    <item>Belize Dollar</item>
-    <item>Bermudian Dollar</item>
-    <item>Bolivar Fuerte</item>
-    <item>Boliviano</item>
-    <item>Brazilian Real</item>
-    <item>Brunei Dollar</item>
-    <item>Bulgarian Lev</item>
-    <item>Burundi Franc</item>
-    <item>Canadian Dollar</item>
-    <item>Cape Verde Escudo</item>
-    <item>Cayman Islands Dollar</item>
-    <item>CFA Franc BCEAO</item>
-    <item>CFA Franc BEAC</item>
-    <item>CFP Franc</item>
-    <item>Chilean Peso</item>
-    <item>Testing currency</item>
-    <item>Colombian Peso</item>
-    <item>Comoro Franc</item>
-    <item>Congolese Franc</item>
-    <item>Convertible Mark</item>
-    <item>Cordoba Oro</item>
-    <item>Costa Rican Colon</item>
-    <item>Croatian Kuna</item>
-    <item>Cuban Convertible Peso</item>
-    <item>Cuban Peso</item>
-    <item>Czech Koruna</item>
-    <item>Dalasi</item>
-    <item>Danish Krone</item>
-    <item>Denar</item>
-    <item>Djibouti Franc</item>
-    <item>Dobra</item>
-    <item>Dominican Peso</item>
-    <item>Dong</item>
-    <item>East Caribbean Dollar</item>
-    <item>Egyptian Pound</item>
-    <item>El Salvador Colon</item>
-    <item>Ethiopian Birr</item>
-    <item>Euro</item>
-    <item>Falkland Islands Pound</item>
-    <item>Fiji Dollar</item>
-    <item>Forint</item>
-    <item>Ghana Cedi</item>
-    <item>Gibraltar Pound</item>
-    <item>Gold</item>
-    <item>Gourde</item>
-    <item>Guarani</item>
-    <item>Guinea Franc</item>
-    <item>Guyana Dollar</item>
-    <item>Hong Kong Dollar</item>
-    <item>Hryvnia</item>
-    <item>Iceland Krona</item>
-    <item>Indian Rupee</item>
-    <item>Iranian Rial</item>
-    <item>Iraqi Dinar</item>
-    <item>Jamaican Dollar</item>
-    <item>Jordanian Dinar</item>
-    <item>Kenyan Shilling</item>
-    <item>Kina</item>
-    <item>Kip</item>
-    <item>Kuwaiti Dinar</item>
-    <item>Kwacha</item>
-    <item>Kwanza</item>
-    <item>Kyat</item>
-    <item>Lari</item>
-    <item>Latvian Lats</item>
-    <item>Lebanese Pound</item>
-    <item>Lek</item>
-    <item>Lempira</item>
-    <item>Leone</item>
-    <item>Liberian Dollar</item>
-    <item>Libyan Dinar</item>
-    <item>Lilangeni</item>
-    <item>Lithuanian Litas</item>
-    <item>Loti</item>
-    <item>Malagasy Ariary</item>
-    <item>Malaysian Ringgit</item>
-    <item>Mauritius Rupee</item>
-    <item>Mexican Peso</item>
-    <item>Mexican Unidad de Inversion (UDI)</item>
-    <item>Moldovan Leu</item>
-    <item>Moroccan Dirham</item>
-    <item>Mozambique Metical</item>
-    <item>Mvdol</item>
-    <item>Naira</item>
-    <item>Nakfa</item>
-    <item>Namibia Dollar</item>
-    <item>Nepalese Rupee</item>
-    <item>Netherlands Antillean Guilder</item>
-    <item>New Israeli Sheqel</item>
-    <item>New Romanian Leu</item>
-    <item>New Taiwan Dollar</item>
-    <item>New Zealand Dollar</item>
-    <item>Ngultrum</item>
-    <item>North Korean Won</item>
-    <item>Norwegian Krone</item>
-    <item>Nuevo Sol</item>
-    <item>Ouguiya</item>
-    <item>Paanga</item>
-    <item>Pakistan Rupee</item>
-    <item>Palladium</item>
-    <item>Pataca</item>
-    <item>Philippine Peso</item>
-    <item>Platinum</item>
-    <item>Pound Sterling</item>
-    <item>Pula</item>
-    <item>Qatari Rial</item>
-    <item>Quetzal</item>
-    <item>Rand</item>
-    <item>Rial Omani</item>
-    <item>Riel</item>
-    <item>Rufiyaa</item>
-    <item>Rupiah</item>
-    <item>Russian Ruble</item>
-    <item>Rwanda Franc</item>
-    <item>Saint Helena Pound</item>
-    <item>Saudi Riyal</item>
-    <item>SDR (Special Drawing Right)</item>
-    <item>Serbian Dinar</item>
-    <item>Seychelles Rupee</item>
-    <item>Silver</item>
-    <item>Singapore Dollar</item>
-    <item>Solomon Islands Dollar</item>
-    <item>Som</item>
-    <item>Somali Shilling</item>
-    <item>Somoni</item>
-    <item>South Sudanese Pound</item>
-    <item>Sri Lanka Rupee</item>
-    <item>Sucre</item>
-    <item>Sudanese Pound</item>
-    <item>Surinam Dollar</item>
-    <item>Swedish Krona</item>
-    <item>Swiss Franc</item>
-    <item>Syrian Pound</item>
-    <item>Taka</item>
-    <item>Tala</item>
-    <item>Tanzanian Shilling</item>
-    <item>Tenge</item>
-    <item>No currency</item>
-    <item>Trinidad and Tobago Dollar</item>
-    <item>Tugrik</item>
-    <item>Tunisian Dinar</item>
-    <item>Turkish Lira</item>
-    <item>Turkmenistan New Manat</item>
-    <item>UAE Dirham</item>
-    <item>Uganda Shilling</item>
-    <item>UIC-Franc</item>
-    <item>Unidad de Valor Real</item>
-    <item>Unidades de fomento</item>
-    <item>Uruguay Peso en Unidades Indexadas (URUIURUI)</item>
-    <item>Uruguayan peso</item>
-    <item>US Dollar</item>
-    <item>Uzbekistan Sum</item>
-    <item>Vatu</item>
-    <item>WIR Euro</item>
-    <item>WIR Franc</item>
-    <item>Won</item>
-    <item>Yemeni Rial</item>
-    <item>Yen</item>
-    <item>Yuan Renminbi</item>
-    <item>Zambian Kwacha</item>
-    <item>Zimbabwe Dollar</item>
-    <item>Zloty</item>
-  </string-array>
   <string name="error_no_accounts">No accounts exist in GnuCash.\nCreate an account before adding a widget</string>
   <string name="title_build_version">Build version</string>
   <string name="title_license">License</string>
diff --git a/app/src/main/res/values-tr-rTR/strings.xml b/app/src/main/res/values-tr-rTR/strings.xml
index a9ade4bd..a9c76198 100644
--- a/app/src/main/res/values-tr-rTR/strings.xml
+++ b/app/src/main/res/values-tr-rTR/strings.xml
@@ -85,183 +85,6 @@
   <string name="label_display_account">Display account</string>
   <string name="btn_create_accounts">Create Accounts</string>
   <string name="title_default_accounts">Select accounts to create</string>
-  <string-array name="currency_names">
-    <item>Afghani</item>
-    <item>Algerian Dinar</item>
-    <item>Argentine Peso</item>
-    <item>Armenian Dram</item>
-    <item>Aruban Florin</item>
-    <item>Australian Dollar</item>
-    <item>Azerbaijanian Manat</item>
-    <item>Bahamian Dollar</item>
-    <item>Bahraini Dinar</item>
-    <item>Baht</item>
-    <item>Balboa</item>
-    <item>Barbados Dollar</item>
-    <item>Belarussian Ruble</item>
-    <item>Belize Dollar</item>
-    <item>Bermudian Dollar</item>
-    <item>Bolivar Fuerte</item>
-    <item>Boliviano</item>
-    <item>Brazilian Real</item>
-    <item>Brunei Dollar</item>
-    <item>Bulgarian Lev</item>
-    <item>Burundi Franc</item>
-    <item>Canadian Dollar</item>
-    <item>Cape Verde Escudo</item>
-    <item>Cayman Islands Dollar</item>
-    <item>CFA Franc BCEAO</item>
-    <item>CFA Franc BEAC</item>
-    <item>CFP Franc</item>
-    <item>Chilean Peso</item>
-    <item>Testing currency</item>
-    <item>Colombian Peso</item>
-    <item>Comoro Franc</item>
-    <item>Congolese Franc</item>
-    <item>Convertible Mark</item>
-    <item>Cordoba Oro</item>
-    <item>Costa Rican Colon</item>
-    <item>Croatian Kuna</item>
-    <item>Cuban Convertible Peso</item>
-    <item>Cuban Peso</item>
-    <item>Czech Koruna</item>
-    <item>Dalasi</item>
-    <item>Danish Krone</item>
-    <item>Denar</item>
-    <item>Djibouti Franc</item>
-    <item>Dobra</item>
-    <item>Dominican Peso</item>
-    <item>Dong</item>
-    <item>East Caribbean Dollar</item>
-    <item>Egyptian Pound</item>
-    <item>El Salvador Colon</item>
-    <item>Ethiopian Birr</item>
-    <item>Euro</item>
-    <item>Falkland Islands Pound</item>
-    <item>Fiji Dollar</item>
-    <item>Forint</item>
-    <item>Ghana Cedi</item>
-    <item>Gibraltar Pound</item>
-    <item>Gold</item>
-    <item>Gourde</item>
-    <item>Guarani</item>
-    <item>Guinea Franc</item>
-    <item>Guyana Dollar</item>
-    <item>Hong Kong Dollar</item>
-    <item>Hryvnia</item>
-    <item>Iceland Krona</item>
-    <item>Indian Rupee</item>
-    <item>Iranian Rial</item>
-    <item>Iraqi Dinar</item>
-    <item>Jamaican Dollar</item>
-    <item>Jordanian Dinar</item>
-    <item>Kenyan Shilling</item>
-    <item>Kina</item>
-    <item>Kip</item>
-    <item>Kuwaiti Dinar</item>
-    <item>Kwacha</item>
-    <item>Kwanza</item>
-    <item>Kyat</item>
-    <item>Lari</item>
-    <item>Latvian Lats</item>
-    <item>Lebanese Pound</item>
-    <item>Lek</item>
-    <item>Lempira</item>
-    <item>Leone</item>
-    <item>Liberian Dollar</item>
-    <item>Libyan Dinar</item>
-    <item>Lilangeni</item>
-    <item>Lithuanian Litas</item>
-    <item>Loti</item>
-    <item>Malagasy Ariary</item>
-    <item>Malaysian Ringgit</item>
-    <item>Mauritius Rupee</item>
-    <item>Mexican Peso</item>
-    <item>Mexican Unidad de Inversion (UDI)</item>
-    <item>Moldovan Leu</item>
-    <item>Moroccan Dirham</item>
-    <item>Mozambique Metical</item>
-    <item>Mvdol</item>
-    <item>Naira</item>
-    <item>Nakfa</item>
-    <item>Namibia Dollar</item>
-    <item>Nepalese Rupee</item>
-    <item>Netherlands Antillean Guilder</item>
-    <item>New Israeli Sheqel</item>
-    <item>New Romanian Leu</item>
-    <item>New Taiwan Dollar</item>
-    <item>New Zealand Dollar</item>
-    <item>Ngultrum</item>
-    <item>North Korean Won</item>
-    <item>Norwegian Krone</item>
-    <item>Nuevo Sol</item>
-    <item>Ouguiya</item>
-    <item>Paanga</item>
-    <item>Pakistan Rupee</item>
-    <item>Palladium</item>
-    <item>Pataca</item>
-    <item>Philippine Peso</item>
-    <item>Platinum</item>
-    <item>Pound Sterling</item>
-    <item>Pula</item>
-    <item>Qatari Rial</item>
-    <item>Quetzal</item>
-    <item>Rand</item>
-    <item>Rial Omani</item>
-    <item>Riel</item>
-    <item>Rufiyaa</item>
-    <item>Rupiah</item>
-    <item>Russian Ruble</item>
-    <item>Rwanda Franc</item>
-    <item>Saint Helena Pound</item>
-    <item>Saudi Riyal</item>
-    <item>SDR (Special Drawing Right)</item>
-    <item>Serbian Dinar</item>
-    <item>Seychelles Rupee</item>
-    <item>Silver</item>
-    <item>Singapore Dollar</item>
-    <item>Solomon Islands Dollar</item>
-    <item>Som</item>
-    <item>Somali Shilling</item>
-    <item>Somoni</item>
-    <item>South Sudanese Pound</item>
-    <item>Sri Lanka Rupee</item>
-    <item>Sucre</item>
-    <item>Sudanese Pound</item>
-    <item>Surinam Dollar</item>
-    <item>Swedish Krona</item>
-    <item>Swiss Franc</item>
-    <item>Syrian Pound</item>
-    <item>Taka</item>
-    <item>Tala</item>
-    <item>Tanzanian Shilling</item>
-    <item>Tenge</item>
-    <item>No currency</item>
-    <item>Trinidad and Tobago Dollar</item>
-    <item>Tugrik</item>
-    <item>Tunisian Dinar</item>
-    <item>Turkish Lira</item>
-    <item>Turkmenistan New Manat</item>
-    <item>UAE Dirham</item>
-    <item>Uganda Shilling</item>
-    <item>UIC-Franc</item>
-    <item>Unidad de Valor Real</item>
-    <item>Unidades de fomento</item>
-    <item>Uruguay Peso en Unidades Indexadas (URUIURUI)</item>
-    <item>Uruguayan peso</item>
-    <item>US Dollar</item>
-    <item>Uzbekistan Sum</item>
-    <item>Vatu</item>
-    <item>WIR Euro</item>
-    <item>WIR Franc</item>
-    <item>Won</item>
-    <item>Yemeni Rial</item>
-    <item>Yen</item>
-    <item>Yuan Renminbi</item>
-    <item>Zambian Kwacha</item>
-    <item>Zimbabwe Dollar</item>
-    <item>Zloty</item>
-  </string-array>
   <string name="error_no_accounts">No accounts exist in GnuCash.\nCreate an account before adding a widget</string>
   <string name="title_build_version">Build version</string>
   <string name="title_license">License</string>
diff --git a/app/src/main/res/values-uk-rUA/strings.xml b/app/src/main/res/values-uk-rUA/strings.xml
index 9c123a97..0f843662 100644
--- a/app/src/main/res/values-uk-rUA/strings.xml
+++ b/app/src/main/res/values-uk-rUA/strings.xml
@@ -85,183 +85,6 @@
   <string name="label_display_account"> </string>
   <string name="btn_create_accounts"> </string>
   <string name="title_default_accounts">   </string>
-  <string-array name="currency_names">
-    <item></item>
-    <item> </item>
-    <item> </item>
-    <item> </item>
-    <item> </item>
-    <item> </item>
-    <item> </item>
-    <item> </item>
-    <item> </item>
-    <item></item>
-    <item></item>
-    <item> </item>
-    <item> </item>
-    <item>Belize Dollar</item>
-    <item>Bermudian Dollar</item>
-    <item>Bolivar Fuerte</item>
-    <item>Boliviano</item>
-    <item>Brazilian Real</item>
-    <item>Brunei Dollar</item>
-    <item>Bulgarian Lev</item>
-    <item>Burundi Franc</item>
-    <item> </item>
-    <item>Cape Verde Escudo</item>
-    <item>Cayman Islands Dollar</item>
-    <item>CFA Franc BCEAO</item>
-    <item>CFA Franc BEAC</item>
-    <item>CFP Franc</item>
-    <item>Chilean Peso</item>
-    <item>Testing currency</item>
-    <item>Colombian Peso</item>
-    <item>Comoro Franc</item>
-    <item>Congolese Franc</item>
-    <item>Convertible Mark</item>
-    <item>Cordoba Oro</item>
-    <item>Costa Rican Colon</item>
-    <item>Croatian Kuna</item>
-    <item>Cuban Convertible Peso</item>
-    <item>Cuban Peso</item>
-    <item> </item>
-    <item>Dalasi</item>
-    <item> </item>
-    <item></item>
-    <item>Djibouti Franc</item>
-    <item>Dobra</item>
-    <item>Dominican Peso</item>
-    <item>Dong</item>
-    <item>East Caribbean Dollar</item>
-    <item> </item>
-    <item>El Salvador Colon</item>
-    <item>Ethiopian Birr</item>
-    <item></item>
-    <item>Falkland Islands Pound</item>
-    <item>Fiji Dollar</item>
-    <item>Forint</item>
-    <item>Ghana Cedi</item>
-    <item>Gibraltar Pound</item>
-    <item></item>
-    <item>Gourde</item>
-    <item>Guarani</item>
-    <item>Guinea Franc</item>
-    <item>Guyana Dollar</item>
-    <item>Hong Kong Dollar</item>
-    <item></item>
-    <item>Iceland Krona</item>
-    <item>Indian Rupee</item>
-    <item>Iranian Rial</item>
-    <item>Iraqi Dinar</item>
-    <item>Jamaican Dollar</item>
-    <item>Jordanian Dinar</item>
-    <item>Kenyan Shilling</item>
-    <item>Kina</item>
-    <item>Kip</item>
-    <item>Kuwaiti Dinar</item>
-    <item>Kwacha</item>
-    <item>Kwanza</item>
-    <item>Kyat</item>
-    <item>Lari</item>
-    <item> </item>
-    <item>Lebanese Pound</item>
-    <item>Lek</item>
-    <item>Lempira</item>
-    <item>Leone</item>
-    <item>Liberian Dollar</item>
-    <item>Libyan Dinar</item>
-    <item>Lilangeni</item>
-    <item>Lithuanian Litas</item>
-    <item>Loti</item>
-    <item>Malagasy Ariary</item>
-    <item>Malaysian Ringgit</item>
-    <item>Mauritius Rupee</item>
-    <item> </item>
-    <item>Mexican Unidad de Inversion (UDI)</item>
-    <item> </item>
-    <item>Moroccan Dirham</item>
-    <item>Mozambique Metical</item>
-    <item>Mvdol</item>
-    <item>Naira</item>
-    <item>Nakfa</item>
-    <item>Namibia Dollar</item>
-    <item>Nepalese Rupee</item>
-    <item>Netherlands Antillean Guilder</item>
-    <item>  </item>
-    <item>  </item>
-    <item>New Taiwan Dollar</item>
-    <item>New Zealand Dollar</item>
-    <item>Ngultrum</item>
-    <item>North Korean Won</item>
-    <item>Norwegian Krone</item>
-    <item>Nuevo Sol</item>
-    <item>Ouguiya</item>
-    <item>Paanga</item>
-    <item>Pakistan Rupee</item>
-    <item></item>
-    <item>Pataca</item>
-    <item>Philippine Peso</item>
-    <item></item>
-    <item> </item>
-    <item>Pula</item>
-    <item>Qatari Rial</item>
-    <item>Quetzal</item>
-    <item>Rand</item>
-    <item>Rial Omani</item>
-    <item>Riel</item>
-    <item>Rufiyaa</item>
-    <item>Rupiah</item>
-    <item> </item>
-    <item>Rwanda Franc</item>
-    <item>Saint Helena Pound</item>
-    <item>Saudi Riyal</item>
-    <item>SDR (Special Drawing Right)</item>
-    <item>Serbian Dinar</item>
-    <item>Seychelles Rupee</item>
-    <item></item>
-    <item>Singapore Dollar</item>
-    <item>Solomon Islands Dollar</item>
-    <item>Som</item>
-    <item>Somali Shilling</item>
-    <item>Somoni</item>
-    <item>South Sudanese Pound</item>
-    <item>Sri Lanka Rupee</item>
-    <item>Sucre</item>
-    <item>Sudanese Pound</item>
-    <item>Surinam Dollar</item>
-    <item> </item>
-    <item> </item>
-    <item>Syrian Pound</item>
-    <item>Taka</item>
-    <item>Tala</item>
-    <item>Tanzanian Shilling</item>
-    <item></item>
-    <item> </item>
-    <item>Trinidad and Tobago Dollar</item>
-    <item>Tugrik</item>
-    <item>Tunisian Dinar</item>
-    <item> </item>
-    <item>Turkmenistan New Manat</item>
-    <item>UAE Dirham</item>
-    <item>Uganda Shilling</item>
-    <item>UIC-Franc</item>
-    <item>Unidad de Valor Real</item>
-    <item>Unidades de fomento</item>
-    <item>Uruguay Peso en Unidades Indexadas (URUIURUI)</item>
-    <item>Uruguayan Peso</item>
-    <item> </item>
-    <item>Uzbekistan Sum</item>
-    <item>Vatu</item>
-    <item>WIR Euro</item>
-    <item>WIR Franc</item>
-    <item>Won</item>
-    <item>Yemeni Rial</item>
-    <item></item>
-    <item></item>
-    <item>Zambian Kwacha</item>
-    <item>Zimbabwe Dollar</item>
-    <item></item>
-  </string-array>
   <string name="error_no_accounts">   Gnucash.\n    .</string>
   <string name="title_build_version"> </string>
   <string name="title_license"></string>
diff --git a/app/src/main/res/values-vi-rVN/strings.xml b/app/src/main/res/values-vi-rVN/strings.xml
index 46251403..1656ad73 100644
--- a/app/src/main/res/values-vi-rVN/strings.xml
+++ b/app/src/main/res/values-vi-rVN/strings.xml
@@ -85,183 +85,6 @@
   <string name="label_display_account">Display account</string>
   <string name="btn_create_accounts">Create Accounts</string>
   <string name="title_default_accounts">Select accounts to create</string>
-  <string-array name="currency_names">
-    <item>Afghani</item>
-    <item>Algerian Dinar</item>
-    <item>Argentine Peso</item>
-    <item>Armenian Dram</item>
-    <item>Aruban Florin</item>
-    <item>Australian Dollar</item>
-    <item>Azerbaijanian Manat</item>
-    <item>Bahamian Dollar</item>
-    <item>Bahraini Dinar</item>
-    <item>Baht</item>
-    <item>Balboa</item>
-    <item>Barbados Dollar</item>
-    <item>Belarussian Ruble</item>
-    <item>Belize Dollar</item>
-    <item>Bermudian Dollar</item>
-    <item>Bolivar Fuerte</item>
-    <item>Boliviano</item>
-    <item>Brazilian Real</item>
-    <item>Brunei Dollar</item>
-    <item>Bulgarian Lev</item>
-    <item>Burundi Franc</item>
-    <item>Canadian Dollar</item>
-    <item>Cape Verde Escudo</item>
-    <item>Cayman Islands Dollar</item>
-    <item>CFA Franc BCEAO</item>
-    <item>CFA Franc BEAC</item>
-    <item>CFP Franc</item>
-    <item>Chilean Peso</item>
-    <item>Testing currency</item>
-    <item>Colombian Peso</item>
-    <item>Comoro Franc</item>
-    <item>Congolese Franc</item>
-    <item>Convertible Mark</item>
-    <item>Cordoba Oro</item>
-    <item>Costa Rican Colon</item>
-    <item>Croatian Kuna</item>
-    <item>Cuban Convertible Peso</item>
-    <item>Cuban Peso</item>
-    <item>Czech Koruna</item>
-    <item>Dalasi</item>
-    <item>Danish Krone</item>
-    <item>Denar</item>
-    <item>Djibouti Franc</item>
-    <item>Dobra</item>
-    <item>Dominican Peso</item>
-    <item>Dong</item>
-    <item>East Caribbean Dollar</item>
-    <item>Egyptian Pound</item>
-    <item>El Salvador Colon</item>
-    <item>Ethiopian Birr</item>
-    <item>Euro</item>
-    <item>Falkland Islands Pound</item>
-    <item>Fiji Dollar</item>
-    <item>Forint</item>
-    <item>Ghana Cedi</item>
-    <item>Gibraltar Pound</item>
-    <item>Gold</item>
-    <item>Gourde</item>
-    <item>Guarani</item>
-    <item>Guinea Franc</item>
-    <item>Guyana Dollar</item>
-    <item>Hong Kong Dollar</item>
-    <item>Hryvnia</item>
-    <item>Iceland Krona</item>
-    <item>Indian Rupee</item>
-    <item>Iranian Rial</item>
-    <item>Iraqi Dinar</item>
-    <item>Jamaican Dollar</item>
-    <item>Jordanian Dinar</item>
-    <item>Kenyan Shilling</item>
-    <item>Kina</item>
-    <item>Kip</item>
-    <item>Kuwaiti Dinar</item>
-    <item>Kwacha</item>
-    <item>Kwanza</item>
-    <item>Kyat</item>
-    <item>Lari</item>
-    <item>Latvian Lats</item>
-    <item>Lebanese Pound</item>
-    <item>Lek</item>
-    <item>Lempira</item>
-    <item>Leone</item>
-    <item>Liberian Dollar</item>
-    <item>Libyan Dinar</item>
-    <item>Lilangeni</item>
-    <item>Lithuanian Litas</item>
-    <item>Loti</item>
-    <item>Malagasy Ariary</item>
-    <item>Malaysian Ringgit</item>
-    <item>Mauritius Rupee</item>
-    <item>Mexican Peso</item>
-    <item>Mexican Unidad de Inversion (UDI)</item>
-    <item>Moldovan Leu</item>
-    <item>Moroccan Dirham</item>
-    <item>Mozambique Metical</item>
-    <item>Mvdol</item>
-    <item>Naira</item>
-    <item>Nakfa</item>
-    <item>Namibia Dollar</item>
-    <item>Nepalese Rupee</item>
-    <item>Netherlands Antillean Guilder</item>
-    <item>New Israeli Sheqel</item>
-    <item>New Romanian Leu</item>
-    <item>New Taiwan Dollar</item>
-    <item>New Zealand Dollar</item>
-    <item>Ngultrum</item>
-    <item>North Korean Won</item>
-    <item>Norwegian Krone</item>
-    <item>Nuevo Sol</item>
-    <item>Ouguiya</item>
-    <item>Paanga</item>
-    <item>Pakistan Rupee</item>
-    <item>Palladium</item>
-    <item>Pataca</item>
-    <item>Philippine Peso</item>
-    <item>Platinum</item>
-    <item>Pound Sterling</item>
-    <item>Pula</item>
-    <item>Qatari Rial</item>
-    <item>Quetzal</item>
-    <item>Rand</item>
-    <item>Rial Omani</item>
-    <item>Riel</item>
-    <item>Rufiyaa</item>
-    <item>Rupiah</item>
-    <item>Russian Ruble</item>
-    <item>Rwanda Franc</item>
-    <item>Saint Helena Pound</item>
-    <item>Saudi Riyal</item>
-    <item>SDR (Special Drawing Right)</item>
-    <item>Serbian Dinar</item>
-    <item>Seychelles Rupee</item>
-    <item>Silver</item>
-    <item>Singapore Dollar</item>
-    <item>Solomon Islands Dollar</item>
-    <item>Som</item>
-    <item>Somali Shilling</item>
-    <item>Somoni</item>
-    <item>South Sudanese Pound</item>
-    <item>Sri Lanka Rupee</item>
-    <item>Sucre</item>
-    <item>Sudanese Pound</item>
-    <item>Surinam Dollar</item>
-    <item>Swedish Krona</item>
-    <item>Swiss Franc</item>
-    <item>Syrian Pound</item>
-    <item>Taka</item>
-    <item>Tala</item>
-    <item>Tanzanian Shilling</item>
-    <item>Tenge</item>
-    <item>No currency</item>
-    <item>Trinidad and Tobago Dollar</item>
-    <item>Tugrik</item>
-    <item>Tunisian Dinar</item>
-    <item>Turkish Lira</item>
-    <item>Turkmenistan New Manat</item>
-    <item>UAE Dirham</item>
-    <item>Uganda Shilling</item>
-    <item>UIC-Franc</item>
-    <item>Unidad de Valor Real</item>
-    <item>Unidades de fomento</item>
-    <item>Uruguay Peso en Unidades Indexadas (URUIURUI)</item>
-    <item>Uruguayan peso</item>
-    <item>US Dollar</item>
-    <item>Uzbekistan Sum</item>
-    <item>Vatu</item>
-    <item>WIR Euro</item>
-    <item>WIR Franc</item>
-    <item>Won</item>
-    <item>Yemeni Rial</item>
-    <item>Yen</item>
-    <item>Yuan Renminbi</item>
-    <item>Zambian Kwacha</item>
-    <item>Zimbabwe Dollar</item>
-    <item>Zloty</item>
-  </string-array>
   <string name="error_no_accounts">No accounts exist in GnuCash.\nCreate an account before adding a widget</string>
   <string name="title_build_version">Build version</string>
   <string name="title_license">License</string>
diff --git a/app/src/main/res/values-zh-rCN/strings.xml b/app/src/main/res/values-zh-rCN/strings.xml
index f5010cc0..83f48ddf 100644
--- a/app/src/main/res/values-zh-rCN/strings.xml
+++ b/app/src/main/res/values-zh-rCN/strings.xml
@@ -85,183 +85,6 @@
   <string name="label_display_account"></string>
   <string name="btn_create_accounts"></string>
   <string name="title_default_accounts"></string>
-  <string-array name="currency_names">
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item> </item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item>Cuban Convertible Peso</item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item>Kina </item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item>Lek </item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item>Mexican Unidad de Inversion (UDI)</item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item>Mvdol</item>
-    <item>Naira</item>
-    <item>Nakfa</item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item>Ngultrum</item>
-    <item></item>
-    <item></item>
-    <item> </item>
-    <item>Ouguiya</item>
-    <item>Paanga</item>
-    <item></item>
-    <item>Palladium</item>
-    <item>Pataca</item>
-    <item>Philippine Peso</item>
-    <item>Platinum</item>
-    <item>Pound Sterling</item>
-    <item>Pula</item>
-    <item>Qatari Rial</item>
-    <item>Quetzal</item>
-    <item>Rand</item>
-    <item>Rial Omani</item>
-    <item>Riel</item>
-    <item>Rufiyaa</item>
-    <item>Rupiah</item>
-    <item></item>
-    <item>Rwanda Franc</item>
-    <item>Saint Helena Pound</item>
-    <item>Saudi Riyal</item>
-    <item>SDR (Special Drawing Right)</item>
-    <item>Serbian Dinar</item>
-    <item>Seychelles Rupee</item>
-    <item></item>
-    <item></item>
-    <item>Solomon Islands Dollar</item>
-    <item>Som</item>
-    <item>Somali Shilling</item>
-    <item>Somoni</item>
-    <item>South Sudanese Pound</item>
-    <item>Sri Lanka Rupee</item>
-    <item>Sucre</item>
-    <item>Sudanese Pound</item>
-    <item>Surinam Dollar</item>
-    <item></item>
-    <item></item>
-    <item>Syrian Pound</item>
-    <item>Taka</item>
-    <item>Tala</item>
-    <item>Tanzanian Shilling</item>
-    <item>Tenge</item>
-    <item></item>
-    <item>Trinidad and Tobago Dollar</item>
-    <item>Tugrik</item>
-    <item>Tunisian Dinar</item>
-    <item>Turkish Lira</item>
-    <item>Turkmenistan New Manat</item>
-    <item>UAE Dirham</item>
-    <item>Uganda Shilling</item>
-    <item>UIC-Franc</item>
-    <item>Unidad de Valor Real</item>
-    <item>Unidades de fomento</item>
-    <item>Uruguay Peso en Unidades Indexadas (URUIURUI)</item>
-    <item>Uruguayan Peso</item>
-    <item></item>
-    <item>Uzbekistan Sum</item>
-    <item>Vatu</item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item>Yemeni Rial</item>
-    <item></item>
-    <item></item>
-    <item>Zambian Kwacha</item>
-    <item></item>
-    <item>Zloty</item>
-  </string-array>
   <string name="error_no_accounts">GnuCash\n</string>
   <string name="title_build_version"></string>
   <string name="title_license"></string>
diff --git a/app/src/main/res/values-zh-rTW/strings.xml b/app/src/main/res/values-zh-rTW/strings.xml
index becfd7de..fc5f6b5d 100644
--- a/app/src/main/res/values-zh-rTW/strings.xml
+++ b/app/src/main/res/values-zh-rTW/strings.xml
@@ -85,183 +85,6 @@
   <string name="label_display_account"></string>
   <string name="btn_create_accounts"></string>
   <string name="title_default_accounts"></string>
-  <string-array name="currency_names">
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item> </item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item>Kina </item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item>Lek </item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item>Mexican Unidad de Inversion (MXV)</item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item>Mvdol</item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item> </item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item>SDR()</item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item>Unidad de Valor Real</item>
-    <item>Unidades de fomento</item>
-    <item>Uruguay Peso en Unidades Indexadas (URUIURUI)</item>
-    <item>Uruguayan Peso</item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-    <item></item>
-  </string-array>
   <string name="error_no_accounts">GnuCash\n</string>
   <string name="title_build_version"></string>
   <string name="title_license"></string>
diff --git a/app/src/main/res/values/strings.xml b/app/src/main/res/values/strings.xml
index b0dd8388..3f0394ec 100644
--- a/app/src/main/res/values/strings.xml
+++ b/app/src/main/res/values/strings.xml
@@ -85,183 +85,6 @@
     <string name="label_display_account">Display account</string>
     <string name="btn_create_accounts">Create Accounts</string>
     <string name="title_default_accounts">Select accounts to create</string>
-    <string-array name="currency_names">
-        <item>Afghani</item>
-		<item>Algerian Dinar</item>
-		<item>Argentine Peso</item>
-		<item>Armenian Dram</item>
-		<item>Aruban Florin</item>
-		<item>Australian Dollar</item>
-		<item>Azerbaijanian Manat</item>
-		<item>Bahamian Dollar</item>
-		<item>Bahraini Dinar</item>
-		<item>Baht</item>
-		<item>Balboa</item>
-		<item>Barbados Dollar</item>
-		<item>Belarussian Ruble</item>
-		<item>Belize Dollar</item>
-		<item>Bermudian Dollar</item>
-		<item>Bolivar Fuerte</item>
-		<item>Boliviano</item>
-		<item>Brazilian Real</item>
-		<item>Brunei Dollar</item>
-		<item>Bulgarian Lev</item>
-		<item>Burundi Franc</item>
-		<item>Canadian Dollar</item>
-		<item>Cape Verde Escudo</item>
-		<item>Cayman Islands Dollar</item>
-		<item>CFA Franc BCEAO</item>
-		<item>CFA Franc BEAC</item>
-		<item>CFP Franc</item>
-		<item>Chilean Peso</item>
-		<item>Testing currency</item>
-		<item>Colombian Peso</item>
-		<item>Comoro Franc</item>
-		<item>Congolese Franc</item>
-		<item>Convertible Mark</item>
-		<item>Cordoba Oro</item>
-		<item>Costa Rican Colon</item>
-		<item>Croatian Kuna</item>
-        <item>Cuban Convertible Peso</item>
-		<item>Cuban Peso</item>
-		<item>Czech Koruna</item>
-		<item>Dalasi</item>
-		<item>Danish Krone</item>
-		<item>Denar</item>
-		<item>Djibouti Franc</item>
-		<item>Dobra</item>
-		<item>Dominican Peso</item>
-		<item>Dong</item>
-		<item>East Caribbean Dollar</item>
-		<item>Egyptian Pound</item>
-		<item>El Salvador Colon</item>
-		<item>Ethiopian Birr</item>
-		<item>Euro</item>
-		<item>Falkland Islands Pound</item>
-		<item>Fiji Dollar</item>
-		<item>Forint</item>
-		<item>Ghana Cedi</item>
-		<item>Gibraltar Pound</item>
-		<item>Gold</item>
-		<item>Gourde</item>
-		<item>Guarani</item>
-		<item>Guinea Franc</item>
-		<item>Guyana Dollar</item>
-		<item>Hong Kong Dollar</item>
-		<item>Hryvnia</item>
-		<item>Iceland Krona</item>
-		<item>Indian Rupee</item>
-		<item>Iranian Rial</item>
-		<item>Iraqi Dinar</item>
-		<item>Jamaican Dollar</item>
-		<item>Jordanian Dinar</item>
-		<item>Kenyan Shilling</item>
-		<item>Kina</item>
-		<item>Kip</item>
-		<item>Kuwaiti Dinar</item>
-		<item>Kwacha</item>
-		<item>Kwanza</item>
-		<item>Kyat</item>
-		<item>Lari</item>
-		<item>Latvian Lats</item>
-		<item>Lebanese Pound</item>
-		<item>Lek</item>
-		<item>Lempira</item>
-		<item>Leone</item>
-		<item>Liberian Dollar</item>
-		<item>Libyan Dinar</item>
-		<item>Lilangeni</item>
-		<item>Lithuanian Litas</item>
-		<item>Loti</item>
-		<item>Malagasy Ariary</item>
-		<item>Malaysian Ringgit</item>
-		<item>Mauritius Rupee</item>
-		<item>Mexican Peso</item>
-		<item>Mexican Unidad de Inversion (UDI)</item>
-		<item>Moldovan Leu</item>
-		<item>Moroccan Dirham</item>
-		<item>Mozambique Metical</item>
-		<item>Mvdol</item>
-		<item>Naira</item>
-		<item>Nakfa</item>
-		<item>Namibia Dollar</item>
-		<item>Nepalese Rupee</item>
-		<item>Netherlands Antillean Guilder</item>
-		<item>New Israeli Sheqel</item>
-		<item>New Romanian Leu</item>
-		<item>New Taiwan Dollar</item>
-		<item>New Zealand Dollar</item>
-		<item>Ngultrum</item>
-		<item>North Korean Won</item>
-		<item>Norwegian Krone</item>
-		<item>Nuevo Sol</item>
-		<item>Ouguiya</item>
-		<item>Paanga</item>
-		<item>Pakistan Rupee</item>
-		<item>Palladium</item>
-		<item>Pataca</item>
-		<item>Philippine Peso</item>
-		<item>Platinum</item>
-		<item>Pound Sterling</item>
-		<item>Pula</item>
-		<item>Qatari Rial</item>
-		<item>Quetzal</item>
-		<item>Rand</item>
-		<item>Rial Omani</item>
-		<item>Riel</item>
-		<item>Rufiyaa</item>
-		<item>Rupiah</item>
-		<item>Russian Ruble</item>
-		<item>Rwanda Franc</item>
-		<item>Saint Helena Pound</item>
-		<item>Saudi Riyal</item>
-		<item>SDR (Special Drawing Right)</item>
-		<item>Serbian Dinar</item>
-		<item>Seychelles Rupee</item>
-		<item>Silver</item>
-		<item>Singapore Dollar</item>
-		<item>Solomon Islands Dollar</item>
-		<item>Som</item>
-		<item>Somali Shilling</item>
-		<item>Somoni</item>
-		<item>South Sudanese Pound</item>
-		<item>Sri Lanka Rupee</item>
-		<item>Sucre</item>
-		<item>Sudanese Pound</item>
-		<item>Surinam Dollar</item>
-		<item>Swedish Krona</item>
-		<item>Swiss Franc</item>
-		<item>Syrian Pound</item>
-		<item>Taka</item>
-		<item>Tala</item>
-		<item>Tanzanian Shilling</item>
-		<item>Tenge</item>
-		<item>No currency</item>
-		<item>Trinidad and Tobago Dollar</item>
-		<item>Tugrik</item>
-		<item>Tunisian Dinar</item>
-		<item>Turkish Lira</item>
-		<item>Turkmenistan New Manat</item>
-		<item>UAE Dirham</item>
-		<item>Uganda Shilling</item>
-		<item>UIC-Franc</item>
-		<item>Unidad de Valor Real</item>
-		<item>Unidades de fomento</item>
-		<item>Uruguay Peso en Unidades Indexadas (URUIURUI)</item>
-        <item>Uruguayan peso</item>
-        <item>US Dollar</item>
-		<item>Uzbekistan Sum</item>
-		<item>Vatu</item>
-		<item>WIR Euro</item>
-		<item>WIR Franc</item>
-		<item>Won</item>
-		<item>Yemeni Rial</item>
-		<item>Yen</item>
-		<item>Yuan Renminbi</item>
-		<item>Zambian Kwacha</item>
-		<item>Zimbabwe Dollar</item>
-		<item>Zloty</item>
-    </string-array>
 	<string name="error_no_accounts">No accounts exist in GnuCash.\nCreate an account before adding a widget</string>
 	<string name="title_build_version">Build version</string>
 	<string name="title_license">License</string>
diff --git a/app/src/main/res/xml-v11/fragment_account_preferences.xml b/app/src/main/res/xml-v11/fragment_account_preferences.xml
index d2f360a9..8c3179e4 100644
--- a/app/src/main/res/xml-v11/fragment_account_preferences.xml
+++ b/app/src/main/res/xml-v11/fragment_account_preferences.xml
@@ -5,7 +5,7 @@
                     android:key="@string/key_default_currency"
                     android:dialogTitle="@string/title_choose_currency"
                     android:title="@string/title_default_currency"
-                    android:entries="@array/currency_names"
+                    android:entries="@array/key_currency_codes"
                     android:entryValues="@array/key_currency_codes"/>
     <Preference android:key="@string/key_create_default_accounts"
                 android:title="@string/title_create_default_accounts"
diff --git a/app/src/main/res/xml/fragment_account_preferences.xml b/app/src/main/res/xml/fragment_account_preferences.xml
index 33e57f67..aba9bff1 100644
--- a/app/src/main/res/xml/fragment_account_preferences.xml
+++ b/app/src/main/res/xml/fragment_account_preferences.xml
@@ -6,7 +6,7 @@
                     android:key="@string/key_default_currency"
                     android:dialogTitle="@string/title_choose_currency"
                     android:title="@string/title_default_currency"
-                    android:entries="@array/currency_names"
+                    android:entries="@array/key_currency_codes"
                     android:entryValues="@array/key_currency_codes"
                     android:defaultValue="USD"/>
     <Preference android:key="@string/key_import_accounts"

From 0a827131cd4e4af275cdbd0fd9c92a99eb905f16 Mon Sep 17 00:00:00 2001
From: Ngewi Fet <ngewif@gmail.com>
Date: Mon, 16 Nov 2015 14:38:27 +0100
Subject: [PATCH 21/25] Update version numbers for v2.0.2-beta1 release

Fix failing test
---
 CHANGELOG.md                                                  | 11 +++++++++++
 app/build.gradle                                              |  4 ++--
 .../java/org/gnucash/android/test/unit/model/MoneyTest.java   |  4 ++--
 3 files changed, 15 insertions(+), 4 deletions(-)

diff --git a/CHANGELOG.md b/CHANGELOG.md
index a5ff4a67..e14ad33d 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -1,5 +1,16 @@
 Change Log
 ===============================================================================
+Version 2.0.2 *(2015-11-20)*
+----------------------------
+* Fixed: Exporting to external service does not work in some devices
+* Fixed: Bar chart does not display negative amounts
+* Fixed: Crash when saving transaction with invalid amount expression
+* Fixed: Crashes when importing some GnuCash XML files with select currencies
+* Improved: Remember last export destination
+* Improved: Set default commodity to the one used by imported file
+* Improved: Add support for unlimited fractional digits in commodities
+* Improved: Option to select date from which to export transactions
+
 Version 2.0.1 *(2015-11-05)*
 ----------------------------
 * Feature: Menu options for moving/duplicating transactions
diff --git a/app/build.gradle b/app/build.gradle
index 402207ba..ca4ea180 100644
--- a/app/build.gradle
+++ b/app/build.gradle
@@ -5,8 +5,8 @@ apply plugin: 'io.fabric'
 
 def versionMajor = 2
 def versionMinor = 0
-def versionPatch = 1
-def versionBuild = 3
+def versionPatch = 2
+def versionBuild = 1
 
 def buildTime() {
     def df = new SimpleDateFormat("yyyyMMdd HH:mm 'UTC'")
diff --git a/app/src/test/java/org/gnucash/android/test/unit/model/MoneyTest.java b/app/src/test/java/org/gnucash/android/test/unit/model/MoneyTest.java
index 4f7bb97f..fd5eb6a8 100644
--- a/app/src/test/java/org/gnucash/android/test/unit/model/MoneyTest.java
+++ b/app/src/test/java/org/gnucash/android/test/unit/model/MoneyTest.java
@@ -160,9 +160,9 @@ public void testPrinting(){
 		String actualOuputDE = mMoneyInEur.formattedString(Locale.GERMANY);
 		assertThat(actualOuputDE).isEqualTo("15,75 " + symbol);
 
-		symbol = Currency.getInstance("EUR").getSymbol(Locale.US);
+		symbol = Currency.getInstance("EUR").getSymbol(Locale.GERMANY);
 		String actualOuputUS = mMoneyInEur.formattedString(Locale.US);
-		assertThat(actualOuputUS).isEqualTo("15.75 " + symbol);
+		assertThat(actualOuputUS).isEqualTo(symbol + "15.75");
 		
 		//always prints with 2 decimal places only
 		Money some = new Money("9.7469", CURRENCY_CODE);

From 7e36bd9d0e6918e4f8152d5cc66dd29ee2c646b4 Mon Sep 17 00:00:00 2001
From: Oleksandr Tyshkovets <olexandr.tyshkovets@gmail.com>
Date: Mon, 16 Nov 2015 22:43:21 +0200
Subject: [PATCH 22/25] Fix bar chart legend crash

---
 .../android/ui/report/BarChartFragment.java        | 23 +++++++++++++++++-----
 1 file changed, 18 insertions(+), 5 deletions(-)

diff --git a/app/src/main/java/org/gnucash/android/ui/report/BarChartFragment.java b/app/src/main/java/org/gnucash/android/ui/report/BarChartFragment.java
index e0fbe83e..0cd2f3dd 100644
--- a/app/src/main/java/org/gnucash/android/ui/report/BarChartFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/report/BarChartFragment.java
@@ -210,6 +210,22 @@ private BarData getData() {
                     double balance = mAccountsDbAdapter.getAccountsBalance(
                             Collections.singletonList(account.getUID()), start, end).asDouble();
                     if (balance != 0) {
+                        stack.add((float) balance);
+
+                        String accountName = account.getName();
+                        while (labels.contains(accountName)) {
+                            if (!accountToColorMap.containsKey(account.getUID())) {
+                                for (String label : labels) {
+                                    if (label.equals(accountName)) {
+                                        accountName += " ";
+                                    }
+                                }
+                            } else {
+                                break;
+                            }
+                        }
+                        labels.add(accountName);
+
                         if (!accountToColorMap.containsKey(account.getUID())) {
                             Integer color;
                             if (mUseAccountColor) {
@@ -221,10 +237,8 @@ private BarData getData() {
                             }
                             accountToColorMap.put(account.getUID(), color);
                         }
-
-                        stack.add((float) balance);
-                        labels.add(account.getName());
                         colors.add(accountToColorMap.get(account.getUID()));
+
                         Log.d(TAG, mAccountType + tmpDate.toString(" MMMM yyyy ") + account.getName() + " = " + stack.get(stack.size() - 1));
                     }
                 }
@@ -476,8 +490,7 @@ public void onValueSelected(Entry e, int dataSetIndex, Highlight h) {
         } else {
             sum = entry.getNegativeSum() + entry.getPositiveSum();
         }
-        Log.w(TAG, "sum2 = " + sum);
-        selectedValueTextView.setText(String.format(SELECTED_VALUE_PATTERN, label, value, value / sum * 100));
+        selectedValueTextView.setText(String.format(SELECTED_VALUE_PATTERN, label.trim(), value, value / sum * 100));
     }
 
     @Override

From 288717df1cde14853cb6e1591bdcbe3ca4dd6316 Mon Sep 17 00:00:00 2001
From: Ngewi Fet <ngewif@gmail.com>
Date: Thu, 19 Nov 2015 00:42:48 +0100
Subject: [PATCH 23/25] Open file for import in background thread

Should fix crashes during import when opening from a network location
Fix crash when opening scheduled actions due to change in export params format
Upgrade database to version 11
Code refactoring
---
 .../org/gnucash/android/db/DatabaseHelper.java     |  4 +-
 .../org/gnucash/android/db/DatabaseSchema.java     |  2 +-
 .../org/gnucash/android/db/MigrationHelper.java    | 58 +++++++++++++++++++++-
 .../org/gnucash/android/export/ExportParams.java   |  5 ++
 .../gnucash/android/importer/ImportAsyncTask.java  | 47 ++++++++++--------
 .../android/ui/account/AccountsActivity.java       | 27 +++-------
 .../android/ui/settings/SettingsActivity.java      | 11 +---
 .../res/layout/activity_transaction_detail.xml     | 16 +++---
 8 files changed, 105 insertions(+), 65 deletions(-)

diff --git a/app/src/main/java/org/gnucash/android/db/DatabaseHelper.java b/app/src/main/java/org/gnucash/android/db/DatabaseHelper.java
index 5af6e0e9..440e5c7e 100644
--- a/app/src/main/java/org/gnucash/android/db/DatabaseHelper.java
+++ b/app/src/main/java/org/gnucash/android/db/DatabaseHelper.java
@@ -212,8 +212,8 @@ public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion){
         /*
         * NOTE: In order to modify the database, create a new static method in the MigrationHelper class
         * called upgradeDbToVersion<#>, e.g. int upgradeDbToVersion10(SQLiteDatabase) in order to upgrade to version 10.
-        * The upgrade method should return the current database version as the return value.
-        * Then all you need to do is incremend the DatabaseSchema.DATABASE_VERSION to the appropriate number.
+        * The upgrade method should return the upgraded database version as the return value.
+        * Then all you need to do is increment the DatabaseSchema.DATABASE_VERSION to the appropriate number.
         */
 		if (oldVersion > newVersion) {
             throw new IllegalArgumentException("Database downgrades are not supported at the moment");
diff --git a/app/src/main/java/org/gnucash/android/db/DatabaseSchema.java b/app/src/main/java/org/gnucash/android/db/DatabaseSchema.java
index 463c9e06..15d7870c 100644
--- a/app/src/main/java/org/gnucash/android/db/DatabaseSchema.java
+++ b/app/src/main/java/org/gnucash/android/db/DatabaseSchema.java
@@ -28,7 +28,7 @@
      * Database version.
      * With any change to the database schema, this number must increase
      */
-    public static final int DATABASE_VERSION = 10;
+    public static final int DATABASE_VERSION = 11;
 
     /**
      * Database version where Splits were introduced
diff --git a/app/src/main/java/org/gnucash/android/db/MigrationHelper.java b/app/src/main/java/org/gnucash/android/db/MigrationHelper.java
index 9040e2d2..f8d91f08 100644
--- a/app/src/main/java/org/gnucash/android/db/MigrationHelper.java
+++ b/app/src/main/java/org/gnucash/android/db/MigrationHelper.java
@@ -56,7 +56,9 @@
 import java.nio.channels.FileChannel;
 import java.sql.Timestamp;
 import java.util.ArrayList;
+import java.util.HashMap;
 import java.util.List;
+import java.util.Map;
 
 import javax.xml.parsers.ParserConfigurationException;
 import javax.xml.parsers.SAXParser;
@@ -1068,7 +1070,7 @@ static int upgradeDbToVersion9(SQLiteDatabase db){
      * <p>This method converts all saved scheduled export parameters to the new format using the
      * timestamp of last export</p>
      * @param db SQLite database
-     * @return New version number
+     * @return 10 if upgrade was successful, 9 otherwise
      */
     static int upgradeDbToVersion10(SQLiteDatabase db){
         Log.i(DatabaseHelper.LOG_TAG, "Upgrading database to version 9");
@@ -1107,6 +1109,8 @@ static int upgradeDbToVersion10(SQLiteDatabase db){
                 db.insert(ScheduledActionEntry.TABLE_NAME, null, contentValues);
             }
 
+            cursor.close();
+
             db.setTransactionSuccessful();
             oldVersion = 10;
         } finally {
@@ -1114,4 +1118,56 @@ static int upgradeDbToVersion10(SQLiteDatabase db){
         }
         return oldVersion;
     }
+
+    /**
+     * Upgrade database to version 11
+     * <p>
+     *     Migrate scheduled backups and update export parameters to the new format
+     * </p>
+     * @param db SQLite database
+     * @return 11 if upgrade was successful, 10 otherwise
+     */
+    static int upgradeDbToVersion11(SQLiteDatabase db){
+        Log.i(DatabaseHelper.LOG_TAG, "Upgrading database to version 9");
+        int oldVersion = 10;
+
+        db.beginTransaction();
+        try {
+            Cursor cursor = db.query(ScheduledActionEntry.TABLE_NAME, null,
+                    ScheduledActionEntry.COLUMN_TYPE + "= ?",
+                    new String[]{ScheduledAction.ActionType.BACKUP.name()}, null, null, null);
+
+            Map<String, String> uidToTagMap = new HashMap<>();
+            while (cursor.moveToNext()) {
+                String uid = cursor.getString(cursor.getColumnIndexOrThrow(ScheduledActionEntry.COLUMN_UID));
+                String tag = cursor.getString(cursor.getColumnIndexOrThrow(ScheduledActionEntry.COLUMN_TAG));
+                String[] tokens = tag.split(";");
+                try {
+                    Timestamp timestamp = Timestamp.valueOf(tokens[2]);
+                } catch (IllegalArgumentException ex) {
+                    tokens[2] = PreferenceManager.getDefaultSharedPreferences(GnuCashApplication.getAppContext())
+                            .getString(Exporter.PREF_LAST_EXPORT_TIME, Exporter.TIMESTAMP_ZERO);
+                } finally {
+                    tag = TextUtils.join(";", tokens);
+                }
+                uidToTagMap.put(uid, tag);
+            }
+
+            cursor.close();
+
+            ContentValues contentValues = new ContentValues();
+            for (Map.Entry<String, String> entry : uidToTagMap.entrySet()) {
+                contentValues.clear();
+                contentValues.put(ScheduledActionEntry.COLUMN_TAG, entry.getValue());
+                db.update(ScheduledActionEntry.TABLE_NAME, contentValues,
+                        ScheduledActionEntry.COLUMN_UID + " = ?", new String[]{entry.getKey()});
+            }
+
+            db.setTransactionSuccessful();
+            oldVersion = 11;
+        } finally {
+            db.endTransaction();
+        }
+        return oldVersion;
+    }
 }
diff --git a/app/src/main/java/org/gnucash/android/export/ExportParams.java b/app/src/main/java/org/gnucash/android/export/ExportParams.java
index 04d860e0..97232940 100644
--- a/app/src/main/java/org/gnucash/android/export/ExportParams.java
+++ b/app/src/main/java/org/gnucash/android/export/ExportParams.java
@@ -16,6 +16,11 @@
 
 package org.gnucash.android.export;
 
+import android.preference.PreferenceManager;
+
+import org.gnucash.android.BuildConfig;
+import org.gnucash.android.R;
+import org.gnucash.android.app.GnuCashApplication;
 import org.gnucash.android.ui.export.ExportFormFragment;
 
 import java.sql.Timestamp;
diff --git a/app/src/main/java/org/gnucash/android/importer/ImportAsyncTask.java b/app/src/main/java/org/gnucash/android/importer/ImportAsyncTask.java
index a0232003..8619362d 100644
--- a/app/src/main/java/org/gnucash/android/importer/ImportAsyncTask.java
+++ b/app/src/main/java/org/gnucash/android/importer/ImportAsyncTask.java
@@ -18,6 +18,7 @@
 import android.annotation.TargetApi;
 import android.app.Activity;
 import android.app.ProgressDialog;
+import android.net.Uri;
 import android.os.AsyncTask;
 import android.os.Build;
 import android.util.Log;
@@ -35,17 +36,17 @@
  * Imports a GnuCash (desktop) account file and displays a progress dialog.
  * The AccountsActivity is opened when importing is done.
  */
-public class ImportAsyncTask extends AsyncTask<InputStream, Void, Boolean> {
-    private final Activity context;
+public class ImportAsyncTask extends AsyncTask<Uri, Void, Boolean> {
+    private final Activity mContext;
     private TaskDelegate mDelegate;
-    private ProgressDialog progressDialog;
+    private ProgressDialog mProgressDialog;
 
     public ImportAsyncTask(Activity context){
-        this.context = context;
+        this.mContext = context;
     }
 
     public ImportAsyncTask(Activity context, TaskDelegate delegate){
-        this.context = context;
+        this.mContext = context;
         this.mDelegate = delegate;
     }
 
@@ -53,34 +54,36 @@ public ImportAsyncTask(Activity context, TaskDelegate delegate){
     @Override
     protected void onPreExecute() {
         super.onPreExecute();
-        progressDialog = new ProgressDialog(context);
-        progressDialog.setTitle(R.string.title_progress_importing_accounts);
-        progressDialog.setIndeterminate(true);
-        progressDialog.setProgressStyle(ProgressDialog.STYLE_HORIZONTAL);
-        progressDialog.show();
+        mProgressDialog = new ProgressDialog(mContext);
+        mProgressDialog.setTitle(R.string.title_progress_importing_accounts);
+        mProgressDialog.setIndeterminate(true);
+        mProgressDialog.setProgressStyle(ProgressDialog.STYLE_HORIZONTAL);
+        mProgressDialog.show();
         if (Build.VERSION.SDK_INT > Build.VERSION_CODES.HONEYCOMB){
             //these methods must be called after progressDialog.show()
-            progressDialog.setProgressNumberFormat(null);
-            progressDialog.setProgressPercentFormat(null);
+            mProgressDialog.setProgressNumberFormat(null);
+            mProgressDialog.setProgressPercentFormat(null);
         }
 
     }
 
     @Override
-    protected Boolean doInBackground(InputStream... inputStreams) {
+    protected Boolean doInBackground(Uri... uris) {
         try {
-            GncXmlImporter.parse(inputStreams[0]);
+            InputStream accountInputStream = mContext.getContentResolver().openInputStream(uris[0]);
+            GncXmlImporter.parse(accountInputStream);
         } catch (Exception exception){
             Log.e(ImportAsyncTask.class.getName(), "" + exception.getMessage());
             Crashlytics.logException(exception);
             exception.printStackTrace();
 
             final String err_msg = exception.getLocalizedMessage();
-            context.runOnUiThread(new Runnable() {
+            Crashlytics.log(err_msg);
+            mContext.runOnUiThread(new Runnable() {
                 @Override
                 public void run() {
-                    Toast.makeText(context,
-                            context.getString(R.string.toast_error_importing_accounts) + "\n" + err_msg,
+                    Toast.makeText(mContext,
+                            mContext.getString(R.string.toast_error_importing_accounts) + "\n" + err_msg,
                             Toast.LENGTH_LONG).show();
                 }
             });
@@ -96,18 +99,18 @@ protected void onPostExecute(Boolean importSuccess) {
             mDelegate.onTaskComplete();
 
         try {
-            if (progressDialog != null && progressDialog.isShowing())
-                progressDialog.dismiss();
+            if (mProgressDialog != null && mProgressDialog.isShowing())
+                mProgressDialog.dismiss();
         } catch (IllegalArgumentException ex){
             //TODO: This is a hack to catch "View not attached to window" exceptions
             //FIXME by moving the creation and display of the progress dialog to the Fragment
         } finally {
-            progressDialog = null;
+            mProgressDialog = null;
         }
 
         int message = importSuccess ? R.string.toast_success_importing_accounts : R.string.toast_error_importing_accounts;
-        Toast.makeText(context, message, Toast.LENGTH_SHORT).show();
+        Toast.makeText(mContext, message, Toast.LENGTH_SHORT).show();
 
-        AccountsActivity.start(context);
+        AccountsActivity.start(mContext);
     }
 }
diff --git a/app/src/main/java/org/gnucash/android/ui/account/AccountsActivity.java b/app/src/main/java/org/gnucash/android/ui/account/AccountsActivity.java
index 9bca152c..494d817b 100644
--- a/app/src/main/java/org/gnucash/android/ui/account/AccountsActivity.java
+++ b/app/src/main/java/org/gnucash/android/ui/account/AccountsActivity.java
@@ -295,18 +295,9 @@ private void handleOpenFileIntent(Intent intent) {
         Uri data = intent.getData();
         if (data != null){
             GncXmlExporter.createBackup();
-
             intent.setData(null);
-            InputStream accountInputStream = null;
-            try {
-                accountInputStream = getContentResolver().openInputStream(data);
-                new ImportAsyncTask(this).execute(accountInputStream);
-            } catch (FileNotFoundException e) {
-                Crashlytics.logException(e);
-                Log.e(LOG_TAG, "Error opening file for import - " + e.getMessage());
-            } finally {
-                removeFirstRunFlag();
-            }
+            new ImportAsyncTask(this).execute(data);
+            removeFirstRunFlag();
         }
     }
 
@@ -496,8 +487,8 @@ public void onTaskComplete() {
             };
         }
 
-        InputStream accountFileInputStream = activity.getResources().openRawResource(R.raw.default_accounts);
-        new ImportAsyncTask(activity, delegate).execute(accountFileInputStream);
+        Uri uri = Uri.parse("android.resource://" + BuildConfig.APPLICATION_ID + "/" + R.raw.default_accounts);
+        new ImportAsyncTask(activity, delegate).execute(uri);
     }
 
     /**
@@ -536,14 +527,8 @@ public static void startXmlFileChooser(Activity activity) {
      * @param data Intent data containing the XML uri
      */
     public static void importXmlFileFromIntent(Activity context, Intent data) {
-        try {
-            GncXmlExporter.createBackup();
-            InputStream accountInputStream = context.getContentResolver().openInputStream(data.getData());
-            new ImportAsyncTask(context).execute(accountInputStream);
-        } catch (FileNotFoundException e) {
-            Crashlytics.logException(e);
-            Toast.makeText(context, R.string.toast_error_importing_accounts, Toast.LENGTH_SHORT).show();
-        }
+        GncXmlExporter.createBackup();
+        new ImportAsyncTask(context).execute(data.getData());
     }
 
     /**
diff --git a/app/src/main/java/org/gnucash/android/ui/settings/SettingsActivity.java b/app/src/main/java/org/gnucash/android/ui/settings/SettingsActivity.java
index 21dc8fcc..250a799c 100644
--- a/app/src/main/java/org/gnucash/android/ui/settings/SettingsActivity.java
+++ b/app/src/main/java/org/gnucash/android/ui/settings/SettingsActivity.java
@@ -27,6 +27,7 @@
 import android.content.IntentSender;
 import android.content.SharedPreferences;
 import android.database.Cursor;
+import android.net.Uri;
 import android.os.Build;
 import android.os.Bundle;
 import android.preference.CheckBoxPreference;
@@ -565,15 +566,7 @@ public void onClick(DialogInterface dialog, int which) {
             @Override
             public void onClick(DialogInterface dialog, int which) {
                 File backupFile = sortedBackupFiles[which];
-
-                try {
-                    FileInputStream inputStream = new FileInputStream(backupFile);
-                    new ImportAsyncTask(SettingsActivity.this).execute(inputStream);
-                } catch (FileNotFoundException e) {
-                    Crashlytics.logException(e);
-                    Log.e(LOG_TAG, "Error restoring backup: " + backupFile.getName());
-                    Toast.makeText(SettingsActivity.this, R.string.toast_error_importing_accounts, Toast.LENGTH_LONG).show();
-                }
+                new ImportAsyncTask(SettingsActivity.this).execute(Uri.fromFile(backupFile));
             }
         });
 
diff --git a/app/src/main/res/layout/activity_transaction_detail.xml b/app/src/main/res/layout/activity_transaction_detail.xml
index 695f3bb5..f04f239a 100644
--- a/app/src/main/res/layout/activity_transaction_detail.xml
+++ b/app/src/main/res/layout/activity_transaction_detail.xml
@@ -133,27 +133,25 @@
                     style="@style/TransactionInfo" />
             </TableRow>
 
-            <TableRow android:id="@+id/row_trn_recurrence"
+            <TableRow android:id="@+id/row_trn_notes"
                 style="@style/FormRow">
-
                 <ImageView style="@style/FormIcon"
-                    android:src="@drawable/ic_action_rotate_right"/>
+                    android:src="@drawable/ic_action_sort_by_size"/>
 
-                <TextView android:id="@+id/trn_recurrence"
+                <TextView android:id="@+id/trn_notes"
                     style="@style/TransactionInfo" />
-
             </TableRow>
 
-            <TableRow android:id="@+id/row_trn_notes"
+            <TableRow android:id="@+id/row_trn_recurrence"
                 style="@style/FormRow">
+
                 <ImageView style="@style/FormIcon"
-                    android:src="@drawable/ic_action_sort_by_size"/>
+                    android:src="@drawable/ic_action_rotate_right"/>
 
-                <TextView android:id="@+id/trn_notes"
+                <TextView android:id="@+id/trn_recurrence"
                     style="@style/TransactionInfo" />
             </TableRow>
 
-
         </TableLayout>
     </LinearLayout>
 </android.support.design.widget.CoordinatorLayout>
\ No newline at end of file

From eadd79e51b48ecc36cbf7ec1263038d6be2d1d15 Mon Sep 17 00:00:00 2001
From: Ngewi Fet <ngewif@gmail.com>
Date: Thu, 19 Nov 2015 20:02:31 +0100
Subject: [PATCH 24/25] Show current imbalance in split editor

Open keyboard immediately when starting a new transaction
---
 .../ui/transaction/SplitEditorFragment.java        | 75 ++++++++++++++++++----
 .../ui/transaction/TransactionFormFragment.java    |  3 +
 .../android/ui/util/widget/CalculatorEditText.java |  2 -
 app/src/main/res/layout/fragment_split_editor.xml  | 28 ++++++++
 .../main/res/layout/fragment_transaction_form.xml  |  4 +-
 5 files changed, 98 insertions(+), 14 deletions(-)

diff --git a/app/src/main/java/org/gnucash/android/ui/transaction/SplitEditorFragment.java b/app/src/main/java/org/gnucash/android/ui/transaction/SplitEditorFragment.java
index a3a141a3..0b641606 100644
--- a/app/src/main/java/org/gnucash/android/ui/transaction/SplitEditorFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/transaction/SplitEditorFragment.java
@@ -25,6 +25,8 @@
 import android.support.v4.widget.SimpleCursorAdapter;
 import android.support.v7.app.ActionBar;
 import android.support.v7.app.AppCompatActivity;
+import android.text.Editable;
+import android.text.TextWatcher;
 import android.view.LayoutInflater;
 import android.view.Menu;
 import android.view.MenuInflater;
@@ -32,6 +34,7 @@
 import android.view.View;
 import android.view.ViewGroup;
 import android.widget.AdapterView;
+import android.widget.CompoundButton;
 import android.widget.EditText;
 import android.widget.ImageView;
 import android.widget.LinearLayout;
@@ -41,6 +44,7 @@
 
 import org.gnucash.android.R;
 import org.gnucash.android.db.AccountsDbAdapter;
+import org.gnucash.android.db.CommoditiesDbAdapter;
 import org.gnucash.android.db.DatabaseSchema;
 import org.gnucash.android.model.AccountType;
 import org.gnucash.android.model.BaseModel;
@@ -60,7 +64,6 @@
 
 import java.math.BigDecimal;
 import java.util.ArrayList;
-import java.util.Currency;
 import java.util.List;
 
 import butterknife.Bind;
@@ -75,12 +78,14 @@
 
     @Bind(R.id.split_list_layout)   LinearLayout mSplitsLinearLayout;
     @Bind(R.id.calculator_keyboard) KeyboardView mKeyboardView;
+    @Bind(R.id.imbalance_textview)  TextView mImbalanceTextView;
 
     private AccountsDbAdapter mAccountsDbAdapter;
     private Cursor mCursor;
     private SimpleCursorAdapter mCursorAdapter;
     private List<View> mSplitItemViewList;
     private String mAccountUID;
+    private Commodity mCommodity;
 
     private BigDecimal mBaseAmount = BigDecimal.ZERO;
 
@@ -88,6 +93,8 @@
 
     CalculatorKeyboard mCalculatorKeyboard;
 
+    BalanceTextWatcher mImbalanceWatcher = new BalanceTextWatcher();
+
     /**
      * Create and return a new instance of the fragment with the appropriate paramenters
      * @param args Arguments to be set to the fragment. <br>
@@ -143,6 +150,8 @@ public void onActivityCreated(Bundle savedInstanceState) {
             view.findViewById(R.id.input_accounts_spinner).setEnabled(false);
             view.findViewById(R.id.btn_remove_split).setVisibility(View.GONE);
         }
+
+        TransactionsActivity.displayBalance(mImbalanceTextView, new Money(mBaseAmount.negate(), mCommodity));
     }
 
     @Override
@@ -214,6 +223,7 @@ private void initArgs() {
                 + DatabaseSchema.AccountEntry.COLUMN_PLACEHOLDER + " = 0"
                 + ")";
         mCursor = mAccountsDbAdapter.fetchAccountsOrderedByFullName(conditions, null);
+        mCommodity = CommoditiesDbAdapter.getInstance().getCommodity(mAccountsDbAdapter.getCurrencyCode(mAccountUID));
     }
 
     /**
@@ -226,7 +236,7 @@ private void initArgs() {
         @Bind(R.id.input_accounts_spinner)  Spinner accountsSpinner;
         @Bind(R.id.split_currency_symbol)   TextView splitCurrencyTextView;
         @Bind(R.id.split_uid)               TextView splitUidTextView;
-        @Bind(R.id.btn_split_type)          TransactionTypeSwitch splitTypeButton;
+        @Bind(R.id.btn_split_type)          TransactionTypeSwitch splitTypeSwitch;
 
         View splitView;
         Money quantity;
@@ -253,15 +263,15 @@ public void onClick(View view) {
                     mRemovedSplitUIDs.add(splitUidTextView.getText().toString());
                     mSplitsLinearLayout.removeView(splitView);
                     mSplitItemViewList.remove(splitView);
+                    mImbalanceWatcher.afterTextChanged(null);
                 }
             });
 
             updateTransferAccountsList(accountsSpinner);
 
-            Currency accountCurrency = Currency.getInstance(mAccountsDbAdapter.getCurrencyCode(mAccountUID));
-            splitCurrencyTextView.setText(accountCurrency.getSymbol());
-            splitTypeButton.setAmountFormattingListener(splitAmountEditText, splitCurrencyTextView);
-            splitTypeButton.setChecked(mBaseAmount.signum() > 0);
+            splitCurrencyTextView.setText(mCommodity.getSymbol());
+            splitTypeSwitch.setAmountFormattingListener(splitAmountEditText, splitCurrencyTextView);
+            splitTypeSwitch.setChecked(mBaseAmount.signum() > 0);
             splitUidTextView.setText(BaseModel.generateUID());
 
             if (split != null) {
@@ -272,12 +282,18 @@ public void onClick(View view) {
                 splitUidTextView.setText(split.getUID());
                 String splitAccountUID = split.getAccountUID();
                 setSelectedTransferAccount(mAccountsDbAdapter.getID(splitAccountUID), accountsSpinner);
-                splitTypeButton.setAccountType(mAccountsDbAdapter.getAccountType(splitAccountUID));
-                splitTypeButton.setChecked(split.getType());
+                splitTypeSwitch.setAccountType(mAccountsDbAdapter.getAccountType(splitAccountUID));
+                splitTypeSwitch.setChecked(split.getType());
             }
 
-            accountsSpinner.setOnItemSelectedListener(new SplitAccountListener(splitTypeButton, this));
-
+            accountsSpinner.setOnItemSelectedListener(new SplitAccountListener(splitTypeSwitch, this));
+            splitTypeSwitch.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener() {
+                @Override
+                public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {
+                    mImbalanceWatcher.afterTextChanged(null);
+                }
+            });
+            splitAmountEditText.addTextChangedListener(mImbalanceWatcher);
         }
     }
 
@@ -360,7 +376,7 @@ private void saveSplits() {
             String accountUID = mAccountsDbAdapter.getUID(viewHolder.accountsSpinner.getSelectedItemId());
             Split split = new Split(valueAmount, accountUID);
             split.setMemo(viewHolder.splitMemoEditText.getText().toString());
-            split.setType(viewHolder.splitTypeButton.getTransactionType());
+            split.setType(viewHolder.splitTypeSwitch.getTransactionType());
             split.setUID(viewHolder.splitUidTextView.getText().toString().trim());
             if (viewHolder.quantity != null)
                 split.setQuantity(viewHolder.quantity.absolute());
@@ -370,6 +386,43 @@ private void saveSplits() {
     }
 
     /**
+     * Updates the displayed balance of the accounts when the amount of a split is changed
+     */
+    private class BalanceTextWatcher implements TextWatcher {
+
+        @Override
+        public void beforeTextChanged(CharSequence charSequence, int i, int i2, int i3) {
+            //nothing to see here, move along
+        }
+
+        @Override
+        public void onTextChanged(CharSequence charSequence, int i, int i2, int i3) {
+            //nothing to see here, move along
+        }
+
+        @Override
+        public void afterTextChanged(Editable editable) {
+            BigDecimal imbalance = BigDecimal.ZERO;
+
+            for (View splitItem : mSplitItemViewList) {
+                SplitViewHolder viewHolder = (SplitViewHolder) splitItem.getTag();
+                viewHolder.splitAmountEditText.removeTextChangedListener(this);
+                BigDecimal amount = viewHolder.splitAmountEditText.getValue();
+                if (amount != null) {
+                    if (viewHolder.splitTypeSwitch.isChecked()) {
+                        imbalance = imbalance.subtract(amount);
+                    } else {
+                        imbalance = imbalance.add(amount);
+                    }
+                }
+                viewHolder.splitAmountEditText.addTextChangedListener(this);
+            }
+
+            TransactionsActivity.displayBalance(mImbalanceTextView, new Money(imbalance.negate(), mCommodity));
+        }
+    }
+
+    /**
      * Listens to changes in the transfer account and updates the currency symbol, the label of the
      * transaction type and if neccessary
      */
diff --git a/app/src/main/java/org/gnucash/android/ui/transaction/TransactionFormFragment.java b/app/src/main/java/org/gnucash/android/ui/transaction/TransactionFormFragment.java
index ed4c48f1..6cd8d00b 100644
--- a/app/src/main/java/org/gnucash/android/ui/transaction/TransactionFormFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/transaction/TransactionFormFragment.java
@@ -39,6 +39,7 @@
 import android.view.MenuItem;
 import android.view.View;
 import android.view.ViewGroup;
+import android.view.WindowManager;
 import android.view.inputmethod.InputMethodManager;
 import android.widget.AdapterView;
 import android.widget.AutoCompleteTextView;
@@ -355,6 +356,8 @@ public void onNothingSelected(AdapterView<?> adapterView) {
 			initializeViewsWithTransaction();
             mEditMode = true;
 		}
+
+        getActivity().getWindow().setSoftInputMode(WindowManager.LayoutParams.SOFT_INPUT_STATE_VISIBLE);
 	}
 
     /**
diff --git a/app/src/main/java/org/gnucash/android/ui/util/widget/CalculatorEditText.java b/app/src/main/java/org/gnucash/android/ui/util/widget/CalculatorEditText.java
index 2b6bb455..cad60a0b 100644
--- a/app/src/main/java/org/gnucash/android/ui/util/widget/CalculatorEditText.java
+++ b/app/src/main/java/org/gnucash/android/ui/util/widget/CalculatorEditText.java
@@ -37,14 +37,12 @@
 
 import org.gnucash.android.R;
 import org.gnucash.android.app.GnuCashApplication;
-import org.gnucash.android.db.CommoditiesDbAdapter;
 import org.gnucash.android.model.Commodity;
 import org.gnucash.android.ui.common.FormActivity;
 
 import java.math.BigDecimal;
 import java.text.DecimalFormat;
 import java.text.NumberFormat;
-import java.util.Currency;
 import java.util.Locale;
 
 /**
diff --git a/app/src/main/res/layout/fragment_split_editor.xml b/app/src/main/res/layout/fragment_split_editor.xml
index 884d8aeb..ebc5337a 100644
--- a/app/src/main/res/layout/fragment_split_editor.xml
+++ b/app/src/main/res/layout/fragment_split_editor.xml
@@ -21,9 +21,37 @@ limitations under the License.
     android:layout_height="match_parent"
     tools:context=".ui.FormActivity">
 
+    <LinearLayout android:id="@+id/imbalance_layout"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"
+        android:layout_alignParentTop="true"
+        android:padding="@dimen/dialog_padding">
+        <TextView
+            android:layout_width="wrap_content"
+            android:layout_height="match_parent"
+            android:textAppearance="?android:attr/textAppearanceSmall"
+            android:gravity="center_vertical"
+            android:text="@string/label_imbalance"/>
+
+        <TextView android:id="@+id/imbalance_textview"
+            android:layout_width="0dp"
+            android:layout_height="match_parent"
+            android:layout_weight="1"
+            android:textAppearance="?android:attr/textAppearanceSmall"
+            android:gravity="right|center_vertical"
+            tools:text="$200"/>
+    </LinearLayout>
+
+    <include
+        android:layout_width="match_parent"
+        android:layout_height="1dp"
+        android:layout_below="@id/imbalance_layout"
+        layout="@layout/horizontal_line" />
+
     <ScrollView
         android:layout_width="match_parent"
         android:layout_height="match_parent"
+        android:layout_below="@id/imbalance_layout"
         android:layout_above="@+id/calculator_keyboard"
         android:padding="@dimen/dialog_padding">
         <LinearLayout android:id="@+id/split_list_layout"
diff --git a/app/src/main/res/layout/fragment_transaction_form.xml b/app/src/main/res/layout/fragment_transaction_form.xml
index ec8f9004..30052c9c 100644
--- a/app/src/main/res/layout/fragment_transaction_form.xml
+++ b/app/src/main/res/layout/fragment_transaction_form.xml
@@ -44,7 +44,9 @@
                     android:singleLine="true"
                     android:nextFocusDown="@+id/input_transaction_amount"
                     android:background="@android:color/transparent"
-                    android:textSize="22sp" />
+                    android:textSize="22sp">
+                    <requestFocus/>
+                    </AutoCompleteTextView>
             </TableRow>
 
             <View style="@style/Divider" android:layout_marginLeft="0dp" />

From 7dcb2544b813c67d94dcb4024147d45a3e9ee61d Mon Sep 17 00:00:00 2001
From: Ngewi Fet <ngewif@gmail.com>
Date: Thu, 19 Nov 2015 20:10:19 +0100
Subject: [PATCH 25/25] Update version number for v2.0.2 release

---
 CHANGELOG.md     | 4 +++-
 app/build.gradle | 2 +-
 2 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/CHANGELOG.md b/CHANGELOG.md
index e14ad33d..4c6ad17d 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -5,8 +5,10 @@ Version 2.0.2 *(2015-11-20)*
 * Fixed: Exporting to external service does not work in some devices
 * Fixed: Bar chart does not display negative amounts
 * Fixed: Crash when saving transaction with invalid amount expression
-* Fixed: Crashes when importing some GnuCash XML files with select currencies
+* Fixed: Crash when displaying bar chart legend with accounts of same name
+* Fixed: Crashes when importing some GnuCash XML files on some devices
 * Improved: Remember last export destination
+* Improved: Display current imbalance in split editor
 * Improved: Set default commodity to the one used by imported file
 * Improved: Add support for unlimited fractional digits in commodities
 * Improved: Option to select date from which to export transactions
diff --git a/app/build.gradle b/app/build.gradle
index ca4ea180..3e0644c2 100644
--- a/app/build.gradle
+++ b/app/build.gradle
@@ -6,7 +6,7 @@ apply plugin: 'io.fabric'
 def versionMajor = 2
 def versionMinor = 0
 def versionPatch = 2
-def versionBuild = 1
+def versionBuild = 2
 
 def buildTime() {
     def df = new SimpleDateFormat("yyyyMMdd HH:mm 'UTC'")
