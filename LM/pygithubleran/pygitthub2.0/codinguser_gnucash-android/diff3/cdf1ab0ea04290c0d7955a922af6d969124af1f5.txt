From cdf1ab0ea04290c0d7955a922af6d969124af1f5 Mon Sep 17 00:00:00 2001
From: Ngewi Fet <ngewif@gmail.com>
Date: Fri, 18 Sep 2015 18:37:23 +0200
Subject: [PATCH] Add constraint to database requiring commodity GUID for both
 accounts and transactions

Deprecate AmountInputFormatter in favour of CalculatorEditText
Extracting some string resources
Code refactoring
---
 .../android/test/ui/TransactionsActivityTest.java  |  3 +-
 app/src/main/AndroidManifest.xml                   |  4 +--
 .../org/gnucash/android/db/DatabaseAdapter.java    |  1 -
 .../org/gnucash/android/db/DatabaseHelper.java     | 34 +++++-----------------
 .../org/gnucash/android/db/MigrationHelper.java    | 28 ++----------------
 .../gnucash/android/db/TransactionsDbAdapter.java  |  1 -
 .../receivers/TransactionAppWidgetProvider.java    |  4 +--
 .../android/receivers/TransactionRecorder.java     |  2 +-
 .../android/ui/account/AccountFormFragment.java    |  2 +-
 .../android/ui/account/AccountsActivity.java       |  9 ++----
 .../android/ui/account/AccountsListFragment.java   |  6 ++--
 .../ui/account/DeleteAccountDialogFragment.java    |  2 +-
 .../ui/{ => common}/BaseDrawerActivity.java        |  2 +-
 .../android/ui/{ => common}/FormActivity.java      |  4 +--
 .../android/ui/{ => common}/UxArgument.java        |  2 +-
 .../WidgetConfigurationActivity.java               |  6 ++--
 .../android/ui/passcode/PassLockActivity.java      |  4 +--
 .../ui/passcode/PasscodeLockScreenActivity.java    |  2 +-
 .../ui/passcode/PasscodePreferenceActivity.java    |  2 +-
 .../android/ui/report/BalanceSheetFragment.java    |  2 --
 .../DeleteAllAccountsConfirmationDialog.java       |  2 +-
 .../DeleteAllTransactionsConfirmationDialog.java   |  2 +-
 .../ui/settings/GeneralPreferenceFragment.java     |  3 +-
 .../android/ui/settings/SettingsActivity.java      |  3 +-
 .../transaction/ScheduledActionsListFragment.java  |  4 +--
 .../ui/transaction/SplitEditorFragment.java        | 13 ++++-----
 .../ui/transaction/TransactionDetailActivity.java  |  4 +--
 .../ui/transaction/TransactionFormFragment.java    | 21 ++++++-------
 .../ui/transaction/TransactionsActivity.java       |  4 +--
 .../ui/transaction/TransactionsListFragment.java   |  8 ++---
 .../transaction/dialog/BulkMoveDialogFragment.java |  4 +--
 ...ansactionsDeleteConfirmationDialogFragment.java |  4 +--
 .../dialog/TransferFundsDialogFragment.java        |  8 ++---
 .../android/ui/util/AmountInputFormatter.java      |  2 ++
 .../ui/util/{ => widget}/CalculatorEditText.java   |  6 ++--
 .../ui/util/{ => widget}/CalculatorKeyboard.java   | 27 ++---------------
 .../util/{ => widget}/CheckableLinearLayout.java   |  2 +-
 .../ui/util/{ => widget}/EmptyRecyclerView.java    |  2 +-
 .../ui/util/{ => widget}/ReselectSpinner.java      |  2 +-
 .../util/{ => widget}/TransactionTypeSwitch.java   |  3 +-
 app/src/main/res/layout/activity_reports.xml       |  3 +-
 app/src/main/res/layout/fragment_accounts_list.xml |  2 +-
 .../main/res/layout/fragment_transaction_form.xml  |  4 +--
 .../main/res/layout/fragment_transactions_list.xml |  2 +-
 app/src/main/res/layout/item_split_entry.xml       |  4 +--
 .../main/res/layout/list_item_scheduled_trxn.xml   |  4 +--
 app/src/main/res/values-de/strings.xml             |  4 +++
 app/src/main/res/values-el/strings.xml             |  4 +++
 app/src/main/res/values-es-rMX/strings.xml         |  4 +++
 app/src/main/res/values-es/strings.xml             |  4 +++
 app/src/main/res/values-fr/strings.xml             |  4 +++
 app/src/main/res/values-hu/strings.xml             |  4 +++
 app/src/main/res/values-it/strings.xml             |  4 +++
 app/src/main/res/values-nb/strings.xml             |  4 +++
 app/src/main/res/values-nl/strings.xml             |  4 +++
 app/src/main/res/values-pl/strings.xml             |  4 +++
 app/src/main/res/values-pt-rBR/strings.xml         |  4 +++
 app/src/main/res/values-ru/strings.xml             |  4 +++
 app/src/main/res/values-uk/strings.xml             |  4 +++
 app/src/main/res/values-zh-rTW/strings.xml         |  4 +++
 app/src/main/res/values-zh/strings.xml             |  4 +++
 app/src/main/res/values/strings.xml                |  4 +++
 app/src/main/res/xml-land/calculator_keyboard.xml  | 17 ++++++++++-
 app/src/main/res/xml/calculator_keyboard.xml       | 17 ++++++++++-
 .../main/res/xml/transaction_appwidget_info.xml    |  2 +-
 65 files changed, 188 insertions(+), 175 deletions(-)
 rename app/src/main/java/org/gnucash/android/ui/{ => common}/BaseDrawerActivity.java (99%)
 rename app/src/main/java/org/gnucash/android/ui/{ => common}/FormActivity.java (98%)
 rename app/src/main/java/org/gnucash/android/ui/{ => common}/UxArgument.java (98%)
 rename app/src/main/java/org/gnucash/android/ui/{widget => homescreen}/WidgetConfigurationActivity.java (98%)
 rename app/src/main/java/org/gnucash/android/ui/util/{ => widget}/CalculatorEditText.java (98%)
 rename app/src/main/java/org/gnucash/android/ui/util/{ => widget}/CalculatorKeyboard.java (90%)
 rename app/src/main/java/org/gnucash/android/ui/util/{ => widget}/CheckableLinearLayout.java (98%)
 rename app/src/main/java/org/gnucash/android/ui/util/{ => widget}/EmptyRecyclerView.java (98%)
 rename app/src/main/java/org/gnucash/android/ui/util/{ => widget}/ReselectSpinner.java (96%)
 rename app/src/main/java/org/gnucash/android/ui/util/{ => widget}/TransactionTypeSwitch.java (98%)

diff --git a/app/src/androidTest/java/org/gnucash/android/test/ui/TransactionsActivityTest.java b/app/src/androidTest/java/org/gnucash/android/test/ui/TransactionsActivityTest.java
index c1af3db6..ff42c539 100644
--- a/app/src/androidTest/java/org/gnucash/android/test/ui/TransactionsActivityTest.java
+++ b/app/src/androidTest/java/org/gnucash/android/test/ui/TransactionsActivityTest.java
@@ -48,7 +48,7 @@
 import org.gnucash.android.model.Transaction;
 import org.gnucash.android.model.TransactionType;
 import org.gnucash.android.receivers.TransactionRecorder;
-import org.gnucash.android.ui.UxArgument;
+import org.gnucash.android.ui.common.UxArgument;
 import org.gnucash.android.ui.transaction.TransactionFormFragment;
 import org.gnucash.android.ui.transaction.TransactionsActivity;
 import org.junit.After;
@@ -66,7 +66,6 @@
 import static android.support.test.espresso.Espresso.onView;
 import static android.support.test.espresso.action.ViewActions.clearText;
 import static android.support.test.espresso.action.ViewActions.click;
-import static android.support.test.espresso.action.ViewActions.longClick;
 import static android.support.test.espresso.action.ViewActions.typeText;
 import static android.support.test.espresso.assertion.ViewAssertions.matches;
 import static android.support.test.espresso.matcher.RootMatchers.withDecorView;
diff --git a/app/src/main/AndroidManifest.xml b/app/src/main/AndroidManifest.xml
index b5a83389..13ac803c 100644
--- a/app/src/main/AndroidManifest.xml
+++ b/app/src/main/AndroidManifest.xml
@@ -88,7 +88,7 @@
         <activity android:name=".ui.passcode.PasscodePreferenceActivity"
             android:theme="@style/Theme.GnucashTheme" />
         <activity android:name=".ui.transaction.TransactionsActivity" />
-        <activity android:name=".ui.widget.WidgetConfigurationActivity"
+        <activity android:name=".ui.homescreen.WidgetConfigurationActivity"
             android:label="@string/label_widget_configuration"
             android:theme="@style/Dialog.WidgetConfiguration"
             android:excludeFromRecents="true">
@@ -96,7 +96,7 @@
 		        <action android:name="android.appwidget.action.APPWIDGET_CONFIGURE"/>
 		    </intent-filter>
 		</activity>
-        <activity android:name=".ui.FormActivity"
+        <activity android:name=".ui.common.FormActivity"
             android:configChanges="orientation|screenSize"/>
         <activity android:name=".ui.transaction.TransactionDetailActivity"
             android:configChanges="orientation|screenSize"/>
diff --git a/app/src/main/java/org/gnucash/android/db/DatabaseAdapter.java b/app/src/main/java/org/gnucash/android/db/DatabaseAdapter.java
index 351f1cf1..e24e33c2 100644
--- a/app/src/main/java/org/gnucash/android/db/DatabaseAdapter.java
+++ b/app/src/main/java/org/gnucash/android/db/DatabaseAdapter.java
@@ -161,7 +161,6 @@ private void createTempView() {
         //   pick the minimal value of the modified account uid (one of the ones begins with 'a', if exists)
         //   use substr to get account uid
 
-        //FIXME: Check if the split value is properly extracted. Also consider adding split quantity to the view
         mDb.execSQL("CREATE TEMP VIEW IF NOT EXISTS trans_extra_info AS SELECT " + TransactionEntry.TABLE_NAME + "_" + TransactionEntry.COLUMN_UID +
                 " AS trans_acct_t_uid , SUBSTR ( MIN ( ( CASE WHEN IFNULL ( " + SplitEntry.TABLE_NAME + "_" +
                 SplitEntry.COLUMN_MEMO + " , '' ) == '' THEN 'a' ELSE 'b' END ) || " +
diff --git a/app/src/main/java/org/gnucash/android/db/DatabaseHelper.java b/app/src/main/java/org/gnucash/android/db/DatabaseHelper.java
index b2eb711a..2d3c50ed 100644
--- a/app/src/main/java/org/gnucash/android/db/DatabaseHelper.java
+++ b/app/src/main/java/org/gnucash/android/db/DatabaseHelper.java
@@ -62,7 +62,7 @@
 			+ AccountEntry.COLUMN_NAME 	            + " varchar(255) not null, "
 			+ AccountEntry.COLUMN_TYPE              + " varchar(255) not null, "
 			+ AccountEntry.COLUMN_CURRENCY          + " varchar(255) not null, "
-            + AccountEntry.COLUMN_COMMODITY_UID     + " varchar(255), "
+            + AccountEntry.COLUMN_COMMODITY_UID     + " varchar(255) not null, "
 			+ AccountEntry.COLUMN_DESCRIPTION       + " varchar(255), "
             + AccountEntry.COLUMN_COLOR_CODE        + " varchar(255), "
             + AccountEntry.COLUMN_FAVORITE 		    + " tinyint default 0, "
@@ -88,7 +88,7 @@
 			+ TransactionEntry.COLUMN_EXPORTED      + " tinyint default 0, "
 			+ TransactionEntry.COLUMN_TEMPLATE      + " tinyint default 0, "
             + TransactionEntry.COLUMN_CURRENCY      + " varchar(255) not null, "
-            + TransactionEntry.COLUMN_COMMODITY_UID + " varchar(255), "
+            + TransactionEntry.COLUMN_COMMODITY_UID + " varchar(255) not null, "
             + TransactionEntry.COLUMN_SCHEDX_ACTION_UID + " varchar(255), "
             + TransactionEntry.COLUMN_CREATED_AT    + " TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP, "
             + TransactionEntry.COLUMN_MODIFIED_AT   + " TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP, "
@@ -260,20 +260,20 @@ private void createDatabaseTables(SQLiteDatabase db) {
         String createAccountUidIndex = "CREATE UNIQUE INDEX '" + AccountEntry.INDEX_UID + "' ON "
                 + AccountEntry.TABLE_NAME + "(" + AccountEntry.COLUMN_UID + ")";
 
-        String createTransactionUidIndex = "CREATE UNIQUE INDEX '"+ TransactionEntry.INDEX_UID +"' ON "
+        String createTransactionUidIndex = "CREATE UNIQUE INDEX '" + TransactionEntry.INDEX_UID + "' ON "
                 + TransactionEntry.TABLE_NAME + "(" + TransactionEntry.COLUMN_UID + ")";
 
-        String createSplitUidIndex = "CREATE UNIQUE INDEX '" + SplitEntry.INDEX_UID +"' ON "
+        String createSplitUidIndex = "CREATE UNIQUE INDEX '" + SplitEntry.INDEX_UID + "' ON "
                 + SplitEntry.TABLE_NAME + "(" + SplitEntry.COLUMN_UID + ")";
 
         String createScheduledEventUidIndex = "CREATE UNIQUE INDEX '" + ScheduledActionEntry.INDEX_UID
-                +"' ON " + ScheduledActionEntry.TABLE_NAME + "(" + ScheduledActionEntry.COLUMN_UID + ")";
+                + "' ON " + ScheduledActionEntry.TABLE_NAME + "(" + ScheduledActionEntry.COLUMN_UID + ")";
 
         String createCommodityUidIndex = "CREATE UNIQUE INDEX '" + CommodityEntry.INDEX_UID
-                +"' ON " + CommodityEntry.TABLE_NAME + "(" + CommodityEntry.COLUMN_UID + ")";
+                + "' ON " + CommodityEntry.TABLE_NAME + "(" + CommodityEntry.COLUMN_UID + ")";
 
         String createPriceUidIndex = "CREATE UNIQUE INDEX '" + PriceEntry.INDEX_UID
-                +"' ON " + PriceEntry.TABLE_NAME + "(" + PriceEntry.COLUMN_UID + ")";
+                + "' ON " + PriceEntry.TABLE_NAME + "(" + PriceEntry.COLUMN_UID + ")";
 
         db.execSQL(createAccountUidIndex);
         db.execSQL(createTransactionUidIndex);
@@ -289,25 +289,5 @@ private void createDatabaseTables(SQLiteDatabase db) {
             e.printStackTrace();
             throw new RuntimeException(e);
         }
-
-//TODO: This might slow down insertions: potentially remove and insert commodity UID manually during db inserts
-        db.execSQL("CREATE TRIGGER insert_account_commodity "
-                + " AFTER INSERT ON " + AccountEntry.TABLE_NAME
-                + " BEGIN " + "UPDATE " + AccountEntry.TABLE_NAME
-                        + " SET " + AccountEntry.COLUMN_COMMODITY_UID + " = "
-                            + " (SELECT " + CommodityEntry.COLUMN_UID + " FROM " + CommodityEntry.TABLE_NAME
-                            + " WHERE " + AccountEntry.TABLE_NAME + "." + AccountEntry.COLUMN_CURRENCY + " = " + CommodityEntry.TABLE_NAME + "." + CommodityEntry.COLUMN_MNEMONIC + ")"
-                        + " WHERE " + AccountEntry.COLUMN_UID + " = NEW." + AccountEntry.COLUMN_UID + ";"
-                + "  END;");
-
-        db.execSQL("CREATE TRIGGER insert_transaction_commodity "
-                + " AFTER INSERT ON " + TransactionEntry.TABLE_NAME
-                + " BEGIN " + "UPDATE " + TransactionEntry.TABLE_NAME
-                    + " SET " + TransactionEntry.COLUMN_COMMODITY_UID + " = "
-                        + " (SELECT " + CommodityEntry.COLUMN_UID + " FROM " + CommodityEntry.TABLE_NAME
-                        + " WHERE " + TransactionEntry.TABLE_NAME + "." + TransactionEntry.COLUMN_CURRENCY + " = " + CommodityEntry.TABLE_NAME + "." + CommodityEntry.COLUMN_MNEMONIC + ") "
-                    + " WHERE " + TransactionEntry.COLUMN_UID + " = NEW." + TransactionEntry.COLUMN_UID + ";"
-                + "  END;");
     }
-
 }
diff --git a/app/src/main/java/org/gnucash/android/db/MigrationHelper.java b/app/src/main/java/org/gnucash/android/db/MigrationHelper.java
index b66cb9c5..60e02d24 100644
--- a/app/src/main/java/org/gnucash/android/db/MigrationHelper.java
+++ b/app/src/main/java/org/gnucash/android/db/MigrationHelper.java
@@ -872,28 +872,6 @@ static int upgradeDbToVersion9(SQLiteDatabase db){
                 throw new RuntimeException(e);
             }
 
-
-//TODO: This might slow down insertions: potentially remove and insert commodity UID manually during db inserts
-
-            db.execSQL("CREATE TRIGGER insert_account_commodity "
-                    + " AFTER INSERT ON " + AccountEntry.TABLE_NAME
-                    + " BEGIN " + "UPDATE " + AccountEntry.TABLE_NAME
-                    + " SET " + AccountEntry.COLUMN_COMMODITY_UID + " = "
-                    + " (SELECT " + CommodityEntry.COLUMN_UID + " FROM " + CommodityEntry.TABLE_NAME
-                    + " WHERE " + AccountEntry.TABLE_NAME + "." + AccountEntry.COLUMN_CURRENCY + " = " + CommodityEntry.TABLE_NAME + "." + CommodityEntry.COLUMN_MNEMONIC + ")"
-                    + " WHERE " + AccountEntry.COLUMN_UID + " = NEW." + AccountEntry.COLUMN_UID + ";"
-                    + "  END;");
-
-            db.execSQL("CREATE TRIGGER insert_transaction_commodity "
-                    + " AFTER INSERT ON " + TransactionEntry.TABLE_NAME
-                    + " BEGIN " + "UPDATE " + TransactionEntry.TABLE_NAME
-                    + " SET " + TransactionEntry.COLUMN_COMMODITY_UID + " = "
-                    + " (SELECT " + CommodityEntry.COLUMN_UID + " FROM " + CommodityEntry.TABLE_NAME
-                    + " WHERE " + TransactionEntry.TABLE_NAME + "." + TransactionEntry.COLUMN_CURRENCY + " = " + CommodityEntry.TABLE_NAME + "." + CommodityEntry.COLUMN_MNEMONIC + ") "
-                    + " WHERE " + TransactionEntry.COLUMN_UID + " = NEW." + TransactionEntry.COLUMN_UID + ";"
-                    + "  END;");
-
-
             db.execSQL(" ALTER TABLE " + AccountEntry.TABLE_NAME
                     + " ADD COLUMN " + AccountEntry.COLUMN_COMMODITY_UID + " varchar(255) "
                     + " REFERENCES " + CommodityEntry.TABLE_NAME + " (" + CommodityEntry.COLUMN_UID + ") ");
@@ -971,17 +949,15 @@ static int upgradeDbToVersion9(SQLiteDatabase db){
                     + SplitEntry.TABLE_NAME + "_bak." + SplitEntry.COLUMN_MEMO + " , "
                     + SplitEntry.TABLE_NAME + "_bak." + SplitEntry.COLUMN_TYPE + " , "
                     + SplitEntry.TABLE_NAME + "_bak.amount * 100, " //put the amount as both value and quantity since multicurrency transactions were not supported until now
-                    + "100, " //todo: lookup the currency and use the appropriate denom
+                    + "100, "
                     + SplitEntry.TABLE_NAME + "_bak.amount * 100, " //default units of 2 decimal places were assumed until now
-                    + "100, " //todo: lookup the currency and use the appropriate denom
+                    + "100, "
                     + SplitEntry.TABLE_NAME + "_bak." + SplitEntry.COLUMN_ACCOUNT_UID + " , "
                     + SplitEntry.TABLE_NAME + "_bak." + SplitEntry.COLUMN_TRANSACTION_UID
                     + " FROM " + SplitEntry.TABLE_NAME + "_bak;");
 
             db.execSQL("DROP TABLE " + SplitEntry.TABLE_NAME + "_bak");
 
-
-            //TODO: add migrations here
             db.setTransactionSuccessful();
             oldVersion = 9;
         } finally {
diff --git a/app/src/main/java/org/gnucash/android/db/TransactionsDbAdapter.java b/app/src/main/java/org/gnucash/android/db/TransactionsDbAdapter.java
index 780aa58d..340c0bf4 100644
--- a/app/src/main/java/org/gnucash/android/db/TransactionsDbAdapter.java
+++ b/app/src/main/java/org/gnucash/android/db/TransactionsDbAdapter.java
@@ -85,7 +85,6 @@ public SplitsDbAdapter getSplitDbAdapter() {
 	 */
     @Override
 	public void addRecord(@NonNull Transaction transaction){
-        //TODO: Override this method to balance transaction splits before saving to database
         Log.d(LOG_TAG, "Replacing transaction in db");
         mDb.beginTransaction();
         try {
diff --git a/app/src/main/java/org/gnucash/android/receivers/TransactionAppWidgetProvider.java b/app/src/main/java/org/gnucash/android/receivers/TransactionAppWidgetProvider.java
index 34974ff8..053c2a0f 100644
--- a/app/src/main/java/org/gnucash/android/receivers/TransactionAppWidgetProvider.java
+++ b/app/src/main/java/org/gnucash/android/receivers/TransactionAppWidgetProvider.java
@@ -21,8 +21,8 @@
 import android.content.SharedPreferences.Editor;
 import android.preference.PreferenceManager;
 
-import org.gnucash.android.ui.UxArgument;
-import org.gnucash.android.ui.widget.WidgetConfigurationActivity;
+import org.gnucash.android.ui.common.UxArgument;
+import org.gnucash.android.ui.homescreen.WidgetConfigurationActivity;
 
 /**
  * {@link AppWidgetProvider} which is responsible for managing widgets on the homescreen
diff --git a/app/src/main/java/org/gnucash/android/receivers/TransactionRecorder.java b/app/src/main/java/org/gnucash/android/receivers/TransactionRecorder.java
index 7630d1f5..0fe6b5ea 100644
--- a/app/src/main/java/org/gnucash/android/receivers/TransactionRecorder.java
+++ b/app/src/main/java/org/gnucash/android/receivers/TransactionRecorder.java
@@ -30,7 +30,7 @@
 import org.gnucash.android.model.Split;
 import org.gnucash.android.model.Transaction;
 import org.gnucash.android.model.TransactionType;
-import org.gnucash.android.ui.widget.WidgetConfigurationActivity;
+import org.gnucash.android.ui.homescreen.WidgetConfigurationActivity;
 
 import java.io.BufferedReader;
 import java.io.IOException;
diff --git a/app/src/main/java/org/gnucash/android/ui/account/AccountFormFragment.java b/app/src/main/java/org/gnucash/android/ui/account/AccountFormFragment.java
index 78bd6637..c5cca688 100644
--- a/app/src/main/java/org/gnucash/android/ui/account/AccountFormFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/account/AccountFormFragment.java
@@ -61,7 +61,7 @@
 import org.gnucash.android.model.AccountType;
 import org.gnucash.android.model.Commodity;
 import org.gnucash.android.model.Money;
-import org.gnucash.android.ui.UxArgument;
+import org.gnucash.android.ui.common.UxArgument;
 import org.gnucash.android.ui.colorpicker.ColorPickerDialog;
 import org.gnucash.android.ui.colorpicker.ColorPickerSwatch;
 import org.gnucash.android.ui.colorpicker.ColorSquare;
diff --git a/app/src/main/java/org/gnucash/android/ui/account/AccountsActivity.java b/app/src/main/java/org/gnucash/android/ui/account/AccountsActivity.java
index 10374c75..d0f660b0 100644
--- a/app/src/main/java/org/gnucash/android/ui/account/AccountsActivity.java
+++ b/app/src/main/java/org/gnucash/android/ui/account/AccountsActivity.java
@@ -47,7 +47,6 @@
 import android.view.MenuItem;
 import android.view.View;
 import android.view.ViewGroup;
-import android.widget.ArrayAdapter;
 import android.widget.Toast;
 
 import com.crashlytics.android.Crashlytics;
@@ -60,8 +59,8 @@
 import org.gnucash.android.export.xml.GncXmlExporter;
 import org.gnucash.android.importer.ImportAsyncTask;
 import org.gnucash.android.model.Money;
-import org.gnucash.android.ui.FormActivity;
-import org.gnucash.android.ui.UxArgument;
+import org.gnucash.android.ui.common.FormActivity;
+import org.gnucash.android.ui.common.UxArgument;
 import org.gnucash.android.ui.passcode.PassLockActivity;
 import org.gnucash.android.ui.transaction.TransactionsActivity;
 import org.gnucash.android.ui.util.OnAccountClickedListener;
@@ -71,10 +70,6 @@
 
 import java.io.FileNotFoundException;
 import java.io.InputStream;
-import java.util.Arrays;
-import java.util.Currency;
-import java.util.List;
-import java.util.Locale;
 
 /**
  * Manages actions related to accounts, displaying, exporting and creating new accounts
diff --git a/app/src/main/java/org/gnucash/android/ui/account/AccountsListFragment.java b/app/src/main/java/org/gnucash/android/ui/account/AccountsListFragment.java
index 4b07b560..8bfea79d 100644
--- a/app/src/main/java/org/gnucash/android/ui/account/AccountsListFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/account/AccountsListFragment.java
@@ -51,11 +51,11 @@
 import org.gnucash.android.db.DatabaseCursorLoader;
 import org.gnucash.android.db.DatabaseSchema;
 import org.gnucash.android.model.Account;
-import org.gnucash.android.ui.FormActivity;
-import org.gnucash.android.ui.UxArgument;
+import org.gnucash.android.ui.common.FormActivity;
+import org.gnucash.android.ui.common.UxArgument;
 import org.gnucash.android.ui.util.AccountBalanceTask;
 import org.gnucash.android.ui.util.CursorRecyclerAdapter;
-import org.gnucash.android.ui.util.EmptyRecyclerView;
+import org.gnucash.android.ui.util.widget.EmptyRecyclerView;
 import org.gnucash.android.ui.util.OnAccountClickedListener;
 import org.gnucash.android.ui.util.Refreshable;
 
diff --git a/app/src/main/java/org/gnucash/android/ui/account/DeleteAccountDialogFragment.java b/app/src/main/java/org/gnucash/android/ui/account/DeleteAccountDialogFragment.java
index c30cc0a0..91663c3c 100644
--- a/app/src/main/java/org/gnucash/android/ui/account/DeleteAccountDialogFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/account/DeleteAccountDialogFragment.java
@@ -38,7 +38,7 @@
 import org.gnucash.android.db.TransactionsDbAdapter;
 import org.gnucash.android.model.AccountType;
 import org.gnucash.android.ui.util.Refreshable;
-import org.gnucash.android.ui.widget.WidgetConfigurationActivity;
+import org.gnucash.android.ui.homescreen.WidgetConfigurationActivity;
 import org.gnucash.android.util.QualifiedAccountNameCursorAdapter;
 
 import java.util.Currency;
diff --git a/app/src/main/java/org/gnucash/android/ui/BaseDrawerActivity.java b/app/src/main/java/org/gnucash/android/ui/common/BaseDrawerActivity.java
similarity index 99%
rename from app/src/main/java/org/gnucash/android/ui/BaseDrawerActivity.java
rename to app/src/main/java/org/gnucash/android/ui/common/BaseDrawerActivity.java
index e9f5f3e6..bb1b71e4 100644
--- a/app/src/main/java/org/gnucash/android/ui/BaseDrawerActivity.java
+++ b/app/src/main/java/org/gnucash/android/ui/common/BaseDrawerActivity.java
@@ -13,7 +13,7 @@
  * See the License for the specific language governing permissions and
  * limitations under the License.
  */
-package org.gnucash.android.ui;
+package org.gnucash.android.ui.common;
 
 import android.app.Activity;
 import android.content.Intent;
diff --git a/app/src/main/java/org/gnucash/android/ui/FormActivity.java b/app/src/main/java/org/gnucash/android/ui/common/FormActivity.java
similarity index 98%
rename from app/src/main/java/org/gnucash/android/ui/FormActivity.java
rename to app/src/main/java/org/gnucash/android/ui/common/FormActivity.java
index b9b76eb9..cc8aa7c5 100644
--- a/app/src/main/java/org/gnucash/android/ui/FormActivity.java
+++ b/app/src/main/java/org/gnucash/android/ui/common/FormActivity.java
@@ -14,7 +14,7 @@
  * limitations under the License.
  */
 
-package org.gnucash.android.ui;
+package org.gnucash.android.ui.common;
 
 import android.content.Intent;
 import android.graphics.drawable.ColorDrawable;
@@ -34,7 +34,7 @@
 import org.gnucash.android.ui.export.ExportFormFragment;
 import org.gnucash.android.ui.transaction.TransactionFormFragment;
 import org.gnucash.android.ui.transaction.SplitEditorFragment;
-import org.gnucash.android.ui.util.CalculatorKeyboard;
+import org.gnucash.android.ui.util.widget.CalculatorKeyboard;
 
 /**
  * Activity for displaying forms in the application.
diff --git a/app/src/main/java/org/gnucash/android/ui/UxArgument.java b/app/src/main/java/org/gnucash/android/ui/common/UxArgument.java
similarity index 98%
rename from app/src/main/java/org/gnucash/android/ui/UxArgument.java
rename to app/src/main/java/org/gnucash/android/ui/common/UxArgument.java
index 6478bd01..ad2d4e8b 100644
--- a/app/src/main/java/org/gnucash/android/ui/UxArgument.java
+++ b/app/src/main/java/org/gnucash/android/ui/common/UxArgument.java
@@ -13,7 +13,7 @@
  * See the License for the specific language governing permissions and
  * limitations under the License.
  */
-package org.gnucash.android.ui;
+package org.gnucash.android.ui.common;
 
 /**
  * Collection of constants which are passed across multiple pieces of the UI (fragments, activities, dialogs)
diff --git a/app/src/main/java/org/gnucash/android/ui/widget/WidgetConfigurationActivity.java b/app/src/main/java/org/gnucash/android/ui/homescreen/WidgetConfigurationActivity.java
similarity index 98%
rename from app/src/main/java/org/gnucash/android/ui/widget/WidgetConfigurationActivity.java
rename to app/src/main/java/org/gnucash/android/ui/homescreen/WidgetConfigurationActivity.java
index 23fd58ba..99f55eab 100644
--- a/app/src/main/java/org/gnucash/android/ui/widget/WidgetConfigurationActivity.java
+++ b/app/src/main/java/org/gnucash/android/ui/homescreen/WidgetConfigurationActivity.java
@@ -14,7 +14,7 @@
  * limitations under the License.
  */
 
-package org.gnucash.android.ui.widget;
+package org.gnucash.android.ui.homescreen;
 
 import android.app.Activity;
 import android.app.PendingIntent;
@@ -40,8 +40,8 @@
 import org.gnucash.android.model.Account;
 import org.gnucash.android.model.Money;
 import org.gnucash.android.receivers.TransactionAppWidgetProvider;
-import org.gnucash.android.ui.FormActivity;
-import org.gnucash.android.ui.UxArgument;
+import org.gnucash.android.ui.common.FormActivity;
+import org.gnucash.android.ui.common.UxArgument;
 import org.gnucash.android.ui.account.AccountsActivity;
 import org.gnucash.android.ui.transaction.TransactionsActivity;
 import org.gnucash.android.util.QualifiedAccountNameCursorAdapter;
diff --git a/app/src/main/java/org/gnucash/android/ui/passcode/PassLockActivity.java b/app/src/main/java/org/gnucash/android/ui/passcode/PassLockActivity.java
index 951b7a7c..1236e8f3 100644
--- a/app/src/main/java/org/gnucash/android/ui/passcode/PassLockActivity.java
+++ b/app/src/main/java/org/gnucash/android/ui/passcode/PassLockActivity.java
@@ -22,8 +22,8 @@
 import android.view.WindowManager.LayoutParams;
 
 import org.gnucash.android.app.GnuCashApplication;
-import org.gnucash.android.ui.BaseDrawerActivity;
-import org.gnucash.android.ui.UxArgument;
+import org.gnucash.android.ui.common.BaseDrawerActivity;
+import org.gnucash.android.ui.common.UxArgument;
 
 /**
  * This activity used as the parent class for enabling passcode lock
diff --git a/app/src/main/java/org/gnucash/android/ui/passcode/PasscodeLockScreenActivity.java b/app/src/main/java/org/gnucash/android/ui/passcode/PasscodeLockScreenActivity.java
index 18cd63e8..a784d195 100644
--- a/app/src/main/java/org/gnucash/android/ui/passcode/PasscodeLockScreenActivity.java
+++ b/app/src/main/java/org/gnucash/android/ui/passcode/PasscodeLockScreenActivity.java
@@ -25,7 +25,7 @@
 
 import org.gnucash.android.R;
 import org.gnucash.android.app.GnuCashApplication;
-import org.gnucash.android.ui.UxArgument;
+import org.gnucash.android.ui.common.UxArgument;
 
 /**
  * Activity for displaying and managing the passcode lock screen.
diff --git a/app/src/main/java/org/gnucash/android/ui/passcode/PasscodePreferenceActivity.java b/app/src/main/java/org/gnucash/android/ui/passcode/PasscodePreferenceActivity.java
index e591ec8a..1f134efe 100644
--- a/app/src/main/java/org/gnucash/android/ui/passcode/PasscodePreferenceActivity.java
+++ b/app/src/main/java/org/gnucash/android/ui/passcode/PasscodePreferenceActivity.java
@@ -24,7 +24,7 @@
 import android.widget.Toast;
 
 import org.gnucash.android.R;
-import org.gnucash.android.ui.UxArgument;
+import org.gnucash.android.ui.common.UxArgument;
 
 /**
  * Activity for entering and confirming passcode
diff --git a/app/src/main/java/org/gnucash/android/ui/report/BalanceSheetFragment.java b/app/src/main/java/org/gnucash/android/ui/report/BalanceSheetFragment.java
index e2cc55fe..edd88bef 100644
--- a/app/src/main/java/org/gnucash/android/ui/report/BalanceSheetFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/report/BalanceSheetFragment.java
@@ -47,8 +47,6 @@
  */
 public class BalanceSheetFragment extends Fragment {
 
-    //TODO: finish generation of text reports
-
     @Bind(R.id.table_assets) TableLayout mAssetsTableLayout;
     @Bind(R.id.table_liabilities) TableLayout mLiabilitiesTableLayout;
     @Bind(R.id.table_equity) TableLayout mEquityTableLayout;
diff --git a/app/src/main/java/org/gnucash/android/ui/settings/DeleteAllAccountsConfirmationDialog.java b/app/src/main/java/org/gnucash/android/ui/settings/DeleteAllAccountsConfirmationDialog.java
index f1d73baf..11001b53 100644
--- a/app/src/main/java/org/gnucash/android/ui/settings/DeleteAllAccountsConfirmationDialog.java
+++ b/app/src/main/java/org/gnucash/android/ui/settings/DeleteAllAccountsConfirmationDialog.java
@@ -28,7 +28,7 @@
 import org.gnucash.android.R;
 import org.gnucash.android.db.AccountsDbAdapter;
 import org.gnucash.android.export.xml.GncXmlExporter;
-import org.gnucash.android.ui.widget.WidgetConfigurationActivity;
+import org.gnucash.android.ui.homescreen.WidgetConfigurationActivity;
 
 /**
  * Confirmation dialog for deleting all accounts from the system.
diff --git a/app/src/main/java/org/gnucash/android/ui/settings/DeleteAllTransactionsConfirmationDialog.java b/app/src/main/java/org/gnucash/android/ui/settings/DeleteAllTransactionsConfirmationDialog.java
index 2b192096..22ae7307 100644
--- a/app/src/main/java/org/gnucash/android/ui/settings/DeleteAllTransactionsConfirmationDialog.java
+++ b/app/src/main/java/org/gnucash/android/ui/settings/DeleteAllTransactionsConfirmationDialog.java
@@ -32,7 +32,7 @@
 import org.gnucash.android.db.TransactionsDbAdapter;
 import org.gnucash.android.export.xml.GncXmlExporter;
 import org.gnucash.android.model.Transaction;
-import org.gnucash.android.ui.widget.WidgetConfigurationActivity;
+import org.gnucash.android.ui.homescreen.WidgetConfigurationActivity;
 
 import java.util.ArrayList;
 import java.util.List;
diff --git a/app/src/main/java/org/gnucash/android/ui/settings/GeneralPreferenceFragment.java b/app/src/main/java/org/gnucash/android/ui/settings/GeneralPreferenceFragment.java
index 7db576da..18f8a901 100644
--- a/app/src/main/java/org/gnucash/android/ui/settings/GeneralPreferenceFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/settings/GeneralPreferenceFragment.java
@@ -27,12 +27,11 @@
 import android.preference.PreferenceFragment;
 import android.preference.PreferenceManager;
 import android.support.v7.app.ActionBar;
-import android.support.v7.app.AppCompatActivity;
 import android.widget.Toast;
 
 import org.gnucash.android.R;
 import org.gnucash.android.app.GnuCashApplication;
-import org.gnucash.android.ui.UxArgument;
+import org.gnucash.android.ui.common.UxArgument;
 import org.gnucash.android.ui.passcode.PasscodeLockScreenActivity;
 import org.gnucash.android.ui.passcode.PasscodePreferenceActivity;
 
diff --git a/app/src/main/java/org/gnucash/android/ui/settings/SettingsActivity.java b/app/src/main/java/org/gnucash/android/ui/settings/SettingsActivity.java
index 72f39b33..74d7f3f3 100644
--- a/app/src/main/java/org/gnucash/android/ui/settings/SettingsActivity.java
+++ b/app/src/main/java/org/gnucash/android/ui/settings/SettingsActivity.java
@@ -21,7 +21,6 @@
 import android.annotation.TargetApi;
 import android.app.Activity;
 import android.app.AlertDialog;
-import android.content.ActivityNotFoundException;
 import android.content.Context;
 import android.content.DialogInterface;
 import android.content.Intent;
@@ -59,7 +58,7 @@
 import org.gnucash.android.importer.ImportAsyncTask;
 import org.gnucash.android.model.Money;
 import org.gnucash.android.model.Transaction;
-import org.gnucash.android.ui.UxArgument;
+import org.gnucash.android.ui.common.UxArgument;
 import org.gnucash.android.ui.account.AccountsActivity;
 import org.gnucash.android.ui.passcode.PasscodeLockScreenActivity;
 import org.gnucash.android.ui.passcode.PasscodePreferenceActivity;
diff --git a/app/src/main/java/org/gnucash/android/ui/transaction/ScheduledActionsListFragment.java b/app/src/main/java/org/gnucash/android/ui/transaction/ScheduledActionsListFragment.java
index a3e5a9fd..f5b808c6 100644
--- a/app/src/main/java/org/gnucash/android/ui/transaction/ScheduledActionsListFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/transaction/ScheduledActionsListFragment.java
@@ -56,8 +56,8 @@
 import org.gnucash.android.export.ExportParams;
 import org.gnucash.android.model.ScheduledAction;
 import org.gnucash.android.model.Transaction;
-import org.gnucash.android.ui.FormActivity;
-import org.gnucash.android.ui.UxArgument;
+import org.gnucash.android.ui.common.FormActivity;
+import org.gnucash.android.ui.common.UxArgument;
 
 import java.text.DateFormat;
 import java.util.Date;
diff --git a/app/src/main/java/org/gnucash/android/ui/transaction/SplitEditorFragment.java b/app/src/main/java/org/gnucash/android/ui/transaction/SplitEditorFragment.java
index c6b83e62..1ac04856 100644
--- a/app/src/main/java/org/gnucash/android/ui/transaction/SplitEditorFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/transaction/SplitEditorFragment.java
@@ -25,8 +25,6 @@
 import android.support.v4.widget.SimpleCursorAdapter;
 import android.support.v7.app.ActionBar;
 import android.support.v7.app.AppCompatActivity;
-import android.text.Editable;
-import android.text.TextWatcher;
 import android.view.LayoutInflater;
 import android.view.Menu;
 import android.view.MenuInflater;
@@ -34,7 +32,6 @@
 import android.view.View;
 import android.view.ViewGroup;
 import android.widget.AdapterView;
-import android.widget.Button;
 import android.widget.EditText;
 import android.widget.ImageView;
 import android.widget.LinearLayout;
@@ -50,13 +47,13 @@
 import org.gnucash.android.model.Split;
 import org.gnucash.android.model.Transaction;
 import org.gnucash.android.model.TransactionType;
-import org.gnucash.android.ui.FormActivity;
-import org.gnucash.android.ui.UxArgument;
+import org.gnucash.android.ui.common.FormActivity;
+import org.gnucash.android.ui.common.UxArgument;
 import org.gnucash.android.ui.transaction.dialog.TransferFundsDialogFragment;
-import org.gnucash.android.ui.util.CalculatorEditText;
-import org.gnucash.android.ui.util.CalculatorKeyboard;
+import org.gnucash.android.ui.util.widget.CalculatorEditText;
+import org.gnucash.android.ui.util.widget.CalculatorKeyboard;
 import org.gnucash.android.ui.util.OnTransferFundsListener;
-import org.gnucash.android.ui.util.TransactionTypeSwitch;
+import org.gnucash.android.ui.util.widget.TransactionTypeSwitch;
 import org.gnucash.android.util.QualifiedAccountNameCursorAdapter;
 
 import java.math.BigDecimal;
diff --git a/app/src/main/java/org/gnucash/android/ui/transaction/TransactionDetailActivity.java b/app/src/main/java/org/gnucash/android/ui/transaction/TransactionDetailActivity.java
index 6c045075..9a53ea20 100644
--- a/app/src/main/java/org/gnucash/android/ui/transaction/TransactionDetailActivity.java
+++ b/app/src/main/java/org/gnucash/android/ui/transaction/TransactionDetailActivity.java
@@ -23,8 +23,8 @@
 import org.gnucash.android.model.ScheduledAction;
 import org.gnucash.android.model.Split;
 import org.gnucash.android.model.Transaction;
-import org.gnucash.android.ui.FormActivity;
-import org.gnucash.android.ui.UxArgument;
+import org.gnucash.android.ui.common.FormActivity;
+import org.gnucash.android.ui.common.UxArgument;
 
 import java.text.DateFormat;
 import java.util.Date;
diff --git a/app/src/main/java/org/gnucash/android/ui/transaction/TransactionFormFragment.java b/app/src/main/java/org/gnucash/android/ui/transaction/TransactionFormFragment.java
index 0c551571..d421ee83 100644
--- a/app/src/main/java/org/gnucash/android/ui/transaction/TransactionFormFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/transaction/TransactionFormFragment.java
@@ -25,6 +25,7 @@
 import android.inputmethodservice.KeyboardView;
 import android.os.Bundle;
 import android.preference.PreferenceManager;
+import android.support.design.widget.Snackbar;
 import android.support.v4.app.Fragment;
 import android.support.v4.app.FragmentManager;
 import android.support.v4.app.FragmentTransaction;
@@ -59,6 +60,7 @@
 
 import org.gnucash.android.R;
 import org.gnucash.android.db.AccountsDbAdapter;
+import org.gnucash.android.db.CommoditiesDbAdapter;
 import org.gnucash.android.db.DatabaseSchema;
 import org.gnucash.android.db.ScheduledActionDbAdapter;
 import org.gnucash.android.db.TransactionsDbAdapter;
@@ -68,15 +70,14 @@
 import org.gnucash.android.model.Split;
 import org.gnucash.android.model.Transaction;
 import org.gnucash.android.model.TransactionType;
-import org.gnucash.android.ui.FormActivity;
-import org.gnucash.android.ui.UxArgument;
+import org.gnucash.android.ui.common.FormActivity;
+import org.gnucash.android.ui.common.UxArgument;
 import org.gnucash.android.ui.transaction.dialog.TransferFundsDialogFragment;
-import org.gnucash.android.ui.util.CalculatorEditText;
-import org.gnucash.android.ui.util.CalculatorKeyboard;
+import org.gnucash.android.ui.util.widget.CalculatorEditText;
 import org.gnucash.android.ui.util.OnTransferFundsListener;
 import org.gnucash.android.ui.util.RecurrenceParser;
-import org.gnucash.android.ui.util.TransactionTypeSwitch;
-import org.gnucash.android.ui.widget.WidgetConfigurationActivity;
+import org.gnucash.android.ui.util.widget.TransactionTypeSwitch;
+import org.gnucash.android.ui.homescreen.WidgetConfigurationActivity;
 import org.gnucash.android.util.QualifiedAccountNameCursorAdapter;
 
 import java.math.BigDecimal;
@@ -816,7 +817,9 @@ private void saveNewTransaction() {
                 }
             }
 
-            mTransaction.setCurrencyCode(mAccountsDbAdapter.getAccountCurrencyCode(mAccountUID));
+            String currencyCode = mAccountsDbAdapter.getAccountCurrencyCode(mAccountUID);
+            mTransaction.setCurrencyCode(currencyCode);
+            mTransaction.setCommodityUID(CommoditiesDbAdapter.getInstance().getCommodityUID(currencyCode));
             mTransaction.setTime(cal.getTimeInMillis());
             mTransaction.setNote(notes);
 
@@ -883,9 +886,7 @@ private void scheduleRecurringTransaction(String transactionUID) {
 
             Log.i("TransactionFormFragment", event.toString());
         }
-        Toast.makeText(getActivity(), "Scheduled recurring transaction", Toast.LENGTH_SHORT).show();
-
-        //TODO: localize this toast string for all supported locales
+        Toast.makeText(getActivity(), R.string.toast_scheduled_recurring_transaction, Toast.LENGTH_SHORT).show();
 
     }
 
diff --git a/app/src/main/java/org/gnucash/android/ui/transaction/TransactionsActivity.java b/app/src/main/java/org/gnucash/android/ui/transaction/TransactionsActivity.java
index 410e9cbd..de0d1f0c 100644
--- a/app/src/main/java/org/gnucash/android/ui/transaction/TransactionsActivity.java
+++ b/app/src/main/java/org/gnucash/android/ui/transaction/TransactionsActivity.java
@@ -48,8 +48,8 @@
 import org.gnucash.android.db.DatabaseSchema;
 import org.gnucash.android.model.Account;
 import org.gnucash.android.model.Money;
-import org.gnucash.android.ui.FormActivity;
-import org.gnucash.android.ui.UxArgument;
+import org.gnucash.android.ui.common.FormActivity;
+import org.gnucash.android.ui.common.UxArgument;
 import org.gnucash.android.ui.account.AccountsActivity;
 import org.gnucash.android.ui.account.AccountsListFragment;
 import org.gnucash.android.ui.passcode.PassLockActivity;
diff --git a/app/src/main/java/org/gnucash/android/ui/transaction/TransactionsListFragment.java b/app/src/main/java/org/gnucash/android/ui/transaction/TransactionsListFragment.java
index efe55248..b6f80e65 100644
--- a/app/src/main/java/org/gnucash/android/ui/transaction/TransactionsListFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/transaction/TransactionsListFragment.java
@@ -49,11 +49,11 @@
 import org.gnucash.android.db.TransactionsDbAdapter;
 import org.gnucash.android.model.Money;
 import org.gnucash.android.model.Split;
-import org.gnucash.android.ui.FormActivity;
-import org.gnucash.android.ui.UxArgument;
-import org.gnucash.android.ui.util.EmptyRecyclerView;
+import org.gnucash.android.ui.common.FormActivity;
+import org.gnucash.android.ui.common.UxArgument;
+import org.gnucash.android.ui.util.widget.EmptyRecyclerView;
 import org.gnucash.android.ui.util.Refreshable;
-import org.gnucash.android.ui.widget.WidgetConfigurationActivity;
+import org.gnucash.android.ui.homescreen.WidgetConfigurationActivity;
 import org.ocpsoft.prettytime.PrettyTime;
 
 import java.util.Date;
diff --git a/app/src/main/java/org/gnucash/android/ui/transaction/dialog/BulkMoveDialogFragment.java b/app/src/main/java/org/gnucash/android/ui/transaction/dialog/BulkMoveDialogFragment.java
index c20352e7..9a2eb2af 100644
--- a/app/src/main/java/org/gnucash/android/ui/transaction/dialog/BulkMoveDialogFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/transaction/dialog/BulkMoveDialogFragment.java
@@ -32,10 +32,10 @@
 import org.gnucash.android.db.AccountsDbAdapter;
 import org.gnucash.android.db.DatabaseSchema;
 import org.gnucash.android.db.TransactionsDbAdapter;
-import org.gnucash.android.ui.UxArgument;
+import org.gnucash.android.ui.common.UxArgument;
 import org.gnucash.android.ui.transaction.TransactionsActivity;
 import org.gnucash.android.ui.util.Refreshable;
-import org.gnucash.android.ui.widget.WidgetConfigurationActivity;
+import org.gnucash.android.ui.homescreen.WidgetConfigurationActivity;
 import org.gnucash.android.util.QualifiedAccountNameCursorAdapter;
 
 /**
diff --git a/app/src/main/java/org/gnucash/android/ui/transaction/dialog/TransactionsDeleteConfirmationDialogFragment.java b/app/src/main/java/org/gnucash/android/ui/transaction/dialog/TransactionsDeleteConfirmationDialogFragment.java
index 80e33b76..3b9bcdbb 100644
--- a/app/src/main/java/org/gnucash/android/ui/transaction/dialog/TransactionsDeleteConfirmationDialogFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/transaction/dialog/TransactionsDeleteConfirmationDialogFragment.java
@@ -28,9 +28,9 @@
 import org.gnucash.android.db.TransactionsDbAdapter;
 import org.gnucash.android.export.xml.GncXmlExporter;
 import org.gnucash.android.model.Transaction;
-import org.gnucash.android.ui.UxArgument;
+import org.gnucash.android.ui.common.UxArgument;
 import org.gnucash.android.ui.util.Refreshable;
-import org.gnucash.android.ui.widget.WidgetConfigurationActivity;
+import org.gnucash.android.ui.homescreen.WidgetConfigurationActivity;
 
 import java.util.ArrayList;
 import java.util.List;
diff --git a/app/src/main/java/org/gnucash/android/ui/transaction/dialog/TransferFundsDialogFragment.java b/app/src/main/java/org/gnucash/android/ui/transaction/dialog/TransferFundsDialogFragment.java
index 74d1813c..408a71fd 100644
--- a/app/src/main/java/org/gnucash/android/ui/transaction/dialog/TransferFundsDialogFragment.java
+++ b/app/src/main/java/org/gnucash/android/ui/transaction/dialog/TransferFundsDialogFragment.java
@@ -44,8 +44,6 @@
 import org.gnucash.android.ui.util.OnTransferFundsListener;
 
 import java.math.BigDecimal;
-import java.math.MathContext;
-import java.math.RoundingMode;
 import java.util.Currency;
 
 import butterknife.Bind;
@@ -161,7 +159,7 @@ public void onClick(View v) {
     @Override
     public Dialog onCreateDialog(Bundle savedInstanceState) {
         Dialog dialog = super.onCreateDialog(savedInstanceState);
-        dialog.setTitle("Transfer Funds");
+        dialog.setTitle(R.string.title_transfer_funds);
         return dialog;
     }
 
@@ -172,7 +170,7 @@ private void transferFunds(){
         if (mExchangeRateRadioButton.isChecked()){
             String exchangeRateString = mExchangeRateInput.getText().toString();
             if (exchangeRateString.isEmpty()){
-                mExchangeRateInputLayout.setError("An exchange rate is required");
+                mExchangeRateInputLayout.setError(getString(R.string.error_exchange_rate_required));
                 return;
             }
 
@@ -183,7 +181,7 @@ private void transferFunds(){
         if (mConvertedAmountRadioButton.isChecked()){
             String convertedAmount = mConvertedAmountInput.getText().toString();
             if (convertedAmount.isEmpty()){
-                mConvertedAmountInputLayout.setError("The converted amount is required");
+                mConvertedAmountInputLayout.setError(getString(R.string.error_converted_amount_required));
                 return;
             }
 
diff --git a/app/src/main/java/org/gnucash/android/ui/util/AmountInputFormatter.java b/app/src/main/java/org/gnucash/android/ui/util/AmountInputFormatter.java
index 8b711150..1e9af5c2 100644
--- a/app/src/main/java/org/gnucash/android/ui/util/AmountInputFormatter.java
+++ b/app/src/main/java/org/gnucash/android/ui/util/AmountInputFormatter.java
@@ -33,7 +33,9 @@
  * of 2.45
  *
  * @author Ngewi Fet <ngewif@gmail.com>
+ * @deprecated Use {@link org.gnucash.android.ui.util.widget.CalculatorEditText} for getting input amounts from the user
  */
+@Deprecated
 public class AmountInputFormatter implements TextWatcher {
     private String current = "0";
     private EditText amountEditText;
diff --git a/app/src/main/java/org/gnucash/android/ui/util/CalculatorEditText.java b/app/src/main/java/org/gnucash/android/ui/util/widget/CalculatorEditText.java
similarity index 98%
rename from app/src/main/java/org/gnucash/android/ui/util/CalculatorEditText.java
rename to app/src/main/java/org/gnucash/android/ui/util/widget/CalculatorEditText.java
index 39044d0c..64a61e0e 100644
--- a/app/src/main/java/org/gnucash/android/ui/util/CalculatorEditText.java
+++ b/app/src/main/java/org/gnucash/android/ui/util/widget/CalculatorEditText.java
@@ -13,7 +13,7 @@
  * See the License for the specific language governing permissions and
  * limitations under the License.
  */
-package org.gnucash.android.ui.util;
+package org.gnucash.android.ui.util.widget;
 
 import android.app.Activity;
 import android.content.Context;
@@ -37,7 +37,7 @@
 
 import org.gnucash.android.R;
 import org.gnucash.android.app.GnuCashApplication;
-import org.gnucash.android.ui.FormActivity;
+import org.gnucash.android.ui.common.FormActivity;
 
 import java.math.BigDecimal;
 import java.text.DecimalFormat;
@@ -262,7 +262,6 @@ public String evaluate(){
         try {
             expression = expressionBuilder.build();
         } catch (RuntimeException e) {
-            // FIXME: i18n
             setError(getContext().getString(R.string.label_error_invalid_expression));
             String msg = "Invalid expression: " + amountText;
             Log.e(this.getClass().getSimpleName(), msg);
@@ -283,7 +282,6 @@ public String evaluate(){
             setText(resultString);
             setSelection(resultString.length());
         } else {
-            // FIXME: i18n
             setError(getContext().getString(R.string.label_error_invalid_expression));
             Log.w(VIEW_LOG_TAG, "Expression is null or invalid: " + expression);
         }
diff --git a/app/src/main/java/org/gnucash/android/ui/util/CalculatorKeyboard.java b/app/src/main/java/org/gnucash/android/ui/util/widget/CalculatorKeyboard.java
similarity index 90%
rename from app/src/main/java/org/gnucash/android/ui/util/CalculatorKeyboard.java
rename to app/src/main/java/org/gnucash/android/ui/util/widget/CalculatorKeyboard.java
index 384ca205..bdd1d762 100644
--- a/app/src/main/java/org/gnucash/android/ui/util/CalculatorKeyboard.java
+++ b/app/src/main/java/org/gnucash/android/ui/util/widget/CalculatorKeyboard.java
@@ -22,44 +22,23 @@
  * documentation would be appreciated but is not required.
  */
 
-package org.gnucash.android.ui.util;
+package org.gnucash.android.ui.util.widget;
 
 import android.app.Activity;
 import android.content.Context;
 import android.inputmethodservice.Keyboard;
 import android.inputmethodservice.KeyboardView;
 import android.inputmethodservice.KeyboardView.OnKeyboardActionListener;
-import android.support.annotation.IdRes;
-import android.support.annotation.LayoutRes;
 import android.support.annotation.XmlRes;
 import android.text.Editable;
-import android.text.InputType;
-import android.util.Log;
 import android.view.HapticFeedbackConstants;
-import android.view.KeyEvent;
-import android.view.MotionEvent;
 import android.view.View;
-import android.view.View.OnClickListener;
-import android.view.View.OnFocusChangeListener;
-import android.view.View.OnTouchListener;
 import android.view.WindowManager;
 import android.view.inputmethod.InputMethodManager;
-import android.widget.EditText;
 
-import com.crashlytics.android.Crashlytics;
+import org.gnucash.android.ui.util.widget.CalculatorEditText;
 
-import net.objecthunter.exp4j.Expression;
-import net.objecthunter.exp4j.ExpressionBuilder;
-
-import org.gnucash.android.app.GnuCashApplication;
-
-import java.math.BigDecimal;
-import java.math.MathContext;
-import java.text.DecimalFormat;
 import java.text.DecimalFormatSymbols;
-import java.text.NumberFormat;
-import java.util.Currency;
-import java.util.Locale;
 
 
 /**
@@ -138,8 +117,8 @@ public void onKey(int primaryCode, int[] keyCodes) {
                     calculatorEditText.evaluate();
                     break;
                 case 1002:
-                    // FIXME: show the keyboard too
                     calculatorEditText.focusSearch(View.FOCUS_DOWN).requestFocus();
+                    hideCustomKeyboard();
                     break;
             }
         }
diff --git a/app/src/main/java/org/gnucash/android/ui/util/CheckableLinearLayout.java b/app/src/main/java/org/gnucash/android/ui/util/widget/CheckableLinearLayout.java
similarity index 98%
rename from app/src/main/java/org/gnucash/android/ui/util/CheckableLinearLayout.java
rename to app/src/main/java/org/gnucash/android/ui/util/widget/CheckableLinearLayout.java
index 10916365..5230e8be 100644
--- a/app/src/main/java/org/gnucash/android/ui/util/CheckableLinearLayout.java
+++ b/app/src/main/java/org/gnucash/android/ui/util/widget/CheckableLinearLayout.java
@@ -13,7 +13,7 @@
  * See the License for the specific language governing permissions and
  * limitations under the License.
  */
-package org.gnucash.android.ui.util;
+package org.gnucash.android.ui.util.widget;
 
 import android.annotation.TargetApi;
 import android.content.Context;
diff --git a/app/src/main/java/org/gnucash/android/ui/util/EmptyRecyclerView.java b/app/src/main/java/org/gnucash/android/ui/util/widget/EmptyRecyclerView.java
similarity index 98%
rename from app/src/main/java/org/gnucash/android/ui/util/EmptyRecyclerView.java
rename to app/src/main/java/org/gnucash/android/ui/util/widget/EmptyRecyclerView.java
index 9ebaa321..427e15b5 100644
--- a/app/src/main/java/org/gnucash/android/ui/util/EmptyRecyclerView.java
+++ b/app/src/main/java/org/gnucash/android/ui/util/widget/EmptyRecyclerView.java
@@ -13,7 +13,7 @@
  * See the License for the specific language governing permissions and
  * limitations under the License.
  */
-package org.gnucash.android.ui.util;
+package org.gnucash.android.ui.util.widget;
 
 import android.content.Context;
 import android.support.annotation.NonNull;
diff --git a/app/src/main/java/org/gnucash/android/ui/util/ReselectSpinner.java b/app/src/main/java/org/gnucash/android/ui/util/widget/ReselectSpinner.java
similarity index 96%
rename from app/src/main/java/org/gnucash/android/ui/util/ReselectSpinner.java
rename to app/src/main/java/org/gnucash/android/ui/util/widget/ReselectSpinner.java
index c637aecd..dc32ef8b 100644
--- a/app/src/main/java/org/gnucash/android/ui/util/ReselectSpinner.java
+++ b/app/src/main/java/org/gnucash/android/ui/util/widget/ReselectSpinner.java
@@ -1,4 +1,4 @@
-package org.gnucash.android.ui.util;
+package org.gnucash.android.ui.util.widget;
 
 import android.content.Context;
 import android.util.AttributeSet;
diff --git a/app/src/main/java/org/gnucash/android/ui/util/TransactionTypeSwitch.java b/app/src/main/java/org/gnucash/android/ui/util/widget/TransactionTypeSwitch.java
similarity index 98%
rename from app/src/main/java/org/gnucash/android/ui/util/TransactionTypeSwitch.java
rename to app/src/main/java/org/gnucash/android/ui/util/widget/TransactionTypeSwitch.java
index b62b6fd8..ef00ddde 100644
--- a/app/src/main/java/org/gnucash/android/ui/util/TransactionTypeSwitch.java
+++ b/app/src/main/java/org/gnucash/android/ui/util/widget/TransactionTypeSwitch.java
@@ -14,7 +14,7 @@
  * limitations under the License.
  */
 
-package org.gnucash.android.ui.util;
+package org.gnucash.android.ui.util.widget;
 
 import android.content.Context;
 import android.support.v7.widget.SwitchCompat;
@@ -27,7 +27,6 @@
 import org.gnucash.android.model.AccountType;
 import org.gnucash.android.model.Transaction;
 import org.gnucash.android.model.TransactionType;
-import org.gnucash.android.ui.transaction.TransactionFormFragment;
 
 /**
  * A special type of {@link android.widget.ToggleButton} which displays the appropriate CREDIT/DEBIT labels for the
diff --git a/app/src/main/res/layout/activity_reports.xml b/app/src/main/res/layout/activity_reports.xml
index 22c8537f..002ffe6c 100644
--- a/app/src/main/res/layout/activity_reports.xml
+++ b/app/src/main/res/layout/activity_reports.xml
@@ -55,7 +55,8 @@
                     android:layout_height="wrap_content"
                     android:text="Period:"/>
 
-                <org.gnucash.android.ui.util.ReselectSpinner android:id="@+id/time_range_spinner"
+                <org.gnucash.android.ui.util.widget.ReselectSpinner
+                    android:id="@+id/time_range_spinner"
                     android:layout_weight="1.8"
                     android:layout_width="0dp"
                     android:layout_height="wrap_content" />
diff --git a/app/src/main/res/layout/fragment_accounts_list.xml b/app/src/main/res/layout/fragment_accounts_list.xml
index d941dc38..5410bae7 100644
--- a/app/src/main/res/layout/fragment_accounts_list.xml
+++ b/app/src/main/res/layout/fragment_accounts_list.xml
@@ -23,7 +23,7 @@
 
     <!-- TODO: Added account_balance_toolbar.xml layout at some point in the future, if necessary-->
 
-    <org.gnucash.android.ui.util.EmptyRecyclerView
+    <org.gnucash.android.ui.util.widget.EmptyRecyclerView
         android:id="@+id/account_recycler_view"
         android:scrollbars="vertical"
         android:paddingBottom="@dimen/card_min_height"
diff --git a/app/src/main/res/layout/fragment_transaction_form.xml b/app/src/main/res/layout/fragment_transaction_form.xml
index 1f8a6c1f..af4ea364 100644
--- a/app/src/main/res/layout/fragment_transaction_form.xml
+++ b/app/src/main/res/layout/fragment_transaction_form.xml
@@ -55,7 +55,7 @@
                     android:textSize="22dp"
                     android:text="$" />
 
-                <org.gnucash.android.ui.util.CalculatorEditText
+                <org.gnucash.android.ui.util.widget.CalculatorEditText
                     android:id="@+id/input_transaction_amount"
                     android:layout_width="0dp"
                     android:layout_weight="3"
@@ -70,7 +70,7 @@
                     android:textSize="20sp"
                     gnucash:keyboardKeysLayout="@xml/calculator_keyboard"/>
 
-                <org.gnucash.android.ui.util.TransactionTypeSwitch
+                <org.gnucash.android.ui.util.widget.TransactionTypeSwitch
                     android:id="@+id/input_transaction_type"
                     android:layout_width="0dp"
                     android:layout_weight="2"
diff --git a/app/src/main/res/layout/fragment_transactions_list.xml b/app/src/main/res/layout/fragment_transactions_list.xml
index 067f5dc0..360b377e 100644
--- a/app/src/main/res/layout/fragment_transactions_list.xml
+++ b/app/src/main/res/layout/fragment_transactions_list.xml
@@ -21,7 +21,7 @@
     android:layout_height="match_parent"
     android:orientation="vertical">
 
-    <org.gnucash.android.ui.util.EmptyRecyclerView
+    <org.gnucash.android.ui.util.widget.EmptyRecyclerView
         android:id="@+id/transaction_recycler_view"
         android:scrollbars="vertical"
         android:paddingBottom="@dimen/card_min_height"
diff --git a/app/src/main/res/layout/item_split_entry.xml b/app/src/main/res/layout/item_split_entry.xml
index dd62af0f..90fa3815 100644
--- a/app/src/main/res/layout/item_split_entry.xml
+++ b/app/src/main/res/layout/item_split_entry.xml
@@ -36,7 +36,7 @@ limitations under the License.
                 android:textSize="22sp"
                 android:text="$"/>
 
-        <org.gnucash.android.ui.util.CalculatorEditText
+        <org.gnucash.android.ui.util.widget.CalculatorEditText
                 android:id="@+id/input_split_amount"
                 android:layout_width="0dp"
                 android:layout_weight="3"
@@ -51,7 +51,7 @@ limitations under the License.
                 android:background="@android:color/transparent"
                 gnucash:keyboardKeysLayout="@xml/calculator_keyboard" />
 
-        <org.gnucash.android.ui.util.TransactionTypeSwitch
+        <org.gnucash.android.ui.util.widget.TransactionTypeSwitch
             android:id="@+id/btn_split_type"
                       android:layout_width="0dp"
                       android:layout_weight="3"
diff --git a/app/src/main/res/layout/list_item_scheduled_trxn.xml b/app/src/main/res/layout/list_item_scheduled_trxn.xml
index d1e3c595..abb47f83 100644
--- a/app/src/main/res/layout/list_item_scheduled_trxn.xml
+++ b/app/src/main/res/layout/list_item_scheduled_trxn.xml
@@ -15,7 +15,7 @@
  limitations under the License.
 -->
 
-<org.gnucash.android.ui.util.CheckableLinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
+<org.gnucash.android.ui.util.widget.CheckableLinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
                                                    android:layout_width="match_parent"
                                                    android:layout_height="wrap_content"
                                                    style="@style/ListItem"
@@ -74,4 +74,4 @@
             android:textColor="@android:color/black"
             android:text="Amount"/>
     </RelativeLayout>
-</org.gnucash.android.ui.util.CheckableLinearLayout>
\ No newline at end of file
+</org.gnucash.android.ui.util.widget.CheckableLinearLayout>
\ No newline at end of file
diff --git a/app/src/main/res/values-de/strings.xml b/app/src/main/res/values-de/strings.xml
index f9dfe278..12964b5c 100644
--- a/app/src/main/res/values-de/strings.xml
+++ b/app/src/main/res/values-de/strings.xml
@@ -525,6 +525,10 @@ No user-identifiable information will be collected as part of this process!</str
 	<string name="title_split_editor">Split Editor</string>
 	<string name="toast_error_check_split_amounts">Check that all splits have valid amounts before saving!</string>
 	<string name="label_error_invalid_expression">Invalid expression!</string>
+	<string name="toast_scheduled_recurring_transaction">Scheduled recurring transaction</string>
+	<string name="error_exchange_rate_required">An exchange rate is required</string>
+	<string name="error_converted_amount_required">The converted amount is required</string>
+	<string name="title_transfer_funds">Transfer Funds</string>
 	<string-array name="report_time_range">
 		<item>All time</item>
 		<item>Current month</item>
diff --git a/app/src/main/res/values-el/strings.xml b/app/src/main/res/values-el/strings.xml
index f0b3c756..c5b0c79a 100644
--- a/app/src/main/res/values-el/strings.xml
+++ b/app/src/main/res/values-el/strings.xml
@@ -544,6 +544,10 @@ No user-identifiable information will be collected as part of this process!
 	<string name="title_split_editor">Split Editor</string>
 	<string name="toast_error_check_split_amounts">Check that all splits have valid amounts before saving!</string>
 	<string name="label_error_invalid_expression">Invalid expression!</string>
+	<string name="toast_scheduled_recurring_transaction">Scheduled recurring transaction</string>
+	<string name="error_exchange_rate_required">An exchange rate is required</string>
+	<string name="error_converted_amount_required">The converted amount is required</string>
+	<string name="title_transfer_funds">Transfer Funds</string>
 	<string-array name="report_time_range">
 		<item>All time</item>
 		<item>Current month</item>
diff --git a/app/src/main/res/values-es-rMX/strings.xml b/app/src/main/res/values-es-rMX/strings.xml
index f404e9ae..254e8096 100644
--- a/app/src/main/res/values-es-rMX/strings.xml
+++ b/app/src/main/res/values-es-rMX/strings.xml
@@ -529,6 +529,10 @@ No user-identifiable information will be collected as part of this process!
     <string name="title_split_editor">Split Editor</string>
     <string name="toast_error_check_split_amounts">Check that all splits have valid amounts before saving!</string>
     <string name="label_error_invalid_expression">Invalid expression!</string>
+    <string name="toast_scheduled_recurring_transaction">Scheduled recurring transaction</string>
+    <string name="error_exchange_rate_required">An exchange rate is required</string>
+    <string name="error_converted_amount_required">The converted amount is required</string>
+    <string name="title_transfer_funds">Transfer Funds</string>
     <string-array name="report_time_range">
         <item>All time</item>
         <item>Current month</item>
diff --git a/app/src/main/res/values-es/strings.xml b/app/src/main/res/values-es/strings.xml
index b34dfd98..8d4dd9c1 100644
--- a/app/src/main/res/values-es/strings.xml
+++ b/app/src/main/res/values-es/strings.xml
@@ -526,6 +526,10 @@ Este proceso solo recoge informaci&#243;n que no permite identificar al usuario<
 	<string name="title_split_editor">Split Editor</string>
 	<string name="toast_error_check_split_amounts">Check that all splits have valid amounts before saving!</string>
 	<string name="label_error_invalid_expression">Invalid expression!</string>
+	<string name="toast_scheduled_recurring_transaction">Scheduled recurring transaction</string>
+	<string name="error_exchange_rate_required">An exchange rate is required</string>
+	<string name="error_converted_amount_required">The converted amount is required</string>
+	<string name="title_transfer_funds">Transfer Funds</string>
 	<string-array name="report_time_range">
 		<item>All time</item>
 		<item>Current month</item>
diff --git a/app/src/main/res/values-fr/strings.xml b/app/src/main/res/values-fr/strings.xml
index 2352b886..715f7713 100644
--- a/app/src/main/res/values-fr/strings.xml
+++ b/app/src/main/res/values-fr/strings.xml
@@ -526,6 +526,10 @@ Aucune information permettant d\'identifier l\'utilisateur ne sera recueillis da
     <string name="title_split_editor">Split Editor</string>
     <string name="toast_error_check_split_amounts">Check that all splits have valid amounts before saving!</string>
     <string name="label_error_invalid_expression">Invalid expression!</string>
+    <string name="toast_scheduled_recurring_transaction">Scheduled recurring transaction</string>
+    <string name="error_exchange_rate_required">An exchange rate is required</string>
+    <string name="error_converted_amount_required">The converted amount is required</string>
+    <string name="title_transfer_funds">Transfer Funds</string>
     <string-array name="report_time_range">
         <item>All time</item>
         <item>Current month</item>
diff --git a/app/src/main/res/values-hu/strings.xml b/app/src/main/res/values-hu/strings.xml
index fbaad1e9..7f5197dc 100644
--- a/app/src/main/res/values-hu/strings.xml
+++ b/app/src/main/res/values-hu/strings.xml
@@ -530,6 +530,10 @@ No user-identifiable information will be collected as part of this process!
     <string name="title_split_editor">Split Editor</string>
     <string name="toast_error_check_split_amounts">Check that all splits have valid amounts before saving!</string>
     <string name="label_error_invalid_expression">Invalid expression!</string>
+    <string name="toast_scheduled_recurring_transaction">Scheduled recurring transaction</string>
+    <string name="error_exchange_rate_required">An exchange rate is required</string>
+    <string name="error_converted_amount_required">The converted amount is required</string>
+    <string name="title_transfer_funds">Transfer Funds</string>
     <string-array name="report_time_range">
         <item>All time</item>
         <item>Current month</item>
diff --git a/app/src/main/res/values-it/strings.xml b/app/src/main/res/values-it/strings.xml
index 9741d433..35c99c91 100644
--- a/app/src/main/res/values-it/strings.xml
+++ b/app/src/main/res/values-it/strings.xml
@@ -530,6 +530,10 @@ No user-identifiable information will be collected as part of this process!
     <string name="title_split_editor">Split Editor</string>
     <string name="toast_error_check_split_amounts">Check that all splits have valid amounts before saving!</string>
     <string name="label_error_invalid_expression">Invalid expression!</string>
+    <string name="toast_scheduled_recurring_transaction">Scheduled recurring transaction</string>
+    <string name="error_exchange_rate_required">An exchange rate is required</string>
+    <string name="error_converted_amount_required">The converted amount is required</string>
+    <string name="title_transfer_funds">Transfer Funds</string>
     <string-array name="report_time_range">
         <item>All time</item>
         <item>Current month</item>
diff --git a/app/src/main/res/values-nb/strings.xml b/app/src/main/res/values-nb/strings.xml
index f5e39ad5..bd8e60f1 100644
--- a/app/src/main/res/values-nb/strings.xml
+++ b/app/src/main/res/values-nb/strings.xml
@@ -527,6 +527,10 @@ Ingen brukerinformasjon vil bli delt i denne prosessen!
 	<string name="title_split_editor">Split Editor</string>
 	<string name="toast_error_check_split_amounts">Check that all splits have valid amounts before saving!</string>
 	<string name="label_error_invalid_expression">Invalid expression!</string>
+	<string name="toast_scheduled_recurring_transaction">Scheduled recurring transaction</string>
+	<string name="error_exchange_rate_required">An exchange rate is required</string>
+	<string name="error_converted_amount_required">The converted amount is required</string>
+	<string name="title_transfer_funds">Transfer Funds</string>
 	<string-array name="report_time_range">
 		<item>All time</item>
 		<item>Current month</item>
diff --git a/app/src/main/res/values-nl/strings.xml b/app/src/main/res/values-nl/strings.xml
index f6851116..16e92880 100644
--- a/app/src/main/res/values-nl/strings.xml
+++ b/app/src/main/res/values-nl/strings.xml
@@ -531,6 +531,10 @@ No user-identifiable information will be collected as part of this process!
     <string name="title_split_editor">Split Editor</string>
     <string name="toast_error_check_split_amounts">Check that all splits have valid amounts before saving!</string>
     <string name="label_error_invalid_expression">Invalid expression!</string>
+    <string name="toast_scheduled_recurring_transaction">Scheduled recurring transaction</string>
+    <string name="error_exchange_rate_required">An exchange rate is required</string>
+    <string name="error_converted_amount_required">The converted amount is required</string>
+    <string name="title_transfer_funds">Transfer Funds</string>
     <string-array name="report_time_range">
         <item>All time</item>
         <item>Current month</item>
diff --git a/app/src/main/res/values-pl/strings.xml b/app/src/main/res/values-pl/strings.xml
index befb9f28..5826f348 100644
--- a/app/src/main/res/values-pl/strings.xml
+++ b/app/src/main/res/values-pl/strings.xml
@@ -527,6 +527,10 @@
     <string name="title_split_editor">Split Editor</string>
     <string name="toast_error_check_split_amounts">Check that all splits have valid amounts before saving!</string>
     <string name="label_error_invalid_expression">Invalid expression!</string>
+    <string name="toast_scheduled_recurring_transaction">Scheduled recurring transaction</string>
+    <string name="error_exchange_rate_required">An exchange rate is required</string>
+    <string name="error_converted_amount_required">The converted amount is required</string>
+    <string name="title_transfer_funds">Transfer Funds</string>
     <string-array name="report_time_range">
         <item>All time</item>
         <item>Current month</item>
diff --git a/app/src/main/res/values-pt-rBR/strings.xml b/app/src/main/res/values-pt-rBR/strings.xml
index 08829950..2fc39b6e 100644
--- a/app/src/main/res/values-pt-rBR/strings.xml
+++ b/app/src/main/res/values-pt-rBR/strings.xml
@@ -529,6 +529,10 @@ Nenhuma informao de  identificao do usurio ser coletada neste proces
 	<string name="title_split_editor">Split Editor</string>
 	<string name="toast_error_check_split_amounts">Check that all splits have valid amounts before saving!</string>
 	<string name="label_error_invalid_expression">Invalid expression!</string>
+	<string name="toast_scheduled_recurring_transaction">Scheduled recurring transaction</string>
+	<string name="error_exchange_rate_required">An exchange rate is required</string>
+	<string name="error_converted_amount_required">The converted amount is required</string>
+	<string name="title_transfer_funds">Transfer Funds</string>
 	<string-array name="report_time_range">
 		<item>All time</item>
 		<item>Current month</item>
diff --git a/app/src/main/res/values-ru/strings.xml b/app/src/main/res/values-ru/strings.xml
index 0602b1e8..a2c4e6a9 100644
--- a/app/src/main/res/values-ru/strings.xml
+++ b/app/src/main/res/values-ru/strings.xml
@@ -533,6 +533,10 @@
     <string name="title_split_editor">Split Editor</string>
     <string name="toast_error_check_split_amounts">Check that all splits have valid amounts before saving!</string>
     <string name="label_error_invalid_expression">Invalid expression!</string>
+    <string name="toast_scheduled_recurring_transaction">Scheduled recurring transaction</string>
+    <string name="error_exchange_rate_required">An exchange rate is required</string>
+    <string name="error_converted_amount_required">The converted amount is required</string>
+    <string name="title_transfer_funds">Transfer Funds</string>
     <string-array name="report_time_range">
         <item>All time</item>
         <item>Current month</item>
diff --git a/app/src/main/res/values-uk/strings.xml b/app/src/main/res/values-uk/strings.xml
index a5d4774b..009f413f 100644
--- a/app/src/main/res/values-uk/strings.xml
+++ b/app/src/main/res/values-uk/strings.xml
@@ -513,6 +513,10 @@
     <string name="title_split_editor">Split Editor</string>
     <string name="toast_error_check_split_amounts">Check that all splits have valid amounts before saving!</string>
     <string name="label_error_invalid_expression">Invalid expression!</string>
+    <string name="toast_scheduled_recurring_transaction">Scheduled recurring transaction</string>
+    <string name="error_exchange_rate_required">An exchange rate is required</string>
+    <string name="error_converted_amount_required">The converted amount is required</string>
+    <string name="title_transfer_funds">Transfer Funds</string>
     <string-array name="report_time_range">
         <item>All time</item>
         <item>Current month</item>
diff --git a/app/src/main/res/values-zh-rTW/strings.xml b/app/src/main/res/values-zh-rTW/strings.xml
index 0ae2ec21..bd8bb209 100644
--- a/app/src/main/res/values-zh-rTW/strings.xml
+++ b/app/src/main/res/values-zh-rTW/strings.xml
@@ -527,6 +527,10 @@ No user-identifiable information will be collected as part of this process!
     <string name="title_split_editor">Split Editor</string>
     <string name="toast_error_check_split_amounts">Check that all splits have valid amounts before saving!</string>
     <string name="label_error_invalid_expression">Invalid expression!</string>
+    <string name="toast_scheduled_recurring_transaction">Scheduled recurring transaction</string>
+    <string name="error_exchange_rate_required">An exchange rate is required</string>
+    <string name="error_converted_amount_required">The converted amount is required</string>
+    <string name="title_transfer_funds">Transfer Funds</string>
     <string-array name="report_time_range">
         <item>All time</item>
         <item>Current month</item>
diff --git a/app/src/main/res/values-zh/strings.xml b/app/src/main/res/values-zh/strings.xml
index e3bd69e1..1eb4cda0 100644
--- a/app/src/main/res/values-zh/strings.xml
+++ b/app/src/main/res/values-zh/strings.xml
@@ -528,6 +528,10 @@ No user-identifiable information will be collected as part of this process!
     <string name="title_split_editor">Split Editor</string>
     <string name="toast_error_check_split_amounts">Check that all splits have valid amounts before saving!</string>
     <string name="label_error_invalid_expression">Invalid expression!</string>
+    <string name="toast_scheduled_recurring_transaction">Scheduled recurring transaction</string>
+    <string name="error_exchange_rate_required">An exchange rate is required</string>
+    <string name="error_converted_amount_required">The converted amount is required</string>
+    <string name="title_transfer_funds">Transfer Funds</string>
     <string-array name="report_time_range">
         <item>All time</item>
         <item>Current month</item>
diff --git a/app/src/main/res/values/strings.xml b/app/src/main/res/values/strings.xml
index f1fb700a..10990a31 100644
--- a/app/src/main/res/values/strings.xml
+++ b/app/src/main/res/values/strings.xml
@@ -533,6 +533,10 @@
     <string name="title_split_editor">Split Editor</string>
     <string name="toast_error_check_split_amounts">Check that all splits have valid amounts before saving!</string>
     <string name="label_error_invalid_expression">Invalid expression!</string>
+    <string name="toast_scheduled_recurring_transaction">Scheduled recurring transaction</string>
+    <string name="error_exchange_rate_required">An exchange rate is required</string>
+    <string name="error_converted_amount_required">The converted amount is required</string>
+    <string name="title_transfer_funds">Transfer Funds</string>
     <string-array name="report_time_range">
         <item>All time</item>
         <item>Current month</item>
diff --git a/app/src/main/res/xml-land/calculator_keyboard.xml b/app/src/main/res/xml-land/calculator_keyboard.xml
index 07259449..7b97137d 100644
--- a/app/src/main/res/xml-land/calculator_keyboard.xml
+++ b/app/src/main/res/xml-land/calculator_keyboard.xml
@@ -1,5 +1,20 @@
 <?xml version="1.0" encoding="utf-8"?>
-<!-- FIXME: make locale independent -->
+<!--
+ Copyright (c) 2015 lex Magaz Graa <rivaldi8@gmail.com>
+ Copyright (c) 2015 Ngewi Fet <ngewif@gmail.com>
+
+ Licensed under the Apache License, Version 2.0 (the "License");
+ you may not use this file except in compliance with the License.
+ You may obtain a copy of the License at
+
+    http://www.apache.org/licenses/LICENSE-2.0
+
+ Unless required by applicable law or agreed to in writing, software
+ distributed under the License is distributed on an "AS IS" BASIS,
+ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ See the License for the specific language governing permissions and
+ limitations under the License.
+-->
 <Keyboard xmlns:android="http://schemas.android.com/apk/res/android"
     android:keyWidth="25%p"
     android:keyHeight="15%p">
diff --git a/app/src/main/res/xml/calculator_keyboard.xml b/app/src/main/res/xml/calculator_keyboard.xml
index 55699bd6..8270c9a6 100644
--- a/app/src/main/res/xml/calculator_keyboard.xml
+++ b/app/src/main/res/xml/calculator_keyboard.xml
@@ -1,5 +1,20 @@
 <?xml version="1.0" encoding="utf-8"?>
-<!-- FIXME: make locale independent -->
+<!--
+ Copyright (c) 2015 lex Magaz Graa <rivaldi8@gmail.com>
+ Copyright (c) 2012 Ngewi Fet <ngewif@gmail.com>
+
+ Licensed under the Apache License, Version 2.0 (the "License");
+ you may not use this file except in compliance with the License.
+ You may obtain a copy of the License at
+
+    http://www.apache.org/licenses/LICENSE-2.0
+
+ Unless required by applicable law or agreed to in writing, software
+ distributed under the License is distributed on an "AS IS" BASIS,
+ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ See the License for the specific language governing permissions and
+ limitations under the License.
+-->
 <Keyboard xmlns:android="http://schemas.android.com/apk/res/android"
     android:keyWidth="20%p"
     android:keyHeight="10%p">
diff --git a/app/src/main/res/xml/transaction_appwidget_info.xml b/app/src/main/res/xml/transaction_appwidget_info.xml
index b37f7451..89e7141d 100644
--- a/app/src/main/res/xml/transaction_appwidget_info.xml
+++ b/app/src/main/res/xml/transaction_appwidget_info.xml
@@ -21,6 +21,6 @@
     android:updatePeriodMillis="86400000"
     android:previewImage="@drawable/widget_preview"
     android:initialLayout="@layout/widget_4x1"
-    android:configure="org.gnucash.android.ui.widget.WidgetConfigurationActivity"
+    android:configure="org.gnucash.android.ui.homescreen.WidgetConfigurationActivity"
     android:resizeMode="horizontal">    
 </appwidget-provider>
\ No newline at end of file
