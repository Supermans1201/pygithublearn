From 7bc13b39ca0cd0e06b527d72c22a3cc9862509e2 Mon Sep 17 00:00:00 2001
From: Yongxin Wang <fefe.wyx@gmail.com>
Date: Sat, 11 Apr 2015 13:25:35 +0800
Subject: [PATCH] fix: template currency, double import

---
 .gitignore                                            |  4 +++-
 .../org/gnucash/android/importer/GncXmlHandler.java   |  2 ++
 .../gnucash/android/ui/account/AccountsActivity.java  | 19 -------------------
 3 files changed, 5 insertions(+), 20 deletions(-)

diff --git a/.gitignore b/.gitignore
index 40af9d3c..591a9a22 100644
--- a/.gitignore
+++ b/.gitignore
@@ -18,4 +18,6 @@ gen-external-apklibs
 *.iws
 out/
 *.project
-*.classpath
\ No newline at end of file
+*.classpath
+# cpu profile generated by Android Studio
+/captures
\ No newline at end of file
diff --git a/app/src/main/java/org/gnucash/android/importer/GncXmlHandler.java b/app/src/main/java/org/gnucash/android/importer/GncXmlHandler.java
index 76a9356d..72611573 100644
--- a/app/src/main/java/org/gnucash/android/importer/GncXmlHandler.java
+++ b/app/src/main/java/org/gnucash/android/importer/GncXmlHandler.java
@@ -192,10 +192,12 @@ public void startElement(String uri, String localName,
         switch (qualifiedName.toLowerCase()){
             case GncXmlHelper.TAG_ACCOUNT:
                 mAccount = new Account(""); // dummy name, will be replaced when we find name tag
+                mISO4217Currency = false;
                 break;
             case GncXmlHelper.TAG_TRANSACTION:
                 mTransaction = new Transaction(""); // dummy name will be replaced
                 mTransaction.setExported(true);     // default to exported when import transactions
+                mISO4217Currency = false;
                 break;
             case GncXmlHelper.TAG_TRN_SPLIT:
                 mSplit = new Split(Money.getZeroInstance(),"");
diff --git a/app/src/main/java/org/gnucash/android/ui/account/AccountsActivity.java b/app/src/main/java/org/gnucash/android/ui/account/AccountsActivity.java
index 985d0d05..87dd87e1 100644
--- a/app/src/main/java/org/gnucash/android/ui/account/AccountsActivity.java
+++ b/app/src/main/java/org/gnucash/android/ui/account/AccountsActivity.java
@@ -555,25 +555,6 @@ public void importAccounts() {
 
     }
 
-    @Override
-    protected void onActivityResult(int requestCode, int resultCode, Intent data) {
-        super.onActivityResult(requestCode, resultCode, data);
-        if (resultCode == RESULT_CANCELED){
-            return;
-        }
-
-        switch (requestCode){
-            case REQUEST_PICK_ACCOUNTS_FILE:
-                try {
-                    InputStream accountInputStream = getContentResolver().openInputStream(data.getData());
-                    new ImportAsyncTask(this).execute(accountInputStream);
-                } catch (FileNotFoundException e) {
-                    e.printStackTrace();
-                }
-                break;
-        }
-    }
-
     /**
      * Starts the AccountsActivity and clears the activity stack
      * @param context Application context
