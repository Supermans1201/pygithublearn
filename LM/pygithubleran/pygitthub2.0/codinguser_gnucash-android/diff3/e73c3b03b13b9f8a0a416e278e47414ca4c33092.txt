From e73c3b03b13b9f8a0a416e278e47414ca4c33092 Mon Sep 17 00:00:00 2001
From: Ngewi Fet <ngewif@gmail.com>
Date: Fri, 20 Jul 2012 13:13:29 +0200
Subject: [PATCH] Implemented SettingsActivity Fixed: OFX exported always used
 the default currency Can now set a default currency for accounts Now lists
 all world currencies in ISO 4217 Removed currencies from database, save them
 now as resources (allows for internationalization) Blocked moving transaction
 between accounts with different currencies

---
 GnucashMobile/AndroidManifest.xml                  |   1 +
 .../res/drawable-hdpi/action_about_holo_light.png  | Bin 0 -> 1764 bytes
 .../drawable-hdpi/action_settings_holo_light.png   | Bin 0 -> 1505 bytes
 .../res/drawable-mdpi/action_about_holo_light.png  | Bin 0 -> 1441 bytes
 .../drawable-mdpi/action_settings_holo_light.png   | Bin 0 -> 1358 bytes
 .../res/drawable-xhdpi/action_about_holo_light.png | Bin 0 -> 2257 bytes
 .../drawable-xhdpi/action_settings_holo_light.png  | Bin 0 -> 1671 bytes
 GnucashMobile/res/values/strings.xml               | 365 ++++++++++++++++++++-
 .../res/xml/fragment_about_preferences.xml         |   5 +
 .../res/xml/fragment_general_preferences.xml       |   6 +
 GnucashMobile/res/xml/preference_headers.xml       |   9 +
 .../src/org/gnucash/android/data/Account.java      |   3 +-
 .../src/org/gnucash/android/data/Money.java        |   4 +-
 .../org/gnucash/android/db/CurrencyDbAdapter.java  |  62 ----
 .../src/org/gnucash/android/db/DatabaseHelper.java |  73 +----
 .../src/org/gnucash/android/ui/MainActivity.java   |  34 +-
 .../android/ui/accounts/AccountsListFragment.java  |   9 +-
 .../ui/accounts/NewAccountDialogFragment.java      |  49 ++-
 .../android/ui/settings/SettingsActivity.java      |  76 +++++
 .../ui/transactions/BulkMoveDialogFragment.java    |  12 +-
 .../ui/transactions/NewTransactionFragment.java    |   4 +-
 .../ui/transactions/TransactionsListFragment.java  |   3 +
 .../src/org/gnucash/android/util/OfxFormatter.java |   3 +-
 .../android/test/TransactionsFragmentTest.java     |   6 +-
 24 files changed, 548 insertions(+), 176 deletions(-)
 create mode 100644 GnucashMobile/res/drawable-hdpi/action_about_holo_light.png
 create mode 100644 GnucashMobile/res/drawable-hdpi/action_settings_holo_light.png
 create mode 100644 GnucashMobile/res/drawable-mdpi/action_about_holo_light.png
 create mode 100644 GnucashMobile/res/drawable-mdpi/action_settings_holo_light.png
 create mode 100644 GnucashMobile/res/drawable-xhdpi/action_about_holo_light.png
 create mode 100644 GnucashMobile/res/drawable-xhdpi/action_settings_holo_light.png
 create mode 100644 GnucashMobile/res/xml/fragment_about_preferences.xml
 create mode 100644 GnucashMobile/res/xml/fragment_general_preferences.xml
 create mode 100644 GnucashMobile/res/xml/preference_headers.xml
 delete mode 100644 GnucashMobile/src/org/gnucash/android/db/CurrencyDbAdapter.java
 create mode 100644 GnucashMobile/src/org/gnucash/android/ui/settings/SettingsActivity.java

diff --git a/GnucashMobile/AndroidManifest.xml b/GnucashMobile/AndroidManifest.xml
index 2f3d9c90..c8bbae1b 100644
--- a/GnucashMobile/AndroidManifest.xml
+++ b/GnucashMobile/AndroidManifest.xml
@@ -45,6 +45,7 @@
                 <category android:name="android.intent.category.LAUNCHER" />
             </intent-filter>
         </activity>
+        <activity android:name=".ui.settings.SettingsActivity"></activity>
     </application>
 
 </manifest>
\ No newline at end of file
diff --git a/GnucashMobile/res/drawable-hdpi/action_about_holo_light.png b/GnucashMobile/res/drawable-hdpi/action_about_holo_light.png
new file mode 100644
index 0000000000000000000000000000000000000000..8f39c428ac6cacd0ad4fd9e7ab4252a77ce91a53
GIT binary patch
literal 1764
zcmaJ?X;2eq7!F0za*QByiN{V56ohOx2O)t#fg~6p2!TRSYh98JNg>%BOA;)tBa9k|
z9j`Lrg(DzZ$67$N7MO|x3d${t##%eHf>taPPz$2%1_Aq{bZ2(I?|bKcp7(mb+5Gsp
zC<oi+wgdvffxm$x#8<NAU2KDYQ$Cp3gD)N!SA->^QcMqP5JI>FO+x^_0!~MS2rS7~
zw;~|~g7q4Ck_ZzCVp(ETL4qwlB!fbQqX~qNFoOyfXCN4mhNR1tY~pa;6(S&)u!$*j
z0a>7mL}c;}+ciky_P8YR_6#voLJSK9LJTaNK!IQ|U{GW#wJZahIL*t#_ZBlq1g2fE
z3^wsyQX)Y-5Q%CKfKDO@h{=Hv5J)3IG%}OM^am(phzvp$kjw~x$SgX8MTUTxhloeh
zNTe(whc^=oKe3523{$Z{P_NgM^i&e6Ne3Y&lL?Y3AcYcudjx2+l^ARYP-?wq890bm
ztdXlQIjRIKjBpy7g|UfvrteBnsOD&u+L<=t4Fe6Z3WP{xOG&ei0>S^gDim|xT1<$%
z&-XuxwMp431Qa4#G)p7K2PgHigi^60H3*EMnj{p>ob6(~48>5b3{?S<iF6VK2w<^X
zX|YTr1OgUcsl{NW7~yl+M4W>pmrGbw9y0<84`R?G$Q%gbLQERO<kBJ{!+CUwL5qN9
zu^d#Kr9hO}ELQR!8#FK0A_j#DkIX?davdV!X;1|)T{KHRe=hWS`DU<^`Ev=J7YpLa
zfR@qzYt*wQTtAlWoN)2Oob(YTu6GSC>^O7T6n<Zl`JC`1gL$YpA!b>E`|k9tzH)zO
zYBkUjeP%&pAjG$=wYB5d+u2T9eexpl_lomNYd<b8_pGZdT@%>aRdBP^?oc$9%6WM4
zIeWz3-tJl3P@BKa*wwtey21Lf682#5U`~EcDEg-JfYG7JCe6BP=e>{0ZF-*8oOr7<
zS(hgC=0Bg>!S^?&{+XKd$_)D)x<4`|S)3Q|8)uADi!xpANL98!rt?1I`kR*YA2#^j
z%`+~dt76BE(gg3f6!WLej1oa_flUIaGwRe^>fIvK&i-WM*W|4(>F&ta54gE~cbJ&5
zP;s_+Q&cm*yXnHj>v($#;eaPO@i*H<pR2Mk$4;&;Pj|h`&E4sA)56#nBX%#S%|vQ^
z>n%N`Z#O=2)`q@@c&kl}eoDp}Q|BLlrMkI<?)uz4+l%a{EF2l_C@$NVFge6&EV$O-
z)ZJd=;if<Qy1Dd7v$;cC)zaM;^o736<?PO{pSWypd8`D{(v4g8gcc2(eWcw_xKx_;
zx8>1Z*a<;vz{^UhU$)M)aI)j%o#hofZ|`kc3k_6#)k;I*Ch<{-CY0?yxT|eIYg}<$
z%`faQG?#3fXc<nW9qFc-$HE;}ETi}DD;}?U(pmMuEM1kI$;eN3Fz<9262tA4E%n#G
zr0mZ>5o&H9?GeZpZM6>OqhUF*tAj6`i|B}|^WXGgjkRaxz9thAG61^D_FQsCYe&)=
zve%GOdR=9UC?lp@8}j-dLfgu_ZkDaQ*I;i~RZ@obb{p^d;W1)^M>R1X_BBB-k3S{b
z7ayBCFkInP!t<s1bsbx>-j3}ZcC`IeV^nVC67AM3R#!`@hZ$Dp+Fic?11O}ZO)k|f
zOFNYbQIGgFKG*7nN1Qwy86rtav!H0DZvU@UkKwg(J?UO1eZ#Z!!|7hs8~t$4X3t!H
zQOp$OT()5%aB>xI{lS<wj&~SZtFXvR>mCcy8>Abjem+;YR>ny#6rCQ2)m9s|Y2(6V
z-?qSx>gbZ9;a8i#S$~Qosc2Hf?X9T1n6kw=J!V~|cj_<RZkKXh^`=7C_K7PZx!UtK
z(moo$X>aZ2U@pI^^74Zw#Z3>L`qlRr^9$-;)*7r%7WG+gJlVd=BJ4~c(9v`8vcDI&
Y6RKUD#(0B`J1qYlJ~xhYK4M$$KMBsYYybcN

literal 0
HcmV?d00001

diff --git a/GnucashMobile/res/drawable-hdpi/action_settings_holo_light.png b/GnucashMobile/res/drawable-hdpi/action_settings_holo_light.png
new file mode 100644
index 0000000000000000000000000000000000000000..cc32e2d1d2f1838fd2ce1c35dbdeff740957c5a3
GIT binary patch
literal 1505
zcmeAS@N?(olHy`uVBq!ia0vp^1|ZDA1|-9oezpTC$r9IylHmNblJdl&R0hYC{G?O`
z&)mfH)S%SFl*+=BsWuD@%qp275hW46K32*3xq68pHF_1f1wh>l3^w)^1&PVosU-?Y
zsp*+{wo31J?^jaDOtDo8H}y5}EpSfF$n>ZxN)4{^3rViZPPR-@vbR&PsjvbXkegbP
zs8ErclUHn2VXFi-*9yo63F|8<fR&VF+bTgE72zA8;GAESs$i;Tpqp%9W~g9hqGxDg
zU}<8hqhMrUXrOOsq;FuZYiM9)YHnp<r~m~@K--E^(yW49+@N*=dA3R!B_#z``ugSN
z<$C4Ddih1^`i7R4mih)p`bI{&Koz>hm3bwJ6}oxF$}kgLQj3#|G7CyF^YauyCMG83
zmzLNn0bL65LT&-v*t}wBFaZNhzap_f-%!s0<RzFwUtj!6b93RUi%Wu15$?rmaB)aw
zL8^XGYH@yPQ8F;%(v(3~6<9eJr6!i-7lq{K=fFZSAS1sdzc?emK*2fKRL@YsH!(Rg
z4<rKC;p=PVnO9trn3tUD>0+w{G(#^lGsVip(89^o)XdP-$-u?X(ACh=#L&{!#L3yw
z&D7A`#K{n**Cju>G&eP`1g19yq1OnfUQlAlEdbi=l3J8mmYU*Ll%J~r_Ow+dR<{^f
zm>U^7<1`PdHwCv_3~=hz2RcR{6tzfE4HE*U9}p9saDg0n(of9;ruQOX!amqpu$F;=
zDcIA+F{I+wo2b)XhaE(GFR^Rcz3>uW`j<s~n%<GR_6OlR3YT`jWBsVja-Fr_QRl7G
z{sT=5VyE5;^3Ile|3H_gP;IAg+9jT6hZYJL&8$v)cV>>|m2WoZjVxtOe>lOB!jj|`
z_hm!a>X+}z<pbEKFfcnvU*ONa^0Fj@MabiyOaP<K1};Aaa}l9TjfKh%q6Ta}AGY@x
zCmoSG@$kgwhe?)_dpm4XyCssiH?VIIRsZ4V@x{Sl!<w@K-hD0)1Pa(RxRzPJ@;T2C
z-jILNnp<Z*_W{0XqW8b?eeh5{U}tt*GQc&#PiL~_p|4wG*91A`9Im|>@I0Qe)@nvc
zaL}&Jp&UDI%<SWc4i644SG3N`Rg+z};J%C(SL*E*X12^1Sxr8ed@FcTeZ$U>Ny)aD
zXNT&97murbf<y}1U%Fj%EabRi_|x$Fnl4XUfm`1@-)BZMtLDxBChy`FlM(co<q5M$
za^R#NQyg-Fo!1#3T;t8TLHp)Pe{RDd<pZe=dlIbD#r=b?TD_9{@WuY!5yq$!lVx1~
ze77r{Rx)KmnQlt)BHgRIC(NBD)a8|+aO1P=MZJydOa;Vpw>X`eGv&oXl?7fCw|aHj
z{jvx=awo|BW70auD}i2DHD0d~JuEI&cwWmwV(pS^4$rt>errvM@;JKGPUm88gLkct
z?h>c-CY<{Mf*)~nZVi}lG|*v%(gQ*M1F8G_*00^{#c9hNr~CEVqX`eVW21|*C;B8L
zan_t@c{92HjJVNB@hJ92y;sX}Utd3#zCYjdw^L!#OK#VTf%UKTey?_PQ&3JQ`@><t
YFmvmIU-Qd-zJUr|Pgg&ebxsLQ0Gu%+Qvd(}

literal 0
HcmV?d00001

diff --git a/GnucashMobile/res/drawable-mdpi/action_about_holo_light.png b/GnucashMobile/res/drawable-mdpi/action_about_holo_light.png
new file mode 100644
index 0000000000000000000000000000000000000000..7c57436fc57705e300e32dfb04a13508b47ec534
GIT binary patch
literal 1441
zcmeAS@N?(olHy`uVBq!ia0vp^3LwnE1|*BCs=fdz$r9IylHmNblJdl&R0hYC{G?O`
z&)mfH)S%SFl*+=BsWuD@%qp275hW46K32*3xq68pHF_1f1wh>l3^w)^1&PVosU-?Y
zsp*+{wo31J?^jaDOtDo8H}y5}EpSfF$n>ZxN)4{^3rViZPPR-@vbR&PsjvbXkegbP
zs8ErclUHn2VXFi-*9yo63F|8<fR&VF+bTgE72zA8;GAESs$i;Tpqp%9W~g9hqGxDg
zU}<8hqhMrUXrOOsq;FuZYiM9)YHnp<r~m~@K--E^(yW49+@N*=dA3R!B_#z``ugSN
z<$C4Ddih1^`i7R4mih)p`bI{&Koz>hm3bwJ6}oxF$}kgLQj3#|G7CyF^YauyCMG83
zmzLNn0bL65LT&-v*t}wBFaZNhzap_f-%!s0<RzFwUtj!6b93RUi%Wu15$?rmaB)aw
zL8^XGYH@yPQ8F;%(v(3~6<9eJr6!i-7lq{K=fFZSAS1sdzc?emK*2fKRL@YsH!(Rg
z4<rKC;p=PVnO9trn3tUD>0+w{G(#^lGsVipz|h&;z{1hg$-u?X(ACh=#L&{!#L3yw
z&D7A`#K{n**Cju>G&eP`1g19yq1OqgUQlAlEdbi=l3J8mmYU*Ll%J~r_Ow+dZns$A
zG!Lpb1-Dx)aq86vIz}H9wMbD769T3m5EGtofgE_!Pt60S_ab1z&J?}i!@$5K?CIhd
zQgQ3e^xa;}fdXxl1)Mn8_9%ShY7$G5)sN`dtFNG?R2G(%D*A!<iqqweB^y4lZrQ-4
zdBkIb;1x9m34O;a2?|;+*Z&`ox6ny9-~IZO(vt)1r{~SQX<w{o{4smhv(H5=HFEuJ
z4Ch%{LiHbitgxLQcY*WPk9U$b4bcInMQ5HCU1O2x;h4c9yrBK&?*}mwHO)*X8cbGL
zoNGwpX=J^?zV0C7iRSQg+Zz}Se5@5sSoQ7-7_d!qkj!Zc{ufng)1+PC@mq2O+oUb!
zItdfx_cKQ?h&Ud{VVzhu?PYY*wVe4(8=rOmc`Du2-+n-Z^X0RyFPg?~M>-ok*Zs7s
z2s%^VP<d(LjQU0S^2s-&niR@+d)%Gb*lSU?`_ksDIfiW=rE9Dfxk<iIj6B*l*|l!s
zf|K)3czx7KU(o&NlbZJxmb9NWjQ4ooeCkn6x)&jO;gt8X6eWkrdP<vT#Vv|`y<f{s
ze^1=(*dK1j$$M`I7M$n3^1i8|?%1yF$_pIa>Ua7u9$RsAv(AE3tJKy#5@eRP50-wm
zIjhIO?br&R*;kuP@;6w@ss7FV!M1H_`rnM@?|GAN?(1^3z0VxDfh%d(PyYfxyV7FA
zUoMi1A8k?Ho#y$Ljng3RxVpn^mfA^aQ!ixM7n~C5c1w0$#qY*@QsMHx$6?Nok{6V&
zRGn>>c`~T};-stJjtH)vwRl-b<rJy<vr<fZ#6Bn=U~tv!ICz#fV+*Lz^mO%eS?83{
F1OPat3zGl<

literal 0
HcmV?d00001

diff --git a/GnucashMobile/res/drawable-mdpi/action_settings_holo_light.png b/GnucashMobile/res/drawable-mdpi/action_settings_holo_light.png
new file mode 100644
index 0000000000000000000000000000000000000000..dc66d914e83151fd6c6e3a7cd5505c5634e8f1e7
GIT binary patch
literal 1358
zcmeAS@N?(olHy`uVBq!ia0vp^3LwnE1|*BCs=fdz$r9IylHmNblJdl&R0hYC{G?O`
z&)mfH)S%SFl*+=BsWuD@%qp275hW46K32*3xq68pHF_1f1wh>l3^w)^1&PVosU-?Y
zsp*+{wo31J?^jaDOtDo8H}y5}EpSfF$n>ZxN)4{^3rViZPPR-@vbR&PsjvbXkegbP
zs8ErclUHn2VXFi-*9yo63F|8<fR&VF+bTgE72zA8;GAESs$i;Tpqp%9W~g9hqGxDg
zU}<8hqhMrUXrOOsq;FuZYiM9)YHnp<r~m~@K--E^(yW49+@N*=dA3R!B_#z``ugSN
z<$C4Ddih1^`i7R4mih)p`bI{&Koz>hm3bwJ6}oxF$}kgLQj3#|G7CyF^YauyCMG83
zmzLNn0bL65LT&-v*t}wBFaZNhzap_f-%!s0<RzFwUtj!6b93RUi%Wu15$?rmaB)aw
zL8^XGYH@yPQ8F;%(v(3~6<9eJr6!i-7lq{K=fFZSAS1sdzc?emK*2fKRL@YsH!(Rg
z4<rKC;p=PVnO9trn3tUD>0+w{G(#^lGsVip(89^o)Xdb>$-u?X(ACh=#L&{!#L3yw
z&D7A`#K{n**Cju>G&eP`1g19yq1OzjUQlAlEdbi=l3J8mmYU*Ll%J~r_Ow+dZnqfY
zG!Lpb1-DyFaO%|uIz}H9wMbD769T3m5EGtofgE_!Pt60S_ab1zPEq=|fq{YXfTxRN
zNX4x;)AxEYI|>|sU-VI1d<)0Eh6QuQq*xA~`o2M6%a=%zH7*Bl-8y&3?cn+uN-Iqs
zNJmHrnI5b7$NulorZ<yrSKMPQeBfR-J<-_O+SvNJd*G8)O-udclXn{SSZPi_ZGTsv
zg<Iyj<LM<KD?`q(sVGDz%zPZZVe&K46ED*baA!0}26$a&@LWF6=zq`V{dKI}3A{ap
z%{v<ZaP=K*-=ue}r#aW)<W@cl=Fr)UvAfn=H!v=GFTLkdkj=+)d)LaXnC!TOfhkq)
z!x8t)qYdjNCv-nPI>)(X{e%mPl*7M!_;;LRt|;O?Wbw0>xlFgJ{lT2a)z7^$1W!J-
zoOdC8UHhEZN{r>xzeF#%pW1(M?w{xbR{OZzEc2U!*B&@g!L_ED^LWWrlRXSuAJ*_@
zM*2q2Hhc2j_=f*#`3u=q2`ei0XEi)2YMvOMux`8VF4qk%U7kx9o?zS&wC<$ZY{S>B
zn;9qFpU(H!;mEDPSK++v>*QyIziN10T$8jy{8D(1#@_?wvMX-$NG#Njm7dhFf8xVd
z9WBP259=dr144ICW&G8+XWF{_g!lemm<wIrvrBn?W1i={cSqQ*-T(4_|F<}Mt3jWU
ZjUjYPR)Mv`jq9Ki&ePS;Wt~$(69A6*^F9Co

literal 0
HcmV?d00001

diff --git a/GnucashMobile/res/drawable-xhdpi/action_about_holo_light.png b/GnucashMobile/res/drawable-xhdpi/action_about_holo_light.png
new file mode 100644
index 0000000000000000000000000000000000000000..2641f142a4684cf149ac36e23417ad56cf021e61
GIT binary patch
literal 2257
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

literal 0
HcmV?d00001

diff --git a/GnucashMobile/res/drawable-xhdpi/action_settings_holo_light.png b/GnucashMobile/res/drawable-xhdpi/action_settings_holo_light.png
new file mode 100644
index 0000000000000000000000000000000000000000..04b65dc343df42d96636a5013dd8250582e7778b
GIT binary patch
literal 1671
zcmaJ?eM}Q~7`~SBEgK(3apE{ihX!fyu9S~f3Y4}$r|tMsaf(vf15Rk~=p9g)K+7}=
zE(&36iVI9IDqzr!4RB!SSVE#Wb$%==Dn-o{U8F;21cvU4!1l-3C3nBy`{sF`_cOVw
zBvpck+k0*R0C*@8WhwL-Ykysw=x-ZVaF0G#Q1Wyt70;%M)dm!hXz?r*ROr+>XbP&<
zmK2;vqX58xgQcZY>B<cv4X)#<?HHa>N6>5lh>9^1YE2$Wfmvt{rWdovd;8fSrWLa{
zhbdttAw_es#8LyATB=IZl;&xKT6Rn{7-baE0y>mZgGODxo)j6y>{(qAeYd+IHaH8R
z^2F@7Nu?{3Kq+oO!7v`o)xhBh7%t!;0$3;zhJbt+fgyws!4X^p7KKHKU<90d*mN|5
zHd~Y;i=T@{TVi%DMG+zhDlRVO6^HV0Lk@%pg+d7CLwr7$MsUdzJ*75s^<?0@f(#`!
z28^IETo2k6)meBUC1%r^zAZsVEXeA~xi--agN$kdLU^#fq<NrH`TtOzZUIeFDd<1>
z{--dRRzjdq3QFRI1`R#9>_B@cLL@byY6>@`;duUh7n5>v3MX@M0+gnP@eoj{)?j+O
zXO^K<iWGX1QtLISLMCR@8axcsiUbH88No*+VR5hwLF9-~fC%M+IH@E)42clLA@f`r
zt|`=^dTO4l{f8U3DA&FWI)aWYLk(CFs*N|`I&ijV5w>_Pk&EihakY!*B3zUU(aAve
z(f(`H^DcUS?AL|GrHzHvNA>i+8|cNxUc|Qp0CQ3ylcX7M|GxF-ol7O2&l)rSI9Tu7
zd|zS%2U9E0tR8Q4^lAb<SwAM&R<Ns=H^s_qPckIwS6sXUg)BBpdXvLy$toHQK4q44
z=ae3==nBnn98q`gZ5%t@+dkFaTD#?oszY3_+Lb;Q7R)Hv+I{Mqk@1hFCPgOF<o;rM
zWu|-0uVY%+R}csSz04lQp`#<irf$<lXl>>|xN|zN!6AMRcmL4D3TxSsGJrQTY<l0i
z&boROAl!)k9T=C9@$t*On%lPi=cd-K1V(+!(B)_6ZvK?HY#n2Jvqf&{OK2u;^#|-d
z(aGdkv(HDK=|?TusZ1W@+10|1!cLBJH}h4S0#IFCRlOuoULo~ia_$~`P-XgVG+g!J
zR9(<kt9xc^o6pbz-TKhMM-IET@g=WDesE>1V~rGTs{{P3&Ig#a-r%q*HU+WG)VL-t
znU3a+4R3tKr9STsxG=h9{nRSW)KI10CAZF)V_nI)tk15E`!;semA^^vjOlyr>eZ02
zXUEYX+3OqQ@~6qeC!9LFc9Lg!WtOEFRbSrZWzKHO_qx(vbF$UtdcGH--2oe-ziyrh
zv3`61`UmG*xp^Hx-)|giLr%f>+mGk8x%9a8I7fzO*YuRa>w8ZsEc?7e-d#F#HZu5)
zQ<P)h1FjYHuffe}q@wt-ORvDpwMO}aVW%epLeBj%y2jI&!7pOIT)Qvvw#vd2M%I^)
zY<j%g+7i2J=5_T$+u?y*{hE^_IR~r#mOZ@d@A`?O2U)#4@!DUNB(r)-jHH=6Cfx6R
zmAZ3{`D}D7QD$oLW9<+4beE}p%gm{<I}=l;lH?h~bw#wLzPw`1lN-)=mRCG=xEeHR
z>KIg}G}I>1#z5$Sr%>oE=1S9}0leyB()033V8^}*@53HG%y7A)q)OVJ>Thdki9N<5
z%3_bW+BW%n1~W>^fJ+mY#g#cY?QlWN+U%b>T>U2_xg0ikIo<SmQ^D6<uABI>W!F2I
g%tJsBm^B?}0d6>7PH=lv8EpSGDC8<xM_gv*-+cFa8UO$Q

literal 0
HcmV?d00001

diff --git a/GnucashMobile/res/values/strings.xml b/GnucashMobile/res/values/strings.xml
index ab2a1ec1..fd5acd07 100644
--- a/GnucashMobile/res/values/strings.xml
+++ b/GnucashMobile/res/values/strings.xml
@@ -75,6 +75,367 @@
     <string name="title_move_transactions">Move %1$d transactions</string>
     <string name="label_move_destination">Destination Account</string>
     <string name="permission_access_sdcard">Access SD Card</string>
-    <string name="title_share_ofx_with">Share OFX export with...</string>
-
+    <string name="title_share_ofx_with">Share OFX export with&#8230;</string>
+    <string name="pref_default_currency">default_currency</string>
+    <string name="toast_incompatible_currency">Cannot move transactions.\nThe destination account uses a different currency from origin account</string>
+    <string name="header_general_settings">General</string>
+    <string name="header_about_gnucash">About</string>
+    <string name="choose_currency">Choose default currency</string>
+    <string name="title_default_currency">Default currency</string>
+    <string name="summary_default_currency">Default currency to assign to new accounts</string>
+    <string-array name="currency_names">
+        <item>Afghani</item>
+		<item>Algerian Dinar</item>
+		<item>Argentine Peso</item>
+		<item>Armenian Dram</item>
+		<item>Aruban Florin</item>
+		<item>Australian Dollar</item>
+		<item>Azerbaijanian Manat</item>
+		<item>Bahamian Dollar</item>
+		<item>Bahraini Dinar</item>
+		<item>Baht</item>
+		<item>Balboa</item>
+		<item>Barbados Dollar</item>
+		<item>Belarussian Ruble</item>
+		<item>Belize Dollar</item>
+		<item>Bermudian Dollar</item>
+		<item>Bolivar Fuerte</item>
+		<item>Boliviano</item>
+		<item>Brazilian Real</item>
+		<item>Brunei Dollar</item>
+		<item>Bulgarian Lev</item>
+		<item>Burundi Franc</item>
+		<item>Canadian Dollar</item>
+		<item>Cape Verde Escudo</item>
+		<item>Cayman Islands Dollar</item>
+		<item>CFA Franc BCEAO</item>
+		<item>CFA Franc BEAC</item>
+		<item>CFP Franc</item>
+		<item>Chilean Peso</item>
+		<item>Testing currency</item>
+		<item>Colombian Peso</item>
+		<item>Comoro Franc</item>
+		<item>Congolese Franc</item>
+		<item>Convertible Mark</item>
+		<item>Cordoba Oro</item>
+		<item>Costa Rican Colon</item>
+		<item>Croatian Kuna</item>
+		<item>Cuban Peso</item>
+		<item>Czech Koruna</item>
+		<item>Dalasi</item>
+		<item>Danish Krone</item>
+		<item>Denar</item>
+		<item>Djibouti Franc</item>
+		<item>Dobra</item>
+		<item>Dominican Peso</item>
+		<item>Dong</item>
+		<item>East Caribbean Dollar</item>
+		<item>Egyptian Pound</item>
+		<item>El Salvador Colon</item>
+		<item>Ethiopian Birr</item>
+		<item>Euro</item>
+		<item>Falkland Islands Pound</item>
+		<item>Fiji Dollar</item>
+		<item>Forint</item>
+		<item>Ghana Cedi</item>
+		<item>Gibraltar Pound</item>
+		<item>Gold</item>
+		<item>Gourde</item>
+		<item>Guarani</item>
+		<item>Guinea Franc</item>
+		<item>Guyana Dollar</item>
+		<item>Hong Kong Dollar</item>
+		<item>Hryvnia</item>
+		<item>Iceland Krona</item>
+		<item>Indian Rupee</item>
+		<item>Iranian Rial</item>
+		<item>Iraqi Dinar</item>
+		<item>Jamaican Dollar</item>
+		<item>Jordanian Dinar</item>
+		<item>Kenyan Shilling</item>
+		<item>Kina</item>
+		<item>Kip</item>
+		<item>Kuwaiti Dinar</item>
+		<item>Kwacha</item>
+		<item>Kwanza</item>
+		<item>Kyat</item>
+		<item>Lari</item>
+		<item>Latvian Lats</item>
+		<item>Lebanese Pound</item>
+		<item>Lek</item>
+		<item>Lempira</item>
+		<item>Leone</item>
+		<item>Liberian Dollar</item>
+		<item>Libyan Dinar</item>
+		<item>Lilangeni</item>
+		<item>Lithuanian Litas</item>
+		<item>Loti</item>
+		<item>Malagasy Ariary</item>
+		<item>Malaysian Ringgit</item>
+		<item>Mauritius Rupee</item>
+		<item>Mexican Peso</item>
+		<item>Mexican Unidad de Inversion (UDI)</item>
+		<item>Moldovan Leu</item>
+		<item>Moroccan Dirham</item>
+		<item>Mozambique Metical</item>
+		<item>Mvdol</item>
+		<item>Naira</item>
+		<item>Nakfa</item>
+		<item>Namibia Dollar</item>
+		<item>Nepalese Rupee</item>
+		<item>Netherlands Antillean Guilder</item>
+		<item>New Israeli Sheqel</item>
+		<item>New Romanian Leu</item>
+		<item>New Taiwan Dollar</item>
+		<item>New Zealand Dollar</item>
+		<item>Ngultrum</item>
+		<item>North Korean Won</item>
+		<item>Norwegian Krone</item>
+		<item>Nuevo Sol</item>
+		<item>Ouguiya</item>
+		<item>Paanga</item>
+		<item>Pakistan Rupee</item>
+		<item>Palladium</item>
+		<item>Pataca</item>
+		<item>Peso Convertible</item>
+		<item>Peso Uruguayo</item>
+		<item>Philippine Peso</item>
+		<item>Platinum</item>
+		<item>Pound Sterling</item>
+		<item>Pula</item>
+		<item>Qatari Rial</item>
+		<item>Quetzal</item>
+		<item>Rand</item>
+		<item>Rial Omani</item>
+		<item>Riel</item>
+		<item>Rufiyaa</item>
+		<item>Rupiah</item>
+		<item>Russian Ruble</item>
+		<item>Rwanda Franc</item>
+		<item>Saint Helena Pound</item>
+		<item>Saudi Riyal</item>
+		<item>SDR (Special Drawing Right)</item>
+		<item>Serbian Dinar</item>
+		<item>Seychelles Rupee</item>
+		<item>Silver</item>
+		<item>Singapore Dollar</item>
+		<item>Solomon Islands Dollar</item>
+		<item>Som</item>
+		<item>Somali Shilling</item>
+		<item>Somoni</item>
+		<item>South Sudanese Pound</item>
+		<item>Sri Lanka Rupee</item>
+		<item>Sucre</item>
+		<item>Sudanese Pound</item>
+		<item>Surinam Dollar</item>
+		<item>Swedish Krona</item>
+		<item>Swiss Franc</item>
+		<item>Syrian Pound</item>
+		<item>Taka</item>
+		<item>Tala</item>
+		<item>Tanzanian Shilling</item>
+		<item>Tenge</item>
+		<item>No currency</item>
+		<item>Trinidad and Tobago Dollar</item>
+		<item>Tugrik</item>
+		<item>Tunisian Dinar</item>
+		<item>Turkish Lira</item>
+		<item>Turkmenistan New Manat</item>
+		<item>UAE Dirham</item>
+		<item>Uganda Shilling</item>
+		<item>UIC-Franc</item>
+		<item>Unidad de Valor Real</item>
+		<item>Unidades de fomento</item>
+		<item>Uruguay Peso en Unidades Indexadas (URUIURUI)</item>
+		<item>US Dollar</item>
+		<item>Uzbekistan Sum</item>
+		<item>Vatu</item>
+		<item>WIR Euro</item>
+		<item>WIR Franc</item>
+		<item>Won</item>
+		<item>Yemeni Rial</item>
+		<item>Yen</item>
+		<item>Yuan Renminbi</item>
+		<item>Zambian Kwacha</item>
+		<item>Zimbabwe Dollar</item>
+		<item>Zloty</item>
+    </string-array>
+    
+	<string-array name="currency_codes">
+        <item>AFN</item>
+		<item>DZD</item>
+		<item>ARS</item>
+		<item>AMD</item>
+		<item>AWG</item>
+		<item>AUD</item>
+		<item>AZN</item>
+		<item>BSD</item>
+		<item>BHD</item>
+		<item>THB</item>
+		<item>PAB</item>
+		<item>BBD</item>
+		<item>BYR</item>
+		<item>BZD</item>
+		<item>BMD</item>
+		<item>VEF</item>
+		<item>BOB</item>
+		<item>BRL</item>
+		<item>BND</item>
+		<item>BGN</item>
+		<item>BIF</item>
+		<item>CAD</item>
+		<item>CVE</item>
+		<item>KYD</item>
+		<item>XOF</item>
+		<item>XAF</item>
+		<item>XPF</item>
+		<item>CLP</item>
+		<item>XTS</item>
+		<item>COP</item>
+		<item>KMF</item>
+		<item>CDF</item>
+		<item>BAM</item>
+		<item>NIO</item>
+		<item>CRC</item>
+		<item>HRK</item>
+		<item>CUP</item>
+		<item>CZK</item>
+		<item>GMD</item>
+		<item>DKK</item>
+		<item>MKD</item>
+		<item>DJF</item>
+		<item>STD</item>
+		<item>DOP</item>
+		<item>VND</item>
+		<item>XCD</item>
+		<item>EGP</item>
+		<item>SVC</item>
+		<item>ETB</item>
+		<item>EUR</item>
+		<item>FKP</item>
+		<item>FJD</item>
+		<item>HUF</item>
+		<item>GHS</item>
+		<item>GIP</item>
+		<item>XAU</item>
+		<item>HTG</item>
+		<item>PYG</item>
+		<item>GNF</item>
+		<item>GYD</item>
+		<item>HKD</item>
+		<item>UAH</item>
+		<item>ISK</item>
+		<item>INR</item>
+		<item>IRR</item>
+		<item>IQD</item>
+		<item>JMD</item>
+		<item>JOD</item>
+		<item>KES</item>
+		<item>PGK</item>
+		<item>LAK</item>
+		<item>KWD</item>
+		<item>MWK</item>
+		<item>AOA</item>
+		<item>MMK</item>
+		<item>GEL</item>
+		<item>LVL</item>
+		<item>LBP</item>
+		<item>ALL</item>
+		<item>HNL</item>
+		<item>SLL</item>
+		<item>LRD</item>
+		<item>LYD</item>
+		<item>SZL</item>
+		<item>LTL</item>
+		<item>LSL</item>
+		<item>MGA</item>
+		<item>MYR</item>
+		<item>MUR</item>
+		<item>MXN</item>
+		<item>MXV</item>
+		<item>MDL</item>
+		<item>MAD</item>
+		<item>MZN</item>
+		<item>BOV</item>
+		<item>NGN</item>
+		<item>ERN</item>
+		<item>NAD</item>
+		<item>NPR</item>
+		<item>ANG</item>
+		<item>ILS</item>
+		<item>RON</item>
+		<item>TWD</item>
+		<item>NZD</item>
+		<item>BTN</item>
+		<item>KPW</item>
+		<item>NOK</item>
+		<item>PEN</item>
+		<item>MRO</item>
+		<item>TOP</item>
+		<item>PKR</item>
+		<item>XPD</item>
+		<item>MOP</item>
+		<item>CUC</item>
+		<item>UYU</item>
+		<item>PHP</item>
+		<item>XPT</item>
+		<item>GBP</item>
+		<item>BWP</item>
+		<item>QAR</item>
+		<item>GTQ</item>
+		<item>ZAR</item>
+		<item>OMR</item>
+		<item>KHR</item>
+		<item>MVR</item>
+		<item>IDR</item>
+		<item>RUB</item>
+		<item>RWF</item>
+		<item>SHP</item>
+		<item>SAR</item>
+		<item>XDR</item>
+		<item>RSD</item>
+		<item>SCR</item>
+		<item>XAG</item>
+		<item>SGD</item>
+		<item>SBD</item>
+		<item>KGS</item>
+		<item>SOS</item>
+		<item>TJS</item>
+		<item>SSP</item>
+		<item>LKR</item>
+		<item>XSU</item>
+		<item>SDG</item>
+		<item>SRD</item>
+		<item>SEK</item>
+		<item>CHF</item>
+		<item>SYP</item>
+		<item>BDT</item>
+		<item>WST</item>
+		<item>TZS</item>
+		<item>KZT</item>
+		<item>XXX</item>
+		<item>TTD</item>
+		<item>MNT</item>
+		<item>TND</item>
+		<item>TRY</item>
+		<item>TMT</item>
+		<item>AED</item>
+		<item>UGX</item>
+		<item>XFU</item>
+		<item>COU</item>
+		<item>CLF</item>
+		<item>UYI</item>
+		<item>USD</item>
+		<item>UZS</item>
+		<item>VUV</item>
+		<item>CHE</item>
+		<item>CHW</item>
+		<item>KRW</item>
+		<item>YER</item>
+		<item>JPY</item>
+		<item>CNY</item>
+		<item>ZMK</item>
+		<item>ZWL</item>
+		<item>PLN</item>
+    </string-array>   	
 </resources>
\ No newline at end of file
diff --git a/GnucashMobile/res/xml/fragment_about_preferences.xml b/GnucashMobile/res/xml/fragment_about_preferences.xml
new file mode 100644
index 00000000..2d9b9e6e
--- /dev/null
+++ b/GnucashMobile/res/xml/fragment_about_preferences.xml
@@ -0,0 +1,5 @@
+<?xml version="1.0" encoding="utf-8"?>
+<PreferenceScreen xmlns:android="http://schemas.android.com/apk/res/android" >
+    
+
+</PreferenceScreen>
\ No newline at end of file
diff --git a/GnucashMobile/res/xml/fragment_general_preferences.xml b/GnucashMobile/res/xml/fragment_general_preferences.xml
new file mode 100644
index 00000000..fe093b75
--- /dev/null
+++ b/GnucashMobile/res/xml/fragment_general_preferences.xml
@@ -0,0 +1,6 @@
+<?xml version="1.0" encoding="utf-8"?>
+<PreferenceScreen xmlns:android="http://schemas.android.com/apk/res/android" >
+    <ListPreference android:summary="@string/summary_default_currency" android:key="@string/pref_default_currency" android:dialogTitle="@string/choose_currency" android:title="@string/title_default_currency" android:entries="@array/currency_names" android:entryValues="@array/currency_codes"/>
+    
+
+</PreferenceScreen>
\ No newline at end of file
diff --git a/GnucashMobile/res/xml/preference_headers.xml b/GnucashMobile/res/xml/preference_headers.xml
new file mode 100644
index 00000000..ea710f94
--- /dev/null
+++ b/GnucashMobile/res/xml/preference_headers.xml
@@ -0,0 +1,9 @@
+<?xml version="1.0" encoding="utf-8"?>
+<preference-headers xmlns:android="http://schemas.android.com/apk/res/android">
+    <header android:fragment="org.gnucash.android.ui.settings.SettingsActivity$GeneralPreferenceFragment"
+        android:icon="@drawable/action_settings_holo_light"
+        android:title="@string/header_general_settings" />
+    <header android:fragment="org.gnucash.android.ui.settings.SettingsActivity$AboutPreferenceFragment"
+        android:icon="@drawable/action_about_holo_light"
+        android:title="@string/header_about_gnucash" />
+</preference-headers>
\ No newline at end of file
diff --git a/GnucashMobile/src/org/gnucash/android/data/Account.java b/GnucashMobile/src/org/gnucash/android/data/Account.java
index edcdc5d5..1aa12f63 100644
--- a/GnucashMobile/src/org/gnucash/android/data/Account.java
+++ b/GnucashMobile/src/org/gnucash/android/data/Account.java
@@ -31,6 +31,7 @@
 import java.util.Locale;
 import java.util.UUID;
 
+import org.gnucash.android.ui.MainActivity;
 import org.w3c.dom.Document;
 import org.w3c.dom.Element;
 
@@ -73,7 +74,7 @@
 	public Account(String name) {
 		setName(name);
 		this.mUID = generateUID();
-		this.mCurrency = Currency.getInstance(Locale.getDefault());
+		this.mCurrency = Currency.getInstance(MainActivity.DEFAULT_CURRENCY_CODE);
 	}
 
 	public Account(String name, Currency currency){
diff --git a/GnucashMobile/src/org/gnucash/android/data/Money.java b/GnucashMobile/src/org/gnucash/android/data/Money.java
index 783c9725..de9c709b 100644
--- a/GnucashMobile/src/org/gnucash/android/data/Money.java
+++ b/GnucashMobile/src/org/gnucash/android/data/Money.java
@@ -33,6 +33,8 @@
 import java.util.Currency;
 import java.util.Locale;
 
+import org.gnucash.android.ui.MainActivity;
+
 import android.util.Log;
 
 /**
@@ -87,7 +89,7 @@ public Money(double amount){
 	}
 	
 	private void init(){
-		mCurrency = Currency.getInstance(Locale.getDefault());
+		mCurrency = Currency.getInstance(MainActivity.DEFAULT_CURRENCY_CODE);
 		mAmount = new BigDecimal(0).setScale(DEFAULT_DECIMAL_PLACES, DEFAULT_ROUNDING_MODE);
 	}
 
diff --git a/GnucashMobile/src/org/gnucash/android/db/CurrencyDbAdapter.java b/GnucashMobile/src/org/gnucash/android/db/CurrencyDbAdapter.java
deleted file mode 100644
index b98ee524..00000000
--- a/GnucashMobile/src/org/gnucash/android/db/CurrencyDbAdapter.java
+++ /dev/null
@@ -1,62 +0,0 @@
-/*
- * Written By: Ngewi Fet <ngewif@gmail.com>
- * Copyright (c) 2012 Ngewi Fet
- *
- * This file is part of Gnucash for Android
- * 
- * Gnucash for Android is free software; you can redistribute it and/or
- * modify it under the terms of the GNU General Public License as
- * published by the Free Software Foundation; either version 2 of
- * the License, or (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; if not, contact:
- *
- * Free Software Foundation           Voice:  +1-617-542-5942
- * 51 Franklin Street, Fifth Floor    Fax:    +1-617-542-2652
- * Boston, MA  02110-1301,  USA       gnu@gnu.org
- */
-
-package org.gnucash.android.db;
-
-import java.util.Currency;
-import java.util.Locale;
-
-import android.content.Context;
-import android.database.Cursor;
-import android.util.Log;
-
-public class CurrencyDbAdapter extends DatabaseAdapter {
-
-	public CurrencyDbAdapter(Context context) {
-		super(context);
-	}
-
-	public Currency getCurrency(long id){
-		Log.v(TAG, "Fetching currency with id " + id);
-		Currency cur = Currency.getInstance(Locale.getDefault()); 
-		Cursor c =	fetchRecord(DatabaseHelper.CURRENCIES_TABLE_NAME, id);
-		if (c != null && c.moveToFirst()){
-			cur = Currency.getInstance(c.getString(DatabaseAdapter.COLUMN_CURRENCY_CODE));	
-			c.close();
-		}
-		return cur;
-	}
-		
-	public long getCurrencyId(String currencyCode){
-		Cursor c =	mDb.query(DatabaseHelper.CURRENCIES_TABLE_NAME, null, 
-				DatabaseHelper.KEY_CURRENCY_CODE + "='" + currencyCode + "'", 
-				null, null, null, null);
-		long id = -1;
-		if (c != null && c.moveToFirst()){
-			id = c.getLong(DatabaseAdapter.COLUMN_ROW_ID);
-			c.close();
-		}
-		return id;
-	}
-}
diff --git a/GnucashMobile/src/org/gnucash/android/db/DatabaseHelper.java b/GnucashMobile/src/org/gnucash/android/db/DatabaseHelper.java
index d52c169f..30ab48b5 100644
--- a/GnucashMobile/src/org/gnucash/android/db/DatabaseHelper.java
+++ b/GnucashMobile/src/org/gnucash/android/db/DatabaseHelper.java
@@ -24,10 +24,6 @@
 
 package org.gnucash.android.db;
 
-import java.util.LinkedHashMap;
-import java.util.Map;
-
-import android.content.ContentValues;
 import android.content.Context;
 import android.database.sqlite.SQLiteDatabase;
 import android.database.sqlite.SQLiteOpenHelper;
@@ -58,58 +54,7 @@
 	
 	//if you modify the order of the columns, 
 	//make sure to modify the indices in DatabaseAdapter
-	
-	public static final LinkedHashMap<String, String> TOP_CURRENCIES_MAP = new LinkedHashMap<String, String>() {
-
-		/**
-		 * 
-		 */
-		private static final long serialVersionUID = -80009596835057456L;
 
-		{
-			//the big guys
-			put("USD", "US Dollar");
-			put("EUR", "Euro");
-			put("GBP", "British Pound");
-			put("CHF", "Swiss Franc");
-			
-			//the rest alphabetically
-			put("AUD", "Australian Dollar");
-			put("BRL", "Brazilian Real");
-			put("XAF", "Central African CFA franc");
-			put("CAD", "Canadian Dollar");
-			put("CLP", "Chilean Peso");
-			put("CNY", "Chinese Yuan");
-			put("CZK", "Czech Koruna");
-			put("DKK", "Danish Krone");
-			put("FJD", "Fijian Dollar");
-			put("HNL", "Honduran Lempira");
-			put("HKD", "Hong Kong Dollar");
-			put("HUF", "Hungarian Forint");
-			put("ISK", "Iceland Krona");
-			put("INR", "Indian rupee");
-			put("IDR", "Indonesian Rupiah");
-			put("ILS", "Israeli New Shekel");
-			put("JPY", "Japanese Yen");
-			put("KRW", "Korean Won");
-			put("LVL", "Latvian Lats");
-			put("MYR", "Malaysian Ringgit");
-			put("MXN", "Mexican Peso");
-			put("NZD", "New Zealand Dollar");
-			put("NOK", "Norwegian Krone");
-			put("PKR", "Pakistan Rupee");
-			put("PHP", "Philippine Peso");
-			put("PLN", "Polish Zloty");
-			put("RUB", "Russion Ruble");
-			put("SGD", "Singapore Dollar");
-			put("ZAR", "South African Rand");
-			put("SEK", "Swedish Krona");
-			put("TWD", "New Taiwan Dollar");
-			put("THB", "Thai Baht");
-			put("TRY", "Turkish Lira");
-		}
-	};
-	
 	private static final String ACCOUNTS_TABLE_CREATE = "create table " + ACCOUNTS_TABLE_NAME + " ("
 			+ KEY_ROW_ID + " integer primary key autoincrement, "
 			+ KEY_UID 	+ " varchar(255) not null, "
@@ -129,12 +74,7 @@
 			+ KEY_EXPORTED 		+ " tinyint default 0, "
 			+ "FOREIGN KEY (" + KEY_ACCOUNT_UID + ") REFERENCES " + ACCOUNTS_TABLE_NAME + " (" + KEY_UID + ")"
 			+ ");";
-	
-	private static final String CURRENCIES_TABLE_CREATE = "create table " + CURRENCIES_TABLE_NAME + "("
-			+ KEY_ROW_ID + " integer primary key autoincrement, " 			
-			+ KEY_CURRENCY_CODE 	+ " varchar(255) not null, "
-			+ KEY_NAME 	+ " varchar(255) not null);";
-	
+
 	public DatabaseHelper(Context context){
 		super(context, DATABASE_NAME, null, DATABASE_VERSION);		
 	}
@@ -144,8 +84,6 @@ public void onCreate(SQLiteDatabase db) {
 		Log.i(TAG, "Creating gnucash database tables");
 		db.execSQL(ACCOUNTS_TABLE_CREATE);
 		db.execSQL(TRANSACTIONS_TABLE_CREATE);
-		db.execSQL(CURRENCIES_TABLE_CREATE);
-		populateCurrencies(db);
 	}
 
 	@Override
@@ -173,13 +111,4 @@ public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {
 		}
 	}
 
-	private void populateCurrencies(SQLiteDatabase db){
-		for (Map.Entry<String, String> entry : TOP_CURRENCIES_MAP.entrySet()) {
-			ContentValues cv = new ContentValues();
-			cv.put(KEY_CURRENCY_CODE, entry.getKey());
-			cv.put(KEY_NAME, entry.getValue());
-			
-			db.insert(CURRENCIES_TABLE_NAME, null, cv);
-		}
-	}
 }
diff --git a/GnucashMobile/src/org/gnucash/android/ui/MainActivity.java b/GnucashMobile/src/org/gnucash/android/ui/MainActivity.java
index b1d7bef4..8c9ab6a9 100644
--- a/GnucashMobile/src/org/gnucash/android/ui/MainActivity.java
+++ b/GnucashMobile/src/org/gnucash/android/ui/MainActivity.java
@@ -24,12 +24,17 @@
 
 package org.gnucash.android.ui;
 
+import java.util.Currency;
+import java.util.Locale;
+
 import org.gnucash.android.R;
 import org.gnucash.android.ui.accounts.AccountsListFragment;
 import org.gnucash.android.ui.transactions.NewTransactionFragment;
 import org.gnucash.android.ui.transactions.TransactionsListFragment;
 import org.gnucash.android.util.OnItemClickedListener;
 
+import android.content.Intent;
+import android.content.SharedPreferences;
 import android.os.Bundle;
 import android.support.v4.app.FragmentManager;
 import android.support.v4.app.FragmentTransaction;
@@ -39,6 +44,7 @@
 import com.actionbarsherlock.app.SherlockFragmentActivity;
 import com.actionbarsherlock.view.Menu;
 import com.actionbarsherlock.view.MenuInflater;
+import com.actionbarsherlock.view.MenuItem;
 
 /**
  * Displays the list of accounts and summary of transactions
@@ -51,7 +57,8 @@
 	public static final String FRAGMENT_ACCOUNTS_LIST 		= "accounts_list";
 	public static final String FRAGMENT_TRANSACTIONS_LIST 	= "transactions_list";
 	public static final String FRAGMENT_NEW_TRANSACTION 	= "new_transaction";
-	
+
+	public static String DEFAULT_CURRENCY_CODE;
 	static final int DIALOG_ADD_ACCOUNT = 0x01;
 
 	protected static final String TAG = "MainActivity";	
@@ -61,6 +68,10 @@ public void onCreate(Bundle savedInstanceState) {
 		super.onCreate(savedInstanceState);
 		setContentView(R.layout.activity_accounts);
 
+		SharedPreferences prefs = getPreferences(MODE_PRIVATE);
+		String currencyCode = prefs.getString(getString(R.string.pref_default_currency), Currency.getInstance(Locale.getDefault()).getCurrencyCode());
+		DEFAULT_CURRENCY_CODE = currencyCode;		
+		
 		FragmentManager fragmentManager = getSupportFragmentManager();
 
 		AccountsListFragment accountsListFragment = (AccountsListFragment) fragmentManager
@@ -82,7 +93,28 @@ public boolean onCreateOptionsMenu(Menu menu) {
 		inflater.inflate(R.menu.global_actions, menu);
 		return true;
 	}
+	
+	@Override
+	public boolean onOptionsItemSelected(MenuItem item) {
+		switch (item.getItemId()) {
+		case android.R.id.home:
+	        FragmentManager fm = getSupportFragmentManager();
+	        if (fm.getBackStackEntryCount() > 0) {
+	            fm.popBackStack();
+	        }
+	        return true;
+
+		default:
+			return false;
+		}
+	}
 
+	@Override
+	protected void onActivityResult(int arg0, int arg1, Intent arg2) {
+		// TODO Auto-generated method stub
+		super.onActivityResult(arg0, arg1, arg2);
+	}
+	
 	/**
 	 * Opens a dialog fragment to create a new account
 	 * @param v View which triggered this callback
diff --git a/GnucashMobile/src/org/gnucash/android/ui/accounts/AccountsListFragment.java b/GnucashMobile/src/org/gnucash/android/ui/accounts/AccountsListFragment.java
index bb2e3d58..289f67b7 100644
--- a/GnucashMobile/src/org/gnucash/android/ui/accounts/AccountsListFragment.java
+++ b/GnucashMobile/src/org/gnucash/android/ui/accounts/AccountsListFragment.java
@@ -34,6 +34,7 @@
 import org.gnucash.android.db.DatabaseCursorLoader;
 import org.gnucash.android.db.DatabaseHelper;
 import org.gnucash.android.db.TransactionsDbAdapter;
+import org.gnucash.android.ui.settings.SettingsActivity;
 import org.gnucash.android.ui.transactions.TransactionsListFragment;
 import org.gnucash.android.util.OnItemClickedListener;
 
@@ -42,6 +43,7 @@
 import android.app.Dialog;
 import android.content.Context;
 import android.content.DialogInterface;
+import android.content.Intent;
 import android.database.Cursor;
 import android.os.Bundle;
 import android.support.v4.app.DialogFragment;
@@ -203,7 +205,8 @@ public void onActivityCreated(Bundle savedInstanceState) {
 		
 		ListView lv = getListView();
 		lv.setOnItemLongClickListener(this);	
-		getLoaderManager().initLoader(0, null, this);		
+		getLoaderManager().initLoader(0, null, this);
+		
 	}
 	
 	@Override
@@ -315,6 +318,10 @@ public boolean onOptionsItemSelected(MenuItem item) {
 			showExportDialog();
 			return true;
 			
+		case R.id.menu_settings:
+			startActivity(new Intent(getActivity(), SettingsActivity.class));
+			return true;
+			
 		default:
 			return false;
 		}
diff --git a/GnucashMobile/src/org/gnucash/android/ui/accounts/NewAccountDialogFragment.java b/GnucashMobile/src/org/gnucash/android/ui/accounts/NewAccountDialogFragment.java
index 338f3003..da56cd50 100644
--- a/GnucashMobile/src/org/gnucash/android/ui/accounts/NewAccountDialogFragment.java
+++ b/GnucashMobile/src/org/gnucash/android/ui/accounts/NewAccountDialogFragment.java
@@ -24,25 +24,25 @@
 
 package org.gnucash.android.ui.accounts;
 
+import java.util.Arrays;
 import java.util.Currency;
-import java.util.Locale;
+import java.util.List;
 
 import org.gnucash.android.R;
 import org.gnucash.android.data.Account;
 import org.gnucash.android.db.AccountsDbAdapter;
-import org.gnucash.android.db.CurrencyDbAdapter;
-import org.gnucash.android.db.DatabaseHelper;
+import org.gnucash.android.ui.MainActivity;
 import org.gnucash.android.ui.transactions.TransactionsListFragment;
 
-import android.database.Cursor;
 import android.os.Bundle;
-import android.support.v4.widget.SimpleCursorAdapter;
+import android.preference.PreferenceManager;
 import android.text.Editable;
 import android.text.TextWatcher;
 import android.view.LayoutInflater;
 import android.view.View;
 import android.view.ViewGroup;
 import android.view.WindowManager.LayoutParams;
+import android.widget.ArrayAdapter;
 import android.widget.Button;
 import android.widget.EditText;
 import android.widget.Spinner;
@@ -56,7 +56,7 @@
 	private Spinner mCurrencySpinner;
 	
 	private AccountsDbAdapter mDbAdapter;
-	private SimpleCursorAdapter mCursorAdapter;
+	private List<String> mCurrencyCodes;
 	
 	private long mSelectedId = 0;
 	private Account mAccount = null;
@@ -101,19 +101,18 @@ public View onCreateView(LayoutInflater inflater, ViewGroup container,
 		
 		mSaveButton.setOnClickListener(new View.OnClickListener() {
 			
+
 			@Override
 			public void onClick(View v) {
 				if (mAccount == null)
 					mAccount = new Account(getEnteredName());
 				else
 					mAccount.setName(getEnteredName());
-				
-				//set the currency
-				CurrencyDbAdapter currencyAdapter = new CurrencyDbAdapter(getActivity());
-				Currency currency = currencyAdapter.getCurrency(mCurrencySpinner.getSelectedItemId());
-				mAccount.setCurrency(currency);
+								
+				String curCode = mCurrencyCodes.get(mCurrencySpinner.getSelectedItemPosition());
+				mAccount.setCurrency(Currency.getInstance(curCode));
 				mDbAdapter.addAccount(mAccount);
-				currencyAdapter.close();
+				
 				((AccountsListFragment)getTargetFragment()).refreshList();				
 				dismiss();				
 			}
@@ -132,26 +131,22 @@ public void onClick(View v) {
 	@Override
 	public void onActivityCreated(Bundle savedInstanceState) {
 		super.onActivityCreated(savedInstanceState);
-		Cursor c = mDbAdapter.fetchAllRecords(DatabaseHelper.CURRENCIES_TABLE_NAME);
-		String[] from = new String[] {DatabaseHelper.KEY_NAME};
-		int[] to = new int[] {android.R.id.text1};
-		mCursorAdapter = new SimpleCursorAdapter(
-				getActivity(), 
-				android.R.layout.simple_spinner_item, 
-				c, from, to, 0);
 		
-		mCursorAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
-		mCurrencySpinner.setAdapter(mCursorAdapter);
+		ArrayAdapter<String> arrayAdapter = new ArrayAdapter<String>(getActivity(), android.R.layout.simple_spinner_item, getResources().getStringArray(R.array.currency_names));
 		
-		String currencyCode = Currency.getInstance(Locale.getDefault()).getCurrencyCode();
+		arrayAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
+		mCurrencySpinner.setAdapter(arrayAdapter);
+		
+		String currencyCode = PreferenceManager.getDefaultSharedPreferences(getActivity()).getString(getString(R.string.pref_default_currency), MainActivity.DEFAULT_CURRENCY_CODE);
 		if (mSelectedId != 0){
+			//if we are editing an account instead of creating one
 			currencyCode = mAccount.getCurrency().getCurrencyCode();
 		}
-		CurrencyDbAdapter currencyDbAdapter = new CurrencyDbAdapter(getActivity());
-		long id = currencyDbAdapter.getCurrencyId(currencyCode);
-		//db IDs are 1-based but list positions are 0-based
-		mCurrencySpinner.setSelection((int)id - 1);	
-		currencyDbAdapter.close();
+		mCurrencyCodes = Arrays.asList(getResources().getStringArray(R.array.currency_codes));
+		
+		if (mCurrencyCodes.contains(currencyCode)){
+			mCurrencySpinner.setSelection(mCurrencyCodes.indexOf(currencyCode));
+		}		
 	}
 	
 	public String getEnteredName(){
diff --git a/GnucashMobile/src/org/gnucash/android/ui/settings/SettingsActivity.java b/GnucashMobile/src/org/gnucash/android/ui/settings/SettingsActivity.java
new file mode 100644
index 00000000..b2f6265c
--- /dev/null
+++ b/GnucashMobile/src/org/gnucash/android/ui/settings/SettingsActivity.java
@@ -0,0 +1,76 @@
+package org.gnucash.android.ui.settings;
+
+import java.util.List;
+
+import org.gnucash.android.R;
+
+import android.os.Build;
+import android.os.Bundle;
+import android.preference.PreferenceFragment;
+
+import com.actionbarsherlock.app.ActionBar;
+import com.actionbarsherlock.app.SherlockPreferenceActivity;
+import com.actionbarsherlock.view.MenuItem;
+
+public class SettingsActivity extends SherlockPreferenceActivity{
+
+	@Override
+	public void onBuildHeaders(List<Header> target) {
+		loadHeadersFromResource(R.xml.preference_headers, target);
+	}
+	
+	@SuppressWarnings("deprecation")
+	@Override
+	protected void onCreate(Bundle savedInstanceState) {		
+		super.onCreate(savedInstanceState);
+		
+		getSupportActionBar().setHomeButtonEnabled(true);
+		getSupportActionBar().setDisplayHomeAsUpEnabled(true);
+		
+		if (Build.VERSION.SDK_INT < Build.VERSION_CODES.HONEYCOMB){
+			addPreferencesFromResource(R.xml.fragment_general_preferences);
+			addPreferencesFromResource(R.xml.fragment_about_preferences);
+		}
+	}
+		
+	@Override
+	public boolean onOptionsItemSelected(MenuItem item) {
+		switch (item.getItemId()) {
+		case android.R.id.home:
+	        android.app.FragmentManager fm = getFragmentManager();
+	        if (fm.getBackStackEntryCount() > 0) {
+	            fm.popBackStack();
+	        } else {
+	        	finish();
+	        }
+	        return true;
+
+		default:
+			return false;
+		}
+	}
+	
+	public static class GeneralPreferenceFragment extends PreferenceFragment{
+		
+		@Override
+		public void onCreate(Bundle savedInstanceState) {
+			super.onCreate(savedInstanceState);
+			addPreferencesFromResource(R.xml.fragment_general_preferences);
+			ActionBar actionBar = ((SherlockPreferenceActivity) getActivity()).getSupportActionBar();
+			actionBar.setHomeButtonEnabled(true);
+			actionBar.setDisplayHomeAsUpEnabled(true);
+		}		
+	}
+	
+	public static class AboutPreferenceFragment extends PreferenceFragment{
+		
+		@Override
+		public void onCreate(Bundle savedInstanceState) {
+			super.onCreate(savedInstanceState);
+			addPreferencesFromResource(R.xml.fragment_about_preferences);
+			ActionBar actionBar = ((SherlockPreferenceActivity) getActivity()).getSupportActionBar();
+			actionBar.setHomeButtonEnabled(true);
+			actionBar.setDisplayHomeAsUpEnabled(true);
+		}		
+	}
+}
diff --git a/GnucashMobile/src/org/gnucash/android/ui/transactions/BulkMoveDialogFragment.java b/GnucashMobile/src/org/gnucash/android/ui/transactions/BulkMoveDialogFragment.java
index 928fffff..2fb812c4 100644
--- a/GnucashMobile/src/org/gnucash/android/ui/transactions/BulkMoveDialogFragment.java
+++ b/GnucashMobile/src/org/gnucash/android/ui/transactions/BulkMoveDialogFragment.java
@@ -41,6 +41,7 @@
 import android.view.WindowManager.LayoutParams;
 import android.widget.Button;
 import android.widget.Spinner;
+import android.widget.Toast;
 
 public class BulkMoveDialogFragment extends DialogFragment {
 
@@ -49,6 +50,7 @@
 	Button mCancelButton; 
 	
 	long[] mTransactionIds = null;
+	long mOriginAccountId = -1;
 	private AccountsDbAdapter mAccountsDbAdapter;
 	
 	@Override
@@ -68,6 +70,7 @@ public void onActivityCreated(Bundle savedInstanceState) {
 		getDialog().getWindow().setLayout(LayoutParams.MATCH_PARENT, LayoutParams.WRAP_CONTENT);
 		
 		mTransactionIds = getArguments().getLongArray(TransactionsListFragment.SELECTED_TRANSACTION_IDS);
+		mOriginAccountId = getArguments().getLong(TransactionsListFragment.ORIGIN_ACCOUNT_ID);
 		
 		String title = getActivity().getString(R.string.title_move_transactions, 
 				mTransactionIds.length);
@@ -106,10 +109,15 @@ public void onClick(View v) {
 					dismiss();
 				}
 				
-				long accountId = mDestinationAccountSpinner.getSelectedItemId();
+				long dstAccountId = mDestinationAccountSpinner.getSelectedItemId();
 				TransactionsDbAdapter trxnAdapter = new TransactionsDbAdapter(getActivity());
+				if (!trxnAdapter.getCurrencyCode(dstAccountId).equals(trxnAdapter.getCurrencyCode(mOriginAccountId))){
+					Toast.makeText(getActivity(), R.string.toast_incompatible_currency, Toast.LENGTH_LONG).show();
+					return;
+				}
+				
 				for (long trxnId : mTransactionIds) {
-					trxnAdapter.moveTranscation(trxnId, accountId);
+					trxnAdapter.moveTranscation(trxnId, dstAccountId);
 				}
 				trxnAdapter.close();
 				
diff --git a/GnucashMobile/src/org/gnucash/android/ui/transactions/NewTransactionFragment.java b/GnucashMobile/src/org/gnucash/android/ui/transactions/NewTransactionFragment.java
index beed632c..bfca9f79 100644
--- a/GnucashMobile/src/org/gnucash/android/ui/transactions/NewTransactionFragment.java
+++ b/GnucashMobile/src/org/gnucash/android/ui/transactions/NewTransactionFragment.java
@@ -34,7 +34,6 @@
 import java.util.Currency;
 import java.util.Date;
 import java.util.GregorianCalendar;
-import java.util.Locale;
 
 import org.gnucash.android.R;
 import org.gnucash.android.data.Account;
@@ -45,6 +44,7 @@
 import org.gnucash.android.db.DatabaseHelper;
 import org.gnucash.android.db.TransactionsDbAdapter;
 import org.gnucash.android.ui.DatePickerDialogFragment;
+import org.gnucash.android.ui.MainActivity;
 import org.gnucash.android.ui.TimePickerDialogFragment;
 
 import android.app.DatePickerDialog.OnDateSetListener;
@@ -202,7 +202,7 @@ private void initalizeViews() {
 		
 		String code;
 		if (accountId == 0)
-			code = Currency.getInstance(Locale.getDefault()).getCurrencyCode();
+			code = MainActivity.DEFAULT_CURRENCY_CODE;
 		else
 			code = mTransactionsDbAdapter.getCurrencyCode(accountId);
 		
diff --git a/GnucashMobile/src/org/gnucash/android/ui/transactions/TransactionsListFragment.java b/GnucashMobile/src/org/gnucash/android/ui/transactions/TransactionsListFragment.java
index 10e6af8c..cb22374b 100644
--- a/GnucashMobile/src/org/gnucash/android/ui/transactions/TransactionsListFragment.java
+++ b/GnucashMobile/src/org/gnucash/android/ui/transactions/TransactionsListFragment.java
@@ -73,6 +73,8 @@
 	public static final String SELECTED_ACCOUNT_NAME = "selected_account_name";
 	
 	public static final String SELECTED_TRANSACTION_IDS = "selected_transactions";
+
+	public static final String ORIGIN_ACCOUNT_ID = "origin_acccount_id";
 	
 	private TransactionsDbAdapter mTransactionsDbAdapter;
 	private SimpleCursorAdapter mCursorAdapter;
@@ -330,6 +332,7 @@ protected void showBulkMoveDialog(){
 	    // Create and show the dialog.
 	    DialogFragment bulkMoveFragment = new BulkMoveDialogFragment();
 	    Bundle args = new Bundle();
+	    args.putLong(ORIGIN_ACCOUNT_ID, mAccountID);
 	    long[] selectedIds = new long[mSelectedIds.size()]; 
 	    int i = 0;
 	    for (long l : mSelectedIds.values()) {
diff --git a/GnucashMobile/src/org/gnucash/android/util/OfxFormatter.java b/GnucashMobile/src/org/gnucash/android/util/OfxFormatter.java
index 8772a61a..3599a62c 100644
--- a/GnucashMobile/src/org/gnucash/android/util/OfxFormatter.java
+++ b/GnucashMobile/src/org/gnucash/android/util/OfxFormatter.java
@@ -26,7 +26,6 @@
 
 import java.text.SimpleDateFormat;
 import java.util.Calendar;
-import java.util.Currency;
 import java.util.Date;
 import java.util.List;
 import java.util.Locale;
@@ -120,7 +119,7 @@ public void toXml(Document doc, Element parent){
 				continue; 
 			
 			Element currency = doc.createElement("CURDEF");
-			currency.appendChild(doc.createTextNode(Currency.getInstance(Locale.getDefault()).getCurrencyCode()));						
+			currency.appendChild(doc.createTextNode(account.getCurrency().getCurrencyCode()));						
 			
 			//================= BEGIN BANK ACCOUNT INFO (BANKACCTFROM) =================================
 			
diff --git a/GnucashMobileTest/src/org/gnucash/android/test/TransactionsFragmentTest.java b/GnucashMobileTest/src/org/gnucash/android/test/TransactionsFragmentTest.java
index c30d94dc..13b86d2c 100644
--- a/GnucashMobileTest/src/org/gnucash/android/test/TransactionsFragmentTest.java
+++ b/GnucashMobileTest/src/org/gnucash/android/test/TransactionsFragmentTest.java
@@ -92,11 +92,11 @@ private int getTranscationCount(){
 	private void validateNewTransactionFields(){
 		long timeMillis = System.currentTimeMillis();
 		String expectedValue = NewTransactionFragment.DATE_FORMATTER.format(new Date(timeMillis));
-		String actualValue = mSolo.getText(5).getText().toString();
+		String actualValue = mSolo.getText(6).getText().toString();
 		assertEquals(expectedValue, actualValue);
 		
 		expectedValue = NewTransactionFragment.TIME_FORMATTER.format(new Date(timeMillis));
-		actualValue = mSolo.getText(6).getText().toString();
+		actualValue = mSolo.getText(7).getText().toString();
 		assertEquals(expectedValue, actualValue);
 		Spinner spinner = mSolo.getCurrentSpinners().get(0);
 		
@@ -123,7 +123,7 @@ public void testAddTransaction(){
 		mSolo.enterText(1, "899");
 		//check that the amount is correctly converted in the input field
 		String actualValue = mSolo.getEditText(1).getText().toString();
-		assertEquals(" - $8.99", actualValue);
+		assertEquals(new Money("-8.99").toPlainString(), actualValue);
 		
 		int transactionsCount = getTranscationCount();
 		
